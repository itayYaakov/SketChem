!function(){var e;"object"==typeof self?e=self:"object"==typeof window&&window&&window.document?e=window:"object"==typeof global&&(e=global),e.__$kekule_single_min_bundle__=!0}(),function(e){e||("object"==typeof self?e=self:"object"==typeof window&&window&&window.document?e=window:"object"==typeof global&&(e=global)),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){t||(t=0);var r=this.length;for(t<0&&(t=r+t);t<r;t++)if(this[t]===e)return t;return-1});var t=e.document;t||"undefined"!=typeof window&&(t=window.document);var r="undefined"!=typeof navigator&&"undefined"!=typeof window&&void 0!==t,n="object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node,o=n,i="function"==typeof __webpack_require__,a="undefined"!=typeof exports;if("function"!=typeof __webpack_require__&&o){var s={};try{var l=require("vm"),u=require("fs")}catch(e){}}if(!o)t&&t.readyState,window.attachEvent&&window.opera;o&&"undefined"!=typeof global&&(e=global);var c=[];function d(e,t,r){if(c.indexOf(t)>=0)r&&r(null);else{if(o){var n=function(e){if(o)try{var t=u.readFileSync(e,"utf8");return l.runInThisContext(t,{filename:e}),!0}catch(e){return e}}(t);return r&&r(!0===n?null:n),n}try{var i=e.createElement("script");return i.src=t,i.onerror=function(e){r&&r(new Error("Loading script file "+t+" failed"))},i.onload=i.onreadystatechange=function(e){if(!i._loaded){var n=i.readyState;void 0!==n&&"loaded"!==n&&"complete"!==n||(i._loaded=!0,i.onload=i.onreadystatechange=null,c.push(t),r&&r(null))}},(e.getElementsByTagName("head")[0]||e.body).appendChild(i),i}catch(e){r&&r(e)}}}function h(e,t,r){!function e(t,r,n,o){if(r.length<=0)return void(n&&(o.length?n(new Error(o.join(", "))):n(null)));var i=r.shift();d(t,i,function(i){i&&o.push(i?i.message||i:""),e(t,r,n,o)})}(e,[].concat(t),r,[])}function f(e,r,n){if(o)h(t,e,function(e){(this.Kekule||s.Kekule)._loaded(),n&&n(e)});else if(function(){if(o)return!0;var e=t&&t.readyState,r=window.attachEvent&&!window.opera;return"complete"===e||"loaded"===e||"interactive"===e&&!r}()||r)h(t,e,function(e){e||Kekule._loaded(),n&&n(e)});else try{for(var i=0,a=e.length;i<a;++i)l=t,u=e[i],l.write('<script type="text/javascript" src="'+u+'"><\/script>');t.write('<script type="text/javascript">if (this.Kekule) Kekule._loaded();<\/script>'),n&&n(null)}catch(e){n(e)}var l,u}var m={lan:{files:["lan/classes.js","lan/xmlJsons.js","lan/serializations.js"],category:"lan",minFile:"root.min.js"},root:{files:["core/kekule.root.js"],category:"root",minFile:"root.min.js"},localization:{requires:["lan","root"],files:["localization/kekule.localizations.js"],category:"localization",minFile:"localization.min.js"},localizationData:{requires:["localization"],files:["localization/en/kekule.localize.general.en.js","localization/en/kekule.localize.widget.en.js","localization/en/kekule.localize.objDefines.en.js"],category:"localization",minFile:"localization.min.js"},"localizationData.zh":{requires:["localization"],files:["localization/zh/kekule.localize.general.zh.js","localization/zh/kekule.localize.widget.zh.js"],category:"localizationData.zh",autoCompress:!1},common:{requires:["lan","root","localization"],files:["core/kekule.common.js","core/kekule.exceptions.js","utils/kekule.utils.js","utils/kekule.domHelper.js","utils/kekule.domUtils.js","core/kekule.externalResMgr.js","core/kekule.metrics.js"],category:"common",minFile:"common.min.js"},core:{requires:["lan","root","common","data"],files:["core/kekule.configs.js","core/kekule.elements.js","core/kekule.electrons.js","core/kekule.valences.js","core/kekule.structures.js","core/kekule.structureBuilder.js","core/kekule.reactions.js","core/kekule.chemUtils.js","chemdoc/kekule.glyph.base.js","chemdoc/kekule.glyph.utils.js","chemdoc/kekule.glyph.pathGlyphs.js","chemdoc/kekule.glyph.lines.js","chemdoc/kekule.glyph.chemGlyphs.js","chemdoc/kekule.contentBlocks.js","chemdoc/kekule.attachedMarkers.js","chemdoc/kekule.commonChemMarkers.js"],category:"core"},html:{requires:["lan","root","common"],files:["xbrowsers/kekule.x.js","html/kekule.nativeServices.js","html/kekule.predefinedResLoaders.js","utils/kekule.htmlDomUtils.js"],category:"core"},io:{requires:["lan","root","common","core"],files:["utils/kekule.textHelper.js","io/kekule.io.js","io/cml/kekule.io.cml.js","io/mdl/kekule.io.mdlBase.js","io/mdl/kekule.io.mdl2000.js","io/mdl/kekule.io.mdl3000.js","io/mdl/kekule.io.mdlIO.js","io/smiles/kekule.io.smiles.js","io/native/kekule.io.native.js"],category:"io"},render:{requires:["lan","root","common","core","html"],files:["render/kekule.render.extensions.js","render/kekule.render.base.js","render/kekule.render.renderColorData.js","render/kekule.render.utils.js","render/kekule.render.configs.js","render/kekule.render.baseTextRender.js","render/kekule.render.boundInfoRecorder.js","render/2d/kekule.render.renderer2D.js","render/2d/kekule.render.glyphRender2D.js","render/2d/kekule.render.canvasRenderer.js","render/2d/kekule.render.raphaelRenderer.js","render/3d/kekule.render.renderer3D.js","render/3d/kekule.render.threeRenderer.js","render/kekule.render.painter.js"],category:"render"},spectroscopy:{requires:["root","common","io"],files:["spectroscopy/kekule.spectrum.core.js","io/jcamp/kekule.io.jcamp.base.js","io/jcamp/kekule.io.jcamp.labels.js","io/jcamp/kekule.io.jcamp.dx.js","io/jcamp/kekule.io.jcamp.cs.js","io/jcamp/kekule.io.jcampIO.js","io/cmlspect/kekule.io.cmlspect.js","spectroscopy/kekule.spectrum.render.js"]},widget:{requires:["lan","root","common","html"],files:["lib/hammer.js/hammer.min.js","widgets/operation/kekule.operations.js","widgets/operation/kekule.actions.js","widgets/kekule.widget.root.js","widgets/kekule.widget.bindings.js","widgets/kekule.widget.events.js","widgets/kekule.widget.base.js","widgets/kekule.widget.sys.js","widgets/kekule.widget.keys.js","widgets/kekule.widget.clipboards.js","widgets/kekule.widget.helpers.js","widgets/kekule.widget.styleResources.js","widgets/kekule.widget.autoLaunchers.js","widgets/transitions/kekule.widget.transitions.js","widgets/transitions/kekule.widget.transMgr.js","widgets/commonCtrls/kekule.widget.resizers.js","widgets/commonCtrls/kekule.widget.movers.js","widgets/commonCtrls/kekule.widget.images.js","widgets/commonCtrls/kekule.widget.containers.js","widgets/commonCtrls/kekule.widget.menus.js","widgets/commonCtrls/kekule.widget.buttons.js","widgets/commonCtrls/kekule.widget.formControls.js","widgets/commonCtrls/kekule.widget.nestedContainers.js","widgets/commonCtrls/kekule.widget.treeViews.js","widgets/commonCtrls/kekule.widget.listViews.js","widgets/commonCtrls/kekule.widget.dialogs.js","widgets/commonCtrls/kekule.widget.msgPanels.js","widgets/commonCtrls/kekule.widget.tabViews.js","widgets/advCtrls/kekule.widget.valueListEditors.js","widgets/advCtrls/kekule.widget.colorPickers.js","widgets/advCtrls/kekule.widget.textEditors.js","widgets/advCtrls/kekule.widget.widgetGrids.js","widgets/advCtrls/objInspector/kekule.widget.objInspectors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.propEditors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.operations.js","widgets/advCtrls/kekule.widget.configurators.js","widgets/advCtrls/grids/kekule.widget.dataSets.js","widgets/advCtrls/grids/kekule.widget.dataGrids.js","widgets/sys/kekule.widget.sysMsgs.js","widgets/operation/kekule.operHistoryTreeViews.js"],category:"widget"},chemWidget:{requires:["lan","root","common","core","html","io","render","algorithm","widget"],files:["widgets/chem/kekule.chemWidget.base.js","widgets/chem/kekule.chemWidget.dialogs.js","widgets/chem/periodicTable/kekule.chemWidget.periodicTables.js","widgets/chem/kekule.chemWidget.chemObjDisplayers.js","widgets/chem/structureTreeView/kekule.chemWidget.structureTreeViews.js","widgets/chem/uiMarker/kekule.chemWidget.uiMarkers.js","widgets/chem/viewer/kekule.chemWidget.viewers.js","widgets/chem/viewer/kekule.chemWidget.spectrumViewers.js","widgets/chem/viewer/kekule.chemWidget.spectrumInspectors.js","widgets/chem/viewer/kekule.chemWidget.viewerGrids.js","widgets/chem/viewer/kekule.chemWidget.chemObjInserters.js","widgets/chem/editor/kekule.chemEditor.extensions.js","widgets/chem/editor/kekule.chemEditor.baseEditors.js","widgets/chem/editor/kekule.chemEditor.operations.js","widgets/chem/editor/kekule.chemEditor.editorUtils.js","widgets/chem/editor/kekule.chemEditor.configs.js","widgets/chem/editor/kekule.chemEditor.repositoryData.js","widgets/chem/editor/kekule.chemEditor.repositories.js","widgets/chem/editor/kekule.chemEditor.utilWidgets.js","widgets/chem/editor/kekule.chemEditor.chemSpaceEditors.js","widgets/chem/editor/kekule.chemEditor.nexus.js","widgets/chem/editor/kekule.chemEditor.actions.js","widgets/chem/editor/kekule.chemEditor.trackParser.js","widgets/chem/editor/kekule.chemEditor.objModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.styleModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.textModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.structureModifiers.js","widgets/chem/editor/modifiers/kekule.chemEditor.glyphModifiers.js","chemdoc/issueCheckers/kekule.issueCheckers.js","widgets/chem/editor/issueInspectors/kekule.chemEditor.issueCheckers.js","widgets/chem/editor/issueInspectors/kekule.chemEditor.issueInspectors.js","widgets/advCtrls/objInspector/kekule.widget.objInspector.chemPropEditors.js","widgets/chem/editor/kekule.chemEditor.composers.js"],category:"chemWidget"},webComponent:{requires:["lan","root","common","core","html","io","render","algorithm","widget","chemWidget"],files:["webComponents/kekule.webComponent.base.js","webComponents/kekule.webComponent.widgetWrappers.js"]},algorithm:{requires:["lan","root","common","core"],files:["algorithm/kekule.graph.js","algorithm/kekule.structures.helpers.js","algorithm/kekule.structures.canonicalizers.js","algorithm/kekule.structures.ringSearches.js","algorithm/kekule.structures.aromatics.js","algorithm/kekule.structures.standardizers.js","algorithm/kekule.structures.searches.js","algorithm/kekule.structures.stereos.js"],category:"algorithm"},calculation:{requires:["lan","root","common","core","algorithm"],files:["calculation/kekule.calc.base.js"]},data:{requires:["root"],files:["data/kekule.chemicalElementsData.js","data/kekule.isotopesData.organSet.js","data/kekule.structGenAtomTypesData.js","data/kekule.dataUtils.js"]},emscripten:{requires:["root","common"],files:["_extras/kekule.emscriptenUtils.js"],category:"extra"},openbabel:{requires:["lan","root","core","emscripten","io"],files:["localization/en/kekule.localize.extras.openbabel.en.js","_extras/OpenBabel/kekule.openbabel.base.js","_extras/OpenBabel/kekule.openbabel.io.js","_extras/OpenBabel/kekule.openbabel.structures.js"],category:"extra"},indigo:{requires:["lan","root","core","emscripten","io"],files:["_extras/Indigo/kekule.indigo.base.js","_extras/Indigo/kekule.indigo.io.js","_extras/Indigo/kekule.indigo.structures.js"],category:"extra"},inchi:{requires:["lan","root","core","emscripten","io"],files:["_extras/InChI/kekule.inchi.js"],category:"extra"}},g=["lan","root","localization","localizationData","common"],p=g.concat(["core","html","io","spectroscopy","render","widget","chemWidget","algorithm","calculation","data"]),C=(p.concat(["emscripten","inchi","openbabel","indigo"]),g.concat(["core","io","spectroscopy","algorithm","calculation","data"])),O=[];function k(e){var t=e||p;t=g.concat(t);for(var r=[],n=function(e,t){if(e.indexOf(t)<0){var r=m[t];if(r&&r.requires)for(var o=0,i=r.requires.length;o<i;++o){var a=r.requires[o];n(e,a)}e.push(t)}},o=0,i=t.length;o<i;++o){var a=t[o];n(r,a)}return r}function S(e,t,r,n,o){void 0!==Kekule&&Kekule.LOADED&&(Kekule.LOADED=!1);for(var i=n.modules||[],a=[],s=0,l=e.length;s<l;++s)i.indexOf(e[s])<0&&a.push(e[s]);var u=function(e,t){for(var r=k(e),n=[],o=0,i=r.length;o<i;++o){var a=r[o],s=m[a];if(s&&s.files)if(t){var l=s.minFile||a+".min.js";n.indexOf(l)<0&&n.push(l)}else n=n.concat(s.files)}return n}(a,t),c=[],d=r,h=n.fileUrls||[],g=[];for(s=0,l=u.length;s<l;++s){var p=d+u[s];h.indexOf(p)<0&&(g.push(p),c.push(u[s]))}return g.push(d+"kekule.loaded.js"),f(g,null,function(e){n.modules=n.modules.concat(a),n.files=n.files.concat(c),n.fileUrls=n.fileUrls.concat(g),o&&o(e)}),{modules:a,files:c,fileUrls:g}}i?module.exports=require("./kekule.webpack.prod.js"):function(){var i;if(r){var l=(i=function(e){var t,r=/^(.*\/?)kekule(.min)?\.js(\?.*)?$/,n=/^domloader\=(.+)$/,o=/^min\=(.+)$/,i=/^modules\=(.+)$/,s=/^locals\=(.+)$/,l=/^language\=(.+)$/;if(!a)if(e&&e.currentScript&&e.currentScript.src)(d=decodeURIComponent(e.currentScript.src))&&(t=d.match(/^(.*[\/\\])([^\/\\]*)\.js(\?.*)?$/));else for(var u=e.getElementsByTagName("script"),c=u.length-1;c>=0;--c){var d,h=u[c];if((d=decodeURIComponent(h.src))&&(t=d.match(r)))break}if(t){t[2];var f=t[3];f&&(f=f.substr(1));var m={src:d,path:t[1],paramStr:f,useMinFile:!0};if(m.paramStr){for(var g=m.paramStr.split("&"),C=0,k=g.length;C<k;++C){var S=g[C].match(o);if(S){var b=S[1].toLowerCase(),T=["false","no","f","n"].indexOf(b)<0;m.useMinFile=T}else{var E=g[C].match(i);if(E)var I=E[1].split(",");else{var A=g[C].match(n);if(A)b=A[1].toLowerCase(),T=["false","no","f","n"].indexOf(b)<0,m.forceDomLoader=T;else{var _=g[C].match(s);if(_){var N=_[1].split(",");m.locals=N}else{var y=g[C].match(l);y&&(b=y[1],m.language=b)}}}}}if(m.modules=I||p,m.locals||(m.locals=O),m.locals||m.language){var v=[].concat(m.locals||[]);if(m.language&&v.indexOf(m.language)<0&&v.push(m.language),v.length){var M=m.modules.indexOf("localizationData");for(M<0&&(M=-1),C=0,k=v.length;C<k;++C){var K=v[C];"en"!==K&&m.modules.splice(M+1,0,"localizationData."+K)}}}}return m}return{src:"",path:"",modules:p,useMinFile:!0}}(t)).src&&i.path;l&&(o=!1),!l&&n&&(i.src=this.__filename||"",i.path=(__dirname||".")+"/",o=!0)}else o&&(i={src:this.__filename||"",path:__dirname+"/",modules:r?p:C,useMinFile:!0,nodeModule:(module,module),nodeRequire:(require,require)});if(o){var c=i.path+m.root.minFile,f=!1;try{f=u.existsSync(c)}catch(e){f=!1}f||(i.useMinFile=!1)}i.singleMinBundle=e&&e.__$kekule_single_min_bundle__,i.explicitModules=i.modules;var g=k(i.modules);i.modules=[],i.files=[],i.fileUrls=[],i.allModuleStructures=m,e.__$kekule_load_info__=i,e.__$kekule_scriptfile_utils__={appendScriptFile:d,appendScriptFiles:h,loadModuleScriptFiles:S},i.singleMinBundle&&void 0!==i.singleMinBundle||S(g,i.useMinFile,i.path,i,function(e){"undefined"!=typeof exports&&(exports.Kekule=this.Kekule||s.Kekule,exports.Class=this.Class||s.Class,exports.ClassEx=this.ClassEx||s.ClassEx,exports.ObjectEx=this.ObjectEx||s.ObjectEx,exports.DataType=this.DataType||s.DataType,this.Class=exports.Class,this.ClassEx=exports.ClassEx,this.ObjectEx=exports.ObjectEx,this.DataType=exports.DataType,this.Kekule.scriptSrcInfo=i)})}()}(this),function(e){function t(){}function r(e){if(!e)return[];if(e.toArray)return e.toArray();for(var t=e.length||0,r=new Array(t);t--;)r[t]=e[t];return r}"object"==typeof self?e=self:"object"==typeof window&&window.document?e=window:"object"==typeof global&&(e=global);var n={createCore:function(){var e=null,o=r(arguments),i=o.length>1?o[1]:o[0],a=i&&i.CLASS_NAME;if(!o[0]&&o.length>1)throw"Can not create new class"+(a?" "+a:"")+" , base class not found";function s(){this.initialize.apply(this,arguments)}if(Object.isFunction(o[0])&&(e=o.shift()),Object.extend(s,n.Methods),s.superclass=e,s.subclasses=[],e){var l=function(){};l.prototype=e.prototype,s.prototype=new l,e.subclasses.push(s)}for(var u=0;u<o.length;u++)s.addMethods(o[u]);return s.prototype.initialize||(s.prototype.initialize=t),s.prototype.constructor=s,a&&(n._named_classes[a]=s),s},create:function(){return n.createCore.apply(this,arguments)},free:function(e){e.finalize&&e.finalize(),e=null},findClass:function(e,t){var r=n._named_classes[e];if(!r){var o=Object.getCascadeFieldValue(e,t);r=o&&Object.isFunction(o)&&(o.superclass||o.subclasses)?o:null}return r},_named_classes:{}};n.Methods={addMethods:function(e){if(!e)return this;var t=this.superclass&&this.superclass.prototype,r=Object.keys(e);Object.keys({toString:!0}).length||r.push("toString","valueOf");for(var n=function(){},i=0,a=r.length;i<a;i++){var s=r[i],l=e[s],u=Object.isFunction(l);if(t&&u&&"$super"===o.argumentNames(l)[0]){var c=l;(l=function(e){return function(){return(t[e]||n).apply(this,arguments)}}(s).wrap(c)).valueOf=c.valueOf.bind(c),l.toString=c.toString.bind(c)}this.prototype[s]=l}return this}},Object.extend=function(e,t,r,n){if(r||n)for(var o in t){var i=t[o];r&&null==i||(n&&""===i||(e[o]=i))}else for(var o in t)e[o]=t[o];return e},Object.extendEx=function(e,t,r){var n=r||{};for(var o in t){var i=t[o];if((!n.ignoreUnsetValue||null!=i)&&(!n.ignoreEmptyString||""!==i)){var a=e[o];if(!r.preserveExisted||!a){var s=a&&a.constructor&&a.constructor.prototype,l=i&&i.constructor&&i.constructor.prototype;a&&"object"==typeof a&&s===l?Object.extendEx(a,i,r):e[o]=i}}}return e},Object._extendSupportMethods=function(e,t){return Object.extendEx(e,t,{ignoreUnsetValue:!0,preserveExisted:!0})},Object.getCascadeFieldValue=function(t,r){var n,o;if(o=t.length&&t.splice?t:t.split("."),!r)r=e||this;for(var i=0,a=o.length;i<a&&(n=r[o[i]]);++i)r=n;return n},Object.setCascadeFieldValue=function(e,t,r,n){for(var o,i=r,a=0,s=(o=e.length&&e.splice?e:e.split(".")).length;a<s;++a){var l=o[a];if(a===s-1)return i[l]=t,t;var u=i[l];if(!u&&n&&(u={},i[l]=u),!u)return!1;i=u}},Object._inherit=function(e){null===e&&(e={});var t=typeof e;if(!a.isFunctionType(t)&&!a.isObjectType(t))throw TypeError();function r(){}return r.prototype=e,new r},Object.create||(Object.create=Object._inherit),Object.copyValues=function(e,t,r){if(r){for(var n=0,o=r.length;n<o;++n){var i=r[n],a=t[i];void 0!==a&&(e[i]=a)}return e}return Object.extend(e,t)},Object._extendSupportMethods(Object,{keys:function(e){var t=[];for(var r in e)t.push(r);return t},isFunction:function(e){return"function"==typeof e},isUndefined:function(e){return void 0===e}}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t});var o={argumentNames:function(e){var t=((e.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)||[])[1]||"").replace(/\s+/g,"").split(",");return 1!=t.length||t[0]?t:[]}};Object._extendSupportMethods(Function.prototype,{argumentNames:function(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return 1!=e.length||e[0]?e:[]},wrap:function(e){var t=this;return function(){return e.apply(this,[t.bind(this)].concat(r(arguments)))}},methodize:function(){if(this._methodized)return this._methodized;var e=this;return this._methodized=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),e.apply(null,t)}},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var e=this,t=r(arguments),n=t.shift();return function(){return e.apply(n,t.concat(r(arguments)))}},delay:function(){var t=this,n=r(arguments),o=n.shift();return e.setTimeout(function(){return t.apply(t,n)},o)},defer:function(){var t=this,n=r(arguments);n.shift();return e.setTimeout(function(){return t.apply(t,n)},10)}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){t||(t=0);var r=this.length;for(t<0&&(t=r+t);t<r;t++)if(this[t]===e)return t;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e,t){t=isNaN(t)?this.length:(t<0?this.length+t:t)+1;var r=this.slice(0,t).reverse().indexOf(e);return r<0?r:t-r-1}),Array.prototype.map&&(Array.prototype.map=function(e){var t,r,n;if(null==this)throw new TypeError("this is null or not defined");var o=Object(this),i=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),r=new Array(i),n=0;n<i;){var a,s;n in o&&(a=o[n],s=e.call(t,a,n,o),r[n]=s),n++}return r}),Object._extendSupportMethods(String.prototype,{gsub:function(e,t){for(var r="",n=this;n.length>0;)void 0===n.match(e)?(r+=n.slice(0,(void 0).index),r+=t,n=n.slice((void 0).index+(void 0)[0].length)):(r+=n,n="");return r},sub:function(e,t,r){return r=Object.isUndefined(r)?1:r,this.gsub(e,function(e){return--r<0?e[0]:t(e)})},scan:function(e,t){return this.gsub(e,t),String(this)},truncate:function(e,t){return e=e||30,t=Object.isUndefined(t)?"...":t,this.length>e?this.slice(0,e-t.length)+t:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var e=new RegExp(Prototype.ScriptFragment,"img"),t=new RegExp(Prototype.ScriptFragment,"im");return(this.match(e)||[]).map(function(e){return(e.match(t)||["",""])[1]})},escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />")},unescapeHTML:function(){return this.replace(/\<br \/\>/g,"\n").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},toQueryParams:function(e){var t=this.strip().match(/([^?#]*)(#.*)?$/);return t?t[1].split(e||"&").inject({},function(e,t){if((t=t.split("="))[0]){var r=decodeURIComponent(t.shift()),n=t.length>1?t.join("="):t[0];null!=n&&(n=decodeURIComponent(n)),r in e?(Object.isArray(e[r])||(e[r]=[e[r]]),e[r].push(n)):e[r]=n}return e}):{}},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(e){return e<1?"":new Array(e+1).join(this)},camelize:function(){var e=this.split("-"),t=e.length;if(1==t)return e[0];for(var r="-"==this.charAt(0)?e[0].charAt(0).toUpperCase()+e[0].substring(1):e[0],n=1;n<t;n++)r+=e[n].charAt(0).toUpperCase()+e[n].substring(1);return r},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},capitalizeFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1-$2").replace(/([a-z\d])([A-Z])/g,"$1-$2").replace(/-/g,"-").toLowerCase()},inspect:function(e){var t=this.gsub(/[\x00-\x1f\\]/,function(e){var t=String.specialChar[e[0]];return t||"\\u00"+e[0].charCodeAt().toPaddedString(2,16)});return e?'"'+t.replace(/"/g,'\\"')+'"':"'"+t.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(!0)},unfilterJSON:function(e){return this.sub(e||Prototype.JSONFilter,"#{1}")},isJSON:function(){var e=this;return!e.blank()&&(e=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""),/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(e))},include:function(e){return this.indexOf(e)>-1},startsWith:function(e){return 0===this.indexOf(e)},endsWith:function(e){var t=this.length-e.length;return t>=0&&this.lastIndexOf(e)===t},empty:function(){return""==this},blank:function(){return/^\s*$/.test(this)},interpolate:function(e,t){return new Template(this,t).evaluate(e)}}),Object._extendSupportMethods(String.prototype,{upperFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},format:function(){for(var e=this,t=0;t<arguments.length;t++){var r=new RegExp("\\{"+t+"\\}","gi");e=e.replace(r,arguments[t])}return e},trim:function(){return this.replace(/^\s*|\s*$/g,"")},ltrim:function(){return this.replace(/^\s+/,"")},rtrim:function(){return this.replace(/\s+$/,"")},trimLeft:function(){return this.ltrim()},trimRight:function(){return this.rtrim()},pad:function(e,t,r){for(var n=t||" ",o=[],i=0,a=e-this.length;i<a;++i)o.push(n);return r?this+o.join(""):o.join("")+this},lpad:function(e,t){return this.pad(e,t,!1)},rpad:function(e,t){return this.pad(e,t,!0)},reverse:function(){for(var e=[],t=this.length-1;t>=0;--t)e.push(this.charAt(t));return e.join("")},toCharArray:function(){for(var e=[],t=0,r=this.length;t<r;++t)e.push(this.charAt(t));return e},hyphenize:function(e){e||(e="-");for(var t=this.length,r=[],n=0;n<t;++n){var o=this.charAt(n);0!==n&&o>="A"&&o<="Z"?r.push(e+o.toLowerCase()):r.push(o)}return r.join("")}});var i={STRUE:"$TRUE",SFALSE:"$FALSE",SUNDEFINED:"$UNDEFINED",SNULL:"$NULL",SNAN:"$NAN",SPOSITIVE:"+",SNEGATIVE:"-",SDATEPREFIX:"@",isAllDigitalChar:function(e){for(var t=0,r=e.length;t<r;++t){var n=e.charAt(t);if(!(n>="0"&&n<="9")&&"."!=n)return!1}return!0},isNumbericStr:function(e){var t=Number(e);return!isNaN(t)},serializeValue:function(e,t){var r=t||[],n=a.getType(e);if(r.indexOf(n)>=0)return e.toString();if(null===e)return i.SNULL;if(void 0===e)return i.SUNDEFINED;if(e!=e)return i.SNAN;switch(n){case"boolean":return e?i.STRUE:i.SFALSE;case"number":case a.INT:case a.FLOAT:return(e>=0?i.SPOSITIVE:"")+e;case a.DATE:return i.SDATEPREFIX+e.toString();default:return e.toString()}},deserializeValue:function(e,t){if("string"!=typeof e)return e;switch(e){case i.STRUE:return!0;case i.SFALSE:return!1;case i.SNULL:return null;case i.SUNDEFINED:return;case i.SNAN:return NaN;default:if(t){if(!e&&[a.NUMBER,a.INT,a.FLOAT].indexOf(t)>=0)return;switch(t){case a.FLOAT:return parseFloat(e);case a.INT:return parseInt(e);case"number":return parseFloat(e);case"boolean":return!!e;default:return e}}else{switch(e.charAt(0)){case i.SPOSITIVE:case i.SNEGATIVE:var r=e.substring(1);return i.isNumbericStr(r)?parseFloat(e):e;case i.SDATEPREFIX:r=e.substr(1);try{var n=new Date(r);return isNaN(n.getTime())?e:n}catch(t){return e}default:return e}}}}};Object.extend(Date.prototype,{copyFrom:function(e){this.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),this.setTime(e.getTime())}}),Date.now||(Date.now=function(){return(new Date).getTime()}),Math.sqr||(Math.sqr=function(e){return e*e}),Math.sign||(Math.sign=function(e){return e>0?1:e<0?-1:0}),Math.log10||(Math.log10=function(e){return Math.log(e)*Math.LOG10E}),void 0===e.Node&&(e.Node=function(){}),e.Node.ELEMENT_NODE||Object.extend(e.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),n.PropertyScope={DEFAULT:3,PUBLISHED:3,PUBLIC:2,PRIVATE:1},n.PropList=function(){this.props=[]},n.PropList.prototype={addProperty:function(e,t){var r;return t||(t={}),(r=this.getPropInfo(e))||(r={},this.props.push(r)),void 0===(r=Object.extend(r,t)).serializable&&(r.serializable=!0),r.name=e,r},removeProperty:function(e){var t=this.indexOf(e);t>=0&&this.props.splice(t,1)},removePropAt:function(e){e>=0&&(this.props[e]&&this.props.splice(e,1))},getLength:function(){return this.props.length},indexOf:function(e){for(var t=0,r=this.props.length;t<r;++t)if(this.props[t].name===e)return t;return-1},getPropInfoAt:function(e){return e>=0?this.props[e]:null},getPropInfo:function(e){var t=this.indexOf(e);return this.getPropInfoAt(t)},hasProperty:function(e){return this.indexOf(e)>=0},clear:function(){this.props.clear()},clone:function(){var e=new n.PropList;return e.props=this.props.slice(),e},appendList:function(e){for(var t=0,r=e.props.length;t<r;++t)this.props.push(e.props[t])}},n.PropList.prototype.constructor=n.PropList,n.EventHandlerList=function(){this.handlers=[],this._$flag_="KekuleEventList"},n.EventHandlerList.prototype={add:function(e,t){t||(t=null),this.handlers.push({thisArg:t,handler:e})},remove:function(e,t){var r=this.indexesOf(e,t);if(r.length>0)for(var n=r.length-1;n>=0;--n)this.removeAt(r[n])},removeAt:function(e){for(var t=e,r=this.handlers.length;t<r;++t)this.handlers[t]=this.handlers[t+1];this.handlers.length=this.handlers.length-1},clear:function(){this.handlers=[]},getHandlerInfo:function(e){return this.handlers[e]},indexOf:function(e,t){for(var r=0,n=this.handlers.length;r<n;++r)if(this.handlers[r].handler==e){if(void 0!==t&&this.handlers[r].thisArg===t)return r;if(void 0===t)return r}return-1},indexesOf:function(e,t){for(var r=[],n=0,o=this.handlers.length;n<o;++n)this.handlers[n].handler==e&&(void 0!==t&&this.handlers[n].thisArg===t?r.push(n):void 0===t&&r.push(n));return r},getLength:function(){return this.handlers.length}},n.EventHandlerList.constructor=n.EventHandlerList;var a={UNKNOWN:null,VARIANT:null,PRIMARY:"primary",UNDEFINED:"undefined",BOOL:"boolean",BOOLEAN:"boolean",NUMBER:"number",INT:"int",INTEGER:"int",FLOAT:"float",STRING:"string",ARRAY:"array",FUNCTION:"function",DATE:"date",HASH:"object",OBJECT:"object",OBJECTEX:"objectex",CLASS:"class",isSimpleType:function(e){return e==a.STRING||e==a.NUMBER||e==a.INT||e==a.FLOAT||e==a.BOOL||e==a.UNDEFINED||e==a.PRIMARY},isComplexType:function(e){return!(a.isSimpleType(e)||a.isFunctionType(e))},isFunctionType:function(e){return e==a.FUNCTION},isObjectType:function(e){return e==a.OBJECT},isDateType:function(e){return e==a.DATE},isObjectExType:function(e){var t=a.isComplexType(e)&&!a.isObjectType(e)&&!a.isDateType(e);if(t){var r=l.findClass(e);t=r&&l.isOrIsDescendantOf(r,u)}return t},getType:function(e){var t=typeof e;switch(t){case"undefined":return a.UNDEFINED;case"function":return a.FUNCTION;case"boolean":return a.BOOL;case"string":return a.STRING;case"number":return Math.floor(e)==e?a.INT:a.FLOAT;case"object":return this.isDateValue(e)?a.DATE:a.isArrayValue(e)?a.ARRAY:l.isClass(e)?a.CLASS:a.isObjectExValue(e)&&e.getClassName?e.getClassName():a.OBJECT;default:return t}},isSimpleValue:function(e){return a.isSimpleType(typeof e)},isUndefinedValue:function(e){return void 0===e},isNullValue:function(e){return null===e},isFunctionValue:function(e){return"function"==typeof e},isObjectValue:function(e){return!!e&&("object"==typeof e&&!a.isArrayValue(e)&&!a.isDateValue(e))},isDateValue:function(e){return!!e&&("object"==typeof e&&void 0!==e.getFullYear)},isArrayValue:function(e){return!!e&&("object"==typeof e&&void 0!==e.length)},isObjectExValue:function(e){return e instanceof u},createInstance:function(e){switch(e){case a.UNDEFINED:return;case a.DATE:return new Date;case a.ARRAY:return new Array;case a.OBJECT:return new Object;case a.FUNCTION:return function(){};default:return new(l.findClass(e.capitalizeFirst()))}}},s=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}(),l={isClass:function(e){return!!e&&!(!e.superclass&&!e.subclasses)},findClass:function(t,r){return n.findClass(t,r||e)},getClassName:function(e){return e?e.prototype.CLASS_NAME:null},getClassLocalName:function(e){var t=l.getClassName(e),r=t.lastIndexOf(".");return r>=0?t.substring(r+1):t},getPrototype:function(e){return e.prototype},getSuperClass:function(e){return e.superclass||e.constructor.superclass},getSuperClassPrototype:function(e){return e.superclass?e.superclass.prototype:null},_getCommonSuperClass2:function(e,t){for(var r=e;r&&!l.isOrIsDescendantOf(t,r);)r=l.getSuperClass(r);return r},getCommonSuperClass:function(e){if(!e||!e.length)return null;var t=e[0].getClass?e[0].getClass():null;if(!t)return null;for(var r=1,n=e.length;r<n;++r){var o=e[r].getClass?e[r].getClass():null;if(!o)return null;t=l._getCommonSuperClass2(t,o)}return t},isDescendantOf:function(e,t){for(var r=l.getSuperClass(e);r&&r!==t;)r=l.getSuperClass(r);return!!r},isOrIsDescendantOf:function(e,t){return e===t||l.isDescendantOf(e,t)},isOrIsDescendantOfClasses:function(e,t){for(var r=0,n=t.length;r<n;++r)if(l.isOrIsDescendantOf(e,t[r]))return!0;return!1},_ensurePropertySystem:function(e){var t=l.getPrototype(e);if(t&&!t.hasOwnProperty("properties")){var r=l.getSuperClass(e);r&&l._ensurePropertySystem(r),l._createPropertyList(e),l._remapPropGetters(e),t.hasOwnProperty("initProperties")&&t.initProperties.apply(t)}},_createPropertyList:function(e){l.getPrototype(e).hasOwnProperty("properties")||(l.getPrototype(e).properties=new n.PropList)},_remapPropGetters:function(e,t){for(var r=l.getPrototype(e),n=t||Object.getOwnPropertyNames(r),o=0,i=n.length;o<i;++o){var a=n[o];if(a.length>5&&a.startsWith("doGet")){var u=r[a];if("function"==typeof u){var c=a.charAt(5).toLowerCase()+a.substr(6);if(r.hasDirectProperty(c))continue;var d=l.getPropInfo(e,c);if(d&&d.getter)if(r["get"+c.capitalizeFirst()]=u,s){var h=Object.extend({},d.descriptor);h.get=u;try{Object.defineProperty(r,c,h)}catch(e){throw e}}}}}},getOwnPropList:function(e){var t=l.getPrototype(e);return t?(t._initPropertySystem(),t.properties):null},getAllPropList:function(e){var t,r=l.getSuperClassPrototype(e);return r?(t=r.getAllPropList().clone()).appendList(l.getOwnPropList(e)):t=l.getOwnPropList(e),t},getPropListOfScopes:function(e,t){var r,o=function(e,t){var r=l.getOwnPropList(e).clone();if(r)for(var o=r.getLength()-1;o>=0;--o){var i=r.getPropInfoAt(o).scope||n.PropertyScope.DEFAULT;t.indexOf(i)<0&&r.removePropAt(o)}return r},i=l.getSuperClass(e);return i?(r=l.getPropListOfScopes(i,t).clone()).appendList(o(e,t)):r=o(e,t),r},defineProp:function(e,t,r){return l._ensurePropertySystem(e),l.getPrototype(e).defineProp(t,r)},defineProps:function(e,t){l._ensurePropertySystem(e);for(var r=l.getPrototype(e),n=0,o=t.length;n<o;++n){var i=t[n],a=i.name,s=i;r.defineProp(a,s)}},getPropInfo:function(e,t,r){return l.getPrototype(e).getPropInfo(t,r)},defineEvent:function(e,t){return l.getPrototype(e).defineEvent(t)},getUnusedMethodName:function(e,t,r){for(var n=r||0,o=l.getPrototype(e),i=t+Number(n).toString();o[i];)++n,i=t+Number(n).toString();return i},extendMethod:function(e,t,r){var n=l.getPrototype(e),o=n[t],i=l.getUnusedMethodName(e,"__$changed$_"+t+"__");n[i]=o;var a,s=(a=i,function(){return n[a].apply(this,arguments)}).wrap(r);n[t]=s,s.valueOf=r.valueOf.bind(r),s.toString=r.toString.bind(r)},extendMethods:function(e,t){for(var r=Object.keys(t),n=0,o=r.length;n<o;++n){var i=r[n],a=t[i];"function"==typeof a&&l.extendMethod(e,i,a)}},extend:function(e,t){var r=l.getPrototype(e),n=l.getSuperClassPrototype(e),i=Object.keys(t);Object.keys({toString:!0}).length||i.push("toString","valueOf");for(var a=0,s=i.length;a<s;a++){var u=i[a],c=t[u];if("function"==typeof c){var d=o.argumentNames(c),h=d[0];if("$origin"==h){var f=c,m=r[u],g=l.getUnusedMethodName(e,"__$changed$_"+u+"__");r[g]=m,(c=function(e){return function(){return r[e].apply(this,arguments)}}(g).wrap(f)).valueOf=f.valueOf.bind(f),c.toString=f.toString.bind(f),d.shift(),h=d.first()}if("$super"==h){f=c;(c=function(e){return function(){return n[e].apply(this,arguments)}}(u).wrap(f)).valueOf=f.valueOf.bind(f),c.toString=f.toString.bind(f)}}r[u]=c}return l._remapPropGetters(e,i),e}},u=n.create({CLASS_NAME:"ObjectEx",EVENT_HANDLERS_FIELD:"__$__k__eventhandlers__$__",initialize:function(){this._initPropertySystem(),this._updateStatus=0,this._childChangeEventSuppressed=!1,this._modifiedProps=[],this._finalized=!1,this.beginUpdate();try{this.initPropValues()}finally{this.endUpdate()}this.afterInitialization()},afterInitialization:function(){},finalize:function(){this._finalized||(this.doFinalize(),this.invokeEvent("finalize",{obj:this}),this[this.EVENT_HANDLERS_FIELD]=null,this._finalized=!0)},doFinalize:function(){},initProperties:function(){this.defineProp("enablePropValueGetEvent",{dataType:a.BOOL,serializable:!1,scope:n.PropertyScope.PUBLIC}),this.defineProp("enablePropValueSetEvent",{dataType:a.BOOL,serializable:!1,scope:n.PropertyScope.PUBLIC}),this.defineProp("enableObjectChangeEvent",{dataType:a.BOOL,serializable:!1,scope:n.PropertyScope.PUBLIC}),this.defineProp("bubbleEvent",{dataType:a.BOOL,serializable:!1,scope:n.PropertyScope.PUBLIC}),this.defineProp("suppressChildChangeEventInUpdating",{dataType:a.BOOL,serializable:!1,scope:n.PropertyScope.PUBLIC}),this.defineProp("eventHandlers",{dataType:a.HASH,serializable:!1,scope:n.PropertyScope.PRIVATE,setter:null,getter:function(){var e=this[this.EVENT_HANDLERS_FIELD];return e||(e={},this[this.EVENT_HANDLERS_FIELD]=e),e}})},initPropValues:function(){},getHigherLevelObj:function(){return null},saved:function(e){},allSaved:function(e){},loaded:function(e){},allLoaded:function(e){},_initPropertySystem:function(){l._ensurePropertySystem(this.getClass())},_createPropertyList:function(){l._createPropertyList(this.getClass())},_remapPropGetters:function(){l._remapPropGetters(this.getClass())},getClass:function(){return this.constructor},getSuperClass:function(){return this.getClass().superclass},getClassName:function(){return this.getPrototype().CLASS_NAME},getClassLocalName:function(){return l.getClassLocalName(this.getClass())},getSerializationName:function(){return this.getClassName()},getPrototype:function(){return this.prototype?this.prototype:this.constructor.prototype},getSuperClassPrototype:function(){return this.constructor&&this.constructor.superclass?this.constructor.superclass.prototype:null},$super:function(e,t){var r=this.getSuperClassPrototype();return e?this.tryCallSuper.apply(this,arguments):r},applySuper:function(e,t,r){var n=this.__getLastSuperMethodCallTarget__(e),o=this.__getMethodBelongedPrototype__(e,n),i=this.__getMethodBelongedPrototype__(e,n.getSuperClassPrototype());i&&i===o&&(i=this.__getMethodBelongedPrototype__(e,i.getSuperClassPrototype()));var a=i&&i[e];if(a){var s;try{this.__pushSuperMethodCallTargetStack__(e,i),s=t?a.apply(this,t):a.apply(this)}finally{this.__popSuperMethodCallTargetStack__(e)}return s}if(!r)throw"Super method not found: "+e},tryApplySuper:function(e,t){return this.applySuper(e,t,!0)},tryCallSuper:function(){var e=r(arguments),t=e.shift();return this.tryApplySuper(t,e)},__getMethodBelongedPrototype__:function(e,t){if(!t)return null;if(t.hasOwnProperty(e))return t;var r=t.getSuperClassPrototype&&t.getSuperClassPrototype();return r&&r.__getMethodBelongedPrototype__?r.__getMethodBelongedPrototype__(e,r):null},__getSuperMethodCallTargetStack__:function(e){var t=this.__$superMethodCallTargetStacks__;t||(t={},this.__$superMethodCallTargetStacks__=t);var r=t[e];return r||(r=[],t[e]=r),r},__getLastSuperMethodCallTarget__:function(e){var t=this.__getSuperMethodCallTargetStack__(e);return t.length?t[t.length-1]:this.getPrototype()},__pushSuperMethodCallTargetStack__:function(e,t){this.__getSuperMethodCallTargetStack__(e).push(t)},__popSuperMethodCallTargetStack__:function(e){var t=null,r=this.__$superMethodCallTargetStacks__,n=r&&r[e];if(n){t=n.pop();n.length||delete r[e]}return t},__changeClass__:function(e){var t=l.getPrototype(e);return this.prototype=t,this.__proto__=t,this.constructor=e,this.objectChange(["__proto__"]),this},getOwnPropList:function(){return this._initPropertySystem(),this.getPrototype().properties},getAllPropList:function(){var e,t=this.getSuperClassPrototype();return t?(e=t.getAllPropList().clone()).appendList(this.getOwnPropList()):e=this.getOwnPropList().clone(),e},getPropListOfScopes:function(e){return l.getPropListOfScopes(this.getClass(),e)},getPropInfoHashKey:function(e){return u._PROPINFO_HASHKEY_PREFIX+e},getDefPropStoreFieldName:function(e){return u._PROP_STOREFIELD_PREFIX+e},defineProp:function(e,t){var r;void 0===(r=t?Object.extend({},t):{}).serializable&&(r.serializable=!0),r.storeField=this.getDefPropStoreFieldName(e);var n,o,i=this.getOwnPropList().addProperty(e,r);if(null!==r.getter&&!1!==r.getter&&(n=this.createPropGetter(i,r.getter),i.getter=n.doGetterName),null!==r.setter&&!1!==r.setter&&(o=this.createPropSetter(i,r.setter),i.setter=o.doSetterName),this[this.getPropInfoHashKey(e)]=i,s){var a={enumerable:r.enumerable,configurable:!1};void 0===a.enumerable&&(a.enumerable=!0),n&&(a.get=this[n.getterName]),o&&(a.set=this[o.setterName]),i.descriptor=a;try{Object.defineProperty(this,e,a)}catch(e){throw e}}return i},createPropGetter:function(e,t){var r=e.name.toString().upperFirst(),n="get"+r,o="doGet"+r,i=this[o];if(!i){var a=e.storeField;i=t||function(){return this[a]},this.getPrototype()[o]=i}return this.getPrototype()[n]=i,{getterName:n,doGetterName:o}},createPropSetter:function(e,t){var r=e.name.toString(),n=r.upperFirst(),o="set"+n,i="doSet"+n,a=this[i];if(!this[i]){var s=e.storeField;a=t||function(e){this[s]=e},this.getPrototype()[i]=a}return this.getPrototype()[o]=function(){var e=arguments[0];return this[i].apply(this,arguments),this.notifyPropSet(r,e),this},{setterName:o,doSetterName:i}},hasProperty:function(e){return null!=this.getPropInfo(e)},hasDirectProperty:function(e){return null!=this.getPropInfo(e,!0)},getPropInfo:function(e,t){var r,n=e||"";t||(r=this[this.getPropInfoHashKey(n)||""]);if(!r&&!(r=this.getOwnPropList().getPropInfo(n))&&!t){var o=this.getSuperClassPrototype();r=o&&o.getPropInfo?o.getPropInfo(n):null}return r},getPropertyDataType:function(e){var t=this.getPropInfo(e);return t?t.dataType:null},isPropertySerializable:function(e){var t=this.getPropInfo(e),r=t&&t.serializable;return void 0===r||!!r},getPropStoreFieldValue:function(e){return this[u._PROP_STOREFIELD_PREFIX+e]},getPropValue:function(e){var t,r=this.getPropInfo(e);if(r){if(r.getter){var n=Array.prototype.slice.call(arguments);n.shift(),t=this[r.getter].apply(this,n)}else t=this[r.storeField];return t}return null},getCascadePropValue:function(e){for(var t,r,n=this,o=0,i=(r=e.length&&e.splice?e:e.split(".")).length;o<i&&(t=n.getPropValue(r[o]));++o)n=t;return t},getPropValues:function(e){var t={};if(a.isArrayValue(e))for(var r=0,n=e.length;r<n;++r){t[o=e[r]]=this.getPropValue(o)}else if(a.isObjectValue(e))for(var o in e)e.hasOwnProperty(o)&&"function"!=typeof e[o]&&(t[o]=this.getPropValue(o));return t},setPropStoreFieldValue:function(e,t){this[u._PROP_STOREFIELD_PREFIX+e]=t},setPropValue:function(e,t,r){var n=this.getPropInfo(e);return n&&(n.setter?this[n.setter].apply(this,[t]):r&&(this[n.storeField]=t),this.notifyPropSet(e,t)),this},setPropValueX:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=this.getPropInfo(t);return r&&(r.setter&&this[r.setter].apply(this,e),this.notifyPropSet(t,this.getPropValue(t))),this},setPropValues:function(e,t){for(var r in e)if(e.hasOwnProperty(r)&&this.hasProperty(r)){var n=e[r];this.setPropValue(r,n,t)}return this},setCascadePropValue:function(e){for(var t,r=Array.prototype.slice.call(arguments),n=this,o=0,i=(t=(e=r.shift()).length&&e.splice?e:e.split(".")).length-1;o<i&&(n=n.getPropValue(t[o]));++o);return n&&(r.unshift(t[i]),n.setPropValueX.apply(n,r)),this},_isPropGetOrSetEvent:function(e){return"propValueGet"==e||"propValueSet"==e},notifyPropSet:function(e,t,r){this.isUpdating()?this._modifiedProps.indexOf(e)<0&&this._modifiedProps.push(e):this._isPropGetOrSetEvent(e)||this.isEventPropName(e)||(this.doPropChanged(e,t),this.getPropStoreFieldValue("enablePropValueSetEvent")&&this.invokeEvent("propValueSet",{propName:e,propValue:t}),r||this.objectChange([e]))},objectChange:function(e){var t=[].concat(e);if(this.doObjectChange(e),this.getEnableObjectChangeEvent()){var r=t.indexOf("enableObjectChangeEvent");r>=0&&t.splice(r,1),this.invokeEvent("change",{changedPropNames:t})}},doObjectChange:function(e){},doPropChanged:function(e,t){},defineEvent:function(e){},eventNameToPropName:function(e){return"__event_"+e},isEventPropName:function(e){return"string"==typeof e&&e.indexOf("__event_")>=0},isEventHandlerList:function(e){return e&&"object"==typeof e&&e instanceof n.EventHandlerList},getEventHandlerList:function(e){var t=this.getEventHandlers(),r=t[e];return r||(r=new n.EventHandlerList,t[e]=r),r},addEventListener:function(e,t,r){var n=this.getEventHandlerList(e);return this.isEventHandlerList(n)?("change"===e&&this.setEnableObjectChangeEvent(!0),n.add(t,r)):null},addOnceEventListener:function(e,t,r){var n=this,o=function(i){n.removeEventListener(e,o,r),t(i)};return this.addEventListener(e,o,r)},removeEventListener:function(e,t,r){var n=this.getEventHandlerList(e);if(this.isEventHandlerList(n))return n.remove(t,r)},on:function(e,t,r){return this.addEventListener(e,t,r)},once:function(e,t,r){return this.addOnceEventListener(e,t,r)},off:function(e,t,r){return this.removeEventListener(e,t,r)},invokeEvent:function(e,t){t?(t.name=e,t.target=this):t={name:e,target:this},t.stopImmediatePropagation||(t.stopImmediatePropagation=this._eventStopImmediatePropagation),t.stopPropagation||(t.stopPropagation=this._eventCancelBubble),t.preventDefault||(t.preventDefault=this._eventPreventDefault),this.dispatchEvent(e,t)},_eventStopImmediatePropagation:function(){this._stopImmediatePropagation=!0,this._cancelBubble=!0},_eventCancelBubble:function(){this._cancelBubble=!0},_eventPreventDefault:function(){this._preventDefault=!0},relayEvent:function(e,t){t.currentTarget=this,"change"===e&&this.getSuppressChildChangeEventInUpdating()&&this.isUpdating()?this._childChangeEventSuppressed=!0:this.dispatchEvent(e,t)},dispatchEvent:function(e,t){for(var r=this.getEventHandlerList(e),n=0,o=r.getLength();n<o&&!t._stopImmediatePropagation;++n){var i=r.getHandlerInfo(n);i.handler.apply(i.thisArg,[t])}if(!t._cancelBubble&&this.getBubbleEvent()){var a=this.getHigherLevelObj();a&&a.relayEvent&&a.relayEvent(e,t)}},stopEventPropagation:function(e){e.cancelBubble=!0},overwriteMethod:function(e,t){var r=this,n=this[e];return this[e]=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(n&&n.bind(r)),t.apply(r,e)},this},assign:function(e){return e.assignTo(this)},assignTo:function(e){var t={};this.saveObj(t,"json"),e.loadObj(t,"json")},clone:function(){var e=new(this.getClass());return this.assignTo(e),e},beginUpdate:function(){this.doBeginUpdate()},doBeginUpdate:function(){++this._updateStatus},endUpdate:function(){if(--this._updateStatus,this.checkUpdateStatus(),!this.isUpdating()){var e=this._modifiedProps||[];this._modifiedProps=[],this._childChangeEventSuppressed&&(e.push("[children]"),this._childChangeEventSuppressed=!1),this.doEndUpdate(e)}},doEndUpdate:function(e){if(e.length){if(this.getPropStoreFieldValue("enablePropValueSetEvent"))for(var t=0,r=e.length;t<r;++t){var n=e[t],o=this.getPropValue(n);this.notifyPropSet(n,o,!0)}this.objectChange(e)}},isUpdating:function(){return this._updateStatus>0},isPropUpdated:function(e){return this._modifiedProps.indexOf(e)>=0},checkUpdateStatus:function(){this._updateStatus<=0&&(this._updateStatus=0)},copyPropsTo:function(e){for(var t=this.getAllPropList(),r=0,n=t.getLength();r<n;++r){var o=t.getPropInfoAt(r).name;if(e.hasProperty(o)){var i=this.getPropValue(o);e.setPropValue(o,i,!0)}}}});u._PROPINFO_HASHKEY_PREFIX="__$propInfo__",u._PROP_STOREFIELD_PREFIX="__$__k__p__",e.Class=n,e.ClassEx=l,e.ObjectEx=u,e.DataType=a,a.StringUtils=i}(this),function(e){"use strict";var t={parse:function(e){return JSON.parse(e)},serializeToStr:function(e,t){return t&&t.prettyPrint?JSON.stringify(e,null,t.indentSpaces||2):JSON.stringify(e)}},r={DOM_PARSER:null,DOM_IMPLEMENTATION:null,XML_SERIALIZER:null,DEF_INCLUDE_TAG_NAME:"include",DEF_INCLUDE_SRC_ATTRIB:"src",DEF_LOAD_TIMEOUT:2e4,DEF_BYPASS_ROOT_ELEM:!0,DEF_SERIALIZE_TO_JSCODE_VARNAME:"__xmlStr__",FILE_EXT_XML:".xml",FILE_EXT_XML_JS_WRAPPER:".xmljs",newDocument:function(e,t){if(e||(e=""),t||(t=""),r.DOM_IMPLEMENTATION)return n=(new r.DOM_IMPLEMENTATION).createDocument(t,e,null);if("undefined"!=typeof document){if(document.implementation&&document.implementation.createDocument)return n=document.implementation.createDocument(t,e,null);if("undefined"!=typeof ActiveXObject){var n=new ActiveXObject("MSXML2.DOMDocument");if(e){var o="",i=e,a=e.indexOf(":");-1!=a&&(o=e.substring(0,a),i=e.substring(a+1));var s="<"+(o?o+":":"")+i+(t?(o?" xmlns:":" xmlns")+o+'="'+t+'"':"")+"/>";n.loadXML(s)}return n}}},parse:function(e){if(r.DOM_PARSER)return(new r.DOM_PARSER).parseFromString(e,"application/xml");if("undefined"!=typeof document){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(e,"application/xml");if("undefined"!=typeof ActiveXObject){var t=r.newDocument();return t.loadXML(e),t}var n="data:text/xml;charset=utf-8,"+encodeURIComponent(e),o=new XMLHttpRequest;return o.open("GET",n,!1),o.send(null),o.responseXML}},load:function(e,t,n){return r.loadHelper.loadSimple(e,t,(n||{}).timeout)},loadHelper:{loadSimple:function(e,t,n){var o=null!=t;if(null==n&&(n=r.DEF_LOAD_TIMEOUT),document.implementation&&document.implementation.createDocument){var i=new XMLHttpRequest,a=null;n&&(a=setTimeout(function(){s(null,!1)},n));var s=function(e,r){a&&clearTimeout(a),t&&t(e,r)};o&&(i.onreadystatechange=function(){if(4==i.readyState){var e=i.responseXML;e&&e.documentElement?s(e,!0):s(null,!1)}});try{i.open("get",e,o),i.send(null)}catch(e){s(null,!1)}var l=i.responseXML;return l&&l.documentElement?l:null}return r.loadHelper.loadSimpleViaDoc(e,t)},loadSimpleViaDoc:function(e,t){var n=null!=t,o=r.newDocument("dummy_dummy_dummy_dummy");return o.async=n,n&&(o.onreadystatechange=function(){4==o.readyState&&(o.documentElement&&"dummy_dummy_dummy_dummy"!=o.documentElement.tag?t(o,!0):t(o,!1))}),o.load(e),o}},serializeNode:function(e,t){if(t&&t.prettyPrint)return r.serializeNodePretty(e);if(r.XML_SERIALIZER)return(new r.XML_SERIALIZER).serializeToString(e);if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(e);if(e.xml)return e.xml;throw"XML.serialize is not supported or can't serialize "+e},serializeNodePretty:function(e){try{return r.XML_SERIALIZER?(new r.XML_SERIALIZER).serializeToString(e).toXMLString():(new XMLSerializer).serializeToString(e).toXMLString()}catch(t){return r.serializeNode(e)}},getXmlDocUrl:function(e){return e.url||e.documentURI||e.URL||e.location}};DataType.JsonUtility=t,DataType.XmlUtility=r}(),function(){"use strict";var e=Class.create(ObjectEx,{CLASS_NAME:"ObjSerializer",SERIALIZER_NAME:null,getSerializerName:function(){return this.SERIALIZER_NAME},serializeValue:function(e){return e},deserializeValue:function(e,t){return e},propNameToStorageName:function(e){return e},storageNameToPropName:function(e){return e},getObjCustomSaveMethod:function(e){return e.doSaveObj},getObjCustomLoadMethod:function(e){return e.doLoadObj},getObjCustomPropSaveMethod:function(e){return e.doSaveProp},getObjCustomPropLoadMethod:function(e){return e.doLoadProp},isUndefined:function(e){return DataType.isUndefinedValue(e)},isNull:function(e){return null===e},isNaN:function(e){return e!=e},isFunction:function(e){return DataType.isFunctionValue(e)},isArray:function(e){return DataType.isArrayValue(e)},isDate:function(e){return DataType.isDateValue(e)},isObject:function(e){return DataType.isObjectValue(e)},isObjectEx:function(e){return DataType.isObjectExValue(e)},isSimpleType:function(e){var t=typeof e;return"string"==t||"number"==t||"boolean"==t||"undefined"==t||this.isNull(e)},isComplexType:function(e){return!this.isSimpleType(e)},createChildStorageNode:function(e,t,r){},appendArrayItemStorageNode:function(e,t,r){},getNameForArrayItemStorageNode:function(e){return this.getDefaultArrayItemStorageName()},getChildStorageNode:function(e,t){},getAllArrayItemStorageNodes:function(e){},getAllStoredStorageNames:function(e){},setStorageNodeExplicitType:function(e,t){},getStorageNodeExplicitType:function(e){},getStorageNodeName:function(e){},isComplexStorageNode:function(e){},isComplexArrayItemStorageNode:function(e){},isSimpleStorageNode:function(e){},getValueExplicitType:function(e){return e instanceof ObjectEx?e.getClassName():this.isObject(e)?DataType.OBJECT:this.isArray(e)?DataType.ARRAY:this.isDate(e)?DataType.DATE:typeof e},getDefaultArrayItemStorageName:function(){return"item"},getDefaultDateStorageName:function(){return"date"},save:function(e,t,r){var n=[],o=this.saveObj(e,t,r,e,t,n);if(o)for(var i=0,a=n.length;i<a;++i)n[i]&&this.isFunction(n[i].allSaved)&&n[i].allSaved(e);return o},saveObj:function(e,t,r,n,o,i){if("object"==typeof e){var a=this.getObjCustomSaveMethod(e);if(a)return a(e,t,r||{},this,n,o,i)}var s=this.doSave(e,t,r||{},n,o,i);return s&&(i||console.log(e,e.getClassName&&e.getClassName()),i.push(e),this.isFunction(e.saved)&&e.saved(n)),s},doSave:function(e,t,r,n,o,i){return"object"==typeof e&&(e instanceof ObjectEx?this.doSaveObjectEx(e,t,r,n,o,i):this.isArray(e)?this.doSaveArray(e,t,r,n,o,i):this.isDate(e)?this.doSaveDate(e,t,r,n,o,i):this.doSaveSimpleObject(e,t,r,n,o,i)),this.setStorageNodeExplicitType(t,this.getValueExplicitType(e)),e},doSaveSimpleObject:function(e,t,r,n,o,i){for(var a in e)if(e.hasOwnProperty(a)){var s,l=e[a];this.isComplexType(l)&&(s=this.getValueExplicitType(l)),this.doSaveFieldValue(e,a,l,t,s,r,n,o,i)}},doSaveArray:function(e,t,r,n,o,i){for(var a=0,s=e.length;a<s;++a){var l=e[a],u=this.getNameForArrayItemStorageNode(l);if(this.isComplexType(l)){var c=this.appendArrayItemStorageNode(t,this.propNameToStorageName(u),this.isArray(l));this.setStorageNodeExplicitType(c,this.getValueExplicitType(l)),this.saveObj(l,c,r,n,o,i)}else this.doAppendArrayItemSimpleValue(this.serializeValue(l),typeof l,t)}},doSaveDate:function(e,t,r,n,o,i){var a=e.toUTCString();this.doSaveSimpleValue(e,this.propNameToStorageName(this.getDefaultDateStorageName()),this.serializeValue(a),DataType.DATE,t,r,n,o)},doSaveObjectEx:function(e,t,r,n,o,i){for(var a=e.getAllPropList(),s=r.propFilter,l=0,u=a.getLength();l<u;++l){var c=a.getPropInfoAt(l);if(!s||s(c,e)){var d=this.getObjCustomPropSaveMethod(e),h=!1;if(d&&(h=d(e,c,t,r,this,n,o,i)),!h)if(c.serializable)("function"==typeof c.serializable?c.serializable.apply(e):c.serializable)&&this.doSaveObjectExProp(e,c,t,r,n,o,i)}}},doSaveObjectExProp:function(e,t,r,n,o,i,a){var s=t.name,l=t.dataType,u=e.getPropValue(s);if(n.saveDefaultValues||u!==t.defaultValue){var c;u instanceof ObjectEx?u.getClassName()!=l&&(c=u.getClassName()):this.isComplexType(u)&&(c=this.getValueExplicitType(u))==l&&(c=void 0);var d=e.getPropSerializationName(s,this.getSerializerName())||s;this.doSaveFieldValue(e,d,u,r,c,n,o,i,a)}},doSaveFieldValue:function(e,t,r,n,o,i,a,s,l){if("function"!=typeof r)if(this.isComplexType(r)){var u=this.createChildStorageNode(n,this.propNameToStorageName(t),this.isArray(r));o&&this.setStorageNodeExplicitType(u,o),this.saveObj(r,u,i,a,s,l)}else this.doSaveSimpleValue(e,this.propNameToStorageName(t),this.serializeValue(r),this.getValueExplicitType(r),n,i,a,s,l)},doSaveSimpleValue:function(e,t,r,n,o,i,a,s,l){},doAppendArrayItemSimpleValue:function(e,t,r){},load:function(e,t){var r=[],n=this.loadObj(e,t,e,t,r);if(n)for(var o=0,i=r.length;o<i;++o)r[o]&&this.isFunction(r[o].allLoaded)&&r[o].allLoaded(e||n);return n},loadObj:function(e,t,r,n,o){if(!e){var i=this.getStorageNodeExplicitType(t);if(!i)return this.doLoadUntypedNode?this.doLoadUntypedNode(t,r,n):null;e=DataType.createInstance(i)}if(r||(r=e),"object"==typeof e){var a=this.getObjCustomLoadMethod(e);if(a)return a(e,t,this,r,n,o)}var s=this.doLoad(e,t,r,n,o);if(s){var l=e||s;o.push(l),this.isFunction(l.loaded)&&l.loaded(r)}return s},doLoad:function(e,t,r,n,o){this.getStorageNodeExplicitType(t);if("object"==typeof e)if(e instanceof ObjectEx){e.beginUpdate();try{e=this.doLoadObjectEx(e,t,r,n,o)}finally{e.endUpdate()}}else e=this.isArray(e)?this.doLoadArray(e,t,r,n,o):this.isDate(e)?this.doLoadDate(e,t,r,n,o):this.doLoadSimpleObject(e,t,r,n,o);return e},doLoadArray:function(e,t,r,n,o){for(var i=this.getAllArrayItemStorageNodes(t),a=0,s=i.length;a<s;++a){var l=i[a];if(this.isComplexArrayItemStorageNode(l)){var u,c=this.getStorageNodeExplicitType(l)||this.getStorageNodeName(l);c?(u=DataType.createInstance(c),this.loadObj(u,l,r,n,o)):(u={},this.loadObj(u,l,r,n,o)),e.push(u)}else{var d=this.deserializeValue(this.doGetArrayItemSimpleStorageValue(l));e.push(d)}}return e},doLoadDate:function(e,t,r,n,o){var i=this.propNameToStorageName(this.getDefaultDateStorageName()),a=this.doLoadSimpleValue(e,i,DataType.DATE,t,r,n,o);if(a){var s=new Date(a);return e.copyFrom(s),e}},doLoadSimpleObject:function(e,t,r,n,o){for(var i=this.getAllStoredStorageNames(t),a=0,s=i.length;a<s;++a){var l=i[a],u=this.storageNameToPropName(l),c=this.getChildStorageNode(t,l);if(c){var d,h=this.getStorageNodeExplicitType(c);d=h?DataType.createInstance(h):{},this.loadObj(d,c,r,n,o),e[u]=d}else{var f=this.doLoadSimpleValue(e,l,null,t,r,n,o);e[u]=f}}return e},doLoadObjectEx:function(e,t,r,n,o){for(var i=e.getAllPropList(),a=0,s=i.getLength();a<s;++a){var l=i.getPropInfoAt(a);if(l.serializable){var u=this.getObjCustomPropLoadMethod(e),c=!1;u&&(c=u(e,l,t,this,r,n,o)),c||this.doLoadObjectExProp(e,l,t,r,n,o)}}return e},doLoadObjectExProp:function(e,t,r,n,o,i){var a=t.name,s=t.dataType,l=e.getPropSerializationName(a,this.getSerializerName())||a,u=this.doLoadFieldValue(e,l,r,s,n,o,i);null!=u&&e.setPropValue(a,u,!0)},doLoadFieldValue:function(e,t,r,n,o,i,a){var s,l=!1;if(DataType.isComplexType(n)){var u=this.getChildStorageNode(r,this.propNameToStorageName(t));if(u){var c=this.getStorageNodeExplicitType(u);s=c&&c!=n?DataType.createInstance(c):DataType.createInstance(n),this.loadObj(s,u,o,i,a),l=!0}}return!DataType.isSimpleType(n)&&l||(s=this.doLoadSimpleValue(e,this.propNameToStorageName(t),n,r,o,i,a)),s},doLoadSimpleValue:function(e,t,r,n,o,i,a){var s=this.doLoadSimpleStorageValue(t,n,o,i,a);return this.deserializeValue(s,r)},doLoadSimpleStorageValue:function(e,t,r,n,o){},doGetArrayItemSimpleStorageValue:function(e){}}),t=Class.create(e,{CLASS_NAME:"JsonObjSerializer",TYPE_TAG_NAME:"__type__",createChildStorageNode:function(e,t,r){var n=r?[]:{};return e[t]=n,n},appendArrayItemStorageNode:function(e,t,r){var n=r?[]:{};return e.push(n),n},getChildStorageNode:function(e,t){var r=e[t];return this.isSimpleType(r)&&(r=null),r},getAllArrayItemStorageNodes:function(e){return Array.prototype.slice.call(e)},getAllStoredStorageNames:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&r!=this.TYPE_TAG_NAME&&t.push(r);return t},isComplexStorageNode:function(e){return this.isComplexType(e)},isComplexArrayItemStorageNode:function(e){return this.isComplexStorageNode(e)},isSimpleStorageNode:function(e){return this.isSimpleType(e)},setStorageNodeExplicitType:function(e,t){this.isArray(e)||(e[this.TYPE_TAG_NAME]=t)},getStorageNodeExplicitType:function(e){var t=e[this.TYPE_TAG_NAME]||null;return!t&&this.isArray(e)?DataType.ARRAY:t},doSaveSimpleValue:function(e,t,r,n,o,i,a,s,l){o[t]=r},doAppendArrayItemSimpleValue:function(e,t,r){return r.push(e)},doLoadSimpleStorageValue:function(e,t,r,n,o){return t[e]},doLoadUntypedNode:function(e,t,r,n){return e},doGetArrayItemSimpleStorageValue:function(e){return e}}),r=Class.create(e,{CLASS_NAME:"XmlObjSerializer",TYPE_TAG_NAME:"dataType",UNSUIT_PROPNAME_PREFIX:"__.",getLocalName:function(e){return e.localName||e.baseName||e.nodeName},getElemTextValue:function(e){for(var t="",r=0,n=e.childNodes.length;r<n;++r)e.childNodes[r].nodeType==Node.TEXT_NODE&&(t+=e.childNodes[r].nodeValue);return t},serializeValue:function(e){return DataType.StringUtils.serializeValue(e)},deserializeValue:function(e,t){return DataType.StringUtils.deserializeValue(e,t)},propNameToStorageName:function(e){var t=e.toString().charAt(0).toLowerCase();return"_"===t||t>="a"&&t<="z"?e:this.UNSUIT_PROPNAME_PREFIX+e},storageNameToPropName:function(e){return"string"!=typeof e?e:0===e.indexOf(this.UNSUIT_PROPNAME_PREFIX)?e.substr(this.UNSUIT_PROPNAME_PREFIX.length):e},createChildStorageNode:function(e,t,r){var n=e.ownerDocument.createElement(t);return e.appendChild(n),n},appendArrayItemStorageNode:function(e,t,r){return this.createChildStorageNode(e,t,r)},getAllArrayItemStorageNodes:function(e){for(var t=[],r=0,n=e.childNodes.length;r<n;++r){var o=e.childNodes[r];o.nodeType==Node.ELEMENT_NODE&&t.push(o)}return t},getAllStoredStorageNames:function(e){for(var t=[],r=0,n=e.childNodes.length;r<n;++r){var o=e.childNodes[r];o.nodeType==Node.ELEMENT_NODE&&this.getLocalName(o)!=this.TYPE_TAG_NAME&&t.push(this.getLocalName(o))}for(r=0,n=e.attributes.length;r<n;++r){var i=e.attributes[r];this.getLocalName(i)!=this.TYPE_TAG_NAME&&t.push(this.getLocalName(i))}return t},getChildStorageNode:function(e,t){for(var r=null,n=0,o=e.childNodes.length;n<o;++n){var i=e.childNodes[n];i.nodeType==Node.ELEMENT_NODE&&this.getLocalName(i)==t&&(r=i)}return r},isComplexStorageNode:function(e){return e.nodeType==Node.ELEMENT_NODE},isComplexArrayItemStorageNode:function(e){return this.isComplexStorageNode(e)&&e.attributes.length&&!this.getElemTextValue(e).trim()},isSimpleStorageNode:function(e){return e.nodeType==Node.ATTRIBUTE_NODE},setStorageNodeExplicitType:function(e,t){e.setAttribute(this.TYPE_TAG_NAME,t)},getStorageNodeExplicitType:function(e){return e.getAttribute(this.TYPE_TAG_NAME)||null},getStorageNodeName:function(e){var t=e.tagName;return t==this.getDefaultArrayItemStorageName()?null:t},doSaveSimpleObject:function(e,t,r,n,o,i){return this.tryApplySuper("doSaveSimpleObject",[e,t,r,n,o,i])},doSaveSimpleValue:function(e,t,r,n,o,i,a,s,l){o.setAttribute(t,r)},doAppendArrayItemSimpleValue:function(e,t,r){var n=this.appendArrayItemStorageNode(r,this.propNameToStorageName(this.getDefaultArrayItemStorageName()),!1),o=n.ownerDocument.createTextNode(e);n.appendChild(o)},doLoadSimpleStorageValue:function(e,t,r,n,o){return t.getAttribute(e)||void 0},doGetArrayItemSimpleStorageValue:function(e){return this.getElemTextValue(e)}}),n={_serializerClasses:{},_defaultName:null,registerSerializer:function(e,t,r){var o="string"==typeof t?ClassEx.findClass(t):t;n._serializerClasses[e]=o,r&&(n._defaultName=e),ClassEx.getPrototype(t).SERIALIZER_NAME=e},getSerializer:function(e){var t=e||n._defaultName;if(t){var r=n._serializerClasses[t];return r?new r:null}return null}};n.registerSerializer("json",t,!0),n.registerSerializer("xml",r),Class.ObjSerializerFactory=n,ClassEx.extend(ObjectEx,{getPropSerializationName:function(e,t){return e},saveObj:function(e,t,r){return(t?"string"==typeof t?n.getSerializer(t):t:n.getSerializer()).save(this,e,r)},loadObj:function(e,t){var r,o;r=t?"string"==typeof t?n.getSerializer(t):t:n.getSerializer(),this.beginUpdate();try{o=r.load(this,e)}finally{this.endUpdate()}return o}}),Object.extend(ClassEx,{saveObj:function(e,t,r,o){return(r?"string"==typeof r?n.getSerializer(r):r:n.getSerializer()).save(e,t,o)},loadObj:function(e,t,r){return(r?"string"==typeof r?n.getSerializer(r):r:n.getSerializer()).load(e,t)}}),Object.extend(DataType,{valueToJson:function(e,t){if(DataType.isSimpleValue(e))return JSON.stringify(e);var r=DataType.isArrayValue(e)?[]:{};return ClassEx.saveObj(e,r,"json",t),JSON.stringify(r)},jsonToValue:function(e){var t=JSON.parse(e);return!t||DataType.isSimpleValue(t)?t:ClassEx.loadObj(null,t,"json")}})}();var Kekule={LIBNAME:"Kekule.js",LIBNAME_CORE:"Kekule",VERSION:"0.9.9.22042600",LOADED:!1,_afterLoadSysProcedures:[],_afterLoadUserProcedures:[],PROP_AUTO_TITLE:!0,_loaded:function(){if(!Kekule.LOADED){Kekule.LOADED=!0;for(var e=Kekule._afterLoadSysProcedures;e.length;){(t=e.shift())&&t()}for(e=Kekule._afterLoadUserProcedures;e.length;){var t;(t=e.shift())&&t()}var r=Kekule.$jsRoot&&Kekule.$jsRoot.document;if(r&&r.createEvent&&r.body&&r.body.dispatchEvent){var n=r.createEvent("Event");n.initEvent("kekuleload",!0,!0),r.body.dispatchEvent(n)}}},_isLoaded:function(){return Kekule.LOADED},_registerAfterLoadSysProc:function(e){e&&(Kekule.LOADED?e():Kekule._afterLoadSysProcedures.push(e))},_ready:function(e){e&&(Kekule.LOADED?e():Kekule._afterLoadUserProcedures.push(e))}};if(Kekule._registerAfterLoadProc=Kekule._ready,Kekule.$jsRoot=this,"object"==typeof self?Kekule.$jsRoot=self:"object"==typeof window&&window&&window.document?Kekule.$jsRoot=window:"object"==typeof global&&(Kekule.$jsRoot=global),Kekule.$jsRoot.Kekule=Kekule,"object"==typeof window&&window&&window.document&&(Kekule.window=window),Kekule.$document=this&&this.document||null,Kekule.scriptSrcInfo||(Kekule.scriptSrcInfo=Kekule.$jsRoot.__$kekule_load_info__),Kekule.scriptSrcInfo&&Kekule.scriptSrcInfo.language&&(Kekule.language=Kekule.scriptSrcInfo.language),!Kekule.scriptSrcInfo&&Kekule.$jsRoot.document&&(Kekule.scriptSrcInfo=function(e){var t,r=/^(.*\/?)kekule\..*\.js(\?.*)?$/;if(e&&e.currentScript&&e.currentScript.src)(t=decodeURIComponent(e.currentScript.src))&&(i=t.match(/^(.*[\/\\])[^\/\\]*\.js(\?.*)?$/));else for(var n=document.getElementsByTagName("script"),o=n.length-1;o>=0;--o){var i,a=n[o];if(t=decodeURIComponent(a.src))if(i=t.match(r))break}if(i){var s=i[2];return s&&(s=s.substr(1)),{src:t,path:i[1],paramStr:s,useMinFile:!0}}return null}(Kekule.$jsRoot.document)),Kekule.scriptSrcInfo||(Kekule.scriptSrcInfo={useMinFile:!0}),Kekule.environment={scriptInfo:Kekule.scriptSrcInfo,isNode:!("object"!=typeof process||"object"!=typeof process.versions||void 0===process.versions.node),isWeb:!("object"!=typeof window||!window.document),variables:{},getEnvVar:function(e){return Kekule.environment.variables[e]||Kekule.$jsRoot._kekule_environment_&&Kekule.$jsRoot._kekule_environment_[e]},setEnvVar:function(e,t){Kekule.environment.variables[e]=t}},Kekule.scriptSrcInfo&&(Kekule.environment.nodeModule=Kekule.scriptSrcInfo.nodeModule,Kekule.environment.nodeRequire=Kekule.scriptSrcInfo.nodeRequire,Kekule.environment.setEnvVar("kekule.path",Kekule.scriptSrcInfo.path),Kekule.environment.setEnvVar("kekule.scriptSrc",Kekule.scriptSrcInfo.src),Kekule.environment.setEnvVar("kekule.useMinJs",Kekule.scriptSrcInfo.useMinFile),Kekule.environment.setEnvVar("kekule.language",Kekule.scriptSrcInfo.language)),Kekule.$jsRoot.__$kekule_scriptfile_utils__&&(Kekule._ScriptFileUtils_=Kekule.$jsRoot.__$kekule_scriptfile_utils__,Kekule.ScriptFileUtils=Kekule._ScriptFileUtils_,Kekule.modules=function(e,t){var r=[];r="string"==typeof e?[e]:e;var n=Kekule.scriptSrcInfo;if(n){Kekule._ScriptFileUtils_.loadModuleScriptFiles(r,Kekule.isUsingMinJs(),Kekule.getScriptPath(),n,function(e){t&&t(e)});return this}return this},Kekule.loadModules=Kekule.modules),Kekule.scriptSrcInfo&&(Kekule.scriptSrcInfo.getValue=function(e){return Kekule.scriptSrcInfo[e]},Kekule.scriptSrcInfo.setValue=function(e,t){Kekule.scriptSrcInfo[e]=t}),Kekule.getScriptPath=function(){return Kekule.environment.getEnvVar("kekule.path")||Kekule.scriptSrcInfo.path},Kekule.getScriptSrc=function(){return Kekule.environment.getEnvVar("kekule.scriptSrc")||Kekule.scriptSrcInfo.src},Kekule.isUsingMinJs=function(){return Kekule.environment.getEnvVar("kekule.useMinJs")||Kekule.scriptSrcInfo.useMinFile},Kekule.getLanguage=function(){return Kekule.environment.getEnvVar("kekule.language")||Kekule.scriptSrcInfo.language},Kekule._getStyleSheetBasePath=function(){return Kekule.isUsingMinJs()?Kekule.getScriptPath():Kekule.getScriptPath()+"widgets/"},Kekule.getStyleSheetUrl=function(){var e=Kekule.environment.getEnvVar("kekule.themeUrl");e||(e=Kekule._getStyleSheetBasePath()+"themes/default/kekule.css");return e},Kekule.$jsRoot&&Kekule.$jsRoot.addEventListener&&Kekule.$jsRoot.postMessage&&Kekule.$jsRoot.addEventListener("message",function(e){"kekule-sys-info-query"===e.data&&Kekule.$jsRoot.postMessage({msg:"kekule-sys-info-result",libName:Kekule.LIBNAME,version:Kekule.VERSION},"*")},!1),Kekule.Dev={},Kekule.Class=Class,Kekule.ClassEx=ClassEx,Kekule.ObjectEx=ObjectEx,Kekule.DataType=DataType,function(e){"use strict";function t(e){var t=e.split(/[-|_]/);return{language:t[0],local:t[1]}}e||(e={});var r=Kekule,n=Kekule.getLanguage()||(e&&e.navigator?navigator.language||navigator.browserLanguage:"en-US");r.language=n;var o=t(n),i=t("en-US"),a=[o.language+"_"+o.local,o.language,i.language+i.local,i.language];Kekule.Localization={},Kekule.LocalizationRes={};var s=Kekule.LocalizationRes;function l(e,t,r){var n=r||s[e];return!n&&t&&(n={},s[e]=n),n}function u(e,t,r){var n=l(t,!1,r);if(n){var o=Object.getCascadeFieldValue(e,n);if(void 0!==o)return o}}function c(e,t,r){for(var n=(t?[t]:[]).concat(a),o=0,i=n.length;o<i;++o){var s=u(e,n[o],r);if(void 0!==s)return s}}function d(e,t,r){var n=c(e,t,r);if(void 0!==n)return n;Kekule.error("Can not find localization resource: "+e)}var h,f=[],m=!!(e||e.window).__kekuleMarkLocalizationModuleInfo__,g={};function p(e,t,r,n){if(r){var o=u(t,e,n);(function(e,t,r,n,o){var i=l(r,n,o);!!i&&Object.setCascadeFieldValue(e,t,i,n)})(t,o?Object.extendEx(o,r,{cascade:!0}):JSON.parse(JSON.stringify(r)),e,!0,n)}}Kekule.$L=d,Kekule.Localization.getLanguages=function(){var e=[];for(var t in s)e.push(t);return e},Kekule.Localization.getValue=d,Kekule.Localization.findValue=c,Kekule.Localization.getModuleInfos=function(){return g},Kekule.Localization.setCurrModule=function(e){h=e,f.indexOf(e)<0&&f.push(e)},Kekule.Localization.getModuleNames=function(){return f},Kekule.Localization.addResource=function(e,t,r){(p(e,t,r),m)&&p(e,t,r,function(e,t){e=e||"GLOBAL";var r=Object.getCascadeFieldValue(e,g);return!r&&t&&(r=Object.setCascadeFieldValue(e,{},g,!0)),r}(h,!0))}}(this),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("general"),Kekule.Localization.addResource("en","Texts",{UNNAMED:"unnamed"}),Kekule.Localization.addResource("en","ErrorMsg",{MODULE_NOT_LOADED:"Module {0} is not loaded",UNIT_NOT_FOUND:"Unit not found: {0}",STANDARD_UNIT_OF_CATEGORY_NOT_FOUND:"Standard unit of category {0} not found",UNABLE_TO_CONVERT_BETWEEN_UNITS:"Unable to convert between units {0} and {1}",NON_OWN_PROPERTY_CANNOT_BE_REPLACED:"Only directly owned property of object can be replaced",EMPTY_DOC:"Document is empty",ELEMENT_NOTSET:"Element not set",EMPTY_RESURI:"Resource URI is empty",CANNOT_LOAD_RES_OF_URI:"Can not load resource of URI: ",LIST_ITEM_CLASS_MISMATCH:"Mismatched item class, can not add to list",CANNOT_CLEAR_WEAKMAP:"Can not clear a weak map",CANNOT_GET_KEY_LIST_IN_WEAKMAP:"Can not get key array from a weak map",CANNOT_GET_VALUE_LIST_IN_WEAKMAP:"Can not get value array from a weak map",INVALID_CHEMELEMENT:"Invalid chemical element",INVALID_ISOTOPE:"Invalid isotope",COORD_STICK_NOT_ALLOWED_ON_CLASS:"Coordinate sticking is not allowed in this type of object",INVALID_STICK_TARGET_OBJ:"Invalid sticking target",UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ:"Unable to stick to object with a different owner",UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD:"Unable to stick to object without absolute coordinates",STICK_RECURSION_NOT_ALLOWED:"Stick recursion is not allowed",UNABLE_ADD_MISTYPED_NODE:"Unable to link mistyped node to connector",UNABLE_ADD_DIFF_OWNER_OBJ:"Object with different owner can not be linked to connector",CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH:"Mismatched group item class",SORT_FUNC_UNSET:"Sort function is not set",SOURCE_FRAGMENT_NOT_SET:"Source structure fragment not set",UNABLE_ADD_NONMOLECULE_MAP:"Unable to add non-molecule to reactants or products",CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER:"Can not add object other than node or connector to structure object container",REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND:"Can not find registered canonicalization executor",ERROR_LOADING_FILE:"Error loading file: ",READER_ID_ALREADY_EXISTS:"Can not register reader: id already exists",WRITER_ID_ALREADY_EXISTS:"Can not register writer: id already exists",FAIL_TO_READ_FORMAT:"Fail to load data of format: ",NO_SUITABLE_READER_FOR_FORMAT:"Can not read data of format: ",NO_SUITABLE_READER_FOR_MIMETYPE:"Can not read data of MIME type: ",NO_SUITABLE_READER_FOR_FILEEXT:"Can not read data of file extension: ",NO_SUITABLE_WRITER_FOR_FORMAT:"Can not write data of format: ",NO_SUITABLE_WRITER_FOR_MIMETYPE:"Can not write data of MIME type: ",NO_SUITABLE_WRITER_FOR_FILEEXT:"Can not write data of file extension: ",AJAX_FILELOADER_NOT_FOUND:"AJAX file loader not found, can not load URL",FAIL_TO_LOAD_FILE_URL:"Fail to load file of URL: ",CML_ELEM_READER_NOT_FOUND:"Reader for element <{0}> not found",ATOMID_NOT_EXISTS:"Atom id not exists: ",BONDID_NOT_EXISTS:"Bond id not exists: ",CML_ELEM_WRITER_TYPE_INPROPER:"{0} is not a proper CML element writer for {1}",CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT:"Can not output content to empty element",UNABLE_TO_OUTPUT_AS_CML:"Unable to output object <{0}> to CML data",MDL_CTAB_ATOM_CANNOT_CREATE:"Can not create atom from source MDL format data",MDL_CTAB_BOND_CANNOT_CREATE:"Can not create bond from source MDL format data",CAN_NOT_WRITE_NON_MOLECULE_TO_MOL:"Object is not a molecule and can not be output to connection table",MOLECULE_HAS_NO_CTAB_TO_OUTPUT:"Molecule has no connection table and can not be output to MDL format",NOT_MDL2000_FORMAT_DATA:"Data format wrong: not MDL 2000",NOT_MDL_RXN_DATA:"Not MDL Reaction(RXN) data",MALFORMED_MDL3000_COUNTLINE:"Malformed MDL 3000 count line",MDL3000_ATOMBLOCK_NOT_FOUND:"Atom block not found, malformed MDL 3000 data?",NOT_MDL_FORMAT_DATA:"Data format wrong: not MDL 2000 or 3000",NOT_MDL2000_RXN_DATA:"Not MDL RXN 2000 data",NOT_MDL3000_RXN_DATA:"Not MDL RXN 3000 data",NOT_MDL3000_RXN_COUNTLINE:"Error in reading RXN 3000 count line",MDL_OUTPUT_DATATYPE_NOT_TEXT:"MDL data can not be output to non text format",MDL_INPUT_DATATYPE_NOT_TEXT:"Non text format is not a legal MDL source data",UNABLE_TO_OUTPUT_AS_MDL:"Unable to output object <{0}> to MDL data",KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT:"Non text or JSON format data is not a legal KCJ source",KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT:"Can not output as non text or JSON data",KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT:"Non text or DOM data is not a legal KCX source",KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT:"Can not output as non text or DOM data",JSON_SERIALIZER_NOT_EXISTS:"Serializer for JSON not exists",XML_SERIALIZER_NOT_EXISTS:"Serializer for XML not exists",JCAMP_DATA_WITHOUT_TITLE_LINE:"Malformed JCAMP format data, not started with TITLE label",JCAMP_OTHER_LABEL_BEFORE_TITLE_LINE:"Malformed JCAMP format data, not started with TITLE label",JCAMP_MORE_THAN_ONE_ROOT_BLOCK:"Malformed JCAMP format data, root block not unique",JCAMP_MORE_THAN_TWO_NEST_LEVEL:"Malformed JCAMP format data, block nested level should not exceed 2",JCAMP_ASDF_FORMAT_ERROR_WITH_STR:"Malformed JCAMP ASDF String: {0}",JCAMP_DATA_TABLE_X_VALUE_CHECK_ERROR:"JCAMP data table X value check failed!",JCAMP_DATA_TABLE_Y_VALUE_CHECK_ERROR:"JCAMP data table Y value check failed!",JCAMP_DATA_TABLE_VALUE_FIRST_LAST_NOT_MATCH:"JCAMP data table first/last values not match",JCAMP_DATA_TABLE_VAR_LIST_FORMAT_ERROR:"Malformed JCAMP variable list format: {0}",JCAMP_DATA_TABLE_VAR_LIST_FORMAT_UNSUPPORTED:"Unsupported JCAMP variable list format: {0}",JCAMP_NTUPLES_BEGIN_END_NAME_NOT_MATCH:"Ntuples name not match in begin/end labels: {0} and {1}",JCAMP_NTUPLES_PAGE_DECLARATION_FORMAT_ERROR:"Malformed JCAMP ntuples page declaration: {0}",JCAMP_LDR_TARGET_UNIT_NOT_MATCH_WITH_DETAIL:"The unit of property {0} ({1}) can not be converted to the request one ({2}) for JCAMP {3} LDR",FAILED_TO_ASSIGN_SYMBOL_TO_VARIABLE:"Fail to assign a symbol to variable {0}",JCAMP_IMPLICIT_HYDROGEN_COUNT_NOT_MATCH_DETAIL:"Unmatched implicit hydrogen count for atom {0}({1}), expect {2} but found {3}",VISIBLE_DATA_RANGE_IS_EMPTY:"The visible range of data is empty, unable to draw the spectrum",INAVAILABLE_AUTOSCALE_REF_LENGTH:"Can not determine the length for calculation of auto scale",FORMULA_RENDERER_3D_NOT_AVAILABLE:"3D renderer for molecule formula is not available",CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ:"Can not find suitable renderer for object",THREEJS_LIB_NOT_UNAVAILABLE:"Three.js not available, try to include it through the <script> tag or import the module by Kekule.externalResourceManager.register method",THREEJS_DRAWING_NOT_UNAVAILABLE:"Webgl, Canvas or SVG is not supported in this browser, please upgrade to a modern one",CANVAS2D_NOT_UNAVAILABLE:"Canvas is not supported in this browser, please upgrade to a modern one",RAPHAEL_LIB_NOT_UNAVAILABLE:"Raphael.js not available, try to import it through the <script> tag",RAPHAEL_SVG_VML_UNAVAILABLE:"SVG or VML is not supported in this browser, please upgrade to a modern one",CALC_TERMINATED_BY_USER:"Calculation terminated by user",CALC_SERVICE_UNAVAILABLE:'Calculation service "{0}" is unavailable'}),Kekule.Localization.addResource("en","ErrorCheckMsg",{GENERAL_ERROR_WITH_CODE:"Error code: {0}",ATOM_VALENCE_ERROR_WITH_SUGGEST:"Abnormal valence {1} of atom {0}, the possible value is {2}",ATOM_VALENCE_ERROR_WITH_SUGGESTS:"Abnormal valence {1} of atom {0}, the possible values are {2}",BOND_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"The bond order ({0}) exceeds the maximum allowed value ({1})",BOND_WITH_ID_ORDER_EXCEED_ALLOWED_WITH_SUGGEST:"The bond order of {0} ({1}) exceeds the maximum allowed value {2}",NODE_DISTANCE_TOO_CLOSE:"Atoms/subgroups are very close to each other",NODE_DISTANCE_TOO_CLOSE_WITH_LABEL:"Atoms/subgroups ({0}) are very close to each other",TITLE_CHANGE_BOND_ORDER_TO:"Change bond order to {0}",DESCRIPTION_CHANGE_BOND_ORDER_TO:"Change bond order from {0} to {1}",TITLE_MERGE_TO:"Merge {0} to {1}",DESCRIPTION_MERGE_TO:"Merge node {0} to {1}"}),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("widget"),Kekule.Localization.addResource("en","WidgetTexts",{CAPTION_OK:"OK",CAPTION_CANCEL:"Cancel",CAPTION_YES:"Yes",CAPTION_NO:"No",CAPTION_BROWSE_COLOR:"Browse colors",HINT_BROWSE_COLOR:"Browse more colors",S_COLOR_UNSET:"(unset)",S_COLOR_DEFAULT:"(default)",S_COLOR_MIXED:"(mixed)",S_COLOR_TRANSPARENT:"(transparent)",S_OBJECT_UNSET:"(none)",S_ITEMS:"item(s)",S_OBJECT:"object",S_VALUE_UNSET:"(Unset)",CAPTION_MENU:"Menu",HINT_MENU:"Open menu",S_INSPECT_NONE:"(none)",S_INSPECT_OBJECTS:"({0} objects)",S_INSPECT_ID_OBJECT:"{0}: {1}",S_INSPECT_ANONYMOUS_OBJECT:"({0})",CAPTION_TOGGLE_TEXTWRAP:"Toggle text wrapping",CAPTION_INC_TEXT_SIZE:"Increase text size",CAPTION_DEC_TEXT_SIZE:"Decrease text size",HINT_TOGGLE_TEXTWRAP:"Toggle the state of text wrapping",HINT_INC_TEXT_SIZE:"Increase text size",HINT_DEC_TEXT_SIZE:"Decrease text size",HINT_CHOOSE_FONT_FAMILY:"Choose font family",CAPTION_FIRST_PAGE:"First",CAPTION_LAST_PAGE:"Last",CAPTION_PREV_PAGE:"Prev",CAPTION_NEXT_PAGE:"Next",HINT_FIRST_PAGE:"First page",HINT_LAST_PAGE:"Last page",HINT_PREV_PAGE:"Previous page",HINT_NEXT_PAGE:"Next page",HINT_CURR_PAGE:"Current page",MSG_RETRIEVING_DATA:"Loading data...",CAPTION_DATATABLE_EDIT:"Edit",CAPTION_DATATABLE_DELETE:"Delete",CAPTION_DATATABLE_INSERT:"Insert",HINT_DATATABLE_EDIT:"Edit",HINT_DATATABLE_DELETE:"Delete",HINT_DATATABLE_INSERT:"Insert",CAPTION_ADD_CELL:"+",HINT_ADD_CELL:"Add new cell",CAPTION_REMOVE_CELL:"Remove",HINT_REMOVE_CELL:"Remove cell",CAPTION_CONFIG:"Settings...",HINT_CONFIG:"Change settings",TITLE_IMG_FORMAT_PNG:"PNG format image",TITLE_IMG_FORMAT_JPG:"Jpeg format image",TITLE_IMG_FORMAT_GIF:"GIF format image",TITLE_IMG_FORMAT_SVG:"SVG format image"}),Kekule.Localization.addResource("en","ChemWidgetTexts",{CAPTION_CLEAROBJS:"Clear",CAPTION_LOADFILE:"Load...",CAPTION_LOADDATA:"Load...",CAPTION_SAVEFILE:"Save...",CAPTION_ZOOMIN:"Zoom In",CAPTION_ZOOMOUT:"Zoom Out",CAPTION_RESETZOOM:"Reset Zoom",CAPTION_RESETVIEW:"Reset",CAPTION_ROTATE:"Rotate",CAPTION_ROTATELEFT:"Left Rotate",CAPTION_ROTATERIGHT:"Right Rotate",CAPTION_ROTATEX:"X Rotate",CAPTION_ROTATEY:"Y Rotate",CAPTION_ROTATEZ:"Z Rotate",CAPTION_MOL_DISPLAY_TYPE:"Molecule Display Style",CAPTION_SKELETAL:"Skeletal",CAPTION_CONDENSED:"Condensed",CAPTION_WIRE:"Wire Frame",CAPTION_STICKS:"Sticks",CAPTION_BALLSTICK:"Ball Stick",CAPTION_SPACEFILL:"Space Fill",CAPTION_HIDEHYDROGENS:"Show/hide hydrogens",CAPTION_AUTO_COORD_GENERATION:"Auto Coordinates Generation",CAPTION_OPENEDITOR:"Edit...",CAPTION_CHANGE_SPECTRUM_SECTION:"Switch Spectrum/Section",CAPTION_SET_SPECTRUM_DATA_ASSIGNMENT:"Set Spectrum Data Assignments",CAPTION_EDITOR_DONE:"Done",CAPTION_EDITOR_CANCEL:"Cancel",CAPTION_EDIT_OBJ:"Edit",HINT_CLEAROBJS:"Clear objects",HINT_LOADFILE:"Load from file",HINT_LOADDATA:"Load data",HINT_SAVEFILE:"Save to file",HINT_ZOOMIN:"Zoom in",HINT_ZOOMOUT:"Zoom out",HINT_RESETZOOM:"Reset zoom",HINT_RESETVIEW:"Reset zoom and rotation",HINT_ROTATE:"Rotate",HINT_ROTATELEFT:"Rotate in anticlockwise direction",HINT_ROTATERIGHT:"Rotate in clockwise direction",HINT_ROTATEX:"Rotate around X axis",HINT_ROTATEY:"Rotate around Y axis",HINT_ROTATEZ:"Rotate around Z axis",HINT_MOL_DISPLAY_TYPE:"Change molecule display style",HINT_SKELETAL:"Show molecule in skeletal style",HINT_CONDENSED:"Show molecule in condensed style",HINT_WIRE:"Show molecule in wire frame style",HINT_STICKS:"Show molecule in sticks style",HINT_BALLSTICK:"Show molecule in ball-stick style",HINT_SPACEFILL:"Show molecule in space-fill style",HINT_HIDEHYDROGENS:"Show/hide hydrogen atoms in model",HINT_AUTO_COORD_GENERATION:"Generate coordinates for molecule atoms",HINT_OPENEDITOR:"Open an editor to modify displayed object",HINT_CHANGE_SPECTRUM_SECTION:"Switch spectrum or data section",HINT_SET_SPECTRUM_DATA_ASSIGNMENT:"Link chem object to spectrum data as assignment",HINT_EDITOR_DONE:"Save the modification",HINT_EDITOR_CANCEL:"Discard the modification",CAPTION_NEWDOC:"New",CAPTION_UNDO:"Undo",CAPTION_REDO:"Redo",CAPTION_COPY:"Copy",CAPTION_COPY_WHOLE:"Copy",CAPTION_CUT:"Cut",CAPTION_PASTE:"Paste",CAPTION_TOGGLE_SELECT:"Toggle select",CAPTION_SELECT_ALL:"Select all",CAPTION_CLONE_SELECTION:"Clone selection",CAPTION_TOGGLE_OBJ_INSPECTOR:"Object inspector",CAPTION_TOGGLE_ISSUE_INSPECTOR:"Issue inspector",CAPTION_TOGGLE_SHOW_ISSUE_MARKERS:"Toggle issue markers",CAPTION_ERASE_SELECTION:"Erase selection",CAPTION_RECHECK_ISSUES:"Recheck issues",CAPTION_MANIPULATE:"Select",CAPTION_MANIPULATE_MARQUEE:"Marquee select",CAPTION_MANIPULATE_LASSO:"Lasso select",CAPTION_MANIPULATE_BRUSH:"Brush select",CAPTION_MANIPULATE_ANCESTOR:"Select molecule",CAPTION_CLIENT_DRAGSCROLL:"Scroll",CAPTION_ERASE:"Erase",CAPTION_TRACK_INPUT:"Track",CAPTION_MOL_BOND:"Bond",CAPTION_MOL_BOND_SINGLE:"Single bond",CAPTION_MOL_BOND_DOUBLE:"Double bond",CAPTION_MOL_BOND_TRIPLE:"Triple bond",CAPTION_MOL_BOND_QUAD:"Quad bond",CAPTION_MOL_BOND_EXPLICIT_AROMATIC:"Aromatic bond",CAPTION_MOL_BOND_WEDGEUP:"Wedge up bond",CAPTION_MOL_BOND_WEDGEUP_INVERTED:"Wedge up bond 2",CAPTION_MOL_BOND_WEDGEDOWN:"Wedge down bond",CAPTION_MOL_BOND_WEDGEDOWN_INVERTED:"Wedge down bond 2",CAPTION_MOL_BOND_CLOSER:"Outer bond",CAPTION_MOL_BOND_WAVY:"Wavy bond",CAPTION_MOL_BOND_DOUBLE_EITHER:"Double Either bond",CAPTION_MOL_BOND_IONIC:"Ionic bond",CAPTION_MOL_BOND_COORDINATE:"Coordinate bond",CAPTION_MOL_BOND_METALLIC:"Metallic bond",CAPTION_MOL_BOND_HYDROGEN:"Hydrogen bond",CAPTION_MOL_BOND_KEKULIZE:"Kekulize",CAPTION_MOL_BOND_HUCKLIZE:"Hucklize",CAPTION_MOL_ATOM:"Atom",CAPTION_MOL_FORMULA:"Formula",CAPTION_MOL_ATOM_AND_FORMULA:"Atom & formula",CAPTION_MOL_CHARGE:"Charge",CAPTION_MOL_CHARGE_CLEAR:"Charge clear",CAPTION_MOL_CHARGE_POSITIVE:"Positive charge",CAPTION_MOL_CHARGE_NEGATIVE:"Negative charge",CAPTION_MOL_CHARGE_SINGLET:"Singlet radical",CAPTION_MOL_CHARGE_DOUBLET:"Monoradical",CAPTION_MOL_CHARGE_TRIPLET:"Triplet radical",CAPTION_MOL_ELECTRON_LONEPAIR:"Lone pair",CAPTION_TEXT_BLOCK:"Text block",CAPTION_IMAGE_BLOCK:"Image block",CAPTION_TEXT_IMAGE:"Text & image",CAPTION_MOL_FLEXCHAIN:"Flex chain",CAPTION_MOL_FLEXRING:"Flex ring",CAPTION_REPOSITORY_RING:"Rings",CAPTION_REPOSITORY_RING_3:"Cyclopropane",CAPTION_REPOSITORY_RING_4:"Cyclobutane",CAPTION_REPOSITORY_RING_5:"Cyclopentane",CAPTION_REPOSITORY_RING_6:"Cyclohexane",CAPTION_REPOSITORY_RING_7:"Cycloheptane",CAPTION_REPOSITORY_RING_8:"Cyclooctane",CAPTION_REPOSITORY_RING_AR_6:"Benzene",CAPTION_REPOSITORY_RING_AR_5:"Cyclopentadiene",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR1:"Cyclohexane chair 1",CAPTION_REPOSITORY_CYCLOHEXANE_CHAIR2:"Cyclohexane chair 2",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH1:"Cyclohexane Haworth 1",CAPTION_REPOSITORY_CYCLOHEXANE_HARWORTH2:"Cyclohexane Haworth 2",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH1:"Cyclopentane Haworth 1",CAPTION_REPOSITORY_CYCLOPENTANE_HARWORTH2:"Cyclopentane Haworth 2",CAPTION_REPOSITORY_METHANE:"Methane",CAPTION_REPOSITORY_FISCHER1:"Fischer projection 1",CAPTION_REPOSITORY_FISCHER2:"Fischer projection 2",CAPTION_REPOSITORY_FISCHER3:"Fischer projection 3",CAPTION_REPOSITORY_SAWHORSE_STAGGERED:"Sawhorse staggered",CAPTION_REPOSITORY_SAWHORSE_ECLIPSED:"Sawhorse eclipsed",CAPTION_REPOSITORY_SUBBOND_MARK:"Substituent bond",CAPTION_REPOSITORY_ARROWLINE:"Arrows & symbols",CAPTION_REPOSITORY_GLYPH:"Glyphs",CAPTION_REPOSITORY_GLYPH_LINE:"Line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"Open arrow arc",CAPTION_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"Single side open arrow arc",CAPTION_ELECTRON_PUSHING_ARROW:"Electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_DOUBLE:"Double electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_SINGLE:"Single electron pushing arrow",CAPTION_REPOSITORY_HEAT_SYMBOL:"Heat symbol",CAPTION_REPOSITORY_ADD_SYMBOL:"Add symbol",CAPTION_TEXT_FORMAT:"Text format",CAPTION_PICK_COLOR:"Color",CAPTION_FONTNAME:"Font name",CAPTION_FONTSIZE:"Font size",CAPTION_TEXT_DIRECTION:"Text direction",CAPTION_TEXT_DIRECTION_DEFAULT:"Default",CAPTION_TEXT_DIRECTION_LTR:"Left to right",CAPTION_TEXT_DIRECTION_RTL:"Right to left",CAPTION_TEXT_DIRECTION_TTB:"Top to bottom",CAPTION_TEXT_DIRECTION_BTT:"Bottom to top",CAPTION_TEXT_HORIZONTAL_ALIGN:"Text horizontal alignment",CAPTION_TEXT_VERTICAL_ALIGN:"Text vertical alignment",CAPTION_TEXT_ALIGN_DEFAULT:"Default",CAPTION_TEXT_ALIGN_LEADING:"Leading",CAPTION_TEXT_ALIGN_TRAILING:"Trailing",CAPTION_TEXT_ALIGN_CENTER:"Center",CAPTION_TEXT_ALIGN_LEFT:"Left",CAPTION_TEXT_ALIGN_RIGHT:"Right",CAPTION_TEXT_ALIGN_TOP:"Top",CAPTION_TEXT_ALIGN_BOTTOM:"Bottom",CAPTION_NODE_LABEL_DISPLAY_MODE:"Atom label display mode",CAPTION_NODE_LABEL_DISPLAY_MODE_DEFAULT:"Default",CAPTION_NODE_LABEL_DISPLAY_MODE_SHOWN:"Show label",CAPTION_NODE_LABEL_DISPLAY_MODE_HIDDEN:"Hide label",CAPTION_NODE_LABEL_DISPLAY_MODE_SMART:"Smart",CAPTION_ATOM_MODIFIER:"Atom",CAPTION_ATOM_MODIFIER_MIXED:"[A]",CAPTION_BOND_MODIFIER:"Bond",CAPTION_CHARGE_MODIFIER:"Charge",CAPTION_GLYPH_PATH_MODIFIER:"Path",CAPTION_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"Reaction arrow & segment",CAPTION_ARC_PATH_MODIFIER:"Arc",CAPTION_MULTI_ARC_PATH_MODIFIER:"Multi-Arc",CAPTION_ELECTRON_PUSHING_ARROW_MODIFIER:"Electron pushing arrow",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"Bond forming arrow",TEXT_CHARGE_POSITIVE:"+",TEXT_CHARGE_NEGATIVE:"-",TEXT_CHARGE_UNKNOWN:"<sup>+</sup>/<sub>-</sub>",TEXT_CHARGE_NONE:"&#8709;",HINT_NEWDOC:"Create new document",HINT_UNDO:"Undo",HINT_REDO:"Redo",HINT_COPY_WHOLE:"Copy objects to internal clipboard",HINT_COPY:"Copy selection to internal clipboard",HINT_CUT:"Cut selection to internal clipboard",HINT_PASTE:"Paste from internal clipboard",HINT_CLONE_SELECTION:"Clone selection",HINT_SELECT_ALL:"Select all",HINT_TOGGLE_SELECT:"Toggle select",HINT_TOGGLE_OBJ_INSPECTOR:"Show or hide object inspector panel",HINT_TOGGLE_ISSUE_INSPECTOR:"Show or hide error inspector panel",HINT_TOGGLE_SHOW_ISSUE_MARKERS:"Show or hide issue markers",HINT_ERASE_SELECTION:"Delete all selected objects",HINT_RECHECK_ISSUES:"Recheck objects in editor for issues",HINT_MANIPULATE:"Select tool",HINT_MANIPULATE_MARQUEE:"Marquee select",HINT_MANIPULATE_LASSO:"Lasso select",HINT_MANIPULATE_BRUSH:"Brush select",HINT_MANIPULATE_ANCESTOR:"Select molecule",HINT_CLIENT_DRAGSCROLL:"Scroll",HINT_ERASE:"Erase tool",HINT_TRACK_INPUT:"Track tool",HINT_MOL_BOND:"Bond tool",HINT_MOL_BOND_SINGLE:"Single bond",HINT_MOL_BOND_DOUBLE:"Double bond",HINT_MOL_BOND_TRIPLE:"Triple bond",HINT_MOL_BOND_QUAD:"Quad bond",HINT_MOL_BOND_EXPLICIT_AROMATIC:"Explicit aromatic bond",HINT_MOL_BOND_WEDGEUP:"Wedge up bond",HINT_MOL_BOND_WEDGEUP_INVERTED:"Wedge up bond 2",HINT_MOL_BOND_WEDGEDOWN:"Wedge down bond",HINT_MOL_BOND_WEDGEDOWN_INVERTED:"Wedge down bond 2",HINT_MOL_BOND_CLOSER:"Outer bond",HINT_MOL_BOND_WAVY:"Wavy bond",HINT_MOL_BOND_DOUBLE_EITHER:"Double either bond",HINT_MOL_BOND_IONIC:"Ionic bond",HINT_MOL_BOND_COORDINATE:"Coordinate bond",HINT_MOL_BOND_METALLIC:"Metallic bond",HINT_MOL_BOND_HYDROGEN:"Hydrogen bond",HINT_MOL_BOND_KEKULIZE:"Kekulize, convert explicit aromatic bonds to compartmental single and double ones",HINT_MOL_BOND_HUCKLIZE:"Hucklize, mark bonds on aromatic rings as explicit aromatic ones",HINT_MOL_ATOM:"Atom tool",HINT_MOL_FORMULA:"Formula tool",HINT_MOL_ATOM_AND_FORMULA:"Atom and formula tool",HINT_MOL_CHARGE:"Charge tool",HINT_MOL_CHARGE_CLEAR:"Clear charge and radical",HINT_MOL_CHARGE_POSITIVE:"Positive charge",HINT_MOL_CHARGE_NEGATIVE:"Negative charge",HINT_MOL_CHARGE_SINGLET:"Singlet radical",HINT_MOL_CHARGE_DOUBLET:"Monoradical",HINT_MOL_CHARGE_TRIPLET:"Triplet radical",HINT_MOL_ELECTRON_LONEPAIR:"Lone pair electrons",HINT_TEXT_BLOCK:"Text block tool",HINT_IMAGE_BLOCK:"Image block tool",HINT_TEXT_IMAGE:"Text and image tool",HINT_MOL_FLEXCHAIN:"Flex carbon chain",HINT_MOL_FLEXRING:"Flex carbon ring",HINT_REPOSITORY_RING:"Ring structures tool",HINT_REPOSITORY_RING_3:"Cyclopropane",HINT_REPOSITORY_RING_4:"Cyclobutane",HINT_REPOSITORY_RING_5:"Cyclopentane",HINT_REPOSITORY_RING_6:"Cyclohexane",HINT_REPOSITORY_RING_7:"Cycloheptane",HINT_REPOSITORY_RING_8:"Cyclooctane",HINT_REPOSITORY_RING_AR_6:"Benzene",HINT_REPOSITORY_RING_AR_5:"Cyclopentadiene",HINT_REPOSITORY_CYCLOHEXANE_CHAIR1:"Cyclohexane chair 1",HINT_REPOSITORY_CYCLOHEXANE_CHAIR2:"Cyclohexane chair 2",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH1:"Cyclohexane Haworth 1",HINT_REPOSITORY_CYCLOHEXANE_HARWORTH2:"Cyclohexane Haworth 2",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH1:"Cyclopentane Haworth 1",HINT_REPOSITORY_CYCLOPENTANE_HARWORTH2:"Cyclopentane Haworth 2",HINT_REPOSITORY_SUBBOND_MARK:"Substituent bond",HINT_REPOSITORY_METHANE:"Methane",HINT_REPOSITORY_FISCHER1:"Fischer projection with one chiral center",HINT_REPOSITORY_FISCHER2:"Fischer projection with two chiral centers",HINT_REPOSITORY_FISCHER3:"Fischer projection with three chiral centers",HINT_REPOSITORY_SAWHORSE_STAGGERED:"Sawhorse staggered",HINT_REPOSITORY_SAWHORSE_ECLIPSED:"Sawhorse eclipsed",HINT_REPOSITORY_ARROWLINE:"Arrows and symbols tool",HINT_REPOSITORY_GLYPH:"Glyphs",HINT_REPOSITORY_GLYPH_LINE:"Line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",HINT_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_ARC:"Open arrow arc",HINT_REPOSITORY_GLYPH_SINGLE_SIDE_OPEN_ARROW_ARC:"Single side open arrow arc",HINT_REPOSITORY_HEAT_SYMBOL:"Heat symbol",HINT_REPOSITORY_ADD_SYMBOL:"Add symbol",HINT_ELECTRON_PUSHING_ARROW:"Electron pushing arrow",HINT_NODE_LABEL_DISPLAY_MODE:"Atom label display mode",HINT_TEXT_FORMAT:"Set text format",HINT_FONTNAME:"Set font name",HINT_FONTSIZE:"Set font size",HINT_PICK_COLOR:"Select color",HINT_TEXT_DIRECTION:"Set text direction",HINT_TEXT_HORIZONTAL_ALIGN:"Set text horizontal alignment",HINT_TEXT_VERTICAL_ALIGN:"Set text vertical alignment",HINT_CHARGE_NONE:"No charge",HINT_ATOM_MODIFIER:"Set atom",HINT_BOND_MODIFIER:"Set bond",HINT_CHARGE_MODIFIER:"Set charge",HINT_GLYPH_PATH_MODIFIER:"Set path properties",HINT_REACTION_ARROW_AND_SEGMENT_PATH_MODIFIER:"Set reaction arrow and segment properties",HINT_ARC_PATH_MODIFIER:"Set arc properties",HINT_MULTI_ARC_PATH_MODIFIER:"Set multi-arc properties",HINT_ELECTRON_PUSHING_ARROW_MODIFIER:"Set electron pushing arrow properties",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_MODIFIER:"Set bond forming arrow properties",HINT_USE_ATOM_CUSTOM_COLOR:"(use atom custom color)",CAPTION_LOADDATA_DIALOG:"Load data",CAPTION_LOADDATA_DIALOG_APPENDMODE:"Append to current",CAPTION_SAVEDATA_DIALOG:"Save data",CAPTION_DATA_FORMAT:"Data format:",CAPTION_DATA_SRC:"Input or paste data below:",CAPTION_LOADDATA_FROM_FILE:"Load from file",CAPTION_CHOOSEFILEFORMAT:"Choose file format",CAPTION_SELECT_FORMAT:"Select format:",CAPTION_PREVIEW_FILE_CONTENT:"Preview: ",S_DEF_SAVE_FILENAME:"Unnamed",CAPTION_ATOMLIST_PERIODIC_TABLE:"more...",CAPTION_RGROUP:"Sub group",CAPTION_VARIABLE_ATOM:"Variable Atom (list)",CAPTION_VARIABLE_NOT_ATOM:"Variable Atom (not list)",CAPTION_PSEUDOATOM:"Pseudoatom",CAPTION_DUMMY_ATOM:"Dummy Atom",CAPTION_HETERO_ATOM:"Hetero Atom",CAPTION_ANY_ATOM:"Any Atom",CAPTION_ATOM:"Atom",CAPTION_SUBGROUP:"Subgroup",CAPTION_PERIODIC_TABLE_DIALOG:"Periodic table",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM:"Select element",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEMS:"Select elements",CAPTION_TEXTBLOCK_INIT:"Enter text here",CAPTION_WIDTH:"Width",CAPTION_LENGTH:"Length",CAPTION_PATH_INDEX:"Path {0}",HINT_PATH_INDEX:"Path {0}",CAPTION_REACTION_ARROW_UNSET:"(Unset)",CAPTION_REACTION_ARROW_CUSTOM:"Custom",CAPTION_REACTION_ARROW_NORMAL:"Normal",CAPTION_REACTION_ARROW_RESONANCE:"Resonance",CAPTION_REACTION_ARROW_REVERSIBLE:"Reversible",CAPTION_REACTION_ARROW_RETROSYNTHESIS:"Retrosynthesis",HINT_REACTION_ARROW_UNSET:"Unset",HINT_REACTION_ARROW_CUSTOM:"Custom",HINT_REACTION_ARROW_NORMAL:"Normal arrow",HINT_REACTION_ARROW_RESONANCE:"Resonance arrow",HINT_REACTION_ARROW_REVERSIBLE:"Reversible arrow",HINT_REACTION_ARROW_RETROSYNTHESIS:"Retrosynthesis arrow",CAPTION_LINE_COUNT:"Line count",CAPTION_LINE_GAP:"Line gap",CAPTION_LINE:"Line",CAPTION_STARTING_ARROW:"Starting arrow",CAPTION_ENDING_ARROW:"Ending arrow",CAPTION_REACTION_ARROW_TYPE:"Reaction arrow type",CAPTION_ELECTRON_PUSHING_ARROW_TYPE:"Arrow type",CAPTION_OPPOSITE_ARROW_SIDES:"Opposite arrow sides",CAPTION_SAME_ARROW_SIDES:"Same arrow sides",CAPTION_ELECTRON_PUSHING_ARROW_1:"Single electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_1_ABBR:"Single",HINT_ELECTRON_PUSHING_ARROW_1:"Single electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_2:"Double electron pushing arrow",CAPTION_ELECTRON_PUSHING_ARROW_2_ABBR:"Double",HINT_ELECTRON_PUSHING_ARROW_2:"Double electron pushing arrow",CAPTION_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"Bond forming electron pushing arrow",HINT_BOND_FORMING_ELECTRON_PUSHING_ARROW_1:"Bond forming electron pushing arrow",LEGEND_CAPTION:"Legend",LEGEND_ELEM_SYMBOL:"Symbol",LEGEND_ELEM_NAME:"name",LEGEND_ATOMIC_NUM:"atomic number",LEGEND_ATOMIC_WEIGHT:"atomic weight",CAPTION_2D:"2D",CAPTION_3D:"3D",CAPTION_AUTOSIZE:"Autosize",CAPTION_AUTOFIT:"Autofit",CAPTION_SHOWSIZEINFO:"Show size info",CAPTION_LABEL_SIZE:"Size: ",CAPTION_BACKGROUND_COLOR:"Background color: ",CAPTION_WIDTH_HEIGHT:"width: {0}, height: {1}",PLACEHOLDER_WIDTH:"width",PLACEHOLDER_HEIGHT:"height",HINT_AUTOSIZE:"Whether graph size is determined by object automatically",HINT_AUTOFIT:"Whether object is zoomed to fullfill the whole graph",CAPTION_CHEMOBJINSERTER_GENERATING_3D_STRUCTURE:"Generating molecule 3D structure...",CAPTION_SPECTRUM_WITH_INDEX:"Spectrum {0}",CAPTION_SPECTRUM_DATASECTION_WITH_INDEX:"Data section {0}",CAPTION_INTERACTIONS:"Interactions: ",CAPTION_ENABLE_HOTTRACK:"Enable hot track",CAPTION_ENABLE_SELECT:"Enable select",CAPTION_ENABLE_MULTISELECT:"Enable multi-select",CAPTION_ASSOC_VIEWER_SIZE:"Correlated molecule viewer size: ",CAPTION_ASSOC_VIEWER_VISUAL_MODE:"Correlated molecule display mode: ",CAPTION_ASSOC_VIEWER_VISUAL_MODE_AUTO:"Auto",CAPTION_ASSOC_VIEWER_VISUAL_MODE_VISIBLE:"Always displayed",CAPTION_ASSOC_VIEWER_VISUAL_MODE_INVISIBLE:"Always hidden",S_VALUE_DEFAULT:"(Default)"}),Kekule.Localization.addResource("en","ErrorMsg",{WIDGET_CLASS_NOT_FOUND:"Widget class not found",WIDGET_CAN_NOT_BIND_TO_ELEM:"Widget {0} can not be binded to element <{1}>",LOAD_CHEMDATA_FAILED:"Failed to load data",FILE_API_NOT_SUPPORTED:"File operations are not supported by your current web browser. Please update it.",DRAW_BRIDGE_NOT_SUPPORTED:"It seems that your web browser is not modern enough to support the drawing function. Please update it.",COMMAND_NOT_REVERSIBLE:"Command can not be undone",PAGE_INDEX_OUTOF_RANGE:"Page index out of range",FETCH_DATA_TIMEOUT:"Time out to fetch data",RENDER_TYPE_CHANGE_NOT_ALLOWED:"It is not allowed to change render type",CAN_NOT_CREATE_EDITOR:"Creating editor failed",CAN_NOT_LOAD_OBJ_OTHER_THAN_SPECTRUM:"Can not load non-spectrum object",FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_SPECTRUM:"Fail to export data URI for spectrum image",FAIL_TO_EXPORT_IMAGE_DATAURI_FOR_ASSOC:"Fail to export data URI for associated image",CAN_NOT_SET_COORD_OF_CLASS:"Can not set coordinate of instance of {0}.",CAN_NOT_SET_DIMENSION_OF_CLASS:"Can not set dimension of instance of {0}.",CAN_NOT_MERGE_CONNECTORS:"Specified connectors can not be merged.",NOT_A_VALID_ATOM:"Not a valid atom",INVALID_ATOM_SYMBOL:"Invalid atom symbol",INVALID_OR_EMPTY_IMAGE:"Image is empty or invalidate"}),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("objDefines"),Kekule.OBJDEF_TEXTS={},Kekule.Localization.addResource("en","OBJDEF_TEXTS",{TITLE_PREFIX:"TITLE_",DESCRIPTION_PREFIX:"DES_",DES_ID:"Unique ID for object.",Render:{GeneralConfigs:{TITLE_drawOpacity:"Opacity",DES_drawOpacity:"Opacity (between 0-1) to draw objects"},Render2DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_displayLabelConfigs:"Display label settings",DES_displayLabelConfigs:"Settings of displayed label in molecule/chem object",TITLE_textFontConfigs:"Text and font settings",DES_textFontConfigs:"Settings about text and font of display",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule/chem object",TITLE_colorConfigs:"Color settings",DES_colorConfigs:"Color settings to display molecule/chem object",TITLE_spectrumDisplayConfigs:"Spectrum display settings",DES_spectrumDisplayConfigs:"Settings for displaying spectrum object"},MoleculeDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display mode",DES_defMoleculeDisplayType:"Default display type of molecule: in skeletal or in condensed mode",TITLE_defNodeDisplayMode:"Default atom display mode",DES_defNodeDisplayMode:"Default mode to display atom in molecule",TITLE_defHydrogenDisplayLevel:"Default hydrogen display level",DES_defHydrogenDisplayLevel:"How to display explicit or implicit hydrogens of atom",TITLE_defChargeMarkType:"Default charge mark type",DES_defChargeMarkType:null,TITLE_partialChargeDecimalsLength:"Decimal length of partial charge",DES_partialChargeDecimalsLength:"If an atom has a partical charge (e.g., +1.5), how many digits after decimal point should be displayed",TITLE_distinguishSingletAndTripletRadical:"Distinguish singlet/triplet radical",DES_distinguishSingletAndTripletRadical:"Whether use different mark to distinguish singlet(..) and triplet(^^) radical",TITLE_bondLineCap:"Bond line cap style",TITLE_bondLineJoin:"Bond line join style",TITLE_glyphLineCap:"Glyph line cap style",TITLE_glyphLineJoin:"Glyph line join style"},DisplayLabelConfigs:{TITLE_enableIsotopeAlias:"Enable isotope alias",DES_enableIsotopeAlias:"Whether isotope alias (e.g. D for 2H) is used to display atom label.",TITLE_unsetElement:"Unset element",DES_unsetElement:"Label for unset or unknown element",TITLE_dummyAtom:"Dummy atom",DES_dummyAtom:"Label for dummy atom",TITLE_heteroAtom:"Hetero atom",DES_heteroAtom:"Label for general hetero atom",TITLE_anyAtom:"Any atom",DES_anyAtom:"Label for atom wildcard",TITLE_variableAtom:"Variable atom",DES_variableAtom:"Label for variable atom or atom list",TITLE_rgroup:"RGroup",DES_rgroup:"Label for RGroup",TITLE_isoListLeadingBracket:"Atom list leading bracket",TITLE_isoListTailingBracket:"Atom list tailing bracket",TITLE_isoListDelimiter:"Atom delimiter in list",TITLE_isoListDisallowPrefix:"Prefix of not-atom list"},TextFontConfigs:{TITLE_labelFontFamily:"Label font",DES_labelFontFamily:"Font to draw general label",TITLE_atomFontFamily:"Atom font",DES_atomFontFamily:"Font to draw atom label",TITLE_supFontSizeRatio:"Superscript font size ratio",DES_supFontSizeRatio:"Ratio of Superscript text size to normal text size",TITLE_subFontSizeRatio:"Subscript font size ratio",DES_subFontSizeRatio:"Ratio of Subscript text size to normal text size",TITLE_superscriptOverhang:"Superscript text overhang",DES_superscriptOverhang:null,TITLE_subscriptOversink:"Subscript text oversink",DES_subscriptOversink:null,TITLE_textCharDirection:"Text direction",DES_textCharDirection:"Default text direction",TITLE_textHorizontalAlign:"Horizontal text alignment",DES_textHorizontalAlign:"Default horizontal text alignment of label",TITLE_textVerticalAlign:"Vertical text alignment",DES_textVerticalAlign:"Default vertical text alignment of label"},LengthConfigs:{TITLE_labelFontSize:"Label text size",DES_labelFontSize:"Size of general label text",TITLE_atomFontSize:"Atom text size",DES_atomFontSize:"Size of atom label text",TITLE_chemMarkerFontSize:"Chem marker text size",DES_chemMarkerFontSize:"Size of text in chem marker",TITLE_chemMarkerMargin:"Chem marker margin",DES_chemMarkerMargin:"Margin of chem marker to main object",TITLE_allenCenterAtomRadius:"Allen center radius",DES_allenCenterAtomRadius:"Radius to draw dot on center carbon atom in allen",TITLE_chargeMarkFontSize:"Charge mark size",DES_chargeMarkFontSize:"Font size of charge mark",TITLE_chargeMarkMargin:"Charge mark margin",DES_chargeMarkMargin:"Margin between charge mark and atom",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default length of a chemical bond",TITLE_bondLineWidth:"Bond line width",DES_bondLineWidth:"Line width to draw a chemical bond",TITLE_hashSpacing:"Hash spacing",DES_hashSpacing:"Spacing between small lines in hash bond",TITLE_multipleBondSpacingRatio:"Multiple bond spacing ratio",DES_multipleBondSpacingRatio:"Ratio of spacing between two lines in double or triple bond to bond length.",TITLE_multipleBondMaxAbsSpacing:"Max multiple bond spacing",DES_multipleBondMaxAbsSpacing:"Maximum spacing between multiple bond",TITLE_bondArrowLength:"Bond arrow length",DES_bondArrowLength:"The length of end triangle in arrow bond",TITLE_bondArrowWidth:"Bond arrow width",DES_bondArrowWidth:"The width of end triangle in arrow bond",TITLE_bondWedgeWidth:"Bond wedge max width",DES_bondWedgeWidth:"The width of ending point in wedge bond",TITLE_bondWedgeHashMinWidth:"Bond wedge min width",DES_bondWedgeHashMinWidth:"The width of starting point in wedge bond",TITLE_bondWavyRadius:"Bond wavy radius",DES_bondWavyRadius:"Radius to draw arc of wavy bond",TITLE_glyphStrokeWidth:"Glyph stroke width",DES_glyphStrokeWidth:"The default width of glyph strokes",TITLE_autofitContextPadding:"Autofit context padding",DES_autofitContextPadding:"Padding of autofit widget edge and drawn object",TITLE_glyphStickOffsetRelLength:"Glyph stick offset relative length",DES_glyphStickOffsetRelLength:"Glyph stick offset relative length",TITLE_defScaleRefLength:"Default scale reference length",DES_defScaleRefLength:"Length for calculating the auto-scale"},ColorConfigs:{TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element",TITLE_labelColor:"Label color",DES_labelColor:"Default color of general label",TITLE_atomColor:"Atom color",DES_atomColor:"Default color of atom label",TITLE_bondColor:"Bond color",DES_bondColor:"Default color of bond",TITLE_glyphStrokeColor:"Glyph stroke color",DES_glyphStrokeColor:"Default stroke color of glyph",TITLE_glyphFillColor:"Glyph fill color",DES_glyphFillColor:"Default fill color of glyph"},spectrumDisplayConfigs:{},Render3DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_environmentConfigs:"3D environment settings",DES_environmentConfigs:"Settings of 3D environment",TITLE_modelConfigs:"3D model settings",DES_modelConfigs:"Settings to render a 3D molecule model",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule"},Render3DEnvironmentConfigs:{TITLE_graphicQuality:"Graphic quality",DES_graphicQuality:"Quality of 3D graphic"},Molecule3DDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display type",DES_defMoleculeDisplayType:"Draw molecule in wire, stick, ball stick or space fill mode",TITLE_defBondSpliceMode:"Bond splice mode",DES_defBondSpliceMode:"How to draw a splice mode between two atoms with different color",TITLE_defDisplayMultipleBond:"Display multiple bond",DES_defDisplayMultipleBond:"Whether draw multiple bond lines for double or triple bond",TITLE_defBondColor:"Default bond color",DES_defBondColor:"Default bond color",TITLE_defAtomColor:"Default atom color",DES_defAtomColor:"Default atom color",TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element"},Model3DConfigs:{TITLE_hideHydrogens:"Hide hydrogens",DES_hideHydrogens:"Whether hide all hydrogen atoms in 3D model",TITLE_useVdWRadius:"Use von dar Waals radius",DES_useVdWRadius:"Whether use atom's von dar Waals radius to draw 3D model",TITLE_multiConnectorRadiusRatio:"Multi-bond radius ratio",DES_multiConnectorRadiusRatio:"If use multi-cylinder for multibond, this value is the radius ratio between multi and single bond",TITLE_multiConnectorMarginRatio:"Multi-bond margin ratio",DES_multiConnectorMarginRatio:"If multi-cylinder is used for multibond, ratio of margin between cylinders and radius of cylinder"},Length3DConfigs:{TITLE_fixedNodeRadius:"Fixed atom radius",DES_fixedNodeRadius:"If vdW radius of atom is not used, this value will be used for all atom's radius",TITLE_connectorRadius:"Bond radius",DES_connectorRadius:"Bond will be draw based on this radius in stick or ball_stick mode",TITLE_connectorLineWidth:"Bond line width",DES_connectorLineWidth:"Bond will be draw on this width in wire mode"}},Widget:{BaseWidget:{TITLE_settingFacade:"General settings",DES_settingFacade:"General settings"}},ChemWidget:{ChemObjDisplayer:{TITLE_enableLoadNewFile:"Enable load data",DES_enableLoadNewFile:"Whether loading new data is enabled"},ChemObjDisplayerConfigs:{TITLE_ioConfigs:"I/O settings",DES_ioConfigs:"Settings of input/output",TITLE_environment2DConfigs:"2D environment settings",DES_environment2DConfigs:"Settings of 2D drawing environment",TITLE_environment3DConfigs:"3D environment settings",DES_environment3DConfigs:"Settings of 3D drawing environment",TITLE_spectrumViewConfigs:"Spectrum view settings",DES_spectrumViewConfigs:"Display and interaction settings of spectrum sub view"},ChemObjDisplayerIOConfigs:{TITLE_canonicalizeBeforeSave:"Canonicalize before save",DES_canonicalizeBeforeSave:"Whether canonicalize molecule before saving it",TITLE_autoGenerateCoordsAfterLoad:"Auto generate coordinates after loading molecule",DES_autoGenerateCoordsAfterLoad:"Whether coordinates of atoms are automatically generated when loading a molecule without explicit coordinate information"},ChemObjDisplayerEnvironmentConfigs:{TITLE_antialias:"Antialias",DES_antialias:"Whether enable extra antialias strategy additional to the default one of browser",TITLE_antialiasBlurRatio:"Antialias blur ratio",DES_antialiasBlurRatio:"Antialias blur ratio",TITLE_overSamplingRatio:"Over sampling ratio",DES_overSamplingRatio:"Over sampling ratio of the drawing context"},ChemObjDisplayerSpectrumViewConfigs:{},Viewer:{TITLE_enableDirectInteraction:"Enable direct interaction",DES_enableDirectInteraction:"Whether interaction with chem object in viewer is enabled",TITLE_enableTouchInteraction:"Enable touch interaction",DES_enableTouchInteraction:"Whether touch interaction is enabled",TITLE_enableToolbar:"Enable toolbar",DES_enableToolbar:"Whether toolbar of viewer is displayed",TITLE_toolbarPos:"Toolbar Position",DES_toolbarPos:"Position of toolbar in viewer",TITLE_toolbarMarginHorizontal:"Toolbar horizontal margin",DES_toolbarMarginHorizontal:"Horizontal margin of toolbar to viewer edge",TITLE_toolbarMarginVertical:"Toolbar vertical margin",DES_toolbarMarginVertical:"Vertical margin of toolbar to viewer edge",TITLE_enableEdit:"Enable editing",DES_enableEdit:"Whether edit chem object in viewer is enabled",TITLE_modalEdit:"Modal editing",DES_modalEdit:"Using modal dialog or popup dialog to edit chem object"},ViewerConfigs:{TITLE_hotKeyConfigs:"Hot key settings",DES_hotKeyConfigs:"Setting of the hot key and action map"},ViewerHotKeyConfigs:{TITLE_hotKeys:"Hot keys",DES_hotKeys:"Hot key and action settings"}},Editor:{BaseEditorConfigs:{TITLE_uiMarkerConfigs:"UI marker settings",DES_uiMarkerConfigs:"Settings of interaction marker",TITLE_interactionConfigs:"Interaction settings",DES_interactionConfigs:"Settings about interaction of editor",TITLE_structureConfigs:"Structure settings",DES_structureConfigs:"Settings about creating molecule structure",TITLE_hotKeyConfigs:"Hot key settings",DES_hotKeyConfigs:"Setting of the hot key and action map"},ChemSpaceEditorConfigs:{TITLE_chemSpaceConfigs:"Chem space settings",DES_chemSpaceConfigs:"Settings about chem space/chem document",TITLE_styleSetterConfigs:"Style setter settings",DES_styleSetterConfigs:"Settings of style toolbar of editor"},InteractionConfigs:{TITLE_enableTrackOnNearest:"Enale track on nearest",DES_enableTrackOnNearest:"If setting to true, hot track or selection will focus on nearest object to current position, otherwise, the topmost object around will be focused.",TITLE_enableHotTrack:"Enable hot track",DES_enableHotTrack:"Whether highlighting objects under mouse position",TITLE_scrollToObjAfterLoading:"Scroll to object after loading",DES_scrollToObjAfterLoading:"Whether scroll to the newly loaded object after opening data",TITLE_autoExpandClientSizeAfterLoading:"Auto expand client size after loading",DES_autoExpandClientSizeAfterLoading:"Whether expand the client size automatically after loading a large object out of boundary",TITLE_autoExpandClientSizeAfterManipulation:"Auto expand client size after manipulation",DES_autoExpandClientSizeAfterManipulation:"Whether expand the client size automatically when moving a object out of the boundary of editor",TITLE_autoSelectNewlyInsertedObjects:"Auto select new inserted objects",DES_autoSelectNewlyInsertedObjects:"Whether select objects newly inserted or modified in editor automatically",TITLE_autoSelectNewlyInsertedObjectsOnTouch:"Auto select new inserted objects in touch device",DES_autoSelectNewlyInsertedObjectsOnTouch:"Whether select objects newly inserted or modified in editor automatically in touch device",TITLE_objBoundTrackMinInflation:"Object bound minimal inflation (default)",DES_objBoundTrackMinInflation:"The default minimal inflation of the bound of object to make it easier to select",TITLE_objBoundTrackMinInflationMouse:"Object bound minimal inflation (mouse)",DES_objBoundTrackMinInflationMouse:"The minimal inflation of the bound of object to make it easier to select when using mouse as pointer device",TITLE_objBoundTrackMinInflationTouch:"Object bound minimal inflation (touch)",DES_objBoundTrackMinInflationTouch:"The minimal inflation of the bound of object to make it easier to select when touching on screen",TITLE_objBoundTrackMinInflationPen:"Object bound minimal inflation (pen)",DES_objBoundTrackMinInflationPen:"The minimal inflation of the bound of object to make it easier to select when using pen as pointer device",TITLE_objBoundTrackInflationRatio:"Object bound inflation ratio (default)",DES_objBoundTrackInflationRatio:"The default inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select",TITLE_objBoundTrackInflationRatioMouse:"Object bound inflation ratio (mouse)",DES_objBoundTrackInflationRatioMouse:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when using mouse as pointer device",TITLE_objBoundTrackInflationRatioPen:"Object bound inflation ratio (pen)",DES_objBoundTrackInflationRatioPen:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when using pen as pointer device",TITLE_objBoundTrackInflationRatioTouch:"Object bound inflation ratio (touch)",DES_objBoundTrackInflationRatioTouch:"The inflation ratio (compaing with the default bond length) of the bound of object to make it easier to select when touching on screen",TITLE_selectionMarkerInflation:"Selection marker inflation",DES_selectionMarkerInflation:"Inflation of object selection mark, makes it easier to see the containing objects",TITLE_selectionMarkerEdgeInflation:"Selection edge inflation",DES_selectionMarkerEdgeInflation:"Inflation when judging if a coord is on selection mark edge",TITLE_followPointerCoordOnDirectManipulatingSingleObj:"Follow pointer coordinate on direct manipulating object",DES_followPointerCoordOnDirectManipulatingSingleObj:"If true, the new coordinate of manipulating object will be set directly by the position of pointer (rather than the delta coordinate to the original position)",TITLE_followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold:"Threshold of following pointer coordinate on direct manipulating object",DES_followPointerCoordOnDirectManipulatingSingleObjDistanceThreshold:"Threshold when following pointer coordinate on direct manipulating object",TITLE_constrainedResizeStep:"Constrained resize step",DES_constrainedResizeStep:"Constrained resize step",TITLE_constrainedRotateStep:"Constrained rotation step",DES_constrainedRotateStep:"Constrained rotation step, in arc",TITLE_rotationLocationPointDistanceThreshold:"Rotation starting min distance",DES_rotationLocationPointDistanceThreshold:"Rotation will occur only when mouse point distance (from rotation center) larger than this value",TITLE_directedMoveDistanceThreshold:"Direct move min distance",DES_directedMoveDistanceThreshold:"Direct moving will only be done if moved distance large than this value",TITLE_enablePartialAreaSelecting:"Enable partial selecting",DES_enablePartialAreaSelecting:"If this value is true, when drag a selecting rubber band, object partly in the band will be totally selected",TITLE_selectingBrushWidth:"Brush selecting Width",DES_selectingBrushWidth:"Width of brush in brush selecting",TITLE_enableOffSelectionManipulation:"Enable off-selection manipulation",DES_enableOffSelectionManipulation:"When setting to true, you can still move, resize or rotate selected objects by holding mouse or touch outside selection for a while",TITLE_offSelectionManipulationActivatingTimeThreshold:"Off-selection manipulation hold time",DES_offSelectionManipulationActivatingTimeThreshold:"The minimal time (in ms) need for holding mouse or touch to invoke off-selection manipulation",TITLE_selectionMarkerDefPulseDuration:"Default selection mark pulse duration",DES_selectionMarkerDefPulseDuration:"The duration (in ms) of selection mark pulse when the selection is been emphasised",TITLE_selectionMarkerDefPulseCount:"Default selection mark pulse count",DES_selectionMarkerDefPulseCount:"The pulse count when the selection is been emphasised",TITLE_rotationRegionInflation:"Rotation region inflation",DES_rotationRegionInflation:"User can rotate the selected objects by pressing and move mouse in this inflated region outside selection",TITLE_enableMergePreview:"Enable merge preview",DES_enableMergePreview:"Whether a preview operation is used rather then the actual merge operation when merge two objects in editor during manipulation. Turn on this option may improve the performance of object manipulation.",TITLE_enableGestureManipulation:"Enable gesture manipulation",DES_enableGestureManipulation:"Whether user can use touch gestures (e.g. pinch) to scale or rotate selected objects in editor",TITLE_enableGestureZoomOnEditor:"Enable gesture zoom on editor",DES_enableGestureZoomOnEditor:"Whether user can use pinch gesture to zoom in or out the editor when there is no selection existed",TITLE_trackSimplifierDistanceThreshold:"Track-input curve simplification threshold",DES_trackSimplifierDistanceThreshold:"Distance threshold in simplifying curve drawn by track-input tool",TITLE_trackSimplifierIgnoreSegmentThreshold:"Track-input ignored segment threshold",DES_trackSimplifierIgnoreSegmentThreshold:"Segment length less than this threshold drawn by track-input will be ignored in parsing",TITLE_trackMergeDistanceThreshold:"Track-input merge distance threshold",DES_trackMergeDistanceThreshold:"If a joint or end point of line segment drawn by track-inpu tool is close to another line segment (less than this threshold), it will be regarded on that line.",TITLE_trackOptimizationAngleConstraint:"Track-input optimization line cross angle constraint",DES_trackOptimizationAngleConstraint:null,TITLE_trackOptimizationDistanceConstraints:"Track-input optimization line length constraint",DES_trackOptimizationDistanceConstraints:null,TITLE_trackOptimizationPrimaryDistanceConstraint:"Track-input optimization primary line length",DES_trackOptimizationPrimaryDistanceConstraint:null,TITLE_autoAdjustZoomLevelOnTrackTouching:null,DES_autoAdjustZoomLevelOnTrackTouching:null,TITLE_editorInitialZoom:"Editor initial zoom level",DES_editorInitialZoom:"The initial zoom level of editor",TITLE_atomSetterFontSize:"Atom setter font size",DES_atomSetterFontSize:"Font size of atom setter",TITLE_allowUnknownAtomSymbol:"Allow unknown atom symbol",DES_allowUnknownAtomSymbol:"Allow inputting unknown symbol and handle it as pseudo atom in atom setter",TITLE_clonedObjectScreenOffset:"Copied object coord offset",DES_clonedObjectScreenOffset:"The distance between copied objects and origin objects when doing paste selection action in editor",TITLE_enableBondKekulizeHucklize:"Enable Kekulize and Hucklize function of bond",DES_enableBondKekulizeHucklize:"Whether Kekulize and Hucklize buttons are shown in bond modifier of editor",TITLE_enableHotKey:"Enable hot keys",DES_enableHotKey:"Whether shortcut with key pressing is enabled in editor"},UiMarkerConfigs:{TITLE_hotTrackerColor:"Hot track mark color",DES_hotTrackerColor:"Color of hot track mark",TITLE_hotTrackerOpacity:"Hot track mark opacity",DES_hotTrackerOpacity:"Opacity of hot track marker, value from 0 to 1",TITLE_selectionMarkerStrokeColor:"Selection mark stroke color",DES_selectionMarkerStrokeColor:"Stroke color of selection mark",TITLE_selectionMarkerStrokeWidth:"Selection mark stroke width",DES_selectionMarkerStrokeWidth:"Width of selection mark stroke",TITLE_selectionMarkerFillColor:"Selection mark fill color",DES_selectionMarkerFillColor:"Fill color of selection mark.",TITLE_selectionMarkerOpacity:"Selection mark opacity",DES_selectionMarkerOpacity:"Opacity of selection mark, value from 0 to 1",TITLE_selectionMarkerEmphasisOpacity:"Emphasised selection mark opacity",DES_selectionMarkerEmphasisOpacity:"Opacity of emphasised selection marker, value from 0 to 1",TITLE_selectingMarkerStrokeColor:"Selecting mark stroke color",DES_selectingMarkerStrokeColor:"Stroke color of selecting rubber band mark",TITLE_selectingMarkerStrokeWidth:"Selecting mark stroke width",DES_selectingMarkerStrokeWidth:"Stroke width of selection rubber band",TITLE_selectingMarkerStrokeDash:"Selecting mark dash style",DES_selectingMarkerStrokeDash:"Dash style of selecting rubber band",TITLE_selectingMarkerFillColor:"Selecting mark fill color",DES_selectingMarkerFillColor:"Fill color of selecting mark. Usually this value should be left blank (not filled)",TITLE_selectingMarkerOpacity:"Selecting mark opacity",DES_selectingMarkerOpacity:"Opacity of selecting mark, value from 0 to 1",TITLE_selectingBrushMarkerStrokeColor:"Brush selecting mark stroke color",DES_selectingBrushMarkerStrokeColor:"Stroke color of brush selecting mark",TITLE_selectingBrushMarkerStrokeDash:"Brush selecting mark dash style",DES_selectingBrushMarkerStrokeDash:"Dash style of brush selecting track",TITLE_selectingBrushMarkerStrokeLineCap:"Brushing selecting mark line-cap style",DES_selectingBrushMarkerStrokeLineCap:"Line-cap style of both ends of brush selecting track",TITLE_selectingBrushMarkerStrokeLineJoin:"Brushing selecting mark join point style",DES_selectingBrushMarkerStrokeLineJoin:"Join style of brush selection track segments",TITLE_selectingBrushMarkerOpacity:"Brush selecting mark opacity",DES_selectingBrushMarkerOpacity:"Opacity of brush selecting mark, value from 0 to 1",TITLE_trackMarkerStrokeColor:"Track-input mark stroke color",DES_trackMarkerStrokeColor:"Stroke color of track mark when using track-input tool to draw a structure",TITLE_trackMarkerStrokeWidth:"Track-input mark stroke width",DES_trackMarkerStrokeWidth:"Stroke width of track mark when using track-input tool to draw a structure",TITLE_trackMarkerStrokeDash:"Track-input mark dash style",DES_trackMarkerStrokeDash:"Dash style of track mark when using track-input tool to draw a structure",TITLE_trackMarkerOpacity:"Track-input mark opacity",DES_trackMarkerOpacity:"Opacity of track mark when using track-input tool to draw a structure",TITLE_flexStructureAssocMarkerColor:"Flex structure association mark color",DES_flexStructureAssocMarkerColor:"Color of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerOpacity:"Flex structure association mark opacity",DES_flexStructureAssocMarkerOpacity:"Opacity of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerFontSize:"Flex structure association mark font size",DES_flexStructureAssocMarkerFontSize:"Font size of mark showing atom count of flex ring/chain tool",TITLE_flexStructureAssocMarkerFontFamily:"Flex structure association mark font family",DES_flexStructureAssocMarkerFontFamily:"Font family of mark showing atom count of flex ring/chain tool",TITLE_issueCheckMarkerColors:"Issue check markers color",DES_issueCheckMarkerColors:"Color of issue check markers, different colors are used for different issue levels",TITLE_issueCheckMarkerStrokeWidth:"Issue check marker stroke width",DES_issueCheckMarkerStrokeWidth:"Stroke width of issue check marker outline",TITLE_issueCheckActiveMarkerStrokeWidth:"Active issue check marker stroke width",DES_issueCheckActiveMarkerStrokeWidth:"Stroke width of active issue check marker outline",TITLE_issueCheckMarkerOpacity:"Issue check marker opacity",DES_issueCheckMarkerOpacity:"Opacity of issue check marker",TITLE_issueCheckActiveMarkerOpacity:"Active Issue check marker opacity",DES_issueCheckActiveMarkerOpacity:"Opacity of active issue check marker"},StructureConfigs:{TITLE_defBondType:"Default bond type",DES_defBondType:"Default type of bond",TITLE_defBondOrder:"Default bond order",DES_defBondOrder:"Default bond order",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default bond length",TITLE_defIsotopeId:"Default isotope",DES_defIsotopeId:"Default isotope when adding a new atom",TITLE_maxFlexChainAtomCount:"Maximum flex chain atom count",DES_maxFlexChainAtomCount:"Maximum atom count when inputting with flex chain tool",TITLE_minFlexChainAtomCount:"Minimal flex chain atom count",DES_minFlexChainAtomCount:"Minimal atom count when inputting with flex chain tool",TITLE_maxFlexRingAtomCount:"Maximum flex ring atom count",DES_maxFlexRingAtomCount:"Maximum atom count when inputting with flex ring tool",TITLE_minFlexRingAtomCount:"Minimal flex ring atom count",DES_minFlexRingAtomCount:"Minimal atom count when inputting with flex ring tool",TITLE_enabledNonAtomNodeTypes:"Available non-atom structure node types",DES_enabledNonAtomNodeTypes:"Non-atom structure node types available in editor",TITLE_enabledBondForms:"Available bond forms",DES_enabledBondForms:"Bond forms available in editor"},ChemSpaceConfigs:{TITLE_defScreenSize2D:"Default 2D screen size",TITLE_defScreenSize3D:"Default 3D screen size",TITLE_autoExpandScreenSize2D:"Auto expanding size 2D",DES_autoExpandScreenSize2D:"The size used when automatically expanding editor client in 2D mode",TITLE_autoExpandScreenSize3D:"Auto expanding size 3D",DES_autoExpandScreenSize3D:"The size used when automatically expanding editor client in 3D mode",TITLE_defPadding:"Default padding",DES_defPadding:"Padding on top when adding an unpositioned object to container chem space"},HotKeyConfigs:{TITLE_hotKeys:"Hot keys",DES_hotKeys:"Hot key and action settings"},BaseEditor:{TITLE_enableCreateNewDoc:"Enable create new document",DES_enableCreateNewDoc:"Whether creating a new document is allowed",TITLE_initOnNewDoc:"Starts with a new document",DES_initOnNewDoc:"Whether create a new document automatically when composer is initialized",TITLE_enableOperHistory:"Enable undo",DES_enableOperHistory:"Whether undo/redo is enabled",TITLE_enableIssueCheck:"Enable issue check",DES_enableIssueCheck:"Whether enable issue checker to detect errors and warning among objects in editor"},ChemSpaceEditor:{TITLE_allowAppendDataToCurr:"Allow appending data",DES_allowAppendDataToCurr:"Whether allow appending data to current document"},Composer:{TITLE_enableStyleToolbar:"Enable style toolbar",DES_enableStyleToolbar:"Whether display style toolbar to set color, font and size of objects",TITLE_enableObjModifierToolbar:"Enable object modifier toolbar",DES_enableObjModifierToolbar:"Whether display toolbar with a series of object modification tools",TITLE_allowCreateNewChild:"Enable create new child object",DES_allowCreateNewChild:"Whether new direct child of document can be created",TITLE_allowAppendDataToCurr:"Allow appending data",DES_allowAppendDataToCurr:"Whether allow appending data to current document"}}}),function(){if(Kekule.PROP_AUTO_TITLE){var e=ClassEx.getPrototype(ObjectEx).defineProp;ClassEx.getPrototype(ObjectEx).defineProp=function(t,r){if(!r.title&&!r.description){var n=this.getClassName();n.startsWith("Kekule.")&&(n=n.substr(7));var o="TITLE_"+t,i="DES_"+t,a=Kekule.Localization.findValue("OBJDEF_TEXTS."+n+"."+o),s=Kekule.Localization.findValue("OBJDEF_TEXTS."+n+"."+i);r.title=a,r.description=s}return e.apply(this,[t,r])}}Kekule.ExceptionLevel={ERROR:-1,NOT_FATAL_ERROR:-10,WARNING:-2,NOTE:-3,LOG:-4,getAllLevels:function(){var e=Kekule.ExceptionLevel;return[e.ERROR,e.NOT_FATAL_ERROR,e.WARNING,e.NOTE,e.LOG]},levelToString:function(e){var t=Kekule.ExceptionLevel;return e===t.ERROR||e===t.NOT_FATAL_ERROR?"error":e===t.WARNING?"warning":e===t.NOTE?"note":"log"}},Kekule.ErrorLevel=Kekule.ExceptionLevel,Kekule.throwException=function(e,t){if(Kekule.exceptionHandler)return Kekule.exceptionHandler.throwException(e,t);var r=Kekule.ExceptionLevel;if(!t||t===r.ERROR)throw"string"==typeof e&&(e=new Kekule.Exception(e)),e;if("undefined"!=typeof console){"string"!=typeof e&&(e=e.message);var n=t===r.NOT_FATAL_ERROR?console.error:t===r.WARNING?console.warn:t===r.NOTE?console.info:console.log;n?n(e):console.log(e)}},Kekule.getExceptionMsg=function(e){return"string"==typeof e?e:"object"==typeof e?e.message:""},Kekule.raise=Kekule.throwException,Kekule.error=function(e,t){var r=t?Kekule.ExceptionLevel.NOT_FATAL_ERROR:Kekule.ExceptionLevel.ERROR;return Kekule.raise(e,r)},Kekule.chemError=function(e,t){return"string"==typeof e&&(e=new Kekule.ChemError(e)),Kekule.error(e,t)},Kekule.warn=function(e){return Kekule.raise(e,Kekule.ExceptionLevel.WARNING)},Kekule.notify=function(e){return Kekule.raise(e,Kekule.ExceptionLevel.NOTE)},Kekule.log=function(e){return Kekule.raise(e,Kekule.ExceptionLevel.LOG)},Kekule.hasLocalRes=function(){return!!Kekule.LOCAL_RES},Kekule.globalOptions={add:function(e,t){var r=Object.getCascadeFieldValue(e,Kekule.globalOptions);r&&DataType.isObjectValue(r)&&DataType.isObjectValue(t)?Object.extend(r,t):Object.setCascadeFieldValue(e,t,Kekule.globalOptions,!0)},get:function(e,t){var r=Object.getCascadeFieldValue(e,Kekule.globalOptions);return void 0===r&&(r=t),r}},Kekule.HashEx=Class.create({CLASS_NAME:"Kekule.HashEx",PROP_NAME_PREFIX:"__$key$__",initialize:function(){this._map={}},finalize:function(){this._map=null},keyToPropName:function(e){return this.PROP_NAME_PREFIX+e},has:function(e){return this._map.hasOwnProperty(this.keyToPropName(e))},set:function(e,t){return this._map[this.keyToPropName(e)]=t,this},get:function(e,t){var r=this.keyToPropName(e);return this._map.hasOwnProperty(r)?this._map[r]:t},remove:function(e){var t=this.keyToPropName(e);return this._map.hasOwnProperty(t)&&delete this._map[t],this},clear:function(){this._map={}}}),Kekule.MapEx=Class.create({CLASS_NAME:"Kekule.MapEx",initialize:function(e,t){this.isWeak=!e,Kekule.MapEx._inited||Kekule.MapEx._init();var r=e?Kekule.MapEx._implementationNonWeak:Kekule.MapEx._implementationWeak;r?this._implementation=new r:(this._keys=[],this._values=[]),t&&(this._cache={})},finalize:function(){this._implementation||(this._keys=null,this._values=null,this._cache=null)},set:function(e,t){if(this._implementation)this._implementation.set(e,t);else{var r=this._keys.indexOf(e);r>=0?this._values[r]=t:(this._keys.push(e),this._values.push(t))}return this._cache&&this._cache.key===e&&(this._cache.value=t),this},get:function(e,t){if(this._cache&&this._cache.key===e)return this._cache.value;var r,n=!1;if(this._implementation)this._implementation.has(e)&&(r=this._implementation.get(e),n=!0);else{var o=this._keys.indexOf(e);o>=0&&(r=this._values[o],n=!0)}return n&&this._cache&&(this._cache.key=e,this._cache.value=r),n?r:t},has:function(e){return this._implementation?this._implementation.has(e):this._keys.indexOf(e)>=0},remove:function(e){if(this._cache&&this._cache.key===e&&(this._cache={}),this._implementation)return this._implementation[!this._implementation||"delete"](e);var t=this._keys.indexOf(e);return t>=0&&(this._keys.splice(t,1),this._values.splice(t,1)),this},clear:function(){return this._cache&&(this._cache={}),this._implementation&&!this._debug||(this._keys=[],this._values=[]),this._implementation&&(this.isWeak?Kekule.error(Kekule.$L("ErrorMsg.CANNOT_CLEAR_WEAKMAP")):this._implementation.clear()),this},getKeys:function(){if(this._implementation){if(this.isWeak)return Kekule.error(Kekule.$L("ErrorMsg.CANNOT_GET_KEY_LIST_IN_WEAKMAP")),[];var e,t=this._implementation.keys();if(Array.from)e=Array.from(t);else if(t.next){e=[];for(var r=t.next();!r.done;)e.push(r.value),r=t.next()}else for(var n in e=[],t)e.push(n);return e}return[].concat(this._keys)},getValues:function(){if(this._implementation){if(this.isWeak)return Kekule.error(Kekule.$L("ErrorMsg.CANNOT_GET_VALUE_LIST_IN_WEAKMAP")),[];var e,t=this._implementation.values();if(Array.from)e=Array.from(t);else if(t.next){e=[];for(var r=t.next();!r.done;)e.push(r.value),r=t.next()}else for(var n in e=[],t)e.push(n);return e}return this._values},getLength:function(){return this.getKeys().length}}),Kekule.MapEx._init=function(){Kekule.MapEx._implementationWeak=null,Kekule.MapEx._implementationNonWeak=null,Kekule.$jsRoot.WeakMap&&(Kekule.MapEx._implementationWeak=Kekule.$jsRoot.WeakMap),Kekule.$jsRoot.Map&&Kekule.$jsRoot.Map.prototype.keys&&(Kekule.MapEx._implementationNonWeak=Kekule.$jsRoot.Map),Kekule.MapEx._inited=!0},Kekule.MapEx._inited=!1,Kekule.TwoTupleMapEx=Class.create({CLASS_NAME:"Kekule.TwoTupleMapEx",initialize:function(e,t){this.nonWeak=e,this.map=new Kekule.MapEx(e,t),t&&(this._level1Cache={})},finalize:function(){this._level1Cache=null,this.map.finalize()},getSecondLevelMap:function(e,t){if(e&&this._level1Cache&&e===this._level1Cache.key&&this._level1Cache.value)return this._level1Cache.value;var r=this.map.get(e);return!r&&t&&(r=new Kekule.MapEx(this.nonWeak),this.map.set(e,r)),r},set:function(e,t,r){return this.getSecondLevelMap(e,!0).set(t,r),this},get:function(e,t,r){var n=this.getSecondLevelMap(e,!1);return n?n.get(t,r):r},has:function(e,t){var r=this.getSecondLevelMap(e,!1);return!!r&&r.has(t)},remove:function(e,t){var r=this.getSecondLevelMap(e,!1);if(r)return r.remove(t)},clear:function(){this.map.clear(),this._level1Cache&&(this._level1Cache={})}}),Kekule.CoordMode={UNKNOWN:0,COORD2D:2,COORD3D:3},Kekule.ObjAnchorPosition={CORNER:0,CENTER:1,DEFAULT:0},Kekule.ClassDefineUtils={CommonSizeMethods:{getSizeOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getSize3D(t):this.getSize2D(t)},setSizeOfMode:function(e,t){return t===Kekule.CoordMode.COORD3D?this.setSize3D(e):this.setSize2D(e)},getBoxOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getBox3D(t):this.getBox2D(t)}},Size2DMethods:{fetchSize2D:function(){var e=this.getPropStoreFieldValue("size2D");return e||(e={},this.setPropStoreFieldValue("size2D",e)),e},notifySize2DChanged:function(e){this.notifyPropSet("size2D",e)},hasSize2D:function(e){var t=this.getPropStoreFieldValue("size2D"),r=t&&(void 0!==t.x||void 0!==t.y);return!r&&e&&(r=!!this.hasSize3D&&this.hasSize3D()),r},getBox2D:function(e){var t=this.getCoord2D(e)||{x:0,y:0},r=this.getSize2D(e);if(r&&(r.x||r.y)){var n={x:r.x,y:-r.y},o=Kekule.CoordUtils.add(t,n);return{x1:t.x,y1:t.y,x2:o.x,y2:o.y}}return{x1:t.x,y1:t.y,x2:t.x,y2:t.y}},get2DSizeX:function(e){var t=this.getSize2D(e);return t&&t.x||0},set2DSizeX:function(e){var t=this.fetchSize2D();t.x!=e&&(t.x=e,this.notifySize2DChanged(t))},get2DSizeY:function(e){var t=this.getSize2D(e);return t&&t.y||0},set2DSizeY:function(e){var t=this.fetchSize2D();t.y!=e&&(t.y=e,this.notifySize2DChanged(t))}},Size3DMethods:{fetchSize3D:function(){var e=this.getPropStoreFieldValue("size3D");return e||(e={},this.setPropStoreFieldValue("size3D",e)),e},notifySize3DChanged:function(e){this.notifyPropSet("size3D",e)},hasSize3D:function(e){var t=this.getPropStoreFieldValue("size3D"),r=t&&(void 0!==t.x||void 0!==t.y||void 0!==t.z);return!r&&e&&(r=!!this.hasSize2D&&this.hasSize2D()),r},getBox3D:function(e){var t=this.getCoord3D(e),r=this.getSize3D(e);if(t&&r){var n=Kekule.CoordUtils.add(t,r);return{x1:t.x,y1:t.y,z1:t.z,x2:n.x,y2:n.y,z2:n.z}}},get3DSizeX:function(e){var t=this.getSize3D(e);return t&&t.x||0},set3DSizeX:function(e){var t=this.fetchSize3D();t.x!=e&&(t.x=e,this.notifySize3DChanged(t))},get3DSizeY:function(e){var t=this.getSize3D(e);return t&&t.y||0},set3DSizeY:function(e){var t=this.fetchSize3D();t.y!=e&&(t.y=e,this.notifySize3DChanged(t))},get3DSizeZ:function(e){var t=this.getSize3D(e);return t&&t.z||0},set3DSizeZ:function(e){var t=this.fetchSize3D();t.z!=e&&(t.z=e,this.notifySize3DChanged(t))}},addStandardSizeSupport:function(e,t){ClassEx.extend(e,Kekule.ClassDefineUtils.CommonSizeMethods),(!t||t.indexOf("size2D")>=0)&&(ClassEx.defineProp(e,"size2D",{dataType:DataType.HASH,getter:function(e,t){var r=this.getPropStoreFieldValue("size2D");!r&&e&&this.hasSize3D()&&(r=this.getSize3D()),!r&&t&&(r={x:0,y:0},this.setPropStoreFieldValue("size2D",r));var n=r?{x:r.x,y:r.y}:void 0;return n&&(n=Kekule.CoordUtils.absValue(n)),n},setter:function(e){var t=this.fetchSize2D();void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),this.notifySize2DChanged(t)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Size2DMethods)),(!t||t.indexOf("size3D")>=0)&&(ClassEx.defineProp(e,"size3D",{dataType:DataType.HASH,getter:function(e,t){var r=this.getPropStoreFieldValue("size3D");return!r&&e&&this.hasSize2D()&&((r=this.getSize2D()).z=0),!r&&t&&(r={x:0,y:0,z:0},this.setPropStoreFieldValue("size3D",r)),r?{x:r.x,y:r.y,z:r.z}:void 0},setter:function(e){var t=this.fetchSize3D();void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),void 0!==e.z&&(t.z=e.z),this.notifySize3DChanged(t)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Size3DMethods))},CommonCoordMethods:{getObjAnchorPosition:function(e){var t=this.doGetObjAnchorPosition&&this.doGetObjAnchorPosition(e);return t=t||Kekule.ObjAnchorPosition.DEFAULT},getCoordParent:function(e){return this.getParent&&this.getParent()||null},getCoordOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getCoord3D(t):this.getCoord2D(t)},setCoordOfMode:function(e,t){return t===Kekule.CoordMode.COORD3D?this.setCoord3D(e):this.setCoord2D(e)},getAbsCoordOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.getAbsCoord3D(t):this.getAbsCoord2D(t)},setAbsCoordOfMode:function(e,t){return t===Kekule.CoordMode.COORD3D?this.setAbsCoord3D(e):this.setAbsCoord2D(e)},hasCoordOfMode:function(e,t){return e===Kekule.CoordMode.COORD3D?this.hasCoord3D(t):this.hasCoord2D(t)},getIndirectCoordStorageOfMode:function(e){var t=this.getIndirectCoordStorage&&this.getIndirectCoordStorage();return t&&t[e]},setIndirectCoordStorageOfMode:function(e,t){var r=this.getIndirectCoordStorage&&this.getIndirectCoordStorage();return r&&(r[e]=t),this},calcIndirectCoordValue:function(e,t){var r=["x","y"];e===Kekule.CoordMode.COORD3D&&r.push("z");var n=this.getIndirectCoordStorage()[e],o=this.getIndirectCoordRefCoords(e,t);Kekule.ArrayUtils.isArray(o)&&(o=o[0]);var i=this.getIndirectCoordRefLengths(e,t);if(n&&o&&i){for(var a={},s=Kekule.ObjUtils.notUnset,l=0,u=r.length;l<u;++l){var c,d=r[l],h=n[d],f=o[d],m=i[d];if(s(h)&&s(f)&&s(m))c=0===m?f:f+m*h,a[d]=c}return a}return null},calcIndirectCoordStorage:function(e,t,r,n){var o=["x","y"];e===Kekule.CoordMode.COORD3D&&o.push("z");var i=this.getIndirectCoordStorageOfMode(e),a=this.getIndirectCoordRefCoords(e,n);Kekule.ArrayUtils.isArray(a)&&(a=a[0]);var s=this.getIndirectCoordRefLengths(e,n);if(i&&a&&s){for(var l={},u=Kekule.ObjUtils.notUnset,c=0,d=o.length;c<d;++c){var h,f=o[c],m=t[f],g=a[f],p=s[f];if(!(u(m)&&u(g)&&u(p)))return null;h=0!==p?(m-g)/p:1,l[f]=h}return l}return null},saveIndirectCoordValue:function(e,t,r,n){if(t){var o=this.calcIndirectCoordStorage(e,t,r,n);if(o)return this.setIndirectCoordStorageOfMode(e,o),o}return null},getIndirectCoordRefLengths:function(e,t){return null},getIndirectCoordRefCoords:function(e,t){return null}},Coord2DMethods:{fetchCoord2D:function(){var e=this.getPropStoreFieldValue("coord2D");return e||(e={},this.setPropStoreFieldValue("coord2D",e)),e},notifyCoord2DChanged:function(e){this.notifyPropSet("coord2D",e)},hasCoord2D:function(e){var t=this.getPropStoreFieldValue("coord2D"),r=t&&(void 0!==t.x||void 0!==t.y);return!r&&e&&(r=!!this.hasCoord3D&&this.hasCoord3D()),r},get2DX:function(e){var t=this.getCoord2D(e);return t&&t.x||0},set2DX:function(e){var t=this.fetchCoord2D();t.x!=e&&(t.x=e,this.notifyCoord2DChanged(t))},get2DY:function(e){var t=this.getCoord2D(e);return t&&t.y||0},set2DY:function(e){var t=this.fetchCoord2D();t.y!=e&&(t.y=e,this.notifyCoord2DChanged(t))}},Coord3DMethods:{fetchCoord3D:function(){var e=this.getPropStoreFieldValue("coord3D");return e||(e={},this.setPropStoreFieldValue("coord3D",e)),e},notifyCoord3DChanged:function(e){this.notifyPropSet("coord3D",e)},hasCoord3D:function(e){var t=this.getPropStoreFieldValue("coord3D"),r=t&&(void 0!==t.x||void 0!==t.y||void 0!==t.z);return!r&&e&&(r=!!this.hasCoord2D&&this.hasCoord2D()),r},get3DX:function(e){var t=this.getCoord3D(e);return t&&t.x||0},set3DX:function(e){var t=this.fetchCoord3D();t.x!=e&&(t.x=e,this.notifyCoord3DChanged(t))},get3DY:function(e){var t=this.getCoord3D(e);return t&&t.y||0},set3DY:function(e){var t=this.fetchCoord3D();t.y!=e&&(t.y=e,this.notifyCoord3DChanged(t))},get3DZ:function(e){var t=this.getCoord3D(e);return t&&t.z||0},set3DZ:function(e){var t=this.fetchCoord3D();t.z!=e&&(t.z=e,this.notifyCoord3DChanged(t))}},addStandardCoordSupport:function(e,t){ClassEx.extend(e,Kekule.ClassDefineUtils.CommonCoordMethods),(!t||t.indexOf("coord2D")>=0)&&(ClassEx.defineProp(e,"coord2D",{dataType:DataType.HASH,getter:function(e,t){if(this.getEnableIndirectCoord()){var r=this.calcIndirectCoordValue(Kekule.CoordMode.COORD2D,e);if(r)return r}var n=this.getPropStoreFieldValue("coord2D");return!n&&e&&this.hasCoord3D()&&(n=this.getCoord3D()),!n&&t&&(n={x:0,y:0},this.setPropStoreFieldValue("coord2D",n)),n?{x:n.x,y:n.y}:void 0},setter:function(e){var t=this.fetchCoord2D();this.getEnableIndirectCoord()&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD2D,e,t),void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),this.notifyCoord2DChanged(t)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Coord2DMethods)),(!t||t.indexOf("coord3D")>=0)&&(ClassEx.defineProp(e,"coord3D",{dataType:DataType.HASH,getter:function(e,t){if(this.getEnableIndirectCoord()){var r=this.calcIndirectCoordValue(Kekule.CoordMode.COORD2D,e);if(r)return r}var n=this.getPropStoreFieldValue("coord3D");return!n&&e&&this.hasCoord2D()&&((n=this.getCoord2D()).z=0),!n&&t&&(n={x:0,y:0,z:0},this.setPropStoreFieldValue("coord3D",n)),n?{x:n.x,y:n.y,z:n.z}:void 0},setter:function(e){var t=this.fetchCoord3D();this.getEnableIndirectCoord()&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD3D,e,t),void 0!==e.x&&(t.x=e.x),void 0!==e.y&&(t.y=e.y),void 0!==e.z&&(t.z=e.z),this.notifyCoord3DChanged(t)}}),ClassEx.extend(e,Kekule.ClassDefineUtils.Coord3DMethods)),(!t||t.indexOf("absCoord2D")>=0)&&ClassEx.defineProp(e,"absCoord2D",{dataType:DataType.HASH,serializable:!1,getter:function(e){var t=this.getCoord2D(e)||{},r=this.getCoordParent(Kekule.CoordMode.COORD2D);return r&&r.getAbsCoord2D?Kekule.CoordUtils.add(t,r.getAbsCoord2D(e)||{}):{x:t.x,y:t.y}},setter:function(e,t){var r=e,n=this.getCoordParent(Kekule.CoordMode.COORD2D);n&&n.getAbsCoord2D&&(r=Kekule.CoordUtils.substract(e,n.getAbsCoord2D(t))),this.setCoord2D(r)}}),(!t||t.indexOf("absCoord3D")>=0)&&ClassEx.defineProp(e,"absCoord3D",{dataType:DataType.HASH,serializable:!1,getter:function(e){var t=this.getCoord3D(e)||{},r=this.getCoordParent(Kekule.CoordMode.COORD3D);return r&&r.getAbsCoord3D?Kekule.CoordUtils.add(t,r.getAbsCoord3D(e)||{}):{x:t.x,y:t.y,z:t.z}},setter:function(e,t){var r=e,n=this.getCoordParent(Kekule.CoordMode.COORD2D);n&&n.getAbsCoord3D&&(r=Kekule.CoordUtils.substract(e,n.getAbsCoord3D(t))),this.setCoord3D(r)}}),(!t||t.indexOf("enableIndirectCoord")>=0)&&ClassEx.defineProp(e,"enableIndirectCoord",{scope:Class.PropertyScope.PUBLIC,dataType:DataType.BOOL,serializable:!0,setter:function(e){if(this.getPropStoreFieldValue("enableIndirectCoord")!=e){if(e){var t=this.getCoord2D(),r=this.getCoord3D();t&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD2D,t,t,!0),r&&this.saveIndirectCoordValue(Kekule.CoordMode.COORD3D,r,r,!0)}this.setPropStoreFieldValue("enableIndirectCoord",e)}}}),(!t||t.indexOf("indirectCoordStorage")>=0)&&ClassEx.defineProp(e,"indirectCoordStorage",{dataType:DataType.HASH,serializable:function(){return!!this.getEnableIndirectCoord()},setter:null,getter:function(){var e=this.getPropStoreFieldValue("indirectCoordStorage");return e||((e={})[Kekule.CoordMode.COORD2D]={},e[Kekule.CoordMode.COORD3D]={},this.setPropStoreFieldValue("indirectCoordStorage",e)),e}})},ExtraObjMapMethods:{getExtraProp:function(e,t){var r=this.getExtraObjMap().get(e);return r?t?r[t]:r:void 0},setExtraProp:function(e,t,r){var n;(n=this.getExtraProp(e))?n[t]=r:((n={})[t]=r,this.getExtraObjMap().set(e,n))},removeExtraProp:function(e,t){if(t){var r=this.getExtraProp(e);r[t]=void 0,delete r[t]}else this.getExtraObjMap().remove(e)}},addExtraObjMapSupport:function(e){ClassEx.defineProp(e,"extraObjMap",{dataType:"Kekule.MapEx",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("extraObjMap");return e||(e=new Kekule.MapEx(!0,!0),this.setPropStoreFieldValue("extraObjMap",e)),e}}),ClassEx.extend(e,Kekule.ClassDefineUtils.ExtraObjMapMethods)},ExtraTwoTupleObjMapMethods:{getExtraProp2:function(e,t,r){var n=(this.__$__k__extraTwoTupleObjMap__$__||this.getExtraTwoTupleObjMap()).get(e,t);return n?r?n[r]:n:void 0},setExtraProp2:function(e,t,r,n){var o;(o=this.getExtraProp2(e,t))?o[r]=n:((o={})[r]=n,(this.__$__k__extraTwoTupleObjMap__$__||this.getExtraTwoTupleObjMap()).set(e,t,o))},removeExtraProp2:function(e,t,r){if(r){var n=this.getExtraProp2(e,t);n[r]=void 0,delete n[r]}else this.getExtraTwoTupleObjMap().remove(e,t)}},addExtraTwoTupleObjMapSupport:function(e){var t="extraTwoTupleObjMap";ClassEx.defineProp(e,t,{dataType:"Kekule.TwoTupleMapEx",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue(t);return e||(e=new Kekule.TwoTupleMapEx(!0,!0),this.setPropStoreFieldValue(t,e),this.__$__k__extraTwoTupleObjMap__$__=e),e}}),ClassEx.extend(e,Kekule.ClassDefineUtils.ExtraTwoTupleObjMapMethods)}},Kekule.ObjPropSettingManager={_items:new Kekule.MapEx(!0),register:function(e,t){Kekule.ObjPropSettingManager._items.set(e,t)},unregister:function(e){Kekule.ObjPropSettingManager._items.remove(e)},getSetting:function(e){return Kekule.ObjPropSettingManager._items.get(e)}},ClassEx.defineProp(ObjectEx,"predefinedSetting",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=Kekule.StrUtils.splitTokens(e||"",",");if(t.length){for(var r=0,n=t.length;r<n;++r){for(var o=this.getClass(),i=t[r],a=null,s="";o&&!a;){s=ClassEx.getClassName(o)+"."+i,a=Kekule.ObjPropSettingManager.getSetting(s);o=ClassEx.getSuperClass(o)}a||(a=Kekule.ObjPropSettingManager.getSetting(i)),a&&this.setPropValues(a)}this.setPropStoreFieldValue("predefinedSetting",s)}}}),Kekule.ObjectTreeOperation={MODIFY:0,ADD:1,REMOVE:2},Kekule.ChemObjInteractMode={DEFAULT:0,UNMOVABLE:1,UNSELECTABLE:2,HIDDEN:3},Kekule.ComparisonMethod={DEFAULT:0,PROPERTIES:1,CHEM_STRUCTURE:10},Kekule.ObjComparer={equal:function(e,t,r){return 0===Kekule.ObjComparer.compare(e,t,r)},compare:function(e,t,r){return Kekule.ObjComparer._compareValue(e,t,r)},_compareValue:function(e,t,r){var n=DataType;if(e===t)return 0;var o=n.getType(e),i=n.getType(t);if("number"===o&&Kekule.NumUtils.isFloatEqual(e,t))return 0;if(e<t&&!(e>t))return-1;if(e>t&&!(e<t))return 1;var a=null;if(o!==i){var s=[n.UNKNOWN,n.VARIANT,n.UNDEFINED,n.BOOL,n.NUMBER,n.INT,n.FLOAT,n.STRING,n.ARRAY,n.FUNCTION,n.DATE,n.OBJECT,n.OBJECTEX,n.CLASS],l=s.indexOf(o),u=s.indexOf(i);a=l<0&&u<0?null:l-u}else if(!e&&t)a=-1;else if(e&&!t)a=1;else if(e.doCompare)a=e.doCompare(t,r);else if(t.doCompare)a=-t.doCompare(e,r);else if(o===DataType.ARRAY){if(!(a=e.length-t.length))for(var c=0,d=e.length;c<d&&!(a=Kekule.ObjComparer._compareValue(e[c],t[c],r));++c);}else a=o===DataType.OBJECT?Kekule.ObjComparer._compareHash(e,t,r):null;if(null===a){var h=e.toString&&e.toString()||"",f=t.toString&&t.toString()||"";null===(a=h<f?-1:h>f?1:null)&&(a=-1)}return a},_compareHash:function(e,t,r){var n=Kekule.ObjUtils.getOwnedFieldNames(e)||[],o=Kekule.ObjUtils.getOwnedFieldNames(t)||[],i=n.length-o.length;if(!(i||(n.sort(),o.sort(),i=Kekule.ArrayUtils.compare(n,o))))for(var a=0,s=n.length;a<s;++a){var l=n[a],u=e[l],c=t[l];if(i=Kekule.ObjComparer.compare(u,c,r)){console.log(l,i,u,c);break}}return i}};Kekule.ChemObject=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemObject",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setId(e),this.setBubbleEvent(!0),this.__load_owner_objRef_props__=null,this.__load_parent_objRef_props__=null,this.__load_parentRoot_objRef_props__=null,this.addEventListener("change",function(e){var t=this.getPropStoreFieldValue("srcInfo");if(t&&t.data){for(var r=e.target,n=e.changedPropNames,o=!1,i=0,a=n.length;i<a;++i){var s=n[i];if(s&&"srcInfo"!==s&&r.isPropertySerializable(s)){o=!0;break}if("[children]"===s){o=!0;break}}o&&(t.data=null)}},this)},doFinalize:function(){this.__load_owner_objRef_props__=null,this.__load_parent_objRef_props__=null,this.__load_parentRoot_objRef_props__=null,this.setPropStoreFieldValue("attachedCoordStickNodes",null),this.removeSelf(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("id",{dataType:DataType.STRING}),this.defineProp("interactMode",{dataType:DataType.INT,enumSource:Kekule.ChemObjInteractMode}),this.defineProp("info",{dataType:DataType.HASH,getter:function(e){var t=this.getPropStoreFieldValue("info");return!t&&e&&(t={},this.setPropStoreFieldValue("info",t)),t}}),this.defineProp("scalarAttribs",{dataType:DataType.ARRAY,setter:null}),this.defineProp("parent",{dataType:"Kekule.ChemObject",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getParent();t!==e&&(t&&t._removeChildObj&&(t._removeChildObj(this),this.invokeEvent("removeFromObjTree",{obj:this,parent:t})),this.setPropStoreFieldValue("parent",e),e&&e._appendChildObj&&(e._appendChildObj(this),this.invokeEvent("addToObjTree",{obj:this,parent:e})),this.parentChanged(e,t))}}),this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getOwner();t!==e&&(t&&(t._removeOwnedObj(this),this.invokeEvent("removeFromSpace",{obj:this,owner:t})),this.setPropStoreFieldValue("owner",e),e&&(e._appendOwnedObj(this),this.invokeEvent("addToSpace",{obj:this,owner:t})),this.ownerChanged(e,t))}}),this.defineProp("srcInfo",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("srcInfo");return e||(e={},this.setPropStoreFieldValue("srcInfo",e)),e}}),this.defineProp("isEditing",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getOwner();return e&&e.getIsEditing?e.getIsEditing():this.getPropStoreFieldValue("isEditing")}}),this.defineProp("attachedCoordStickNodes",{dataType:DataType.ARRAY,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("attachedCoordStickNodes");return e||(e=[],this.setPropStoreFieldValue("attachedCoordStickNodes",e)),e}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setEnableObjectChangeEvent(!0)},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},getAutoIdPrefix:function(){return"o"},_parentObjectLoaded:function(e){},_ownerObjectLoaded:function(e){},_handleObjRefProps:function(e,t){var r=t;if(r)for(var n=Kekule.ObjUtils.getOwnedFieldNames(r),o=0,i=n.length;o<i;++o){var a=n[o],s=this.getPropInfo(a),l=this._doGetPropObjRefObjInfo(this,s,e).rootObj,u=r[a];if(DataType.isArrayValue(u)){var c=[];for(o=0,i=u.length;o<i;++o){if(f=this._doUnwrapObjRefSerializationStr(this,u[o])){var d=l.getChildAtIndexStack(f);c.push(d)}else c.push(void 0)}this.setPropValue(a,c)}else{var h,f;(f=this._doUnwrapObjRefSerializationStr(this,u))&&(h=l.getChildAtIndexStack(f)),h&&this.setPropValue(a,h)}try{delete r[a]}catch(e){}}},doSaveProp:function(e,t,r,n,o,i,a,s){if(t.serializable&&(e._doGetObjRefSerializationValue&&!!t.objRef)){var l=e._doGetPropObjRefObjInfo(e,t,i);if(l){var u=l.rootObj;if(u){var c=e.getPropValue(t.name);if(c){if(Kekule.ArrayUtils.isArray(c)){for(var d=[],h=0,f=c.length;h<f;++h){var m=e._doGetObjRefSerializationValue(u,e,c[h],l.objRefRoot);m?d.push(m):d.push(c[h])}return o.doSaveFieldValue(e,t.name,d,r,o.getValueExplicitType(d),n,u,a,s),!0}var g=e._doGetObjRefSerializationValue(u,e,c,l.objRefRoot);if(g)return o.doSaveFieldValue(e,t.name,g,r,o.getValueExplicitType(g),n,u,a,s),!0}}}}},_doGetObjRefSerializationValue:function(e,t,r,n){var o=e.indexStackOfChild&&e.indexStackOfChild(r);if(o&&o.length){return"@"+JSON.stringify(o)}return null},doLoadProp:function(e,t,r,n,o,i,a){if(t.serializable&&!!t.objRef){var s=n.doLoadFieldValue(e,t.name,r,null,o,i,a);if(s){var l=(e._doGetPropObjRefObjInfo&&e._doGetPropObjRefObjInfo(e,t,i)).storageObjName,u=e[l];return u||(u={},e[l]=u),u[t.name]=s,!0}}},_doUnwrapObjRefSerializationStr:function(e,t){try{var r=t.startsWith("@")?t.substr("@".length):t,n=JSON.parse(r);return DataType.isArrayValue(n)?n:null}catch(e){Kekule.error(e)}},_doGetPropObjRefObjInfo:function(e,t,r){var n=t.objRefRoot,o="owner"===n,i="storageRoot"===n,a="parent"===n?e.getParent&&e.getParent():o?e.getOwner&&e.getOwner():i?r:null;if(!a){var s=e.getOwner&&e.getOwner();s?(n="owner",o=!0,a=s):(n="storageRoot",i=!0,a=r)}return{objRefRoot:n,rootObj:a,storageObjName:"__load_objRef_props__"}},loaded:function(e){this.tryApplySuper("loaded",[e]),this.notifyParentLoaded()},allLoaded:function(e){this.tryApplySuper("allLoaded",[e]),this._handleObjRefProps(e,this.__load_objRef_props__)},notifyParentLoaded:function(){for(var e=0,t=this.getChildCount();e<t;++e){var r=this.getChildAt(e);r&&r._parentObjectLoaded&&r._parentObjectLoaded(this)}},isObjRefProperty:function(e){return!(!e||!e.objRef)},notifyPropSet:function(e,t,r){this.tryApplySuper("notifyPropSet",[e,t,r]);var n=this.getPropInfo(e);if(n&&this.isObjRefProperty(n)){var o=this.getOwner();o&&o.modifyObjRefRelation&&o.modifyObjRefRelation(this,n,this.getPropValue(n.name))}},getObjRefProperties:function(){for(var e=[],t=this.getAllPropList(),r=0,n=t.getLength();r<n;++r){var o=t.getPropInfoAt(r);this.isObjRefProperty(o)&&e.push(o)}return e},_registerObjRefRelations:function(e){if(e&&e.modifyObjRefRelation){var t=this.getObjRefProperties();if(t.length)for(var r=0,n=t.length;r<n;++r){var o=t[r],i=this.getPropValue(o.name);e.modifyObjRefRelation(this,o,i)}}},_unregisterObjRefRelations:function(e){if(e&&e.releaseObjRefRelation){var t=this.getObjRefProperties();if(t.length)for(var r=0,n=t.length;r<n;++r){var o=t[r];e.releaseObjRefRelation(this,o)}}},isSelectable:function(){var e=Kekule.ChemObjInteractMode;return!((this.getInteractMode()||e.DEFAULT)&e.UNSELECTABLE)},isMovable:function(){var e=Kekule.ChemObjInteractMode;return!((this.getInteractMode()||e.DEFAULT)&e.UNMOVABLE)},getNearestSelectableObject:function(){return this.isSelectable()?this:this.getParent()?this.getParent().getNearestSelectableObject():null},getNearestMovableObject:function(){return this.isMovable()?this:this.getParent()?this.getParent().getNearestMovableObject():null},getNearestAncestorOfType:function(e){var t=this.getParent();return t?t instanceof e?t:t.getNearestAncestorOfType?t.getNearestAncestorOfType(e):null:null},removeSelf:function(){this.setParent(null),this.setOwner(null)},notifyScalarAttribsChange:function(){this.notifyPropSet("scalarAttribs",this.getPropStoreFieldValue("scalarAttribs"))},notifyInfoChange:function(){this.notifyPropSet("info",this.getPropStoreFieldValue("info"))},_removeChildObj:function(e){this._notifyOwnerObjTreeOperation(e,this,Kekule.ObjectTreeOperation.REMOVE)},_appendChildObj:function(e){this._notifyOwnerObjTreeOperation(e,this,Kekule.ObjectTreeOperation.ADD)},_notifyOwnerObjTreeOperation:function(e,t,r){var n=this.getOwner();n&&n._notifyObjTreeOperation&&n._notifyObjTreeOperation(e,t,r)},objTreeOfOwnerUpdated:function(e,t,r){},objSpaceOfOwnerUpdated:function(e,t,r){},ownerChanged:function(e,t){for(var r=0,n=this.getScalarAttribCount();r<n;++r)this.getScalarAttribAt(r).setOwner(e);for(r=0,n=this.getChildCount();r<n;++r){var o=this.getChildAt(r);o&&o.setOwner&&o.setOwner(e)}},parentChanged:function(e,t){},getParentList:function(){var e=[],t=this.getParent();return t&&(t.getParentList&&(e=t.getParentList()||[]),e.unshift(t)),e},getParentRoot:function(){var e=this.getParent();return e&&e.getParentRoot&&(e=e.getParentRoot()||e),e},isChildOf:function(e){for(var t=this.getParent();t&&t!==e;)t=t.getParent?t.getParent():null;return!!t},getNextSibling:function(){var e=this.getParent();return e&&e.getNextSiblingOfChild?e.getNextSiblingOfChild(this):null},isSiblingWith:function(e){var t=this.getParent(),r=e.getParent&&e.getParent();return t&&r&&t===r},getChildHolder:function(){return this},getChildSubgroupNames:function(){return[]},getBelongChildSubGroupName:function(e){return null},_getPrevSubgroupChildrenCount:function(e){for(var t=this.getChildSubgroupNames(),r=0,n=0,o=t.length;n<o;++n){if(t[n]===e)return r;var i=this._getSubGroupChildCountMethod(t[n]);r+=i&&i.apply(this)||0}return r},_getSubgroupChildIndexInfoFromChildIndex:function(e){for(var t=this.getChildSubgroupNames(),r=0,n=0,o=t.length;n<o;++n){var i=this._getSubGroupChildCountMethod(t[n]),a=i&&i.apply(this)||0;if(e<r+a)return{name:t[n],index:e-r};r+=a}return null},_getSubGroupChildCountMethod:function(e){return this["get"+e.upperFirst()+"Count"]},_getSubGroupChildAtMethod:function(e){return this["get"+e.upperFirst()+"At"]},_getSubGroupChildIndexOfMethod:function(e){return this["indexOf"+e.upperFirst()]},_getSubGroupChildRemoveMethod:function(e){return this["remove"+e.upperFirst()]},_getSubGroupChildRemoveAtMethod:function(e){return this["remove"+e.upperFirst()+"At"]},_getSubGroupChildAppendMethod:function(e){return this["append"+e.upperFirst()]},_getSubGroupChildInsertBeforeMethod:function(e){return this["insert"+e.upperFirst()+"Before"]},_getSubGroupChildInsertAtMethod:function(e){return this["insert"+e.upperFirst()+"At"]},_ensureSubGroupChildMethodsExist:function(){for(var e=["_getSubGroupChildCountMethod","_getSubGroupChildAtMethod","_getSubGroupChildIndexOfMethod","_getSubGroupChildRemoveMethod","_getSubGroupChildRemoveAtMethod","_getSubGroupChildInsertBeforeMethod","_getSubGroupChildInsertAtMethod"],t=this.getChildSubgroupNames(),r=0,n=t.length;r<n;++r)for(var o=0,i=e.length;o<i;++o){this[e[o]].apply(this,[t[r]])||Kekule.warn("Subgroup child method not exisits: "+e[o]+" / "+this.getClassName())}},getChildCount:function(){var e=this.getChildHolder();return e&&e!==this?e.getChildCount():this.doGetChildCount()},doGetChildCount:function(){for(var e=0,t=this.getChildSubgroupNames(),r=0,n=t.length;r<n;++r){var o=this._getSubGroupChildCountMethod(t[r]);o&&(e+=o.apply(this))}return e},getChildAt:function(e){var t=this.getChildHolder();return t&&t!==this?t.getChildAt(e):this.doGetChildAt(e)},doGetChildAt:function(e){var t=this._getSubgroupChildIndexInfoFromChildIndex(e);if(t){var r=this._getSubGroupChildAtMethod(t.name);return r&&r.apply(this,[t.index])}return null},indexOfChild:function(e){var t=this.getChildHolder();return t&&t!==this?t.indexOfChild(e):this.doIndexOfChild(e)},doIndexOfChild:function(e){for(var t=this.getChildSubgroupNames(),r=0,n=t.length;r<n;++r){var o=this._getSubGroupChildIndexOfMethod(t[r]);if(o){var i=o.apply(this,[e]);if(i>=0)return this._getPrevSubgroupChildrenCount(t[r])+i}}return-1},hasChild:function(e){return this.indexOfChild(e)>=0},filterChildren:function(e,t){for(var r=[],n=0,o=this.getChildCount();n<o;++n){var i=this.getChildAt(n);if(i)if(e(i,n))r.push(i);else if(t&&i.filterChildren){var a=i.filterChildren(e,t);a&&a.length&&(r=r.concat(a))}}return r},iterateChildren:function(e,t){for(var r=0,n=this.getChildCount();r<n;++r){var o=this.getChildAt(r);o&&(e(o,r),t&&o.iterateChildren&&o.iterateChildren(e,t))}},removeChildAt:function(e){return this.doRemoveChildAt(e)},doRemoveChildAt:function(e){var t=this._getSubgroupChildIndexInfoFromChildIndex(e);if(t){var r=this._getSubGroupChildRemoveAtMethod(t.name);return r&&r.apply(this,[t.index])}return null},removeChild:function(e){var t=this.getChildHolder();return t&&t!==this?t.removeChild(e):this.doRemoveChild(e)},doRemoveChild:function(e){for(var t,r=this.getChildSubgroupNames(),n=0,o=r.length;n<o;++n){var i=this._getSubGroupChildRemoveMethod(r[n]);if(i&&(t=i.apply(this,[e])))return t}return null},removeChildren:function(e){for(var t=e.length-1;t>=0;--t)this.removeChild(e[t])},insertChildAt:function(e,t){var r=this.getChildHolder();return r&&r!==this?r.insertChildAt(e,t):this.doInsertChildAt(e,t)},doInsertChildAt:function(e,t){if(t>=this.getChildCount())return this.appendChild(e);var r=this._getSubgroupChildIndexInfoFromChildIndex(t);if(r){var n=this._getSubGroupChildInsertAtMethod(r.name);if(n){var o=n.apply(this,[e,r.index]);if(o>=0)return this._getPrevSubgroupChildrenCount(r.name)+o}}return-1},insertBefore:function(e,t){return this.insertChildBefore(e,t)},insertChildBefore:function(e,t){var r=this.getChildHolder();return r&&r!==this?r.insertChildBefore(e,t):this.doInsertChildBefore(e,t)},doInsertChildBefore:function(e,t){var r=this.getBelongChildSubGroupName(e);if(!r)return-1;if(t&&r!==this.getBelongChildSubGroupName(t))return-1;this.getChildSubgroupNames();var n=this._getSubGroupChildInsertBeforeMethod(r);return n?this._getPrevSubgroupChildrenCount(r)+n.apply(this,[e,t]):-1},appendChild:function(e){return this.insertChildBefore(e,null)},appendChildren:function(e){for(var t=0,r=e.length;t<r;++t)this.appendChild(e[t])},cascadeOnChildren:function(e){if(!e)return this;for(var t=0,r=this.getChildCount();t<r;++t){var n=this.getChildAt(t);n.cascadeOnChildren&&n.cascadeOnChildren(e),e(n)}return this},cascade:function(e){return e?(this.cascadeOnChildren(e),e(this),this):this},indexStackOfChild:function(e){var t=e.getParentList&&e.getParentList(),r=-1;if(t&&t.length&&(r=t.indexOf(this)),r<0)return null;for(var n,o=[],i=this,a=r-1;a>=0;--a){var s=t[a];if(!((n=i.indexOfChild(s))>=0))return null;o.push(n),i=s}return(n=i.indexOfChild(e))>=0?(o.push(n),o):null},getChildAtIndexStack:function(e){if(!e)return null;if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getChildAt(e[0]),r=1,n=e.length;r<n;++r){if(!t||!t.getChildAt)return null;t=t.getChildAt(e[r])}return t},isEmpty:function(){return!1},clearIds:function(){this.setId(void 0);for(var e=0,t=this.getChildCount();e<t;++e){var r=this.getChildAt(e);r.clearIds&&r.clearIds()}},assignTo:function(e,t){var r=this.tryApplySuper("assignTo",[e]);return!t&&e.clearIds&&e.clearIds(),r},assign:function(e,t){return e.assignTo(this,t)},clone:function(e){var t=new(this.getClass());return this.assignTo(t,e),t},getScalarAttribCount:function(){var e=this.getScalarAttribs();return e?e.length:0},getScalarAttribAt:function(e){var t=this.getScalarAttribs();return t?t[e]:null},appendScalarAttrib:function(e){this.getScalarAttribs()||this.setPropStoreFieldValue("scalarAttribs",[]);var t=Kekule.ArrayUtils.pushUniqueEx(this.getScalarAttribs(),e);return t.isPushed&&(e.setParent(this),this.notifyScalarAttribsChange()),t.index},removeScalarAttribAt:function(e){if(this.getScalarAttribs()){var t=Kekule.ArrayUtils.removeAt(this.getScalarAttribs(),e);return t&&(t.setParent(null),this.notifyScalarAttribsChange()),t}return null},removeScalarAttrib:function(e){if(this.getScalarAttribs()){var t=Kekule.ArrayUtils.remove(this.getScalarAttribs(),e);return t&&(t.setParent(null),this.notifyScalarAttribsChange()),t}return null},getInfoKeys:function(){return this.getInfo()?Kekule.ObjUtils.getOwnedFieldNames(this.getInfo()):[]},getInfoValue:function(e){return this.getInfo()?this.getInfo()[e]:null},setInfoValue:function(e,t){this.doGetInfo(!0)[e]=t,this.notifyInfoChange()},getContainerBox:function(e,t){if(this.getAbsCoordOfMode){var r=this.getAbsCoordOfMode(e,t)||{},n=r;if(this.getSizeOfMode){var o=this.getSizeOfMode(e,t)||{};if(this.getObjAnchorPosition(e)===Kekule.ObjAnchorPosition.CENTER){var i=Kekule.CoordUtils.divide(o,2);e!==Kekule.CoordMode.COORD3D&&(i.y=-i.y),r=Kekule.CoordUtils.substract(r,i)}n=e===Kekule.CoordMode.COORD3D?Kekule.CoordUtils.add(r,this.getSizeOfMode(e,t)||{}):{x:(r.x||0)+(o.x||0),y:(r.y||0)-(o.y||0)}}return Kekule.BoxUtils.createBox(r,n)}return null},equal:function(e,t){return 0===this.compare(e,t)},compare:function(e,t){if(e===this)return 0;if(!e)return 1;var r,n=this.doGetActualCompareOptions(t);return 0===(r=n.customMethod?n.customMethod(this,e,n):this.doCompare(e,n))?0:r<0?-1:1},doGetActualCompareOptions:function(e){return e||{}},doCompare:function(e,t){if(e===this)return 0;if(this.getClass()!==(e.getClass&&e.getClass()))return this.getClassName()<(e.getClassName&&e.getClassName()||"")?-1:1;var r=this.doCompareOnProperties(e,t);if(!r&&t.extraComparisonProperties)for(var n=0,o=t.extraComparisonProperties.length;n<o;++n){var i=t.extraComparisonProperties[n];if(this.hasProperty(i)&&e.hasProperty&&e.hasProperty(i)){var a=this.getPropValue(i),s=e.getPropValue(i);if(0!==(r=this.doCompareOnValue(a,s,t)))break}}return r},doCompareOnProperties:function(e,t){var r;r=t.properties?t.properties:this.getComparisonPropNames(t);for(var n=t&&t.ignoredProperties,o=0,i=0,a=r.length;i<a;++i){var s=r[i];if(!(n&&n.indexOf(s)>=0)&&0!==(o=this.doCompareProperty(e,r[i],t)))return o}return 0},getComparisonPropNames:function(e){var t=this.doGetComparisonPropNames(e);return t||(t=this.doGetDefaultComparisonPropNames()),t},doGetComparisonPropNames:function(e){return null},doGetDefaultComparisonPropNames:function(){for(var e=[],t=this.getPropListOfScopes([Class.PropertyScope.PUBLIC,Class.PropertyScope.PUBLISHED]),r=0,n=t.getLength();r<n;++r){var o=t.getPropInfoAt(r);e.push(o.name)}return e},doCompareProperty:function(e,t,r){var n=e.getPropValue&&e.getPropValue(t),o=this.getPropValue(t);return o===n?0:this.doCompareOnValue(o,n,r)},doCompareOnValue:function(e,t,r){return Kekule.ObjComparer._compareValue(e,t,r)},attachCoordStickNodes:function(e){var t=Kekule.ArrayUtils,r=t.toArray(e),n=this.getAttachedCoordStickNodes();return t.pushUnique(n,r),this},detachCoordStickNodes:function(e){for(var t=Kekule.ArrayUtils,r=t.toArray(e),n=this.getAttachedCoordStickNodes(),o=0,i=r.length;o<i;++o)t.remove(n,r[o]);return this}}),Kekule.VarDependency={INDEPENDENT:0,DEPENDENT:1},Kekule.VarDefinition=Class.create(ObjectEx,{CLASS_NAME:"Kekule.VarDefinition",initialize:function(e){this.tryApplySuper("initialize"),this.beginUpdate();try{e&&this.setPropValues(e),Kekule.ObjUtils.isUnset(this.getDependency())&&this.setDependency(Kekule.VarDependency.INDEPENDENT)}finally{this.endUpdate()}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("symbol",{dataType:DataType.STRING}),this.defineProp("unit",{dataType:DataType.STRING}),this.defineProp("units",{dataType:DataType.STRING,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getUnit()},setter:function(e){this.setUnit(e)}}),this.defineProp("dependency",{dataType:DataType.INT,enumSource:Kekule.VarDependency}),this.defineProp("displayLabel",{dataType:DataType.VARIANT}),this.defineProp("description",{dataType:DataType.STRING}),this.defineProp("info",{dataType:DataType.HASH,getter:function(e){var t=this.getPropStoreFieldValue("info");return!t&&e&&(t={},this.setPropStoreFieldValue("info",t)),t}})},isIndependent:function(){return this.getDependency()!==Kekule.VarDependency.DEPENDENT},getInfoKeys:function(){return this.getInfo()?Kekule.ObjUtils.getOwnedFieldNames(this.getInfo()):[]},getInfoValue:function(e){return this.getInfo()?this.getInfo()[e]:null},setInfoValue:function(e,t){this.doGetInfo(!0)[e]=t,this.notifyInfoChange()},notifyInfoChange:function(){this.notifyPropSet("info",this.getPropStoreFieldValue("info"))},doCompare:function(e,t){for(var r,n=0,o=0,i=(r=t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE?["unit","dependency","info"]:["name","symbol","unit","dependency","info","displayLabel","description"]).length;o<i;++o){var a=r[o],s=this.getPropValue(a),l=e.getPropValue(a);if(!(n=Kekule.ObjComparer._compareValue(s,l,t)))break}return n}}),Kekule.Scalar=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Scalar",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e]),t&&this.setName(t),void 0!==r&&this.setValue(r),n&&this.setUnit(n)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("value",{dataType:DataType.PRIMARY}),this.defineProp("errorValue",{dataType:DataType.PRIMARY}),this.defineProp("unit",{dataType:DataType.STRING}),this.defineProp("title",{dataType:DataType.STRING})},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE?(t||[]).concat(["name","value","errorValue","unit","title"]):t}}),Kekule.Scalar.create=function(e,t,r){var n=new Kekule.Scalar(null,null,e,t);return void 0!==r&&n.setErrorValue(r),n},Kekule.ChemObjList=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemObjList",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("itemBaseClass",t),this.setPropStoreFieldValue("items",[]),this._transparent=!!r},initProperties:function(){this.defineProp("itemBaseClass",{dataType:DataType.CLASS,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("items",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("items");return!t&&e&&(t=[],this.setPropStoreFieldValue("items",t)),t}})},loaded:function(e){this.ownerChanged(this.getOwner()),this.parentChanged(this.getParent()),this.tryApplySuper("loaded",[e])},parentChanged:function(e,t){this.changeAllItemsParent(),this.tryApplySuper("parentChanged",[e,t])},isEmpty:function(){return this.getItemCount()<=0},isValidItemType:function(e){var t=this.getItemBaseClass();return!t||e instanceof t},checkItemType:function(e){var t=this.isValidItemType(e);return t||Kekule.raise(Kekule.$L("ErrorMsg.LIST_ITEM_CLASS_MISMATCH")),t},notifyItemsChange:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},getItemOwner:function(){return this.getOwner()},changeAllItemsOwner:function(){var e=this.getItems();if(e)for(var t=this.getItemOwner(),r=0,n=e.length;r<n;++r){var o=e[r];o&&o.setOwner&&o.setOwner(t)}},getItemParent:function(){return this._transparent&&this.getParent()||this},changeAllItemsParent:function(){var e=this.getItems();if(e)for(var t=this.getItemParent(),r=0,n=e.length;r<n;++r){var o=e[r];o&&o.setParent&&o.setParent(t)}},getItemCount:function(){var e=this.getPropStoreFieldValue("items");return e?e.length:0},getItemAt:function(e){var t=this.getPropStoreFieldValue("items");return t?t[e]:null},indexOf:function(e){var t=this.getPropStoreFieldValue("items");return t?t.indexOf(e):-1},indexOfItem:function(e){return this.indexOf(e)},getNextSiblingOfChild:function(e){var t=this.indexOf(e);return t>=0?this.getItemAt(t+1):null},getChildSubgroupNames:function(){return["item"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return this.isValidItemType(e)?"item":this.tryApplySuper("getBelongChildSubGroupName",[e])},append:function(e){if(this.checkItemType(e),e){var t=Kekule.ArrayUtils.pushUniqueEx(this.doGetItems(!0),e);return t.isPushed&&(this.notifyItemsChange(),e.setOwner&&e.setOwner(this.getItemOwner()),e.setParent&&e.setParent(this.getItemParent())),t.index}return-1},insert:function(e,t){if(this.checkItemType(e),e){var r=Kekule.ArrayUtils.insertUniqueEx(this.doGetItems(!0),e,t);return r.isInserted&&(this.notifyItemsChange(),e.setOwner&&e.setOwner(this.getItemOwner()),e.setParent&&e.setParent(this.getItemParent())),r.index}return-1},insertItemAt:function(e,t){return this.insert(e,t)},insertItemBefore:function(e,t){if(t){var r=this.indexOfItem(t);return r>=0?this.insertItemAt(e,r):this.appendItem(e)}return this.append(e)},removeAt:function(e){if(this.getItems()){var t=Kekule.ArrayUtils.removeAt(this.getItems(),e);return t&&(t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyItemsChange()),t}},removeItemAt:function(e){return this.removeAt(e)},remove:function(e){if(this.getItems()){var t=Kekule.ArrayUtils.remove(this.getItems(),e);return t&&(t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyItemsChange()),t}},removeItem:function(e){return this.remove(e)},toArray:function(){return this.getItems()||[]},getContainerBox:function(e,t){for(var r,n=this.toArray(),o=0,i=n.length;o<i;++o){var a=n[o],s=a.getContainerBox?a.getContainerBox(e,t):null;s&&(r=r?Kekule.BoxUtils.getContainerBox(r,s):Kekule.BoxUtils.clone(s))}return r},getComparisonPropNames:function(e){var t=this.tryApplySuper("getComparisonPropNames",[e]);return t&&this._transparent&&(t=Kekule.ArrayUtils.exclude(t,["parent","owner"])),t}}),Kekule.ChemSpaceElement=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpaceElement",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=new Kekule.ChemObjList(null,Kekule.ChemObject,!0);t.setParent(this),t.addEventListener("change",function(){this.objectChange(["children"])},this),this.setPropStoreFieldValue("children",t)},initProperties:function(){this.defineProp("children",{dataType:"Kekule.ChemObjList",scope:Class.PropertyScope.PUBLIC,setter:function(e){var t=this.getChildren();t&&t.finalize(),e&&(e.setParent(this),e.setOwner(this.getOwner()),e._transparent=!0),this.setPropStoreFieldValue("children",e)}})},loaded:function(e){var t=this.getChildren();t&&(t.parentChanged(this),t.ownerChanged(this.getOwner())),this.tryApplySuper("loaded",[e])},ownerChanged:function(e,t){this.getChildren().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){var t=this.indexOfChild(e);t>=0&&this.removeChildAt(t),this.tryApplySuper("_removeChildObj",[e])},getChildHolder:function(){return this.getChildren()},getNextSiblingOfChild:function(e){return this.getChildren().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.getChildren().insert(e,t)}}),Kekule.ChemSpace=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpace",initialize:function(e){this.tryApplySuper("initialize",[e]),this._autoIdMap={},this._enableObjRefRelations=!0,this._autoUpdateObjRefRelations=!0,this.setPropStoreFieldValue("enableAutoId",!0),this.setPropStoreFieldValue("ownedObjs",[]);var t=new Kekule.ChemSpaceElement;this.setPropStoreFieldValue("root",t),this.setPropStoreFieldValue("objRefRelationManager",new Kekule.ObjRefRelationManager(this)),t.setParent(this),t.setOwner(this)},initProperties:function(){this.defineProp("ownedObjs",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("root",{dataType:"Kekule.ChemSpaceElement",setter:null}),this.defineProp("enableAutoId",{dataType:DataType.BOOL}),this.defineProp("objScreenLengthRatio",{dataType:DataType.FLOAT,serializable:!1,scope:Class.PropertyScope.PRIVATE}),this.defineProp("screenSize",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("screenSize")||{};return{x:e.x,y:e.y}},setter:function(e){var t=this.getPropStoreFieldValue("screenSize");t||(t={},this.setPropStoreFieldValue("screenSize",t)),t.x=e.x,t.y=e.y}}),this.defineProp("objRefRelationManager",{dataType:"Kekule.ObjRefRelationManager",serializable:!1,scope:Class.PropertyScope.PRIVATE,setter:null})},loaded:function(e){var t=this.getRoot();t&&(t.setParent(this),t.setOwner(this)),this.tryApplySuper("loaded",[e]),this.notifyOwnerLoaded()},notifyOwnedObjsChange:function(){this.notifyPropSet("ownedObjs",this.getPropStoreFieldValue("ownedObjs"))},_notifyOwnedObjsSpaceUpdate:function(e,t,r){for(var n=0,o=this.getOwnedObjCount();n<o;++n){var i=this.getOwnedObjAt(n);i&&i.objSpaceOfOwnerUpdated&&i.objSpaceOfOwnerUpdated(e,t,r)}if(this._enableObjRefRelations&&this._autoUpdateObjRefRelations&&r===Kekule.ObjectTreeOperation.REMOVE){var a=Kekule.ArrayUtils,s=this.findObjRefRelations({dest:e})||[];for(n=0,o=s.length;n<o;++n){var l=s[n];if(l.srcProp.autoUpdate){var u=l.dest,c=a.isArray(u)?a.exclude(u,[e]):null;l.srcObj.setPropValue(l.srcProp.name,c)}}}},notifyOwnerLoaded:function(){for(var e=this.getOwnedObjs()||[],t=0,r=e.length;t<r;++t){var n=e[t];n&&n._ownerObjectLoaded&&n._ownerObjectLoaded(this)}},getChildren:function(){return this.getRoot().getChildren().toArray()},getChildHolder:function(){return this.getRoot()},getNextSiblingOfChild:function(e){return this.getRoot().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.getRoot().insertChild(e,t)},indexStackOfChild:function(e){return this.getRoot().indexStackOfChild(e)},getChildAtIndexStack:function(e){return this.getRoot().getChildAtIndexStack(e)},getObjById:function(e){for(var t=0,r=this.getOwnedObjCount();t<r;++t){var n=this.getOwnedObjAt(t);if(n.getId&&n.getId()===e)return n}return null},getAutoId:function(e,t){r=e&&e.getAutoIdPrefix?e.getAutoIdPrefix():"o";var r=e.getAutoIdPrefix?e.getAutoIdPrefix():"o";n=Kekule.ObjUtils.notUnset(t)?t:1;var n=this._getAutoIdIndex(r,n);return this._autoIdMap[r]=n,r+Number(n).toString()},_getAutoIdIndex:function(e,t){for(var r=t||0,n=e+Number(r).toString();this.getObjById(n);)++r,n=e+Number(r).toString();return r},assignAutoIdToObj:function(e){if(e.setId){var t=this.getAutoId(e);e.setId(t)}},getOwnedObjCount:function(){return this.getOwnedObjs().length},getOwnedObjAt:function(e){return this.getOwnedObjs()[e]},indexOfOwnedObj:function(e){return this.getOwnedObjs().indexOf(e)},_appendOwnedObj:function(e){this.indexOfOwnedObj(e)>=0||(this.getEnableAutoId()&&e.getId&&!e.getId()&&this.assignAutoIdToObj(e),this.getOwnedObjs().push(e),e._registerObjRefRelations&&e._registerObjRefRelations(this),this._notifyOwnedObjsSpaceUpdate(e,this,Kekule.ObjectTreeOperation.ADD),this.notifyOwnedObjsChange())},_removeOwnedObjAt:function(e){var t=this.getOwnedObjAt(e);t&&(this.getOwnedObjs().splice(e,1),t._unregisterObjRefRelations&&t._unregisterObjRefRelations(this),this._notifyOwnedObjsSpaceUpdate(t,this,Kekule.ObjectTreeOperation.REMOVE),this.notifyOwnedObjsChange())},_removeOwnedObj:function(e){var t=this.getOwnedObjs().indexOf(e);t>=0&&this._removeOwnedObjAt(t)},_notifyObjTreeOperation:function(e,t,r){for(var n=0,o=this.getOwnedObjCount();n<o;++n){var i=this.getOwnedObjAt(n);i.objTreeOfOwnerUpdated&&i.objTreeOfOwnerUpdated(e,t,r)}},getObjRefRelations:function(){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelations():null},createObjRefRelation:function(e,t,r){return this._enableObjRefRelations?this.getObjRefRelationManager().createRelation(e,t,r):null},modifyObjRefRelation:function(e,t,r){return this._enableObjRefRelations?this.getObjRefRelationManager().modifyRelation(e,t,r):null},getObjRefRelationIndex:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelationIndex(e,t):-1},getObjRefRelation:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().getRelation(e,t):null},releaseObjRefRelation:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().releaseRelation(e,t):null},findObjRefRelations:function(e,t){return this._enableObjRefRelations?this.getObjRefRelationManager().findRelations(e,t):[]}}),Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.ChemSpace),Kekule.IntermediateChemSpace=Class.create(Kekule.ChemSpace,{CLASS_NAME:"Kekule.IntermediateChemSpace",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("enableAutoId",!1),this._enableObjRefRelations=!1,this._autoUpdateObjRefRelations=!1}}),Kekule.ChemDocument=Class.create(Kekule.ChemSpace,{CLASS_NAME:"Kekule.ChemDocument",initProperties:function(){},getAutoIdPrefix:function(){return"d"}}),Kekule.ObjRefRelationManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ObjRefRelationManager",initialize:function(e){this.tryApplySuper("initialize"),this.setOwner(e),this.setPropStoreFieldValue("relations",[])},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemObject",serializable:!1}),this.defineProp("relations",{dataType:DataType.ARRAY,serializable:!1,setter:null})},createRelation:function(e,t,r){var n={srcObj:e,srcProp:t,dest:r};return this.getRelations().push(n),n},modifyRelation:function(e,t,r){var n=!r||Kekule.ArrayUtils.isArray(r)&&!r.length,o=this.getRelation(e,t);return n?(o&&this.removeRelation(o),null):(o?o.dest=r:o=this.createRelation(e,t,r),o)},getRelationIndex:function(e,t){for(var r=this.getRelations(),n=0,o=r.length;n<o;++n){var i=r[n];if(i.srcObj===e&&i.srcProp===t)return n}return-1},getRelation:function(e,t){var r=this.getRelations(),n=this.getRelationIndex(e,t);return n>=0?r[n]:null},releaseRelation:function(e,t){var r=this.getRelations(),n=this.getRelationIndex(e,t);n>=0&&r.splice(n,1)},removeRelation:function(e){var t=this.getRelations(),r=t.indexOf(e);r>=0&&t.splice(r,1)},findRelations:function(e,t){var r,n=t||{},o=[],i=Object.extend({},e),a=!1;i.dest&&(delete i.dest,a=!0,r=Kekule.ArrayUtils.toArray(e.dest));for(var s=this.getRelations(),l=0,u=s.length;l<u;++l){var c=s[l],d=!1;if((d=Kekule.ObjUtils.match(c,i))&&a){var h=Kekule.ArrayUtils.toArray(c.dest);d=n.checkDestChildren?this._hasChildOrSelfOfParents(h,r):Kekule.ArrayUtils.intersect(h,r).length===r.length}d&&o.push(c)}return o},_hasChildOrSelfOfParents:function(e,t){for(var r=0,n=e.length;r<n;++r)for(var o=e[r],i=0,a=t.length;i<a;++i){var s=t[i];if(o===s||o.isChildOf&&o.isChildOf(s))return!0}return!1}})}(),Kekule.ExceptionHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExceptionHandler",initProperties:function(){this.defineEvent("exceptionThrown")},notifyExceptionThrown:function(e,t){var r={exception:e,level:t};return this.invokeEvent("exceptionThrown",r),r},throwException:function(e,t){var r=Kekule.ExceptionLevel;if(t||(t=r.ERROR),!this.notifyExceptionThrown(e,t||r.ERROR).stop){if(!t||t===r.ERROR){var n=e;throw"string"==typeof e&&(n=new Kekule.Exception(e)),n}if("undefined"!=typeof console){"string"!=typeof e&&(e=e.message);var o=t===r.NOT_FATAL_ERROR?"error":t===r.WARNING?"warn":t===r.NOTE?"info":"log";o?console[o](e):console.log(e)}}},raise:function(e,t){return this.throwException(e,t||Kekule.ExceptionLevel.ERROR)}}),Kekule.ExceptionHandler.getInstance=function(){return this.instance||(this.instance=new Kekule.ExceptionHandler),this.instance},Kekule.exceptionHandler=Kekule.ExceptionHandler.getInstance(),Kekule.Exception=function(e,t){this.message=e,this.name=t},Kekule.Exception.prototype=new Error,Kekule.Exception.prototype.constructor=Kekule.Exception,Object.extend(Kekule.Exception.prototype,{getMessage:function(){return this.message}}),Kekule.Error=function(e,t){this.message=e,this.name=t},Kekule.Error.prototype=Kekule.Exception.prototype,Kekule.Error.prototype.constructor=Kekule.Error,Kekule.ChemError=function(e,t){this.message=e,this.name=t},Kekule.ChemError.prototype=Kekule.Error.prototype,Kekule.ChemError.prototype.constructor=Kekule.ChemError,"undefined"==typeof console&&(console={log:function(){},warn:function(){},info:function(){},error:function(){}}),Kekule.oneOf=function(){for(var e=arguments,t=Kekule.ObjUtils.notUnset,r=0,n=e.length;r<n;++r)if(t(e[r]))return e[r];return null},Kekule.ClassUtils={getShortClassName:function(e){var t=e.indexOf(".");return t>=0?e.substring(t+1):e},getLastClassName:function(e){var t=e.lastIndexOf(".");return t>=0?e.substring(t+1):e},makeSingleton:function(e){return Object.extend(e,{_instance:null,getInstance:function(t,r,n,o,i,a,s,l,u,c){return e._instance||(e._instance=new e(t,r,n,o,i,a,s,l,u,c)),e._instance}})}},Kekule.NumUtils={isNormalNumber:function(e){return"number"==typeof e&&!isNaN(e)},isInteger:function(e){return"number"==typeof e&&parseInt(e,10)===parseFloat(e)},toDecimals:function(e,t){if(Kekule.NumUtils.isInteger(e))return e.toString();var r=Math.pow(10,t),n=Math.round(e*r);n/=r;var o=parseInt(n),i=(n-o).toString();return i.length>t+2?(i=i.substr(2,t),o.toString()+"."+i):n.toString()},toPrecision:function(e,t,r,n){var o,i=Math.sign(e),a=Math.abs(e),s=Kekule.NumUtils.getDecimalPointPos(a)+1-t;if(s>=0)o=n?Math.round(a):a.toPrecision(t);else{var l=Math.round(a*Math.pow(10,-s)).toString(),u=l.length,c=Math.abs(s);if(o=u===c?"0."+l:u>c?l.substr(0,u-c)+"."+l.substr(u-c):(0).toFixed(c-u)+l,r){for(var d=0,h=o.charAt(o.length-1-d);("0"===h||"."===h)&&(++d,"."!==h);)h=o.charAt(o.length-1-d);o=o.substr(0,o.length-d)}}return i<0&&(o="-"+o),o},getDecimalPointPos:function(e){if(Kekule.NumUtils.isFloatEqual(e,0))return 0;for(var t=Math.abs(e),r=t>1?10:.1,n=t>1?1:-1,o=1,i=0;t>1&&o<=t||t<1&&o>t;)o*=r,i+=n;return t>1?i-1:i},getHeadingDigit:function(e){if(Kekule.NumUtils.isFloatEqual(e,0))return 0;var t=Math.abs(e),r=Kekule.NumUtils.getDecimalPointPos(t),n=Math.pow(10,r);return Math.floor(t/n)},isFloatEqual:function(e,t,r){return Kekule.ObjUtils.isUnset(r)&&(r=1e-15*Math.min(Math.abs(e),Math.abs(t))),Math.abs(e-t)<=r},compareFloat:function(e,t,r){return Kekule.NumUtils.isFloatEqual(e,t,r)?0:e<t?-1:1},getPrimes:function(e){var t,r,n=[],o=[];for(t=2;t<=e;++t)if(!n[t])for(o.push(t),r=t<<1;r<=e;r+=t)n[r]=!0;return o}},Kekule.ObjUtils={getPrototypeOf:function(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.prototype||e.__proto__},getPropertyDescriptor:function(e,t,r){var n=Object.getOwnPropertyDescriptor;if(n){var o=n(e,t);return!o&&r&&(e.prototype||e.__proto__)&&(o=Kekule.ObjUtils.getPropertyDescriptor(e.prototype||e.__proto__,t,r)),o}return null},getOwnedFieldNames:function(e,t){var r=[];for(var n in e)e.hasOwnProperty(n)&&(t||"function"!=typeof e[n])&&r.push(n);return r},replacePropName:function(e,t,r){return void 0!==e[t]&&(e.hasOwnProperty(t)?(e[r]=e[t],delete e[t]):Kekule.raise(Kekule.$L("ErrorMsg.NON_OWN_PROPERTY_CANNOT_BE_REPLACED"))),e},isUnset:function(e){return null==e},notUnset:function(e){return null!=e},equal:function(e,t,r){var n=[];for(var o in e)if(!(r&&r.indexOf(o)>=0)){if(e[o]!==t[o])return!1;n.push(o)}for(var o in t)if(!(r&&r.indexOf(o)>=0)&&n.indexOf(o)<0)return!1;return!0},match:function(e,t){var r=e instanceof ObjectEx;for(var n in t){if(t.hasOwnProperty(n))if((r?e.getPropValue(n):e[n])!==t[n])return!1}return!0},isInstanceOf:function(e,t){if(DataType.isArrayValue(t)){for(var r=0,n=t.length;r<n;++r)if(e instanceof t[r])return!0;return!1}return e instanceof t},getLeafFieldCascadeNames:function(e,t){var r=function(e,t,n,o){for(var i in n)if(n.hasOwnProperty(i)&&(o||"function"!=typeof n[i])){var a=n[i];"object"==typeof a?r(e,t+i+".",a,o):e.push(t+i)}},n=[];return r(n,"",e,t),n}},Kekule.ArrayUtils={isArray:function(e){return!!e&&("object"==typeof e&&void 0!==e.length)},toArray:function(e){return Kekule.ArrayUtils.isArray(e)?e:[e]},clone:function(e){return e.slice(0)},filter:function(e,t,r){if(!t)return Kekule.ArrayUtils.clone(e);if(e.filter)return e.filter(t,r);for(var n=[],o=0,i=e.length;o<i;++o){var a=e[o];t.apply(r,[a,o,e])&&n.push(a)}return n},divide:function(e,t){for(var r=[],n=[],o=0,i=0,a=e.length;i<a;++i)n.push(e[i]),++o>=t&&(r.push(n),n=[],o=0);return n.length&&r.push(n),r},pushUnique:function(e,t,r){var n=Kekule.ArrayUtils.pushUniqueEx(e,t,r);return n?n.index:null},pushUniqueEx:function(e,t,r){if(DataType.isArrayValue(t)){for(var n,o=r?Kekule.ArrayUtils._pushUniqueItemEx:Kekule.ArrayUtils.pushUniqueEx,i=0,a=t.length;i<a;++i)Kekule.ObjUtils.isUnset(n)?n=o(e,t[i],r):o(e,t[i],r);return n}return Kekule.ArrayUtils._pushUniqueItemEx(e,t)},_pushUniqueItemEx:function(e,t){if(!t)return{index:-1,isPushed:!1};var r=e.indexOf(t);return r<0?{index:e.push(t),isPushed:!0}:{index:r,isPushed:!1}},insertUnique:function(e,t,r){return Kekule.ArrayUtils.insertUniqueEx(e,t,r).index},insertUniqueEx:function(e,t,r){if(!t)return{index:-1,isInserted:!1};(Kekule.ObjUtils.isUnset(r)||r<0)&&(r=e.length);var n=e.indexOf(t);return n<0?(e.splice(r,0,t),{index:r,isInserted:!0}):n!=r?(e.splice(n,1),e.splice(r,0,t),{index:r,isInserted:!1}):void 0},removeAt:function(e,t){var r=e[t];return void 0!==r?(e.splice(t,1),r):null},remove:function(e,t,r){var n=e.indexOf(t);return n>=0?(Kekule.ArrayUtils.removeAt(e,n),r&&Kekule.ArrayUtils.remove(e,t,r),t):null},replace:function(e,t,r,n){var o=e.indexOf(t);return o>=0?(e[o]=r,n&&Kekule.ArrayUtils.replace(e,t,r,n),t):null},changeIndex:function(e,t,r){if(t>=0&&t<=e.length){var n=e[t];return e.splice(t,1),e.splice(r,0,n),n}return null},changeItemIndex:function(e,t,r){var n=e.indexOf(t);return Kekule.ArrayUtils.changeIndex(e,n,r)},toUnique:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var o=e[r];t.indexOf(o)<0&&t.push(o)}return t},getUniqueElemCount:function(e){return Kekule.ArrayUtils.toUnique(e).length},reverse:function(e){for(var t=[],r=0,n=e.length;r<n;++r)Kekule.ObjUtils.notUnset(e[r])&&(t[n-r-1]=e[r]);return t},randomize:function(e){if(!e)return null;if(!e.length)return[];for(var t=[],r=e.slice(0);r.length>1;){var n=Math.round(Math.random()*(r.length-1));t.push(r.splice(n,1)[0])}return t.push(r[0]),t},exclude:function(e,t){for(var r=[],n=Kekule.ArrayUtils.toArray(t),o=0,i=e.length;o<i;++o){var a=e[o];n.indexOf(a)<0&&r.push(a)}return r},intersect:function(e,t){for(var r=[],n=0,o=e.length;n<o;++n)t.indexOf(e[n])>=0&&r.push(e[n]);return r},flatten:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var o=e[r];if(Kekule.ArrayUtils.isArray(o)){var i=Kekule.ArrayUtils.flatten(o);t=t.concat(i)}else t.push(o)}return t},compare:function(e,t,r){r||(r=function(e,t){return e>t?1:e<t?-1:0});for(var n=Math.min(e.length,t.length),o=0;o<n;++o){var i=r(e[o],t[o]);if(0!==i)return i}return e.length>n?1:t.length>n?-1:0},compareNestedArray:function(e,t,r){var n=Math.min(e.length,t.length);r||(r=function(e,t){return e-t});for(var o=0;o<n;++o){var i=0,a=e[o],s=t[o],l=DataType.isArrayValue(a),u=DataType.isArrayValue(s);if(0!=(i=l&&u?Kekule.ArrayUtils.compareNestedArray(a,s,r):l?1:u?-1:r(a,s)))return i}return e.length>n?1:t.length>n?-1:0},group:function(e,t){t||(t=function(e,t){return e<t?-1:e>t?1:0});var r=Kekule.ArrayUtils.clone(e);r.sort(t);for(var n,o=[],i=0,a=r.length;i<a;++i){var s=r[i];if(n&&0===t(s,n)){var l=o.length?o[o.length-1]:null;Kekule.ArrayUtils.isArray(l)||(o.pop(),l=[n],o.push(l)),l.push(s)}else o.push(s);n=s}return o},indexStackOfElem:function(e,t){for(var r=0,n=t.length;r<n;++r){var o=t[r];if(o===e)return[r];if(Kekule.ArrayUtils.isArray(o)){var i=Kekule.ArrayUtils.indexStackOfElem(e,o);if(i)return i.unshift(r),i}}return null},getElemByIndexStack:function(e,t){var r=Kekule.ArrayUtils.isArray(t)?Kekule.ArrayUtils.clone(t):[t],n=e[r.shift()];return n?r.length?Kekule.ArrayUtils.isArray(n)?Kekule.ArrayUtils.getElemByIndexStack(n,r):null:n:null},getMedian:function(e){var t=[].concat(e),r=t.length;return 0===r?null:r<=1?t[0]:(t.sort(function(e,t){return e-t}),r%2?t[r+1>>1]:(t[r>>1]+t[(r>>1)-1])/2)},sortHashArray:function(e,t){for(var r=[],n=0,o=t.length;n<o;++n){var i={},a=t[n]||"";a.startsWith("!")?(i.field=a.substr(1),i.desc=!0):(i.field=a,i.desc=!1),r.push(i)}return e.sort(function(e,t){for(var n=0,o=0,i=r.length;o<i;++o){var a=r[o].field,s=e[a]||"",l=t[a]||"";if(n=s>l?1:s<l?-1:0,r[o].desc&&(n=-n),0!==n)break}return n}),e}},Kekule.StrUtils={STR_TRUES:["true","yes","t","y"],STR_FALSES:["false","no","f","n"],trim:function(e){return e.replace(/^\s*|\s*$/g,"")},normalizeSpace:function(e){return e.replace(/^\s*|\s(?=\s)|\s*$/g,"")},convertToStr:function(e){return""+e},convertToType:function(e,t){if("string"!=typeof e)return e;switch(t){case DataType.FLOAT:case DataType.NUMBER:return parseFloat(e);case DataType.INT:return parseInt(e);case DataType.BOOL:return Kekule.StrUtils.strToBool(e);default:return e}},boolToStr:function(e){return e?Kekule.StrUtils.STR_TRUES[0]:Kekule.StrUtils.STR_FALSES[0]},strToBool:function(e){for(var t=e.toLowerCase(),r=0,n=Kekule.StrUtils.STR_FALSES.length;r<n;++r)if(t==Kekule.StrUtils.STR_FALSES[r])return!1;return!!e},removeAroundPair:function(e,t,r){return e.startsWith(t)&&e.endsWith(r)?e.substring(t.length,e.length-t.length-r.length+1):e},unquote:function(e){var t=Kekule.StrUtils.removeAroundPair,r=e;return r=t(r,"'","'"),r=t(r,'"','"')},splitTokens:function(e,t){if(!e)return[];if(DataType.isArrayValue(e))return e;var r=t?new RegExp(t,"g"):/\s+/g;return e.split(r)},hasToken:function(e,t,r){return Kekule.StrUtils.splitTokens(e,r).indexOf(t)>=0},addTokens:function(e,t,r){for(var n=Kekule.StrUtils.splitTokens(e,r),o=Kekule.StrUtils.splitTokens(t,r),i=0,a=o.length;i<a;++i)n.indexOf(o[i])<0&&n.push(o[i]);return n.join(r||" ")},removeTokens:function(e,t,r){for(var n=Kekule.StrUtils.splitTokens(e,r),o=Kekule.StrUtils.splitTokens(t,r),i=0,a=o.length;i<a;++i){var s=n.indexOf(o[i]);s>=0&&n.splice(s,1)}return n.join(r||" ")},toggleTokens:function(e,t,r){for(var n=Kekule.StrUtils.splitTokens(e,r),o=Kekule.StrUtils.splitTokens(t,r),i=[],a=0,s=o.length;a<s;++a){var l=n.indexOf(o[a]);l>=0?n.splice(l,1):i.push(o[a])}return(n=n.concat(i)).join(r||" ")},getLineCount:function(e,t){return t||(t="\n"),e.split(t).length},getMaxLineCharCount:function(e,t){t||(t="\n");for(var r=e.split(t),n=0,o=0,i=r.length;o<i;++o){var a=r[o];n=Math.max(a.length,n)}return n},isNumbericStr:function(e){var t=Number(e);return!isNaN(t)},splitIndexEndingStr:function(e){for(var t=e.length-1,r=e.charAt(t),n="";r&&Kekule.StrUtils.isNumbericStr(r);)--t,n=r+n,r=e.charAt(t);return n?{prefix:e.substring(0,t+1),index:parseInt(n)}:null}},Kekule.RoleMapUtils={KEY_ITEM:"item",KEY_ROLE:"role",NON_EXPLICIT_ROLE:null,createMap:function(e,t){var r={};return t=t||Kekule.RoleMapUtils.NON_EXPLICIT_ROLE,r[Kekule.RoleMapUtils.KEY_ITEM]=e,r[Kekule.RoleMapUtils.KEY_ROLE]=t,r},getItem:function(e){return e[Kekule.RoleMapUtils.KEY_ITEM]},setItem:function(e,t){e[Kekule.RoleMapUtils.KEY_ITEM]=t},getRole:function(e){return e[Kekule.RoleMapUtils.KEY_ROLE]},setRole:function(e,t){e[Kekule.RoleMapUtils.KEY_ROLE]=t}},Kekule.FactoryUtils={MATCH_EXACTLY:0,MATCH_BY_CLASS:1,DEF_ITEM_STORE_FIELD_NAME:"_items",createSimpleFactory:function(e){var t=Kekule.FactoryUtils,r={_items:new Kekule.MapEx(!0),_matchMethod:e||Kekule.FactoryUtils.MATCH_EXACTLY,register:function(e,t){r._items.set(e,t)},unregister:function(e){r._items.remove(e)},getClass:function(e){if(r._matchMethod===t.MATCH_EXACTLY)return r._items.get(e);if(r._matchMethod===t.MATCH_BY_CLASS){var n=r._items.get(e);if(!n){var o=e&&ClassEx.getSuperClass(e);o&&(n=r.getClass(o))}return n}},getInstance:function(e,t,n,o,i,a,s,l,u,c){var d=r.getClass(e);if(d)return new d(t,n,o,i,a,s,l,u,c)}};return r}},Kekule.UrlUtils={PROTOCAL_DELIMITER:"://",EXT_DELIMITER:".",PATH_DELIMITER:"/",SEARCH_DELIMITER:"?",SEARCH_PAIR_DELIMITER:"&",KEY_VALUE_DELIMITER:"=",HASH_DELIMITER:"#",normalizePath:function(e){return e.replace(/\\/g,"/")},extractProtocal:function(e){if(!e)return null;var t=e.indexOf(Kekule.UrlUtils.PROTOCAL_DELIMITER);return t>=0?e.substr(0,t):""},extractFileName:function(e){if(!e)return null;var t=e.lastIndexOf(Kekule.UrlUtils.PATH_DELIMITER);return t>=0?e.substr(t+1):e},extractFileExt:function(e){var t=Kekule.UrlUtils.extractFileName(e);if(t){var r=t.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);return r>=0?t.substr(r+1):""}return null},extractFileCoreName:function(e){var t=Kekule.UrlUtils.extractFileName(e);if(t){var r=t.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);return r>=0?t.substr(0,r):""}return null},extractSearch:function(e){if(!e)return null;var t=e.lastIndexOf(Kekule.UrlUtils.SEARCH_DELIMITER);return t>=0?e.substr(t):null},analysisSearch:function(e,t){for(var r=Kekule.UrlUtils.extractSearch(e)||"",n=(r=r.substr(1)).split(Kekule.UrlUtils.SEARCH_PAIR_DELIMITER),o=t?{}:[],i=0,a=n.length;i<a;++i){var s=n[i].split(Kekule.UrlUtils.KEY_VALUE_DELIMITER);s[0]&&(t?o[s[0]]=s[1]:o.push({key:s[0],value:s[1]}))}return o},generateSearchString:function(e){for(var t=Kekule.UrlUtils,r=[],n=Kekule.ObjUtils.getOwnedFieldNames(e),o=0,i=n.length;o<i;++o){var a=n[o],s=e[a];if(Kekule.ObjUtils.notUnset(s)){s=encodeURIComponent(""+s);r.push(a+t.KEY_VALUE_DELIMITER+s)}}return r.join(t.SEARCH_PAIR_DELIMITER)},generateUrl:function(e,t,r){var n=Kekule.UrlUtils,o=e;if(t){var i=n.generateSearchString(t);o+=n.SEARCH_DELIMITER+i}return r&&(o+=n.HASH_DELIMITER+r),o}},Kekule.MatrixUtils={create:function(e,t,r){var n=!1,o=!1,i=Kekule.ObjUtils;i.notUnset(r)&&(n=!0,Kekule.ArrayUtils.isArray(r)&&(o=!0));for(var a=0,s=new Array(e),l=0,u=s.length;l<u;++l){var c=new Array(t);if(n)for(var d=0,h=c.length;d<h;++d)o&&i.notUnset(r[a])?(c[d]=r[a],++a):c[d]=r;s[l]=c}return s},createIdentity:function(e){for(var t=Kekule.MatrixUtils.create(e,e,0),r=0;r<e-1;++r)t[r][r]=1;return t},getRowCount:function(e){return e.length},getColCount:function(e){return Kekule.MatrixUtils.getRowCount(e)>0?e[0].length:0},getValue:function(e,t,r){return e[t-1][r-1]||0},setValue:function(e,t,r,n){e[t-1][r-1]=n},transpose:function(e){for(var t=Kekule.MatrixUtils,r=t.getColCount(e),n=t.getRowCount(e),o=t.create(r,n),i=1;i<=r;++i)for(var a=o[i-1],s=1;s<=n;++s)a[s-1]=t.getValue(e,s,i);return o},minus:function(e){for(var t=Kekule.MatrixUtils,r=t.getRowCount(e),n=t.getColCount(e),o=this.create(r,n),i=0;i<r;++i)for(var a=o[i],s=e[i],l=0;l<n;++l)a[l]=-(s[l]||0);return o},add:function(e,t){for(var r=Kekule.MatrixUtils,n=r.getRowCount(e),o=r.getColCount(e),i=this.create(n,o),a=1;a<=n;++a)for(var s=1;s<=o;++s)r.setValue(i,a,s,r.getValue(e,a,s)+r.getValue(t,a,s));return i},substract:function(e,t){var r=Kekule.MatrixUtils;return r.add(e,r.minus(t))},multiply:function(e,t){for(var r=Kekule.MatrixUtils,n=r.getRowCount(e),o=r.getColCount(t),i=r.create(n,o),a=1;a<=n;++a)for(var s=1;s<=o;++s){for(var l=0,u=1;u<=n;++u)l+=r.getValue(e,a,u)*r.getValue(t,u,s);r.setValue(i,a,s,l)}return i}},Kekule.CoordUtils={create:function(e,t,r){var n={x:e,y:t};return(r||0===r)&&(n.z=r),n},clone:function(e){var t={x:e.x,y:e.y};return(e.z||0===e.z)&&(t.z=e.z),t},is3D:function(e){return e.z||0===e.z},isEqual:function(e,t){var r=e.x===t.x&&e.y===t.y,n=Kekule.ObjUtils;return r&&(n.notUnset(e.z)||n.notUnset(t.z))&&(r=e.z===t.z),r},isZero:function(e,t){var r=Kekule.ObjUtils.notUnset(t)?t:0;return Math.abs(e.x||0)<=r&&Math.abs(e.y||0)<=r&&Math.abs(e.z||0)<=r},absValue:function(e){if(e){var t={};return Kekule.ObjUtils.isUnset(e.x)||(t.x=Math.abs(e.x)),Kekule.ObjUtils.isUnset(e.y)||(t.y=Math.abs(e.y)),Kekule.ObjUtils.isUnset(e.z)||(t.z=Math.abs(e.z)),t}},add:function(e,t){var r={};return Kekule.ObjUtils.isUnset(e.x)&&Kekule.ObjUtils.isUnset(t.x)||(r.x=(e.x||0)+(t.x||0)),Kekule.ObjUtils.isUnset(e.y)&&Kekule.ObjUtils.isUnset(t.y)||(r.y=(e.y||0)+(t.y||0)),Kekule.ObjUtils.isUnset(e.z)&&Kekule.ObjUtils.isUnset(t.z)||(r.z=(e.z||0)+(t.z||0)),r},substract:function(e,t){var r={};return Kekule.ObjUtils.isUnset(e.x)&&Kekule.ObjUtils.isUnset(t.x)||(r.x=(e.x||0)-(t.x||0)),Kekule.ObjUtils.isUnset(e.y)&&Kekule.ObjUtils.isUnset(t.y)||(r.y=(e.y||0)-(t.y||0)),Kekule.ObjUtils.isUnset(e.z)&&Kekule.ObjUtils.isUnset(t.z)||(r.z=(e.z||0)-(t.z||0)),r},multiply:function(e,t){var r={};return Kekule.ObjUtils.isUnset(e.x)||(r.x=e.x*t),Kekule.ObjUtils.isUnset(e.y)||(r.y=e.y*t),Kekule.ObjUtils.isUnset(e.z)||(r.z=e.z*t),r},divide:function(e,t){return Kekule.CoordUtils.multiply(e,1/t)},standardize:function(e){var t=Math.sqrt(Math.sqr(e.x||0)+Math.sqr(e.y||0)+Math.sqr(e.z||0));return Kekule.CoordUtils.divide(e,t||1)},toArray:function(e){var t=[];t.push(e.x,e.y),Kekule.CoordUtils.is3D(e)&&t.push(e.z)},isSameTransform2DOptions:function(e,t,r){var n=Kekule.ObjUtils.isUnset,o=Kekule.NumUtils.isFloatEqual;r||(r={});var i=r.translate||.01,a=r.scale||.01,s=r.rotate||.01,l=!1,u=e.center,c=t.center;if(l=!(!u||!c)&&(o(u.x,c.x,i)&&o(u.y,c.y,i)))for(var d=["scale","scaleX","scaleY","rotateAngle","translateX","translateY"],h=0,f=d.length;h<f;++h){var m=d[h],g=e[m],p=t[m];if(!n(g)||!n(p))if(!(l=!n(g)&&!n(p)&&o(g,p,0===m.indexOf("scale")?a:0===m.indexOf("rotate")?s:i)))break}return l},isSameTransform3DOptions:function(e,t,r){var n=Kekule.ObjUtils.isUnset,o=Kekule.NumUtils.isFloatEqual;r||(r={});var i=r.translate||.01,a=r.scale||.01,s=r.rotate||.01,l=!1,u=e.center,c=t.center;if(l=u&&c?o(u.x,c.x,i)&&o(u.y,c.y,i)&&o(u.z,c.z,i):!u&&!c){var d=e.rotateAxisVector,h=t.rotateAxisVector;l=d&&h?o(d.x,h.x,i)&&o(d.y,h.y,i)&&o(d.z,h.z,i):!d&&!h}if(l)for(var f=["scale","scaleX","scaleY","scaleZ","rotateAngle","rotateX","rotateY","rotateZ","translateX","translateY","translateZ"],m=0,g=f.length;m<g;++m){var p=f[m],C=e[p],O=t[p];if(!n(C)||!n(O))if(!(l=!n(C)&&!n(O)&&o(C,O,0===p.indexOf("scale")?a:0===p.indexOf("rotate")?s:i)))break}return l},transform2D:function(e,t){var r=Kekule.CoordUtils.calcTransform2DMatrix(t);return Kekule.CoordUtils.transform2DByMatrix(e,r)},inverseTransform2D:function(e,t){var r=Kekule.CoordUtils.calcInverseTransform2DMatrix(t);return Kekule.CoordUtils.transform2DByMatrix(e,r)},transform2DByMatrix:function(e,t){var r=Kekule.MatrixUtils,n=r.create(3,1,[e.x||0,e.y||0,1]);return{x:(n=r.multiply(t,n))[0][0],y:n[1][0]}},calcTransform2DMatrix:function(e,t){var r=Kekule.MatrixUtils,n=Kekule.ObjUtils.notUnset,o=e||{},i=o.center;if(i)var a=r.create(3,3,[1,0,-(i.x||0),0,1,-(i.y||0),0,0,1]),s=r.create(3,3,[1,0,i.x||0,0,1,i.y||0,0,0,1]);if(o.rotateAngle)var l=o.rotateAngle,u=Math.cos(l),c=Math.sin(l),d=r.create(3,3,[u,-c,0,c,u,0,0,0,1]);var h=o.scale,f=o.scaleX,m=o.scaleY,g=Kekule.oneOf(h,1);if(n(h)||n(f)||n(m)){var p=r.create(3,3);r.setValue(p,1,1,Kekule.oneOf(f,g)),r.setValue(p,2,2,Kekule.oneOf(m,g)),r.setValue(p,3,3,1)}var C=o.translateX,O=o.translateY;if(C||O){var k=r.create(3,3);r.setValue(k,1,1,1),r.setValue(k,2,2,1),r.setValue(k,3,3,1),r.setValue(k,1,3,C||0),r.setValue(k,2,3,O||0)}var S=r.create(3,3,[1,0,0,0,1,0,0,0,1]);return t?(a&&(S=r.multiply(a,S)),k&&(S=r.multiply(k,S)),p&&(S=r.multiply(p,S)),d&&(S=r.multiply(d,S)),s&&(S=r.multiply(s,S))):(a&&(S=r.multiply(a,S)),d&&(S=r.multiply(d,S)),p&&(S=r.multiply(p,S)),k&&(S=r.multiply(k,S)),s&&(S=r.multiply(s,S))),S},calcInverseTransform2DMatrix:function(e){var t=Kekule.ObjUtils.notUnset,r=Object.create(e);return e.center&&(r.center={x:e.center.x,y:e.center.y}),t(r.scale)&&(r.scale=1/r.scale),t(r.scaleX)&&(r.scaleX=1/r.scaleX),t(r.scaleY)&&(r.scaleY=1/r.scaleY),r.translateX&&(r.translateX=-r.translateX),r.translateY&&(r.translateY=-r.translateY),r.rotateAngle&&(r.rotateAngle=-r.rotateAngle),Kekule.CoordUtils.calcTransform2DMatrix(r,!0)},transform3D:function(e,t){var r=Kekule.CoordUtils.calcTransform3DMatrix(t);return Kekule.CoordUtils.transform3DByMatrix(e,r)},transform3DByMatrix:function(e,t){var r=Kekule.MatrixUtils,n=r.create(4,1,[e.x||0,e.y||0,e.z||0,1]);return{x:(n=r.multiply(t,n))[0][0],y:n[1][0],z:n[2][0]}},_calcRotateXYZ3DMatrixCore:function(e){var t=Kekule.MatrixUtils,r=t.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n=[];if(e.rotateAngle&&e.rotateAxisVector){var o=Kekule.CoordUtils.standardize(e.rotateAxisVector);n.push({vector:[o.x,o.y,o.z],angle:-e.rotateAngle})}else{var i=e.rotateX,a=e.rotateY,s=e.rotateZ;i&&n.push({vector:[1,0,0],angle:-i}),a&&n.push({vector:[0,1,0],angle:-a}),s&&n.push({vector:[0,0,1],angle:-s})}for(var l=0,u=n.length;l<u;++l){var c,d=t.create(4,4),h=n[l].angle,f=n[l].vector,m=Math.cos(h),g=Math.sin(h);for(l=1;l<=4;++l)for(var p=1;p<=4;++p){if(l<4&&p<4){for(var C=1;C<=3&&(C===l||C===p);++C);var O=f[l-1]*f[p-1];c=l<p?O*(1-m)-Math.pow(-1,l+p)*f[C-1]*g:l>p?O*(1-m)+Math.pow(-1,l+p)*f[C-1]*g:O+(1-O)*m}else c=l===p?1:0;t.setValue(d,l,p,c)}r=t.multiply(d,r)}return r},calcRotate3DMatrix:function(e){var t=Kekule.MatrixUtils,r=Object.create(e||{});if(r.rotateMatrix)a=r.rotateMatrix;else{var n=r.center;if(n)var o=t.create(4,4,[1,0,0,-(n.x||0),0,1,0,-(n.y||0),0,0,1,-(n.z||0),0,0,0,1]),i=t.create(4,4,[1,0,0,n.x||0,0,1,0,n.y||0,0,0,1,n.z||0,0,0,0,1]);var a=Kekule.CoordUtils._calcRotateXYZ3DMatrixCore(e);o&&(a=t.multiply(o,a)),i&&(a=t.multiply(i,a))}return a},calcTransform3DMatrix:function(e){var t=Kekule.ObjUtils.notUnset,r=Kekule.MatrixUtils,n=e||{},o=n.center;if(o)var i=r.create(4,4,[1,0,0,-(o.x||0),0,1,0,-(o.y||0),0,0,1,-(o.z||0),0,0,0,1]),a=r.create(4,4,[1,0,0,o.x||0,0,1,0,o.y||0,0,0,1,o.z||0,0,0,0,1]);var s=Object.copyValues({},n,["rotateX","rotateY","rotateZ","rotateAngle","rotateAxisVector","rotateMatrix"]),l=Kekule.CoordUtils.calcRotate3DMatrix(s),u=n.scale,c=n.scaleX,d=n.scaleY,h=n.scaleZ;if(t(u)||t(c)||t(d)||t(h)){var f=Kekule.oneOf(u,1),m=r.create(4,4);r.setValue(m,1,1,Kekule.oneOf(c,f)),r.setValue(m,2,2,Kekule.oneOf(d,f)),r.setValue(m,3,3,Kekule.oneOf(h,f)),r.setValue(m,4,4,1)}var g=n.translateX,p=n.translateY,C=n.translateZ;if(g||p||C){var O=r.create(4,4);r.setValue(O,1,1,1),r.setValue(O,2,2,1),r.setValue(O,3,3,1),r.setValue(O,4,4,1),r.setValue(O,1,4,g||0),r.setValue(O,2,4,p||0),r.setValue(O,3,4,C||0)}var k=r.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);return i&&(k=r.multiply(i,k)),l&&(k=r.multiply(l,k)),m&&(k=r.multiply(m,k)),O&&(k=r.multiply(O,k)),a&&(k=r.multiply(a,k)),k},calcInverseTransform3DMatrix:function(e){var t=Kekule.ObjUtils.notUnset,r=Object.create(e);return e.center&&(r.center={x:e.center.x,y:e.center.y,z:e.center.z}),t(r.scale)&&(r.scale=1/r.scale),t(r.scaleX)&&(r.scaleX=1/r.scaleX),t(r.scaleY)&&(r.scaleY=1/r.scaleY),t(r.scaleZ)&&(r.scaleZ=1/r.scaleZ),r.translateX&&(r.translateX=-r.translateX),r.translateY&&(r.translateY=-r.translateY),r.translateZ&&(r.translateZ=-r.translateZ),r.rotateAngle&&(r.rotateAngle=-r.rotateAngle),r.rotateX&&(r.rotateX=-r.rotateX),r.rotateX&&(r.rotateY=-r.rotateY),r.rotateZ&&(r.rotateZ=-r.rotateZ),Kekule.CoordUtils.calcTransform3DMatrix(r,!0)},calcCoordGroup2DTransformParams:function(e,t,r,n){var o=Kekule.CoordUtils,i=o.getDistance(e,t),a=o.substract(t,e),s=Math.atan2(a.y,a.x),l=o.getDistance(r,n),u=o.substract(n,r),c=Math.atan2(u.y,u.x),d=o.substract(r,e);return{translateX:d.x,translateY:d.y,scale:l/i,rotateAngle:c-s,center:e}},getDistance:function(e,t){t||(t={x:0,y:0,z:0});var r=Math.sqr(t.x-e.x)+Math.sqr(t.y-e.y);return Kekule.ObjUtils.notUnset(e.z)&&Kekule.ObjUtils.notUnset(t.z)&&(r+=Math.sqr(t.z-e.z)),Math.sqrt(r)},getCenter:function(e){var t=e.length;if(t<=0)return null;for(var r=Object.extend(e[0]),n=1;n<t;++n)r=Kekule.CoordUtils.add(r,e[n]);return Kekule.CoordUtils.divide(r,t)},insideRect:function(e,t,r){return(e.x-t.x)*(e.x-r.x)<=0&&(e.y-t.y)*(e.y-r.y)<=0},isInsideBox:function(e,t){var r=t,n=Math.sign(e.x-r.x1)*Math.sign(e.x-r.x2)<=0&&Math.sign(e.y-r.y1)*Math.sign(e.y-r.y2)<=0;return Kekule.ObjUtils.notUnset(e.z)&&(n=n&&Math.sign(e.z-r.z1)*Math.sign(e.z-r.z2)<=0),n},getContainerBoxCorners:function(e){var t={},r={},n=e.length;if(!(n>0))return null;t=Kekule.CoordUtils.clone(e[0]),r=Kekule.CoordUtils.clone(e[0]);for(var o=1;o<n;++o){var i=e[o];t.x=Math.min(t.x,i.x),t.y=Math.min(t.y,i.y),r.x=Math.max(r.x,i.x),r.y=Math.max(r.y,i.y),Kekule.ObjUtils.notUnset(t.z)&&(t.z=Math.min(t.z,i.z),r.z=Math.max(r.z,i.z))}return{min:t,max:r}},getContainerBox:function(e){var t=Kekule.CoordUtils.getContainerBoxCorners(e),r=t.min,n=t.max;return Kekule.BoxUtils.createBox(r,n)}},Kekule.GeometryUtils={standardizeAngle:function(e,t,r){t=t||0,Math.PI;return e-Math.floor((e-t)/Math.PI/2)*Math.PI*2},polarToCartesian:function(e,t,r,n){return{x:e+r*Math.cos(n),y:t+r*Math.sin(n)}},getVectorScalarProduct:function(e,t){return(e.x||0)*(t.x||0)+(e.y||0)*(t.y||0)+(e.z||0)*(t.z||0)},getVectorCrossProduct:function(e,t){return{x:(e.y||0)*(t.z||0)-(e.z||0)*(t.y||0),y:(e.z||0)*(t.x||0)-(e.x||0)*(t.z||0),z:(e.x||0)*(t.y||0)-(e.y||0)*(t.x||0)}},getVectorIncludedAngle:function(e,t){var r=Kekule.CoordUtils,n=Kekule.GeometryUtils.getVectorCrossProduct(e,t),o={x:0,y:0,z:0},i=r.getDistance(e,o)*r.getDistance(t,o),a=r.getDistance(n,o)/i;return Math.asin(a)},getVectorIncludedAngle2:function(e,t){return Kekule.GeometryUtils.standardizeAngle(Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x))},getDihedralAngleOfVectors:function(e,t,r){var n=Kekule.CoordUtils,o=Kekule.GeometryUtils,i=o.getVectorCrossProduct(e,t),a=o.getVectorCrossProduct(t,r),s=n.getDistance(t)/1e5;if(n.isZero(i,s)||n.isZero(a,s))return-1;var l=n.standardize(t),u=o.getVectorScalarProduct(o.getVectorCrossProduct(i,a),l),c=o.getVectorScalarProduct(i,a),d=Math.atan2(u,c);return d<0&&(d+=2*Math.PI),d},getDihedralAngleOfPoints:function(e,t,r,n){var o=Kekule.CoordUtils,i=o.substract(t,e),a=o.substract(r,t),s=o.substract(n,r);return Kekule.GeometryUtils.getDihedralAngleOfVectors(i,a,s)},getPerpendicularCrossPointFromCoordToLine:function(e,t,r,n){var o,i={};if(Math.abs(t.x-r.x)<1e-10)i.x=t.x,i.y=e.y;else{var a=(r.y-t.y)/(r.x-t.x);i.x=(a*a*t.x+a*(e.y-t.y)+e.x)/(a*a+1),i.y=a*(i.x-t.x)+t.y}if(n)o=!0;else{var s={x:t.x-r.x,y:t.y-r.y};o=Math.abs(s.y)>Math.abs(s.x)?Math.sign(i.y-t.y)*Math.sign(i.y-r.y)<=0:Math.sign(i.x-t.x)*Math.sign(i.x-r.x)<=0}return o?i:null},getDistanceFromPointToLine:function(e,t,r,n){var o=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(e,t,r,n);if(o)return Kekule.CoordUtils.getDistance(e,o);var i=Kekule.CoordUtils.getDistance(e,t),a=Kekule.CoordUtils.getDistance(e,r);return Math.min(i,a)},getCrossPointOfLines:function(e,t,r,n){var o=(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x),i=(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x);if(o*i>=0)return null;var a=(r.x-e.x)*(n.y-e.y)-(r.y-e.y)*(n.x-e.x);if(a*(a+o-i)>=0)return null;var s=a/(i-o),l=s*(t.x-e.x),u=s*(t.y-e.y);return{x:e.x+l,y:e.y+u}},getCrossPointOfVectors:function(e,t){return Kekule.GeometryUtils.getCrossPointOfLines(e[0],e[1],t[0],t[1])},getCrossPointsOfVectorToCircle:function(e,t,r,n){var o=[],i=Kekule.CoordUtils,a=Kekule.NumUtils.isFloatEqual,s=n,l=[i.substract(e[0],t),i.substract(e[1],t)],u=l[1].y-l[0].y,c=l[0].x-l[1].x,d=l[1].x*l[0].y-l[0].x*l[1].y,h=r,f=[],m=4*u*u*d*d-4*(u*u+c*c)*(d*d-h*h*c*c);if(a(m,0,s))f=[-u*d/(u*u+c*c)];else if(m<0)f=[];else{var g=Math.sqrt(m);f=[(-2*u*d+g)/(2*(u*u+c*c)),(-2*u*d-g)/(2*(u*u+c*c))]}if(f&&f.length){var p=[];if(1===f.length&&a(c,0,s)){var C=Math.sqrt(h*h-f[0]*f[0]);a(C,0,s)?p=[0]:(p[0]=C,p[1]=-C,f[1]=f[0])}else for(var O=0,k=f.length;O<k;++O)p[O]=-(u*f[O]+d)/c;for(O=0,k=f.length;O<k;++O){var S=(f[O]-l[0].x)*(f[O]-l[1].x),b=(p[O]-l[0].y)*(p[O]-l[1].y);(a(u,0,s)&&S<=0||a(c,0,s)&&b<=0||S<=0&&b<=0)&&o.push(i.add({x:f[O],y:p[O]},t))}}return o},getCrossPointsOfCircles:function(e,t,r,n,o){if(Kekule.CoordUtils.getDistance(e,r)>t+n)return[];for(var i=t,a=n,s=e.x,l=r.x,u=e.y,c=r.y,d=(i*i-a*a+(l*l-s*s)+(c*c-u*u))/(2*(c-u)),h=(l-s)/(c-u),f=1+h*h,m=-(2*s+2*(d-u)*h),g=s*s+Math.sqr(d-u)-i*i,p=Math.sqrt(m*m-4*f*g),C=2*f,O=Kekule.NumUtils.isFloatEqual(p,0,o)?[-m]:[(-m+p)/C,(-m-p)/C],k=[],S=[],b=0,T=O.length;b<T;++b)k[b]=d-h*O[b],S.push({x:O[b],y:k[b]});return S},clipLineSegmentByBox:function(e,t){for(var r=t[0].x,n=t[0].y,o=t[1].x,i=t[1].y,a=e[0].x,s=e[0].y,l=e[1].x,u=e[1].y,c=function(e){var t=0;return e.x<r?t|=1:e.x>o&&(t|=2),e.y<n?t|=4:e.y>i&&(t|=8),t},d=c(e[0]),h=c(e[1]),f=!1;;){if(!(d|h)){f=!0;break}if(d&h){f=!1;break}var m,g,p=d||h;8&p?(m=a+(l-a)*(i-s)/(u-s),g=i):4&p?(m=a+(l-a)*(n-s)/(u-s),g=n):2&p?(g=s+(u-s)*(o-a)/(l-a),m=o):1&p&&(g=s+(u-s)*(r-a)/(l-a),m=r),p===d?(s=g,d=c(a=m)):(u=g,h=c(l=m))}if(f){var C=Kekule.CoordUtils.create;return[C(a,s),C(l,u)]}return null},simplifyCurveToLineSegments:function(e,t){return t?e.length<=2?Kekule.ArrayUtils.clone(e):Kekule.GeometryUtils._simplifyCurvePartToLineSegments(e,0,e.length-1,t):e},_simplifyCurvePartToLineSegments:function(e,t,r,n){var o=Kekule.GeometryUtils,i=e[t],a=e[r];if(r-t<=1)return[i,a];for(var s=n,l=null,u=t+1;u<r;++u){var c=Kekule.GeometryUtils.getDistanceFromPointToLine(e[u],i,a);c>s&&(s=c,l=u)}if(null===l)return[i,a];var d=o._simplifyCurvePartToLineSegments(e,t,l,n),h=o._simplifyCurvePartToLineSegments(e,l,r,n);return h.shift(),[].concat(d).concat(h)}},Kekule.IntersectionState={EQUAL:0,CONTAINING:1,CONTAINED:2,OVERLAPPED:3,SEPARATED:4},Kekule.BoxUtils={createBox:function(e,t){var r={},n=e.x||0,o=e.y||0,i=t.x||0,a=t.y||0;return n<=i?(r.x1=n,r.x2=i):(r.x1=i,r.x2=n),o<=a?(r.y1=o,r.y2=a):(r.y1=a,r.y2=o),Kekule.ObjUtils.notUnset(e.z)&&Kekule.ObjUtils.notUnset(t.z)&&(e.z<=t.z?(r.z1=e.z,r.z2=t.z):(r.z1=t.z,r.z2=e.z)),r},clone:function(e){var t={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2};return Kekule.ObjUtils.notUnset(e.z1)&&Kekule.ObjUtils.notUnset(e.z2)&&(t.z1=e.z1,t.z2=e.z2),t},convertToRect:function(e){var t=Kekule.BoxUtils.normalize(e);return Kekule.RectUtils.createRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)},normalize:function(e){var t={x1:Math.min(e.x1,e.x2),y1:Math.min(e.y1,e.y2),x2:Math.max(e.x1,e.x2),y2:Math.max(e.y1,e.y2)};return Kekule.ObjUtils.notUnset(e.z1)&&Kekule.ObjUtils.notUnset(e.z2)&&(t.z1=Math.min(e.z1,e.z2),t.z2=Math.max(e.z1,e.z2)),t},shiftBox:function(e,t,r,n){var o=t||0,i=r||0,a=n||0,s={x:e.x1+o,y:e.y1+i},l={x:e.x2+o,y:e.y2+i};return Kekule.ObjUtils.notUnset(e.z1)&&Kekule.ObjUtils.notUnset(e.z2)&&(s.z=e.z1+a,l.z=e.z2+a),Kekule.BoxUtils.createBox(s,l)},inflateBox:function(e,t,r,n){Kekule.ObjUtils.isUnset(r)&&(r=t),Kekule.ObjUtils.isUnset(n)&&(n=t);var o={x1:(o=Kekule.BoxUtils.normalize(e)).x1-t,y1:o.y1-r,x2:o.x2+t,y2:o.y2+r};return Kekule.ObjUtils.notUnset(o.z1)&&Kekule.ObjUtils.notUnset(o.z2)&&(o.z1=o.z1-n,o.z2=o.z2+n),o},getContainerBox:function(e,t){if(!e)return Kekule.BoxUtils.clone(t);if(!t)return Kekule.BoxUtils.clone(e);var r=Kekule.BoxUtils.normalize(e),n=Kekule.BoxUtils.normalize(t),o={x1:Math.min(r.x1,n.x1),y1:Math.min(r.y1,n.y1),x2:Math.max(r.x2,n.x2),y2:Math.max(r.y2,n.y2)};return Kekule.ObjUtils.notUnset(r.z1)&&Kekule.ObjUtils.notUnset(r.z2)&&Kekule.ObjUtils.notUnset(n.z1)&&Kekule.ObjUtils.notUnset(n.z2)&&(o.z1=Math.min(r.z1,n.z1),o.z2=Math.max(r.z2,n.z2)),o},getIntersection:function(e,t){var r=Kekule.BoxUtils.normalize(e),n=Kekule.BoxUtils.normalize(t),o={x1:Math.max(r.x1,n.x1),y1:Math.max(r.y1,n.y1),x2:Math.min(r.x2,n.x2),y2:Math.min(r.y2,n.y2)};return o.x1>o.x2||o.y1>o.y2?null:Kekule.ObjUtils.notUnset(r.z1)&&Kekule.ObjUtils.notUnset(r.z2)&&Kekule.ObjUtils.notUnset(n.z1)&&Kekule.ObjUtils.notUnset(n.z2)&&(o.z1=Math.max(r.z1,n.z1),o.z2=Math.min(r.z2,n.z2),o.z1>o.z2)?null:o},hasIntersection:function(e,t){return!!Kekule.BoxUtils.getIntersection(e,t)},isEqual:function(e,t){return Math.min(e.x1,e.x2)===Math.min(t.x1,t.x2)&&Math.max(e.x1,e.x2)===Math.max(t.x1,t.x2)&&Math.min(e.y1,e.y2)===Math.min(t.y1,t.y2)&&Math.max(e.y1,e.y2)===Math.max(t.y1,t.y2)},isInside:function(e,t){var r=e,n=t;return Math.min(r.x1,r.x2)>=Math.min(n.x1,n.x2)&&Math.max(r.x1,r.x2)<=Math.max(n.x1,n.x2)&&Math.min(r.y1,r.y2)>=Math.min(n.y1,n.y2)&&Math.max(r.y1,r.y2)<=Math.max(n.y1,n.y2)},getIntersectionState:function(e,t){var r=Kekule.BoxUtils,n=Kekule.IntersectionState;return r.isEqual(e,t)?n.EQUAL:r.isInside(e,t)?n.CONTAINED:r.isInside(t,e)?n.CONTAINING:r.hasIntersection(e,t)?n.OVERLAPPED:n.SEPARATED},getCenterCoord:function(e){var t={x:((e.x1||0)+(e.x2||0))/2,y:((e.y1||0)+(e.y2||0))/2};return(Kekule.ObjUtils.notUnset(e.z1)||Kekule.ObjUtils.notUnset(e.z2))&&(t.z=(e.z1||0+e.z2||0)/2),t},getMinMaxCoords:function(e){var t=Kekule.BoxUtils.normalize(e),r={min:{x:t.x1,y:t.y1},max:{x:t.x2,y:t.y2}};return Kekule.ObjUtils.notUnset(t.z1)&&(r.min.z=t.z1,r.max.z=t.z2),r},getCornerCoords:function(e){var t=Kekule.BoxUtils.normalize(e);return Kekule.ObjUtils.isUnset(t.z1)?[{x:t.x1,y:t.y1},{x:t.x1,y:t.y2},{x:t.x2,y:t.y1},{x:t.x2,y:t.y2}]:[{x:t.x1,y:t.y1,z:t.z1},{x:t.x1,y:t.y2,z:t.z1},{x:t.x2,y:t.y1,z:t.z1},{x:t.x2,y:t.y2,z:t.z1},{x:t.x1,y:t.y1,z:t.z2},{x:t.x1,y:t.y2,z:t.z2},{x:t.x2,y:t.y1,z:t.z2},{x:t.x2,y:t.y2,z:t.z2}]},transform2D:function(e,t){for(var r=Kekule.BoxUtils.getCornerCoords(e),n=[],o=0,i=r.length;o<i;++o)n.push(Kekule.CoordUtils.transform2D(r[o],t));return Kekule.CoordUtils.getContainerBox(n)},transform3D:function(e,t){for(var r=Kekule.BoxUtils.getCornerCoords(e),n=[],o=0,i=r.length;o<i;++o)n.push(Kekule.CoordUtils.transform3D(r[o],t));return Kekule.CoordUtils.getContainerBox(n)}},Kekule.RectUtils={createRect:function(e,t,r,n){return{left:e,top:t,width:r,height:n}},clone:function(e){return{left:e.left,top:e.top,width:e.width,height:e.height}},isZero:function(e){return 0===e.width&&0===e.height},convertToBox:function(e){var t=Kekule.CoordUtils.create(e.left,e.top),r=Kekule.CoordUtils.create(e.left+e.width,e.top+e.height);return Kekule.BoxUtils.createBox(t,r)},inflateRect:function(e,t,r){return Kekule.ObjUtils.isUnset(r)&&(r=t),Kekule.RectUtils.createRect(e.left,e.top,e.width+t,e.height+r)},shiftRect:function(e,t,r){var n=t||0,o=r||0;return Kekule.RectUtils.createRect(e.left+n,e.top+o,e.width,e.height)},getContainerRect:function(e,t){var r=Kekule.RectUtils.convertToBox(e),n=Kekule.RectUtils.convertToBox(t),o=Kekule.BoxUtils.getContainerBox(r,n);return Kekule.BoxUtils.convertToRect(o)},getIntersection:function(e,t){var r=Kekule.RectUtils.convertToBox(e),n=Kekule.RectUtils.convertToBox(t),o=Kekule.BoxUtils.getIntersection(r,n);return o?Kekule.BoxUtils.convertToRect(o):null},hasIntersection:function(e,t){return!!Kekule.RectUtils.getIntersection(e,t)}},Kekule.ZoomUtils={PREDEFINED_ZOOM_RATIOS:[.1,.3,.5,.66,.8,.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5,7,10,15,20],RATIO_INT_BASE:100,getNearestZoomLevel:function(e,t){var r=t||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS,n=r.length;if(e>r[n-1])return r[n-1];if(e<r[0])return r[0];for(var o=0;o<n-1;++o){var i=r[o],a=r[o+1];if(e>=i&&e<=a)return 1===i||1===a?1:(e-i)/(a-i)<=.5?i:a}},getNextZoomInRatio:function(e,t,r){t||(t=1);var n=r||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS,o=n.length,i=Math.round(e*Kekule.ZoomUtils.RATIO_INT_BASE);if(i<Math.round(n[o-1]*Kekule.ZoomUtils.RATIO_INT_BASE))for(var a=0;a<o;++a)if(Math.round(n[a]*Kekule.ZoomUtils.RATIO_INT_BASE)>i)return n[Math.min(a+t,o)-1];return e},getNextZoomOutRatio:function(e,t,r){t||(t=1);var n=r||Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS,o=n.length,i=Math.round(e*Kekule.ZoomUtils.RATIO_INT_BASE);if(i>Math.round(n[0]*Kekule.ZoomUtils.RATIO_INT_BASE))for(var a=o-1;a>=0;--a)if(Math.round(n[a]*Kekule.ZoomUtils.RATIO_INT_BASE)<i)return n[Math.max(a-t+1,0)];return e}},Kekule.DomHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DomHelper",NAMESPACE_DEFINE_PREFIX:"xmlns",NAMESPACE_DELIMITER:":",XMLNS_URI:"http://www.w3.org/2000/xmlns/",ERR_EMPTY_DOC:"Document is empty",ERR_ELEMENT_NOTSET:"Element not set",initialize:function(e){this.tryApplySuper("initialize"),this._supportNsMethods=null,e&&this.setDocument(e)},initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("document");if(!e){var t=this.getPropStoreFieldValue("rootElement");e=t?t.ownerDocument:null}return e},setter:function(e){e!=this.getPropStoreFieldValue("document")&&(this.setPropStoreFieldValue("document",e),this.analysisRootElem())}}),this.defineProp("rootElement",{dataType:DataType.OBJECT,serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("rootElement");if(!e){var t=this.getPropStoreFieldValue("document");e=t?t.documentElement:null}return e},setter:function(e){this.setPropStoreFieldValue("rootElement",e),this.analysisRootElem()}}),this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:!1,getter:function(){return this.getPropStoreFieldValue("namespaces")||this.setPropStoreFieldValue("namespaces",[]),this.getPropStoreFieldValue("namespaces")}}),this.defineProp("defNamespaceURI",{dataType:DataType.STRING,serializable:!1}),this.defineProp("forceAnalysisDoc",{dataType:DataType.BOOL})},analysisRootElem:function(){this.setNamespaces([]),this.setDefNamespaceURI(null);var e=this.getRootElement();if(e){var t=e.ownerDocument;if(this._supportNsMethods=!!t.getElementsByTagNameNS,!this._supportNsMethods||this.getForceAnalysisDoc())for(var r=0,n=e.attributes.length;r<n;++r){var o=e.attributes[r],i=o.name;if(i&&i.indexOf(this.NAMESPACE_DEFINE_PREFIX)>=0){var a=o.value,s=i.indexOf(this.NAMESPACE_DELIMITER),l=s>=0?i.substring(s+1):null;this.getNamespaces().push({namespaceURI:a,prefix:l}),l||this.setDefNamespaceURI(a)}}}},_getEmptyDocErrorMsg:function(){return Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.EMPTY_DOC"):this.ERR_EMPTY_DOC},_getElementNotSetErrorMsg:function(){return Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.ELEMENT_NOTSET"):this.ELEMENT_NOTSET},assertDocAvailable:function(e){return!!e||(Kekule.raise(this._getEmptyDocErrorMsg()),!1)},assertElementAvailable:function(e){return!!e||(Kekule.raise(this._getElementNotSetErrorMsg()),!1)},getNsPrefix:function(e){if(e==this.getDefNamespaceURI())return"";for(var t=this.getNamespaces(),r=0,n=t.length;r<n;++r)if(t[r].namespaceURI==e)return t[r].prefix;return null},getQualifiedName:function(e,t){var r=this.getNsPrefix(e);return null===r?null:r?r+this.NAMESPACE_DELIMITER+t:t},addNamespace:function(e,t,r,n){n||(n=e.documentElement);var o=t?this.NAMESPACE_DEFINE_PREFIX+this.NAMESPACE_DELIMITER+t:this.NAMESPACE_DEFINE_PREFIX,i=this.XMLNS_URI;this.setAttributeNS(i,o,r,n)},createElementNS:function(e,t){var r=this.getDocument();return this.assertDocAvailable(r)?this._supportNsMethods?r.createElementNS(e,t):r.createElement(t):null},getElementsByTagNameNS:function(e,t,r){var n=this.getPropStoreFieldValue("document")||this.getPropStoreFieldValue("rootElement"),o=this.getDocument();if(!this.assertDocAvailable(o))return null;if(this._supportNsMethods)return e||(e="*"),r?r.getElementsByTagNameNS(e,t):n.getElementsByTagNameNS(e,t);var i=this.getQualifiedName(e,t);return null===i?[]:r?r.getElementsByTagName(i):n.getElementsByTagName(i)},getAttributeNodeNS:function(e,t,r){if(!this.assertElementAvailable(r))return null;if(this._supportNsMethods)return e||(e="*"),r.getAttributeNodeNS(e,t);var n=this.getQualifiedName(e,t);return null===n?null:r.getAttributeNode(n)},getAttributeNS:function(e,t,r){if(!this.assertElementAvailable(r))return null;if(this._supportNsMethods)return e||(e="*"),r.getAttributeNS(e,t);var n=this.getQualifiedName(e,t);return null===n?null:r.getAttribute(n)},setAttributeNS:function(e,t,r,n){if(!this.assertElementAvailable(n))return null;if(this._supportNsMethods)return n.setAttributeNS(e,t,r);var o=this.getQualifiedName(e,t);return null===o?null:n.setAttribute(o,r)}}),Kekule.DomUtils={namespaceMatched:function(e,t,r){return void 0===r&&(r=!0),e.namespaceURI==t||r&&!e.namespaceURI},isElement:function(e){return e&&e.tagName&&e.nodeType},getElementText:function(e){for(var t="",r=0,n=e.childNodes.length;r<n;++r)3==e.childNodes[r].nodeType&&(t+=e.childNodes[r].nodeValue);return t},setElementText:function(e,t,r){for(var n=0,o=e.childNodes.length;n<o;++n)if(3==e.childNodes[n].nodeType)return e.childNodes[n].nodeValue=t,t;var i=r?(t||"").split("\n"):[t||""];for(n=0,o=i.length;n<o;++n){if(n>0){var a=e.ownerDocument.createElement("br");e.appendChild(a)}var s=e.ownerDocument.createTextNode(i[n]);e.appendChild(s)}return t},getLocalName:function(e){return e.localName||e.baseName||e.nodeName},getChildNodesOfTypes:function(e,t){for(var r=[],n=Kekule.ArrayUtils.toArray(t),o=0,i=e.childNodes.length;o<i;++o){var a=e.childNodes[o];(!t||n.indexOf(a.nodeType)>=0)&&r.push(a)}return r},getFirstChildElem:function(e,t,r,n){for(var o=0,i=e.childNodes.length;o<i;++o){var a=e.childNodes[o];if(a.nodeType===Node.ELEMENT_NODE&&(t&&t.toLowerCase()===a.tagName.toLowerCase()||r&&r.toLowerCase()===Kekule.DomUtils.getLocalName(a).toLowerCase()||!t&&!r)&&(!n||Kekule.DomUtils.namespaceMatched(a,n)))return a}},getDirectChildElems:function(e,t,r,n){for(var o=[],i=0,a=e.childNodes.length;i<a;++i){var s=e.childNodes[i];s.nodeType===Node.ELEMENT_NODE&&(t&&t.toLowerCase()===s.tagName.toLowerCase()||r&&r.toLowerCase()===Kekule.DomUtils.getLocalName(s).toLowerCase()||!t&&!r)&&(n&&!Kekule.DomUtils.namespaceMatched(s,n)||o.push(s))}return o},getDirectChildElemsOfAttribValues:function(e,t,r,n,o){for(var i=Kekule.DomUtils.getDirectChildElems(e,r,n,o),a=[],s=0,l=i.length;s<l;++s){for(var u=!0,c=0,d=t.length;c<d;++c){var h=Kekule.ObjUtils.getOwnedFieldNames(t[c])[0];if(i[s].getAttribute(h)!=t[c][h]){u=!1;break}}u&&a.push(i[s])}return a},getParentNode:function(e,t){var r=t||{},n=e.parentNode;return n||(r.acrossShadowRoot&&e.host?e.host:null)},isDescendantOf:function(e,t,r){var n=r||{};try{if(e&&t){if(e.documentElement)return!1;if(e.ownerDocument===t)return!0;for(var o=Kekule.DomUtils.getParentNode,i=o(e,n);i;){if(i===t)return!0;i=o(i,n)}}return!1}catch(e){return!1}},isOrIsDescendantOf:function(e,t,r){return e===t||Kekule.DomUtils.isDescendantOf(e,t,r)},getNearestAncestorByTagName:function(e,t,r){var n=t.toLowerCase();if(r&&e.tagName&&e.tagName.toLowerCase()===n)return e;for(var o=e.parentNode;o&&o.tagName;){if(o.tagName.toLowerCase()===n)return o;o=o.parentNode}return null},getSameNSAttributeValue:function(e,t,r){return e.getAttribute(t)},setSameNSAttributeValue:function(e,t,r,n){return e.setAttribute(t,r)},fetchAttributeValuesToArray:function(e,t,r){for(var n=[],o=0,i=e.attributes.length;o<i;++o){var a=e.attributes[o];if(!t||Kekule.DomUtils.namespaceMatched(a,t,!0)){var s;if(r)try{s=Kekule.DomUtils.getLocalName(a)}catch(e){s=a.name}else s=a.name;n.push({name:s,value:a.value})}}return n},fetchAttributeValuesToJson:function(e,t,r){for(var n={},o=0,i=e.attributes.length;o<i;++o){var a=e.attributes[o];if(!t||Kekule.DomUtils.namespaceMatched(a,t,!0)){var s;if(r)try{s=Kekule.DomUtils.getLocalName(a)}catch(e){s=a.name}else s=a.name;n[s]=a.value}}return n},hasAttribute:function(e,t){return e.hasAttribute?e.hasAttribute(t):!!e.getAttribute(t)},isDataAttribName:function(e){return e.toString().startsWith("data-")},getDataAttribCoreName:function(e){return Kekule.DomUtils.isDataAttribName(e)?e.substr(5):null},getDataAttrib:function(e,t){return e.dataset?e.dataset[t]:e.getAttribute("data-"+t.toString().hyphenize())},setDataAttrib:function(e,t,r){e.dataset?e.dataset[t]=r:e.setAttribute("data-"+t.toString().hyphenize(),r)},getDataset:function(e){if(e.dataset)return e.dataset;for(var t={},r=e.attributes,n=0,o=r.length;n<o;++n){var i=r[n],a=i.name;0===a.toLowerCase().indexOf("data-")&&(t[a.substring(5).camelize()]=i.value)}return t},clearChildContent:function(e){for(var t=Kekule.ArrayUtils.toArray(e.childNodes),r=t.length-1;r>=0;--r){var n=t[r];n.nodeType!==Node.ATTRIBUTE_NODE&&e.removeChild(n)}return e},replaceTagName:function(e,t){if(e.tagName.toLowerCase()!==t.toLowerCase()){for(var r=e.ownerDocument.createElement(t),n=Kekule.DomUtils.fetchAttributeValuesToArray(e),o=0,i=n.length;o<i;++o)r.setAttribute(n[o].name,n[o].value);var a=Kekule.DomUtils.getDirectChildElems(e);for(o=0,i=a.length;o<i;++o)r.appendChild(a[o]);var s=e.parentNode,l=e.nextSibling;return s.removeChild(e),l?s.insertBefore(r,l):s.appendChild(r),r}return e},setElemAttributes:function(e,t){for(var r=Kekule.ObjUtils.getOwnedFieldNames(t),n=0,o=r.length;n<o;++n){var i=r[n],a=t[i];i&&a&&e.setAttribute(i,a)}return e},isInDomTree:function(e,t,r){var n=r||{};if(!e)return!1;if(t||(t=e.ownerDocument),t){if(!n.acrossShadowRoot&&e.getRootNode)return e.getRootNode()===t;var o=t.documentElement;return Kekule.DomUtils.isDescendantOf(e,o,r)||e===o}return!1},isInShadowRoot:function(e){if("undefined"==typeof ShadowRoot)return!1;try{return(e.getRootNode&&e.getRootNode())instanceof ShadowRoot}catch(e){return!1}}},Kekule.DataSrcAttribUtils={isUrlBasedValue:function(e){return 0===e.toLowerCase().indexOf("url(")},getUrl:function(e){var t=e.trim();if(0===t.toLowerCase().indexOf("url(")){var r=t.lastIndexOf(")");return t=t.substring(4,r)}return null},getElementContent:function(e){if(!e)return null;var t=e.innerHTML;return t=t.ltrim()},getElementMimeType:function(e){return e.getAttribute("type")}},Kekule.ScriptFileUtils={_existedScriptUrls:new Kekule.MapEx,appendScriptFile:function(e,t,r){var n;if(e){if((n=Kekule.ScriptFileUtils._existedScriptUrls.get(e))||(n=[],Kekule.ScriptFileUtils._existedScriptUrls.set(e,n)),n.indexOf(t)>=0)return void(r&&r(null));var o=e.createElement("script");return o.src=t,o.onerror=function(e){r&&r(e)},o.onload=o.onreadystatechange=function(e){if(!o._loaded){var i=o.readyState;void 0!==i&&"loaded"!==i&&"complete"!==i||(o._loaded=!0,o.onload=o.onreadystatechange=null,n.push(t),r&&r(null))}},(e.getElementsByTagName("head")[0]||e.body).appendChild(o),o}var i=Kekule.$jsRoot.__$kekule_scriptfile_utils__;if(i&&i.appendScriptFile)return i.appendScriptFile(e,t,r)},appendScriptFiles:function(e,t,r){var n=[].concat(t),o=function(e,t,r,n){if(t.length<=0)r&&(n.length?r(new Error("Error in loading: "+n.join("; "))):r(null));else{var i=t.shift();Kekule.ScriptFileUtils.appendScriptFile(e,i,function(a){a&&n.push(i+": "+a?a.message||a:""),o(e,t,r,n)})}};o(e,n,r,[])}},function(){"use strict";Kekule.ExternalResourceType={JS_OBJ:"jsObject",STYLESHEET:"stylesheet",DATA:"data",OTHER:"other"},Kekule.ExternalResourceType.DEFAULT=Kekule.ExternalResourceType.JS_OBJ,Kekule.ExternalResourceManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExternalResourceManager",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("resources",{})},doFinalize:function(){this.setPropStoreFieldValue("resources",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("resources",{dataType:DataType.HASH,serializable:!1,setter:null})},register:function(e,t,r,n){var o=this.getResources();o[e]&&this.unregister(e),o[e]={name:e,resource:t,resourceType:r||Kekule.ExternalResourceType.DEFAULT},this.invokeEvent("resourceRegistered",{name:e,resource:t,resourceType:r}),this.invokeEvent(e+"Registered",{name:e,resource:t,resourceType:r})},unregister:function(e){var t=this.getResources();if(t[e]){var r=t[e];this.invokeEvent("resourceUnregistered",r),this.invokeEvent(e+"Unregistered",r),delete t[e]}},getResourceDetails:function(e){return this.getResources()[e]},getResource:function(e){var t=this.getResourceDetails(e);return t&&t.resource}}),Kekule.ClassUtils.makeSingleton(Kekule.ExternalResourceManager),Kekule.externalResourceManager=Kekule.ExternalResourceManager.getInstance()}(),function(){"use strict";Kekule.Unit={ALL:{},_KEY_MAP:{},register:function(t,r,n,o,i){var a=e[n];a||(a=e._createCategoryObj(n),e[n]=a);var s=r.toUpperCase();return a[s]=e._createUnitObj(t,r,a,o,i),1===o&&a.setStandardUnit(a[s]),e.ALL[s]=a[s],e._KEY_MAP[a[s].getKey()]=a[s],a[s]},unregister:function(t){var r=e.getUnit(t);if(r){var n=r.getKey().toUpperCase();delete e.ALL[n],delete e._KEY_MAP[n],delete r.category[n]}},getUnit:function(t,r){if("object"==typeof t)return t.getKey?t:null;var n=e._KEY_MAP[t];if(!n&&r)for(var o=t.toLowerCase(),i=Kekule.ObjUtils.getOwnedFieldNames(e._KEY_MAP),a=0,s=i.length;a<s;++a)if(o===i[a].toLowerCase()){n=e._KEY_MAP[i[a]];break}return n},getUnitByName:function(t,r){for(var n=Kekule.ObjUtils.getOwnedFieldNames(e._KEY_MAP),o=r&&t.toLowerCase(),i=0,a=n.length;i<a;++i){var s=e._KEY_MAP[n[i]],l=s.name;if(t===l||r&&o===l.toLowerCase())return s}return null},_createCategoryObj:function(t){var r=Object.create(e._categoryObjProto);return r.name=t,r},_createUnitObj:function(e,t,r,n,o){var i=Object.create(Kekule.Unit._unitObjProto);return Object.extend(i,{symbol:e,name:t,category:r,rateToStandard:n}),o&&Object.extend(i,o),i}};var e=Kekule.Unit;Kekule.Unit._categoryObjProto={getName:function(){return this.name},getStandardUnit:function(){return this._standardUnit},setStandardUnit:function(e){this._standardUnit=e},getUnitsOf:function(e){for(var t=Kekule.ObjUtils.getOwnedFieldNames(this,!1),r=[],n=0,o=t.length;n<o;++n)if("_standardUnit"!==t[n]){var i=this[t[n]];Kekule.ObjUtils.getPrototypeOf(i)!==Kekule.Unit._unitObjProto||e&&!e(i)||r.push(i)}return r},getAllUnits:function(){return this.getUnitsOf()},getConvertableUnits:function(){return this.getUnitsOf(function(e){return!!e.rateToStandard})}},Kekule.Unit._unitObjProto={getKey:function(){return this.symbol||this.name},isStandard:function(){return 1===this.rateToStandard},canConvertValueTo:function(e,t){return e.category===this.category},convertValueTo:function(t,r,n){var o="string"==typeof r?e.getUnit(r):r;if(o)return this.doConvertValueTo(t,o,n);Kekule.error(Kekule.$L("ErrorMsg.UNIT_NOT_FOUND").format(r.symbol||r.name||r))},convertValueFromStandard:function(e,t){var r=this.category.getStandardUnit();if(r)return this._convFromStandard?this._convFromStandard(e,t):r.convertValueTo(e,this,t);Kekule.error(Kekule.$L("ErrorMsg.STANDARD_UNIT_OF_CATEGORY_NOT_FOUND").format(this.category.name))},convertValueToStandard:function(e,t){return this.convertValueToStandardEx(e,t).value},convertValueToStandardEx:function(e,t){var r=this.category.getStandardUnit();if(r)return{value:this._convToStandard?this._convToStandard(e,t):this.convertValueTo(e,r,t),unit:r};Kekule.error(Kekule.$L("ErrorMsg.STANDARD_UNIT_OF_CATEGORY_NOT_FOUND").format(this.category.name))},doConvertValueTo:function(e,t,r){if(t===this)return e;if(this.canConvertValueTo(t,r)){var n=t.rateToStandard,o=this.rateToStandard;if(n&&o)return e*o/n;var i=o||this._convToStandard,a=n||t._convFromStandard;if(i&&a){var s=this.convertValueToStandard(e,r);return t.convertValueFromStandard(s,r)}Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_CONVERT_BETWEEN_UNITS").format(this.getKey(),t.getKey()))}else Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_CONVERT_BETWEEN_UNITS").format(this.getKey(),t.getKey()))}},Kekule.UnitUtils={convertValue:function(t,r,n,o){return e.getUnit(r).convertValueTo(t,n,o)}};var t=e.register;t("unk","Unknown","Unknown",null),t("","counts","Counts",1),t("arb","arbitrary","Arbitrary",null),t("","one","Dimensionless",1),t("%","percent","Dimensionless",.01),t("","thousandth","Dimensionless",.001),t("ppm","parts_per_million","Dimensionless",1e-6),t("pH","pH","AcidicScake",1),t("sec","second","Time",1),t("hr","hour","Time",3600),t("min","minute","Time",60),t("ms","millisecond","Time",.001),t("s","microsecond","Time",1e-6),t("ns","nanosecond","Time",1e-9),t("m","meter","Length",1),t("cm","centimeter","Length",.01),t("mm","millimeter","Length",.001),t("m","micrometer","Length",1e-6),t("nm","nanometer","Length",1e-9),t("","Angstrom","Length",1e-10),t("A-1","Angstrom-1","InverseLength",1e10,{symbolHtml:"A<sup>-1</sup>"}),t("A","ampere","ElectricCurrent",1),t("A","microampere","ElectricCurrent",1e-6),t("nA","nanoampere","ElectricCurrent",1e-9),t("pA","picoampere","ElectricCurrent",1e-12),t("kg","kilogram","Mass",1),t("g","gram","Mass",.001),t("K","kelvin","Temperature",1),t("","Celsius","Temperature",null,{_convToStandard:function(e){return e+273.15},_convFromStandard:function(e){return e-273.15}}),t("mol","mole","AmountOfSubstance",1),t("cd","candela","LuminousIntensity",1),t("rad","radian","Angle",1),t("deg","degree","Angle",.01745329,{symbolHtml:""}),t("sr","steradian","SolidAngle",1),t("Hz","Hertz","Frequency",1),t("kHz","kilohertz","Frequency",1e3),t("MHz","megahertz","Frequency",1e6),t("N","Newton","Force",1),t("kcal/","kilocalorie_per_angstrom","Force",null),t("J","Joule","Energy",1),t("cal","calorie","Energy",4.184),t("kcal","kilocalorie","Energy",4184),t("kcal/rad","kilocalorie_per_radian","Energy",null),t("eV","electron_volt","Energy",1.60217733e-19),t("hart","Hartree","Energy",4.3597482e-18),t("W","Watt","Power",1),t("Pa","Pascal","Pressure",1),t("GPa","gigaPascal","Pressure",1e9),t("bar","Bar","Pressure",1e5),t("kbar","kbar","Pressure",1e8),t("atm","Atmosphere","Pressure",101325.027),t("GPa-1","gigaPascal-1","InversePressure",1e-9,{symbolHtml:"GPa<sup>-1</sup>"}),t("C","Coulomb","ElectricCharge",1),t("e","electron_charge","ElectricCharge",1.60217733e-19),t("V","Volt","ElectricPotentialDifference",1),t("","Ohm","ElectricResistance",1),t("F","Farad","ElectricCapacitance",1),t("S","Siemens","ElectricConductance",1),t("Wb","Weber","MagneticFlux",1),t("T","Tesla","MagneticFluxDensity",1),t("H","Henry","MagneticInductance",1),t("Bq","Becquerel","Radioactivity",1),t("Gy","Gray","RadioactiveAbsorbedDose",1),t("Sv","Sievert","RadioactiveEquivalentDose",1),t("kat","Katal","CatalyticActivity",1),t("cp","Centipoise","DynamicVicosity",null),t("mol/L","Molarity","Molarity",1),t("mol/kg","Molality","Molality",1),t("m2","Square_meter","Area",1,{symbolHtml:"m<sup>2</sup>"}),t("cm2","centimeter_squared","Area",1e-4,{symbolHtml:"cm<sup>2</sup>"}),t("m3","Cubic_meter","Volume",1,{symbolHtml:"m<sup>3</sup>"}),t("3","Angstrom_cubed","Volume",1e-30,{symbolHtml:"<sup>3</sup>"}),t("L","litre","Volume",.001),t("mL","millilitre","Volume",1e-6),t("m/s","Meter_per_second","Velocity",1),t("km/s","kilometers_per_second","Velcity",1e3),t("ms-2","Meter_per_second_squared","Acceleration",1,{symbolHtml:"ms<sup>-2</sup>"}),t("rad/s","radian_per_second","AngularVelocity",1),t("Ns","newton_second","Momentum",1),t("Nms","newton_meter_second","AngularMomentum",1),t("Nm","newton_meter","Torque",1),t("m-1","reciprocal_meter","WaveNumber",1,{symbolHtml:"m<sup>-1</sup>"}),t("cm-1","reciprocal_centimeter","WaveNumber",100,{symbolHtml:"cm<sup>-1</sup>"}),t("kgm-3","Kilogram_per_cubic_meter","MassDensity",1,{symbolHtml:"kgm<sup>-3</sup>"}),t("kg-1m3","cubic_meter_per_kilogram","SpecificVolume",1,{symbolHtml:"kg<sup>-1</sup>m<sup>3</sup>"}),t("m-3mol","mole_per_cubic_meter","AmountConcentration",1,{symbolHtml:"m<sup>-3</sup>mol"}),t("m3/mol","cubic_meter_per_mole","MolarVolume",1,{symbolHtml:"m<sup>3</sup>/mol"}),t("J/K","joule_per_kelvin","HeatCapacity",1),t("JK-1mol-1","joule_per_kelvin_mole","MolarHeatCapacity",1,{symbolHtml:"JK<sup>-1</sup>mol<sup>-1</sup>"}),t("JK-1kg-1","joule_per_kilogram_kelvin","SpecificHeatCapacity",1,{symbolHtml:"JK<sup>-1</sup>kg<sup>-1</sup>"}),t("J/mol","joule_per_mole","MolarEnergy",1),t("J/kg","joule_per_kilogram","SpecificEnergy",1),t("Jm-3","joule_per_cubic_meter","EnergyDensity",1,{symbolHtml:"Jm<sup>-3</sup>"}),t("N/m","newton_per_meter","SurfaceTension",1),t("Wm-2","watt_per_square_meter","HeatFluxDensity",1,{symbolHtml:"Wm<sup>-2</sup>"}),t("Wm-1K-1","watt_per_meter_kelvin","ThermalConductivity",1,{symbolHtml:"Wm<sup>-1</sup>K<sup>-1</sup>"}),t("m2/s","square_meter_per_second","KinematicViscosity",1,{symbolHtml:"m<sup>2</sup>/s"}),t("Pas","Pascal_second","DynamicViscosity",1),t("Cm-3","coulomb_per_cubic_meter","ElectricChargeDensity",1,{symbolHtml:"Cm<sup>-3</sup>"}),t("Am-2","ampere_per_square_meter","ElectricCurrentDensity",1,{symbolHtml:"Am<sup>-2</sup>"}),t("S/m","siemens_per_meter","ElectricalConductivity",1),t("Sm2/mol","siemens_square_meter_per_mole","MolarConductivity",1,{symbolHtml:"Sm<sup>2</sup>/mol"}),t("F/m","farad_per_meter","Permittivity",1),t("H/m","henry_per_meter","Permeability",1),t("V/m","volt_per_meter","ElectricFieldStrength",1),t("A/m","ampere_per_meter","MagneticFieldStrength",1),t("cdm-2","candela_per_square_meter","Luminance",1,{symbolHtml:"cdm<sup>-2</sup>"}),t("C/kg","coulomb_per_kilogram","Exposure",1),t("Gy/s","gray_per_second","AbsorbedDoseRate",1),t("J/m","joule_per_meter","EnergyLengthGradient",1),t("kj/mol","kj_per_mole","MolarEnergy",1e3),t("D","debye","Dipole",3.335641e-30)}(),Kekule.AbstractConfigs=Class.create(ObjectEx,{CLASS_NAME:"Kekule.AbstractConfigs",CONFIG_PROP_FLAG:"__$config_prop__",initialize:function(e){this.tryApplySuper("initialize"),void 0===e&&(e=!0),e&&this.initPropDefValues()},addConfigProp:function(e,t,r,n){var o={dataType:t};n&&(o=Object.extend(o,n)),void 0!==r&&(o.defaultValue=r);var i=this.defineProp(e,o);return i[this.CONFIG_PROP_FLAG]=!0,i},addHashConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.HASH,t,r)},addStrConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.STRING,t,r)},addNumConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.NUM,t,r)},addIntConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.INT,t,r)},addFloatConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.FLOAT,t,r)},addBoolConfigProp:function(e,t,r){return this.addConfigProp(e,DataType.BOOL,t,r)},initPropDefValues:function(){this.beginUpdate();try{for(var e=this.getAllPropList(),t=0,r=e.getLength();t<r;++t){var n=e.getPropInfoAt(t),o=n.name,i=n.defaultValue;void 0!==i&&this.setPropValue(o,i)}}finally{this.endUpdate()}},isConfigProp:function(e){return!!e[this.CONFIG_PROP_FLAG]},assign:function(e){e.copyPropsTo(this)},doTransformPropNameToHash:function(e){return this.doGetPropNameToHashPrefix()+e},doGetPropNameToHashPrefix:function(){return""},toHash:function(e){var t={},r=this.CONFIG_PROP_FLAG;this.saveObj(t,"json",{saveDefaultValues:!0,propFilter:function(e,t){return e[r]}});for(var n=e||this.doTransformPropNameToHash.bind(this),o={},i=Kekule.ObjUtils.getOwnedFieldNames(t,!1),a=0,s=i.length;a<s;++a){o[n(i[a])]=t[i[a]]}return o}}),Kekule.ConfigPresetMap=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ConfigPresetMap",initialize:function(){this.tryApplySuper("initialize"),this.map=new Kekule.MapEx(!0)},doFinalize:function(){this.map=null,this.tryApplySuper("doFinalize")},set:function(e,t){this.map.set(e,t)},get:function(e){return this.map.get(e)},getHash:function(e){var t=this.get(e);return t?t.toHash?t.toHash():t:null},remove:function(e){this.map.remove(e)},has:function(e){return this.map.has(e)},clear:function(){this.map.clear()}}),Kekule.ElementSeries={NONMETAL:"Nonmetals",METAL:"Metals",ALKALI_METAL:"Alkali Metals",ALKALI_EARTH_METAL:"Alkali Earth Metals",TRANSITION_METAL:"Transition Metals",METALLOID:"Metalloids",HALOGEN:"Halogens",NOBLE_GAS:"Noble Gases",LANTHANIDE:"Lanthanides",ACTINIDE:"Actinides"},Kekule.ElementCategory={NONMETAL:1,METAL:21,ALKALI_METAL:22,ALKALI_EARTH_METAL:23,TRANSITION_METAL:24,METALLOID:11,HALOGEN:3,NOBLE_GAS:2,LANTHANIDE:25,ACTINIDE:26},Kekule.Element=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Element",initialize:function(e){if(this.tryApplySuper("initialize"),e!=Kekule.Element.UNSET_ELEMENT){var t=this.getElementInfo(e);t?(this.setPropStoreFieldValue("symbol",t.symbol),this.setPropStoreFieldValue("atomicNumber",t.atomicNumber),this.setPropStoreFieldValue("group",t.group),this.setPropStoreFieldValue("period",t.period),this.setPropStoreFieldValue("series",t.chemicalSerie),this.setPropStoreFieldValue("naturalMass",t.naturalMass),this.setPropStoreFieldValue("categories",this._getElementCategoriesFromSeries(t.chemicalSerie)),t.name&&this.setPropStoreFieldValue("name",t.name)):Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.INVALID_CHEMELEMENT")+": "+e:"Invalid chemical element: "+e)}else this.setPropStoreFieldValue("symbol",Kekule.Element.UNSET_ELEMENT),this.setPropStoreFieldValue("atomicNumber",Kekule.Element.UNSET_ELEMENT)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("atomicNumber",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("symbol",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("group",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("period",{dataType:DataType.INT,serializable:!1,setter:null}),this.defineProp("series",{dataType:DataType.STRING,serializable:!1,setter:null}),this.defineProp("categories",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("naturalMass",{dataType:DataType.FLOAT,serializable:!1,setter:null})},getElementInfo:function(e){return e==Kekule.Element.UNSET_ELEMENT?{symbol:Kekule.Element.UNSET_ELEMENT,atomicNumber:Kekule.Element.UNSET_ELEMENT}:Kekule.Element.isDummyElement(e)?{symbol:Kekule.Element.DUMMY_ELEMENT,atomicNumber:Kekule.Element.DUMMY_ELEMENT_ATOMICNUM}:Kekule.Element.isRGroup(e)?{symbol:Kekule.Element.RGROUP_ELEMENT,atomicNumber:Kekule.Element.RGROUP_ELEMENT_ATMOICNUM}:Kekule.ChemicalElementsDataUtil.getElementInfo(e)},_getElementCategoriesFromSeries:function(e){var t=Kekule.ElementSeries,r=Kekule.ElementCategory,n=[];switch(e){case t.NONMETAL:n=[r.NONMETAL];break;case t.METAL:n=[r.METAL];break;case t.ALKALI_METAL:n=[r.METAL,r.ALKALI_METAL];break;case t.ALKALI_EARTH_METAL:n=[r.METAL,r.ALKALI_EARTH_METAL];break;case t.TRANSITION_METAL:n=[r.METAL,r.TRANSITION_METAL];break;case t.METALLOID:n=[r.METALLOID];break;case t.HALOGEN:n=[r.NONMETAL,r.HALOGEN];break;case t.NOBLE_GAS:n=[r.NONMETAL,r.NOBLE_GAS];break;case t.LANTHANIDE:n=[r.METAL,r.LANTHANIDE];break;case t.ACTINIDE:n=[r.METAL,r.ACTINIDE]}return n},getTheoreticValence:function(){return this.getGroup()?Kekule.Element.getTheoreticValenceOfGroup(this.getGroup()):null},isDummyElement:function(){return this.getAtomicNumber()==Kekule.Element.DUMMY_ELEMENT_ATOMICNUM},isRGroupElement:function(){return this.getAtomicNumber()==Kekule.Element.RGROUP_ELEMENT_ATMOICNUM},isNormalElement:function(){return Kekule.Element.isNormalElement(this.getAtomicNumber())},isSameElement:function(e){return e==Kekule.Element.UNSET_ELEMENT?this.getAtomicNumber()==Kekule.Element.UNSET_ELEMENT:"number"==typeof e?this.getAtomicNumber()==e:this.getSymbol()==e},isHetero:function(){return(this.getSeries()===Kekule.ElementSeries.NONMETAL||this.getSeries()===Kekule.ElementSeries.HALOGEN)&&6!==this.getAtomicNumber()&&1!==this.getAtomicNumber()},belongToCategory:function(e){return(this.getCategories()||[]).indexOf(e)>=0},getLabel:function(){return this.getSymbol()}}),Object.extend(Kekule.Element,Kekule.ChemicalElementsDataUtil),Kekule.Element.UNSET_ELEMENT=void 0,Kekule.Element.DUMMY_ELEMENT="DU",Kekule.Element.DUMMY_ELEMENT_ATOMICNUM=-1,Kekule.Element.RGROUP_ELEMENT="R",Kekule.Element.RGROUP_ELEMENT_ATOMICNUM=-2,Kekule.Element.DEUTERIUM="D",Kekule.Element.isNormalElement=function(e){return e!=Kekule.Element.UNSET_ELEMENT&&!Kekule.Element.isPseudoElement(e)},Kekule.Element.isPseudoElement=function(e){return"string"==typeof e?e==Kekule.Element.DUMMY_ELEMENT||e==Kekule.Element.RGROUP_ELEMENT:e==Kekule.Element.DUMMY_ELEMENT_ATOMICNUM||e==Kekule.Element.RGROUP_ELEMENT_ATMOICNUM},Kekule.Element.isDummyElement=function(e){return e===Kekule.Element.DUMMY_ELEMENT||e===Kekule.Element.DUMMY_ELEMENT_ATOMICNUM},Kekule.Element.isRGroup=function(e){return e===Kekule.Element.RGROUP_ELEMENT||e===Kekule.Element.RGROUP_ELEMENT_ATOMICNUM},Kekule.Element.getTheoreticValenceOfGroup=function(e){return e<=2?e:e<=12?null:e<=17?e-10:0},Kekule.Element.getTheoreticValence=function(e){var t=Kekule.ChemicalElementsDataUtil.getElementInfo(e);return t.group?Kekule.Element.getTheoreticValenceOfGroup(t.group):null},Object.extend(Kekule.Element,{isAtomicNumberAvailable:function(e){return Kekule.ChemicalElementsDataUtil.isAtomicNumberAvailable(e)},isElementSymbolAvailable:function(e){return Kekule.ChemicalElementsDataUtil.isElementSymbolAvailable(e)}}),Kekule.Isotope=Class.create(Kekule.Element,{CLASS_NAME:"Kekule.Isotope",initialize:function(e,t){var r=e,n=t,o=Kekule.IsotopesDataUtil.getIsotopeInfo(e,t);if(o&&(o.atomicNumber&&(r=o.atomicNumber),n=o.massNumber),this.tryApplySuper("initialize",[r]),this.setPropStoreFieldValue("massNumber",n),o&&o.isotopeAlias&&this.setPropStoreFieldValue("isotopeAlias",o.isotopeAlias),Kekule.Element.isNormalElement(r)&&n!==Kekule.Isotope.UNSET_MASSNUMBER){var i=Kekule.IsotopesDataUtil.getIsotopeInfo(this.getAtomicNumber(),n);i?(this.setPropStoreFieldValue("exactMass",i.exactMass),this.setPropStoreFieldValue("naturalAbundance",i.naturalAbundance)):Kekule.chemError((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.INVALID_ISOTOPE"):"Invalid isotope")+": "+this.getSymbol()+"/"+t)}},initProperties:function(){this.defineProp("massNumber",{dataType:DataType.INTEGER,serializable:!1,setter:null}),this.defineProp("exactMass",{dataType:DataType.FLOAT,serializable:!1,setter:null}),this.defineProp("naturalAbundance",{dataType:DataType.FLOAT,serializable:!1,setter:null}),this.defineProp("isotopeAlias",{dataType:DataType.STRING,serializable:!1,setter:null})},isSame:function(e){return e instanceof Kekule.Isotope&&(e===this||e.getAtomicNumber()==this.getAtomicNumber()&&e.getMassNumber()==this.getMassNumber())},getIsotopeId:function(){return Kekule.IsotopesDataUtil.getIsotopeId(this.getAtomicNumber(),this.getMassNumber())},getLabel:function(){return""+(this.getMassNumber()||"")+this.getSymbol()}}),Object.extend(Kekule.Isotope,Kekule.IsotopesDataUtil),Kekule.Isotope.UNSET_MASSNUMBER=void 0,Kekule.Isotope.getIsotopeId=function(e,t){return Kekule.IsotopesDataUtil.getIsotopeId(e,t)},Object.extend(Kekule.Isotope,{isMassNumberAvailable:function(e,t){return Kekule.IsotopesDataUtil.isMassNumberAvailable(e,t)}}),Kekule.IsotopeFactory={GENERIC_ELEMENT_ID:"__GENERIC__",_isotopes:{},getIsotopeId:function(e,t){return e?Kekule.IsotopesDataUtil.getIsotopeId(e,t):Kekule.IsotopeFactory.GENERIC_ELEMENT_ID},getIsotope:function(e,t){var r=Kekule.IsotopeFactory.getIsotopeId(e,t);if(!Kekule.IsotopeFactory._isotopes[r]){var n=new Kekule.Isotope(e,t);Kekule.IsotopeFactory._isotopes[r]=n}return Kekule.IsotopeFactory._isotopes[r]},getIsotopeById:function(e){if(Kekule.IsotopeFactory._isotopes[e])return Kekule.IsotopeFactory._isotopes[e];var t=Kekule.IsotopesDataUtil.getIsotopeIdDetail(e);return t?Kekule.IsotopeFactory.getIsotope(t.symbol,t.massNumber):null}},Kekule.AtomType={UNSET_ATOMTYPE:void 0},Kekule.ElectronSet=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ElectronSet",initialize:function(e){this.tryApplySuper("initialize"),this.setElectronCount(e||Kekule.ElectronSet.UNSET_ELECTRONCOUNT)},initProperties:function(){this.defineProp("electronCount",{dataType:DataType.FLOAT})}}),Kekule.ElectronSet.UNSET_ELECTRONCOUNT=null,Kekule.UnbondedElectronSet=Class.create(Kekule.ElectronSet,{CLASS_NAME:"Kekule.UnBondedElectronSet",initialize:function(e){this.tryApplySuper("initialize",[e])},initProperties:function(){}}),Kekule.BondType={COVALENT:"covalent",IONIC:"ionic",COORDINATE:"coordinate",METALLIC:"metallic",HYDROGEN:"hydrogen",UNKNOWN:null,DEFAULT:"covalent"},Kekule.BondOrder={SINGLE:1,DOUBLE:2,TRIPLE:3,QUAD:4,EXPLICIT_AROMATIC:10,SINGLE_OR_DOUBLE:5,ANY:8,OTHER:20,UNSET:null,DEFAULT:1,getBondValence:function(e){return e===Kekule.BondOrder.UNSET?0:e==Kekule.BondOrder.EXPLICIT_AROMATIC||Kekule.BondOrder.SINGLE_OR_DOUBLE?1.5:e}},Kekule.BondForm=Class.create(Kekule.ElectronSet,{CLASS_NAME:"Kekule.BondForm",initialize:function(e,t,r){this.tryApplySuper("initialize",[t]),this.setBondOrder(e||Kekule.BondOrder.DEFAULT),Kekule.ObjUtils.notUnset(r)&&this.setBondType(r),Kekule.ObjUtils.notUnset(t)&&this.setElectronCount(t)},initProperties:function(){this.defineProp("bondType",{dataType:DataType.STRING,enumSource:Kekule.BondType,getter:function(){var e=this.getPropStoreFieldValue("bondType");return e||Kekule.BondType.DEFAULT}}),this.defineProp("bondOrder",{dataType:DataType.FLOAT,enumSource:Kekule.BondOrder,setter:function(e){this.getPropStoreFieldValue("bondOrder")!=e&&(this.setPropStoreFieldValue("bondOrder",e),e?this.getBondType()==Kekule.BondType.COVALENT&&this.setElectronCount(2*this.getBondValence()):e===Kekule.BondOrder.UNSET&&this.setElectronCount(Kekule.ElectronSet.UNSET_ELECTRONCOUNT))}}),this.defineProp("electronCount",{dataType:DataType.FLOAT}),this.defineProp("bondValence",{dataType:DataType.FLOAT,serializable:!1,getter:function(){return Kekule.BondOrder.getBondValence(this.getBondOrder())},setter:null})}}),Kekule.BondFormFactory={_bondForms:{},getBondFormId:function(e,t,r){var n="";return r&&(n+=r+"_"),e&&(n+=Number(e).toString()),t&&(n+="_"+Number(t).toString()),n},getBondForm:function(e,t,r){if(e||t||r){if(r||(r=Kekule.BondType.DEFAULT),!t&&e&&r===Kekule.BondType.COVALENT)t=2*Kekule.BondOrder.getBondValence(e);var n=Kekule.BondFormFactory.getBondFormId(e,t,r);return Kekule.BondFormFactory._bondForms[n]||(Kekule.BondFormFactory._bondForms[n]=new Kekule.BondForm(e,t,r)),Kekule.BondFormFactory._bondForms[n]}}},Kekule.RadicalOrder={NONE:0,SINGLET:1,DOUBLET:2,TRIPLET:3,DEFAULT:0,getRadicalElectronCount:function(e){var t=Kekule.RadicalOrder;return Kekule.ObjUtils.isUnset(e)||e===t.NONE?0:e===t.DOUBLET?1:2}},Kekule.HybridizationType={UNKNOWN:null,SP:1,SP2:2,SP3:3,NONE:0},Kekule.ValenceUtils={getPossibleMdlValenceInfo:function(e,t){var r=Math.round(t),n=[],o=0,i=!1;switch(e){case 1:case 3:case 11:case 19:case 37:case 55:case 87:0===r?n=[1]:1===r?n=[0]:i=!0,o=1;break;case 4:case 12:case 20:case 38:case 56:case 88:switch(r){case 0:n=[2];break;case 1:n=[1];break;case 2:n=[0];break;default:i=!0}o=2;break;case 5:switch(r){case-4:n=[1];break;case-3:n=[2];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 1:n=[2];break;case 2:n=[1];break;case 3:n=[0];break;default:i=!0}o=3;break;case 6:switch(r){case-4:n=[0];break;case-3:n=[1];break;case-2:n=[2];break;case-1:n=[3,5];break;case 0:n=[4];break;case 1:n=[3];break;case 2:n=[2];break;case 3:n=[1];break;case 4:n=[0];break;default:i=!0}o=4;break;case 7:switch(r){case-3:n=[0];break;case-2:n=[1];break;case-1:n=[2];break;case 0:n=[3,5];break;case 1:n=[4];break;case 2:n=[3];break;case 3:n=[2];break;case 4:n=[1];break;case 5:n=[0];break;default:i=!0}o=5;break;case 8:switch(r){case-2:n=[0];break;case-1:n=[1];break;case 0:n=[2];break;case 1:n=[3,5];break;case 2:n=[4];break;case 3:n=[3];break;case 4:n=[2];break;case 5:n=[1];break;case 6:n=[0];break;default:i=!0}o=6;break;case 9:switch(r){case-1:n=[0];break;case 0:n=[1];break;case 1:n=[2];break;case 2:n=[3,5];break;case 3:n=[4];break;case 4:n=[3];break;case 5:n=[2];break;case 6:n=[1];break;case 7:n=[0];break;default:i=!0}o=7;break;case 13:switch(r){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 1:n=[2];break;case 2:n=[1];break;case 3:n=[0];break;default:i=!0}o=3;break;case 14:switch(r){case-4:n=[0];break;case-3:n=[1,3,5,7];break;case-2:n=[2,4,6];break;case-1:n=[3,5];break;case 0:n=[4];break;case 1:n=[3];break;case 2:n=[2];break;case 3:n=[1];break;case 4:n=[0]}o=4;break;case 15:switch(r){case-3:n=[0];break;case-2:n=[1,3,5,7];break;case-1:n=[2,4,6];break;case 0:n=[3,5];break;case 1:n=[4];break;case 2:n=[3];break;case 3:n=[2];break;case 4:n=[1];break;case 5:n=[0]}o=5;break;case 16:switch(r){case-2:n=[0];break;case-1:n=[1,3,5,7];break;case 0:n=[2,4,6];break;case 1:n=[3,5];break;case 2:n=[4];break;case 3:n=[3];break;case 4:n=[2];break;case 5:n=[1];break;case 6:n=[0]}o=6;break;case 17:switch(r){case-1:n=[0];break;case 0:n=[1,3,5,7];break;case 1:n=[2,4,6];break;case 2:n=[3,5];break;case 3:n=[4];break;case 4:n=[3];break;case 5:n=[2];break;case 6:n=[1];break;case 7:n=[0]}o=7;break;case 31:switch(r){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 2:n=[1];break;case 3:n=[0];break;default:i=!0}o=3;break;case 32:switch(r){case-4:n=[0];break;case-3:n=[1,3,5,7];break;case-2:n=[2,4,6];break;case-1:n=[3,5];break;case 0:n=[4];break;case 1:n=[3];break;case 3:n=[1];break;case 4:n=[0]}o=4;break;case 33:switch(r){case-3:n=[0];break;case-2:n=[1,3,5,7];break;case-1:n=[2,4,6];break;case 0:n=[3,5];break;case 1:n=[4];break;case 2:n=[3];break;case 4:n=[1];break;case 5:n=[0]}o=5;break;case 34:switch(r){case-2:n=[0];break;case-1:n=[1,3,5,7];break;case 0:n=[2,4,6];break;case 1:n=[3,5];break;case 2:n=[4];break;case 3:n=[3];break;case 5:n=[1];break;case 6:n=[0]}o=6;break;case 35:switch(r){case-1:n=[0];break;case 0:n=[1,3,5,7];break;case 1:n=[2,4,6];break;case 2:n=[3,5];break;case 3:n=[4];break;case 4:n=[3];break;case 6:n=[1];break;case 7:n=[0]}o=7;break;case 49:switch(r){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[4];break;case 0:n=[3];break;case 2:n=[1];break;case 3:n=[0];break;default:i=!0}o=3;break;case 50:case 82:switch(r){case-4:n=[0];break;case-3:n=[1,3,5,7];break;case-2:n=[2,4,6];break;case-1:n=[3,5];break;case 0:n=[2,4];break;case 1:n=[3];break;case 3:n=[1];break;case 4:n=[0]}o=4;break;case 51:case 83:switch(r){case-3:n=[0];break;case-2:n=[1,3,5,7];break;case-1:n=[2,4,6];break;case 0:n=[3,5];break;case 1:n=[2,4];break;case 2:n=[3];break;case 4:n=[1];break;case 5:n=[0]}o=5;break;case 52:case 84:switch(r){case-2:n=[0];break;case-1:n=[1,3,5,7];break;case 0:n=[2,4,6];break;case 1:n=[3,5];break;case 2:n=[2,4];break;case 3:n=[3];break;case 5:n=[1];break;case 6:n=[0]}o=6;break;case 53:case 85:switch(r){case-1:n=[0];break;case 0:n=[1,3,5,7];break;case 1:n=[2,4,6];break;case 2:n=[3,5];break;case 3:n=[2,4];break;case 4:n=[3];break;case 6:n=[1];break;case 7:n=[0]}o=7;break;case 81:switch(r){case-4:n=[1,3,5,7];break;case-3:n=[2,4,6];break;case-2:n=[3,5];break;case-1:n=[2,4];break;case 0:n=[1,3];break;case 3:n=[0];break;default:i=!0}o=3}if(i){var a=o-t;(a<0||a>8)&&(n=[])}return{valences:n,valenceElectronCount:o,unexpectedCharge:i}},getMaxPossibleMdlValence:function(e,t){var r=Kekule.ValenceUtils.getPossibleMdlValenceInfo(e,t).valences;return r.length?r[r.length-1]:0},getImplicitMdlValence:function(e,t,r){var n=t,o=r;switch(e){case 1:case 3:case 11:case 19:case 37:case 55:case 87:if(0==n&&o<=1)return 1;break;case 4:case 12:case 20:case 38:case 56:case 88:switch(n){case 0:if(o<=2)return 2;break;case 1:if(o<=1)return 1}break;case 5:switch(n){case-4:if(o<=1)return 1;break;case-3:if(o<=2)return 2;break;case-2:if(o<=3)return 3;if(o<=5)return 5;break;case-1:if(o<=4)return 4;break;case 0:if(o<=3)return 3;break;case 1:if(o<=2)return 2;break;case 2:if(o<=1)return 1}break;case 6:switch(n){case-3:if(o<=1)return 1;break;case-2:if(o<=2)return 2;break;case-1:if(o<=3)return 3;if(o<=5)return 5;break;case 0:if(o<=4)return 4;break;case 1:if(o<=3)return 3;break;case 2:if(o<=2)return 2;break;case 3:if(o<=1)return 1}break;case 7:switch(n){case-2:if(o<=1)return 1;break;case-1:if(o<=2)return 2;break;case 0:if(o<=3)return 3;if(o<=5)return 5;break;case 1:if(o<=4)return 4;break;case 2:if(o<=3)return 3;break;case 3:if(o<=2)return 2;break;case 4:if(o<=1)return 1}break;case 8:switch(n){case-1:if(o<=1)return 1;break;case 0:if(o<=2)return 2;break;case 1:if(o<=3)return 3;if(o<=5)return 5;break;case 2:if(o<=4)return 4;break;case 3:if(o<=3)return 3;break;case 4:if(o<=2)return 2;break;case 5:if(o<=1)return 1}break;case 9:switch(n){case 0:if(o<=1)return 1;break;case 1:if(o<=2)return 2;break;case 2:if(o<=3)return 3;if(o<=5)return 5;break;case 3:if(o<=4)return 4;break;case 4:if(o<=3)return 3;break;case 5:if(o<=2)return 2;break;case 6:if(o<=1)return 1}break;case 13:switch(n){case-4:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case-3:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case-2:if(o<=3)return 3;if(o<=5)return 5;break;case-1:if(o<=4)return 4;break;case 0:if(o<=3)return 3;break;case 1:if(o<=2)return 2;break;case 2:if(o<=1)return 1}break;case 14:switch(n){case-3:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case-2:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case-1:if(o<=3)return 3;if(o<=5)return 5;break;case 0:if(o<=4)return 4;break;case 1:if(o<=3)return 3;break;case 2:if(o<=2)return 2;break;case 3:if(o<=1)return 1}break;case 15:switch(n){case-2:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case-1:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case 0:if(o<=3)return 3;if(o<=5)return 5;break;case 1:if(o<=4)return 4;break;case 2:if(o<=3)return 3;break;case 3:if(o<=2)return 2;break;case 4:if(o<=1)return 1}break;case 16:switch(n){case-1:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case 0:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case 1:if(o<=3)return 3;if(o<=5)return 5;break;case 2:if(o<=4)return 4;break;case 3:if(o<=3)return 3;break;case 4:if(o<=2)return 2;break;case 5:if(o<=1)return 1}break;case 17:switch(n){case 0:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case 1:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case 2:if(o<=3)return 3;if(o<=5)return 5;break;case 3:if(o<=4)return 4;break;case 4:if(o<=3)return 3;break;case 5:if(o<=2)return 2;break;case 6:if(o<=1)return 1}break;case 31:switch(n){case-4:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case-3:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case-2:if(o<=3)return 3;if(o<=5)return 5;break;case-1:if(o<=4)return 4;break;case 0:if(o<=3)return 3;break;case 2:if(o<=1)return 1}break;case 32:switch(n){case-3:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case-2:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case-1:if(o<=3)return 3;if(o<=5)return 5;break;case 0:if(o<=4)return 4;break;case 1:if(o<=3)return 3;break;case 3:if(o<=1)return 1}break;case 33:switch(n){case-2:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case-1:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case 0:if(o<=3)return 3;if(o<=5)return 5;break;case 1:if(o<=4)return 4;break;case 2:if(o<=3)return 3;break;case 4:if(o<=1)return 1}break;case 34:switch(n){case-1:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case 0:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case 1:if(o<=3)return 3;if(o<=5)return 5;break;case 2:if(o<=4)return 4;break;case 3:if(o<=3)return 3;break;case 5:if(o<=1)return 1}break;case 35:switch(n){case 0:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case 1:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case 2:if(o<=3)return 3;if(o<=5)return 5;break;case 3:if(o<=4)return 4;break;case 4:if(o<=3)return 3;break;case 6:if(o<=1)return 1}break;case 49:switch(n){case-4:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case-3:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case-2:if(o<=3)return 3;if(o<=5)return 5;break;case-1:if(o<=2)return 2;if(o<=4)return 4;break;case 0:if(o<=3)return 3;break;case 2:if(o<=1)return 1}break;case 50:case 82:switch(n){case-3:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case-2:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case-1:if(o<=3)return 3;if(o<=5)return 5;break;case 0:if(o<=2)return 2;if(o<=4)return 4;break;case 1:if(o<=3)return 3;break;case 3:if(o<=1)return 1}break;case 51:case 83:switch(n){case-2:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case-1:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case 0:if(o<=3)return 3;if(o<=5)return 5;break;case 1:if(o<=2)return 2;if(o<=4)return 4;break;case 2:if(o<=3)return 3;break;case 4:if(o<=1)return 1}break;case 52:case 84:switch(n){case-1:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case 0:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case 1:if(o<=3)return 3;if(o<=5)return 5;break;case 2:if(o<=2)return 2;if(o<=4)return 4;break;case 3:if(o<=3)return 3;break;case 5:if(o<=1)return 1}break;case 53:case 85:switch(n){case 0:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case 1:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case 2:if(o<=3)return 3;if(o<=5)return 5;break;case 3:if(o<=2)return 2;if(o<=4)return 4;break;case 4:if(o<=3)return 3;break;case 6:if(o<=1)return 1}break;case 81:switch(n){case-4:if(o<=1)return 1;if(o<=3)return 3;if(o<=5)return 5;if(o<=7)return 7;break;case-3:if(o<=2)return 2;if(o<=4)return 4;if(o<=6)return 6;break;case-2:if(o<=3)return 3;if(o<=5)return 5;break;case-1:if(o<=2)return 2;if(o<=4)return 4;break;case 0:if(o<=1)return 1;if(o<=3)return 3}}return o},getImplicitHydValence:function(e,t,r){var n=e,o=t,i=r,a=0;return 6==n?a=4-Math.abs(o):7==n||15==n?a=3+o:8!=n&&16!=n||(a=2+o),a<0&&(a=0),i>a&&(a=i),a}},Kekule.ValenceUtils.getImplicitValence=Kekule.ValenceUtils.getImplicitMdlValence,Kekule.ValenceUtils.getMaxPossibleValence=Kekule.ValenceUtils.getMaxPossibleMdlValence,function(){"use strict";var e=Kekule.ArrayUtils;Kekule.StructureComparationLevel={SKELETAL:1,CONSTITUTION:2,CONFIGURATION:3,EXACT:4,DEFAULT:4},Kekule.globalOptions.add("structure",{defaultBondLength2D:.8,defaultBondLength3D:1.5}),Kekule.globalOptions.add("algorithm.structureComparation",{structureComparationLevel:Kekule.StructureComparationLevel.DEFAULT}),Kekule.globalOptions.add("algorithm.structureClean",{structureCleanOptions:{orphanChemNode:!0,hangingChemConnector:!0}}),Kekule.globalOptions.add("structure.implicitHydrogenEstimationStrategy",{targetElementCategories:{},targetElements:{},targetOrphanAtomElementCategories:{},targetOrphanAtomElements:{}}),Kekule.globalOptions.structure.implicitHydrogenEstimationStrategy.targetOrphanAtomElementCategories[Kekule.ElementCategory.METAL]=!1,Kekule.ObjComparer.compareStructure=function(e,t,r){var n=Object.create(r||{});return n.method=Kekule.ComparisonMethod.CHEM_STRUCTURE,Kekule.ObjComparer.compare(e,t,n)},Kekule.ObjComparer.equalStructure=function(e,t,r){return 0===Kekule.ObjComparer.compareStructure(e,t,r)},Kekule.ObjComparer.getStructureComparisonDetailOptions=function(e){var t=Object.extend({},e);if(e){var r,n=Kekule.StructureComparationLevel,o=e.structureLevel||e.level||Kekule.globalOptions.algorithm.structureComparation.structureComparationLevel,i=["atom","mass","linkedConnectorCount","charge","radical","stereo","hydrogenCount","connectedObjCount","bondType","bondOrder"];o===n.SKELETAL?r={atom:!1,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!1,hydrogenCount:!1,connectedObjCount:!0,bondType:!1,bondOrder:!1}:o===n.CONSTITUTION?r={atom:!0,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!1,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0}:o===n.CONFIGURATION?r={atom:!0,mass:!1,linkedConnectorCount:!0,charge:!1,radical:!1,stereo:!0,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0}:o===n.EXACT&&(r={atom:!0,mass:!0,linkedConnectorCount:!0,charge:!0,radical:!0,stereo:!0,hydrogenCount:!0,connectedObjCount:!0,bondType:!0,bondOrder:!0});for(var a=0,s=i.length;a<s;++a){var l=i[a],u="compare"+l.capitalizeFirst(),c=t[l];Kekule.ObjUtils.isUnset(c)&&(c=t[u]),Kekule.ObjUtils.isUnset(c)?(t[l]=r[l],t[u]=r[l]):(t[l]=c,t[u]=c)}}return t},Kekule.ChemStructureObject=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemStructureObject",initialize:function(e){this.setPropStoreFieldValue("autoClearStructureCache",!0),this.tryApplySuper("initialize",[e])},doFinalize:function(){this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("linkedConnectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null}),this.defineProp("linkedObjs",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t)for(var n=this.getLinkedConnectorAt(t).getConnectedObjs(),o=0,i=n.length;o<i;++o){var a=n[o];a===this||this.hasChildObj&&this.hasChildObj(a)||Kekule.ArrayUtils.pushUnique(e,n[o])}return e}}),this.defineProp("linkedSiblings",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=this.getParent(),r=0,n=this.getLinkedConnectorCount();r<n;++r)for(var o=this.getLinkedConnectorAt(r).getConnectedObjs(),i=0,a=o.length;i<a;++i){var s=o[i];s!==this&&e.indexOf(s)<0&&(s.getParent()!==t&&(s=t.getDirectChildOfNestedNode(s)),s&&e.push(s))}return e}}),this.defineProp("structureCache",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("structureCache");return!t&&e&&(t={},this.setPropStoreFieldValue("structureCache",t)),t}}),this.defineProp("autoClearStructureCache",{dataType:DataType.BOOL,serializable:!1})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("linkedConnectors",[]),this.setSuppressChildChangeEventInUpdating(!0)},getAutoIdPrefix:function(){return"o"},getAcceptCoordStickFrom:function(e){return!1},doGetActualCompareOptions:function(e){if(e&&e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){var t=Kekule.ObjComparer.getStructureComparisonDetailOptions(e);return e.customMethod&&(t.customMethod=e.customMethod),e.extraComparisonProperties&&(t.extraComparisonProperties=e.extraComparisonProperties),t}return this.tryApplySuper("doGetActualCompareOptions",[e])},_getComparisonOptionFlagValue:function(e,t){var r=e["compare"+t.capitalizeFirst()];return Kekule.ObjUtils.isUnset(r)&&(r=e[t]),r},doGetComparisonPropNames:function(e){return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE?[]:this.tryApplySuper("doGetComparisonPropNames",[e])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"linkedConnectorCount")){var n=this.getLinkedNonHydrogenConnectors(),o=e.getLinkedNonHydrogenConnectors&&e.getLinkedNonHydrogenConnectors();r=this.doCompareOnValue(n.length,o&&o.length,t)}return r},compareStructure:function(e,t){var r=Object.create(t||{});return r.method=Kekule.ComparisonMethod.CHEM_STRUCTURE,this.compare(e,r)},equalStructure:function(e,t){return 0===this.compareStructure(e,t)},getParentFragment:function(){var e=this.getParent();return e instanceof Kekule.StructureFragment?e:null},getRootFragment:function(){var e=this.getParentFragment();return e&&e.getRootFragment()||e},getStructureCacheData:function(e){var t=this.getStructureCache();return t&&t[e]},setStructureCacheData:function(e,t){return this.getStructureCache(!0)[e]=t,this},clearStructureCache:function(){return this.setPropStoreFieldValue("structureCache",null),this},needAutoClearStructureCache:function(){var e=this.getParent();return this.getAutoClearStructureCache()&&(!e||!e.needAutoClearStructureCache||e.needAutoClearStructureCache())},notifyLinkedConnectorsChanged:function(){this.notifyPropSet("linkedConnectors",this.getPropStoreFieldValue("linkedConnectors"))},getCurrConnectableObj:function(){return this},getActualConnectedObjToConnector:function(e){return this},getLinkedConnectorCount:function(){return this.getLinkedConnectors().length},getLinkedConnectorAt:function(e){return this.getLinkedConnectors()[e]},indexOfLinkedConnector:function(e){return this.getLinkedConnectors().indexOf(e)},appendLinkedConnector:function(e){var t=this._doAppendLinkedConnector(e);return e&&e._doAppendConnectedObj(this),t},_doAppendLinkedConnector:function(e){if(!e)return-1;var t=this.getPropStoreFieldValue("linkedConnectors"),r=Kekule.ArrayUtils.pushUniqueEx(t,e);return r.isPushed&&this.notifyLinkedConnectorsChanged(),r.index},insertLinkedConnectorAt:function(e,t){t||(t=0);var r=this.indexOfLinkedConnector(e),n=this.getLinkedConnectors();r>=0?(n.splice(r,1),n.splice(t,0,e),this.notifyLinkedConnectorsChanged()):(n.splice(t,0,e),e&&e._doAppendConnectedObj(this),this.notifyLinkedConnectorsChanged())},insertLinkedConnectorBefore:function(e,t){var r=t?this.indexOfLinkedConnector(t):-1;return r<0?this.appendLinkedConnector(e):this.insertLinkedConnectorAt(e,r)},removeLinkedConnectorAt:function(e){var t=this.getLinkedConnectorAt(e);return t&&t._doRemoveConnectedObjAt(t.indexOfConnectedObj(this)),this._doRemoveLinkedConnectorAt(e)},_doRemoveLinkedConnectorAt:function(e){var t=Kekule.ArrayUtils.removeAt(this.getLinkedConnectors(),e);return t&&this.notifyLinkedConnectorsChanged(),t},removeLinkedConnector:function(e){var t=this.getLinkedConnectors().indexOf(e);t>=0&&this.removeLinkedConnectorAt(t)},getConnectorTo:function(e){for(var t=0,r=this.getLinkedConnectorCount();t<r;++t){var n=this.getLinkedConnectorAt(t);if(n.hasConnectedObj(e))return n}return null},removeThisFromLinkedConnector:function(){for(var e=this.getLinkedConnectorCount()-1;e>=0;--e){this.getLinkedConnectorAt(e).removeConnectedObj(this)}},getLinkedObjsOnConnector:function(e){for(var t=[],r=e.getConnectedObjs(),n=0,o=r.length;n<o;++n)r[n]!==this&&Kekule.ArrayUtils.pushUnique(t,r[n]);return t},filterConnector:function(e){for(var t=[],r=0,n=this.getLinkedConnectorCount();r<n;++r){var o=this.getLinkedConnectorAt(r);e(o)&&Kekule.ArrayUtils.pushUnique(t,o)}return t},getLinkedNonHydrogenConnectors:function(){var e=this;return this.filterConnector(function(t){var r=e.getLinkedObjsOnConnector(t);return r.length>1||!(r[0].isHydrogenAtom&&r[0].isHydrogenAtom())})},getLinkedHydrogenConnectors:function(){var e=this;return this.filterConnector(function(t){var r=e.getLinkedObjsOnConnector(t);return 1===r.length&&r[0].isHydrogenAtom&&r[0].isHydrogenAtom()})},getLinkedNonHydrogenObjs:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t)for(var n=this.getLinkedConnectorAt(t).getConnectedObjs(),o=0,i=n.length;o<i;++o)n[o]===this||n[o].isHydrogenAtom&&n[o].isHydrogenAtom()||Kekule.ArrayUtils.pushUnique(e,n[o]);return e},getLinkedHydrogenAtoms:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var n=this.getLinkedConnectorAt(t);if(n instanceof Kekule.Bond)for(var o=n.getConnectedObjs(),i=0,a=o.length;i<a;++i)o[i]!==this&&o[i].isHydrogenAtom&&o[i].isHydrogenAtom()&&Kekule.ArrayUtils.pushUnique(e,o[i])}return e},getLinkedHydrogenAtomsWithSingleBond:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var n=this.getLinkedConnectorAt(t);if(n instanceof Kekule.Bond&&n.isSingleBond()){var o=n.getConnectedObjs();if(2===o.length)for(var i=0,a=o.length;i<a;++i)o[i]!==this&&o[i].isHydrogenAtom&&o[i].isHydrogenAtom()&&Kekule.ArrayUtils.pushUnique(e,o[i])}}return e},getLinkedHydrogenAtomsWithSingleBondCount:function(e){var t=this.getLinkedHydrogenAtomsWithSingleBond().length||0;e&&(t+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0);return t},getPathesToDest:function(e){return this._doGetPathesToDest(e,[])},_doGetPathesToDest:function(t,r){if(t===this)return[];for(var n,o=[],i=e.clone(r),a=0,s=this.getLinkedConnectorCount();a<s;++a){var l=this.getLinkedConnectorAt(a);if(!(i.indexOf(l)>=0)){i.push(l);for(var u=l.getConnectedObjs(),c=0,d=u.length;c<d;++c){var h=u[c];if(h===t)n=[[]];else{if(h===this)continue;n=h&&h._doGetPathesToDest&&h._doGetPathesToDest(t,i)}if(n){for(var f={connector:l,object:h},m=0,g=n.length;m<g;++m)n[m].unshift(f);o=o.concat(n)}}}}return o.length||(o=null),o},getStructureRelatedPropNames:function(){return["linkedConnectors"]},structureChange:function(e){this.needAutoClearStructureCache()&&(this.clearStructureFlags(),this.clearStructureCache()),this.invokeEvent("structureChange",{origin:e||this})},clearStructureFlags:function(){},relayEvent:function(e,t){"structureChange"===e?this.structureChange(t.origin):this.tryApplySuper("relayEvent",[e,t])},doObjectChange:function(e){Kekule.ArrayUtils.intersect(e||[],this.getStructureRelatedPropNames()).length&&this.structureChange()}}),Kekule.SimpleStructureNode=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.SimpleStructureNode",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){this.defineProp("zIndex2D",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["coord2D","coord3D"])},getAutoIdPrefix:function(){return"n"},getContainerBox:function(e,t){var r=this.getAbsCoordOfMode(e,t);return Kekule.BoxUtils.createBox(r,r)},getContainerBox2D:function(e){return this.getContainerBox(Kekule.CoordMode.COORD2D,e)},getContainerBox3D:function(e){return this.getContainerBox(Kekule.CoordMode.COORD3D,e)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.SimpleStructureNode),Kekule.BaseStructureNode=Class.create(Kekule.SimpleStructureNode,{CLASS_NAME:"Kekule.BaseStructureNode",initProperties:function(){this.defineProp("coordStickTarget",{dataType:"Kekule.ChemStructureObject",objRef:!0,autoUpdate:!0,getter:function(){return this.getPropStoreFieldValue("coordStickTarget")},setter:function(e){if(e){if(!this.getAllowCoordStickTo(e))return void Kekule.chemError(Kekule.$L("ErrorMsg.COORD_STICK_NOT_ALLOWED_ON_CLASS"));var t=this.getOwner(),r=e.getOwner&&e.getOwner();if(r&&t!==r)return void Kekule.chemError(Kekule.$L("ErrorMsg.UNABLE_TO_STICK_TO_OTHER_OWNER_OBJ"));if(!e.getAcceptCoordStickFrom&&!e.getAcceptCoordStickFrom(this))return void Kekule.chemError(Kekule.$L("ErrorMsg.INVALID_STICK_TARGET_OBJ"));if(!e.getAbsCoordOfMode)return void Kekule.chemError(Kekule.$L("ErrorMsg.UNABLE_TO_STICK_TO_OBJ_WITHOUT_ABS_COORD"));if(e.getCoordStickTarget&&e.getCoordStickTarget()===this)return void Kekule.chemError(Kekule.$L("ErrorMsg.STICK_RECURSION_NOT_ALLOWED"))}var n=this.getCoordStickTarget();this.setPropStoreFieldValue("coordStickTarget",e),this._coordStickTargetChanged(n,e)}})},getAllowCoordStickTo:function(e){return!1},notifyCoordStickTargetChanged:function(e,t){},_getParentAbsCoord:function(e,t){var r=this.getCoordParent();return r&&r.getAbsCoordOfMode&&r.getAbsCoordOfMode(e,t)},_coordStickTargetChanged:function(e,t){e&&!t?this._copyAbsCoordFromStickedTarget(e,this.getCoordParent()):t&&this._copyAbsCoordFromStickedTarget(t,this.getCoordParent()),e&&e.detachCoordStickNodes&&e.detachCoordStickNodes(this),t&&t.attachCoordStickNodes&&t.attachCoordStickNodes(this),this.notifyCoordStickTargetChanged(e,t)},_copyAbsCoordFromStickedTarget:function(e,t,r){var n=Kekule.CoordUtils,o=Kekule.CoordMode;t||(t=this.getCoordParent());var i=r&&r!==o.COORD2D?null:e.getAbsCoord2D(),a=r&&r!==o.COORD2D?null:e.getAbsCoord3D();if(t){if(i){var s=t.getAbsCoord2D&&t.getAbsCoord2D();s&&(i=n.substract(i,s))}if(a){var l=t.getAbsCoord3D&&t.getAbsCoord3D();l&&(a=n.substract(a,l))}}i&&this.setPropStoreFieldValue("coord2D",i),a&&this.setPropStoreFieldValue("coord3D",a)},doGetCoord2D:function(e,t){var r=this.getCoordStickTarget();if(r&&r.getAbsCoord2D){var n=r.getAbsCoord2D(e,t),o=this._getParentAbsCoord(Kekule.CoordMode.COORD2D,e);return o&&(n=Kekule.CoordUtils.substract(n,o)),n}return this.tryApplySuper("doGetCoord2D",[e,t])},doGetCoord3D:function(e,t){var r=this.getCoordStickTarget();if(r&&r.getAbsCoord3D){var n=r.getAbsCoord3D(e,t),o=this._getParentAbsCoord(Kekule.CoordMode.COORD3D,e);return o&&(n=Kekule.CoordUtils.substract(n,o)),n}return this.tryApplySuper("doGetCoord3D",[e,t])},isOrphan:function(){var e=this.getParent();return!e||e.getChildCount()<=1}}),Kekule.StereoParity={NONE:null,ODD:1,EVEN:2,UNKNOWN:0},Kekule.ChemStructureNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.ChemStructureNode",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}}),this.defineProp("radical",{dataType:DataType.INT}),this.defineProp("parity",{dataType:DataType.INT}),this.defineProp("isAnchor",{dataType:DataType.BOOL,serializable:!1,getter:function(){var e=this.getParent();return!(!e||!e.indexOfAnchorNode)&&e.indexOfAnchorNode(this)>=0},setter:function(e){if(e!==this.getIsAnchor()){var t=this.getParent();t&&(e&&t.appendAnchorNode()?t.appendAnchorNode(this):!e&&t.removeAnchorNode&&t.removeAnchorNode(this))}}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["charge","radical"])},getLabel:function(){return null},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof Kekule.ChemStructureNode)},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(e,"charge")&&t.push("charge"),this._getComparisonOptionFlagValue(e,"radical")&&t.push("radical")),t},doCompareProperty:function(e,t,r){if(r.method!==Kekule.ComparisonMethod.CHEM_STRUCTURE||"charge"!==t&&"radical"!==t)return this.tryApplySuper("doCompareProperty",[e,t,r]);var n=e.getPropValue&&e.getPropValue(t)||0;return(this.getPropValue(t)||0)-n},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"stereo")){var n=this.getParity()||Kekule.StereoParity.UNKNOWN,o=e.getParity&&e.getParity()||Kekule.StereoParity.UNKNOWN;r=this.doCompareOnValue(n,o,t)}return r},getPrimaryIsotope:function(){return null},getLinkedChemNodes:function(e){for(var t=this.getLinkedObjs(),r=[],n=0,o=t.length;n<o;++n){var i=t[n];!(i instanceof Kekule.ChemStructureNode)||e&&i.isHydrogenAtom&&i.isHydrogenAtom()||r.push(i)}return r},getLinkedBonds:function(e){for(var t=[],r=0,n=this.getLinkedConnectorCount();r<n;++r){var o=this.getLinkedConnectorAt(r);o instanceof Kekule.Bond&&(!e||o.getBondType()===e)&&t.push(o)}return t},getLinkedMultiCenterBonds:function(){for(var e=[],t=0,r=this.getLinkedConnectorCount();t<r;++t){var n=this.getLinkedConnectorAt(t);n instanceof Kekule.Bond&&n.getConnectedObjCount()>2&&e.push(n)}return e},getLinkedMultipleBonds:function(){for(var e=Kekule.BondOrder,t=[],r=0,n=this.getLinkedConnectorCount();r<n;++r){var o=this.getLinkedConnectorAt(r);if(o instanceof Kekule.Bond&&o.getBondType()===Kekule.BondType.COVALENT)switch(o.getBondOrder()){case e.SINGLE:case e.DOUBLE:case e.TRIPLE:case e.EXPLICIT_AROMATIC:case e.SINGLE_OR_DOUBLE:case e.SINGLE_OR_AROMATIC:case e.DOUBLE_AROMATIC:case e.ANY:t.push(o)}}return t},getLinkedDoubleBonds:function(){for(var e=Kekule.BondOrder,t=[],r=0,n=this.getLinkedConnectorCount();r<n;++r){var o=this.getLinkedConnectorAt(r);if(o instanceof Kekule.Bond&&o.getBondType()===Kekule.BondType.COVALENT)o.getBondOrder()===e.DOUBLE&&t.push(o)}return t},clearStructureFlags:function(){this.setPropStoreFieldValue("parity",Kekule.StereoParity.NONE)},isHydrogenAtom:function(){return!1},_getBondsValenceInfo:function(e){for(var t=0,r=0,n=this.getStructureCacheData("piElectronCount")||null,o=0,i=e.length;o<i;++o){var a,s=e[o];if(s instanceof Kekule.Bond)t+=a=s.getBondType()==Kekule.BondType.COVALENT&&s.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC&&n>=2?1:s.getBondValence(),a>r&&(r=a)}return{valenceSum:t,maxValence:r}},_getCurrCovalentBondsInfo:function(){return this._getBondsValenceInfo(this.filterConnector(function(e){return e instanceof Kekule.Bond&&e.getBondType()==Kekule.BondType.COVALENT}))},_getCurrIonicBondsInfo:function(e){return this._getBondsValenceInfo(this.filterConnector(function(e){return e instanceof Kekule.Bond&&e.getBondType()==Kekule.BondType.IONIC}))}}),Kekule.RadicalType=Kekule.RadicalOrder,Kekule.AbstractAtom=Class.create(Kekule.ChemStructureNode,{CLASS_NAME:"Kekule.AbstractAtom",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},initProperties:function(){this.defineProp("explicitHydrogenCount",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=parseFloat(e),r=isNaN(t)||t<0?void 0:t;this.setPropStoreFieldValue("explicitHydrogenCount",r)}})},getAutoIdPrefix:function(){return"a"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["explicitHydrogenCount"])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"hydrogenCount")){var n=this.getHydrogenCount(!0),o=e.getHydrogenCount&&e.getHydrogenCount(!0);r=this.doCompareOnValue(n,o,t)}return r},getHydrogenCount:function(e){var t=this.getExplicitHydrogenCount()||0;return e&&(t+=this.getLinkedHydrogenAtomsWithSingleBondCount(!1)),t+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0},setHydrogenCount:function(e){return this.setExplicitHydrogenCount(e)},hasExplicitHydrogens:function(){return Kekule.ObjUtils.notUnset(this.getExplicitHydrogenCount())},isSaturated:function(){return!this.getLinkedMultipleBonds().length},mayContainElement:function(e){var t;return t="string"==typeof e?Kekule.ChemicalElementsDataUtil.getAtomicNumber(e):e,this.doMayContainElement(t)},doMayContainElement:function(e){return!1}}),Kekule.Atom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.Atom",initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e,n,o]),(t||r)&&this.changeIsotope(t,r)},initProperties:function(){this.defineProp("isotope",{dataType:"Kekule.Isotope",serializable:!1}),this.defineProp("isotopeId",{dataType:DataType.STRING,serializable:!0,getter:function(){var e=this.getIsotope();return e?e.getIsotopeId():Kekule.Element.UNSET_ELEMENT},setter:function(e){var t=Kekule.IsotopeFactory.getIsotopeById(e);t&&this.setIsotope(t)}}),this.defineProp("symbol",{dataType:DataType.STRING,serializable:!1,getter:function(){var e=this.getIsotope();return e?e.getSymbol():Kekule.Element.UNSET_ELEMENT},setter:function(e){this.changeElement(e)}}),this.defineProp("atomicNumber",{dataType:DataType.INTEGER,serializable:!1,getter:function(){var e=this.getIsotope();return e?e.getAtomicNumber():0},setter:function(e){this.changeElement(e)}}),this.defineProp("massNumber",{dataType:DataType.INTEGER,getter:function(){var e=this.getIsotope();return e?e.getMassNumber():Kekule.Isotope.UNSET_MASSNUMBER},setter:function(e){this.changeMassNumber(e)}}),this.defineProp("isotopeAlias",{dataType:DataType.STRING,getter:function(){var e=this.getIsotope();return e?e.getIsotopeAlias():void 0},setter:function(e){this.changeElement(e)}}),this.defineProp("atomType",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("atomTypeId",{dataType:DataType.STRING,getter:function(){var e=this.getPropStoreFieldValue("atomType");return e?e.id:Kekule.AtomType.UNSET_ATOMTYPE},setter:function(e){if(this.isNormalAtom()){var t=Kekule.AtomTypeDataUtil.getAtomTypeFromId(this.getAtomicNumber(),e);this.setAtomType(t)}}}),this.defineProp("hybridizationType",{dataType:DataType.INT,enumSource:Kekule.HybridizationType}),this.defineProp("disableImplicitHydrogenEstimation",{dataType:DataType.BOOL})},getAutoIdPrefix:function(){return"a"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["isotope","atomType"])},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(e,"mass")&&t.unshift("massNumber"),this._getComparisonOptionFlagValue(e,"atom")&&t.unshift("atomicNumber")),t},getPrimaryIsotope:function(){return this.getIsotope()},getLabel:function(){return""+(this.getMassNumber()||"")+this.getSymbol()},doMayContainElement:function(e){return this.getAtomicNumber()===e},changeIsotope:function(e,t){e===Kekule.Element.UNSET_ELEMENT?t=Kekule.Isotope.UNSET_MASSNUMBER:e||(e=this.getAtomicNumber()),t||(t=Kekule.Isotope.UNSET_MASSNUMBER),this.getAtomicNumber()!==e&&this.setAtomType(Kekule.AtomType.UNSET_ATOMTYPE);var r=Kekule.IsotopeFactory.getIsotope(e,t);this.setIsotope(r)},changeElement:function(e){return this.changeIsotope(e,Kekule.Isotope.UNSET_MASSNUMBER)},changeMassNumber:function(e){return this.changeIsotope(null,e)},isElement:function(e){return this.getSymbol()===e||this.getAtomicNumber()===e},getElementSeries:function(){var e=this.getIsotope();return e&&e.getSeries()},isNormalAtom:function(){var e=this.getIsotope();return!!e&&e.isNormalElement()},isHydrogenAtom:function(){return this.isElement(1)&&(!this.getMassNumber()||this.getMassNumber()<=1)},guessAtomType:function(){if(this.isNormalAtom()){var e=null,t=null,r=this._getCurrCovalentBondsInfo(),n=Kekule.AtomTypeDataUtil.getAllAtomTypes(this.getAtomicNumber());if(n){for(var o=0,i=n.length;o<i;++o){var a=n[o];if(t=a,a.bondOrderSum>=r.valenceSum&&(e=a,a.maxBondOrder>=r.maxValence))return a}return e||t}}return null},getProximalAtomType:function(){return this.getAtomType()||this.guessAtomType()},getImplicitValence:function(){if(this.isNormalAtom()){var e=this._getCurrCovalentBondsInfo().valenceSum,t=Math.round(this.getCharge()||0);return Kekule.ValenceUtils.getImplicitValence(this.getAtomicNumber(),t,e)}return 0},getExplicitValence:function(e){var t=e||{};if(this.isNormalAtom()){var r=this._getCurrCovalentBondsInfo().valenceSum;if(t.ignoreBondHydrogens)r-=(this.getLinkedHydrogenAtomsWithSingleBond()||[]).length;else r+=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0;if(t.ignoreExplicitHydrogens);else r+=this.getExplicitHydrogenCount()||0;return r}return 0},getValence:function(e){var t=e||{};if(this.isNormalAtom()){var r,n=this.getExplicitValence(t);if(this.hasExplicitHydrogens())r=n;else{var o=t.ignoreCharge?0:Math.round(this.getCharge()||0);r=Kekule.ValenceUtils.getImplicitValence(this.getAtomicNumber(),o,n)}return r}return 0},getImplicitHydrogenCount:function(e){if(this.isNormalAtom()&&this._needToEsitmateImplicityHydrogens()){var t=this._getCurrCovalentBondsInfo(),r=this._getCurrIonicBondsInfo(),n=Math.round(this.getCharge()||0),o=Kekule.RadicalOrder.getRadicalElectronCount(this.getRadical()),i=this.getStructureCacheData("omittedBondHydrogenAtomCount")||0;return Kekule.ChemStructureUtils.getImplicitHydrogenCount(this.getAtomicNumber()||0,{coValenceBondValenceSum:(t.valenceSum||0)+i,otherBondValenceSum:r.valenceSum||0,charge:n,radicalECount:o})}return 0},_needToEsitmateImplicityHydrogens:function(){var e=!this.getDisableImplicitHydrogenEstimation();if(e){var t=this.isOrphan(),r=this.getSymbol(),n=Kekule.globalOptions.get("structure.implicitHydrogenEstimationStrategy")||{};if((n.targetElements&&!1===n.targetElements[r]||t&&n.targetOrphanAtomElements&&!1===n.targetOrphanAtomElements[r])&&(e=!1),e)for(var o=n.targetElementCategories,i=n.targetOrphanAtomElementCategories,a=this.getIsotope().getCategories(),s=0,l=a.length;s<l;++s){var u=a[s];if(o&&!1===o[u]||t&&i&&!1===i[u]){e=!1;break}}}return e},getHydrogenCount:function(e){var t=this.tryApplySuper("getHydrogenCount",[e]);return Kekule.ObjUtils.isUnset(this.getExplicitHydrogenCount())&&(t+=this.getImplicitHydrogenCount()||0),t},getAtomicMass:function(){var e=null,t=this.getIsotope();return t&&(e=t.getExactMass()||t.getNaturalMass()),e}}),Kekule.PseudoatomType={DUMMY:"dummy",ANY:"any",HETERO:"hetero",CUSTOM:"custom"},Kekule.Pseudoatom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.Pseudoatom",initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e,n,o]),t&&this.setAtomType(t),r&&t==Kekule.PseudoatomType.CUSTOM&&this.setSymbol(r)},initProperties:function(){this.defineProp("atomType",{dataType:DataType.STRING,enumSource:Kekule.PseudoatomType}),this.defineProp("symbol",{dataType:DataType.STRING,getter:function(){var e=this.getAtomType(),t=Kekule.PseudoatomType,r=Kekule.ChemStructureNodeLabels;return e===t.DUMMY?r.DUMMY_ATOM:e===t.ANY?r.ANY_ATOM:e===t.HETERO?r.HETERO_ATOM:this.getPropStoreFieldValue("symbol")||r.CUSTOM_ATOM},setter:function(e){var t=Kekule.PseudoatomType,r=Kekule.ChemStructureNodeLabels;if(e){var n=e===r.DUMMY_ATOM?t.DUMMY:e===r.ANY_ATOM?t.ANY:e===r.HETERO_ATOM?t.HETERO:t.CUSTOM;this.setAtomType(n)}this.setPropStoreFieldValue("symbol",e)}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["atomType","symbol"])},getPrimaryIsotope:function(){return null},getLabel:function(){return this.getSymbol()},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(e,"atom")&&t.push("atomType"),t},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"atom")&&this.getAtomType()===Kekule.PseudoatomType.CUSTOM){var n=this.getSymbol(),o=e.getSymbol&&e.getSymbol();r=this.doCompareOnValue(n,o,t)}return r},doMayContainElement:function(e){var t=Kekule.PseudoatomType,r=this.getAtomType();return r===t.ANY||r===t.HETERO&&(!([1,6].indexOf(e)>=0)&&"Nonmetals"===Kekule.ChemicalElementsDataUtil.getElementInfo(e).chemicalSerie)}}),Kekule.VariableAtom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.VariableAtom",initProperties:function(){this.defineProp("allowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(e){var t=this.getPropStoreFieldValue("allowedIsotopeIds");return!t&&e&&(t=[],this.setPropStoreFieldValue("allowedIsotopeIds",t)),t}}),this.defineProp("disallowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(e){var t=this.getPropStoreFieldValue("disallowedIsotopeIds");return!t&&e&&(t=[],this.setPropStoreFieldValue("disallowedIsotopeIds",t)),t}}),this.defineProp("allowedIsotopes",{dataType:DataType.ARRAY,setter:null,getter:function(){return this._getIsotopesFromIds(this.getAllowedIsotopeIds())}}),this.defineProp("disallowedIsotopes",{dataType:DataType.ARRAY,setter:null,getter:function(){return this._getIsotopesFromIds(this.getDisallowedIsotopeIds())}})},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["allowedIsotopeIds","disallowedIsotopeIds"])},getPrimaryIsotope:function(){if(this.isDisallowedList())return null;var e=this.getAllowedIsotopeIds(),t=e?e[0]:null;return t?Kekule.IsotopeFactory.getIsotopeById(t):null},getLabel:function(){return Kekule.ChemStructureNodeLabels.VARIABLE_ATOM},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"atom")){var n=Kekule.ArrayUtils,o=this.getAllowedIsotopeIds(),i=e.getAllowedIsotopeIds&&e.getAllowedIsotopeIds();if(o)o=n.clone(o).sort(),i&&i.length&&(i=n.clone(i).sort()),r=this.doCompareOnValue(o,i,t);else if(i)r=1;else{var a=this.getDisallowedIsotopeIds(),s=e.getDisallowedIsotopeIds&&e.getDisallowedIsotopeIds();a&&a.length&&(a=n.clone(a).sort()),s&&s.length&&(s=n.clone(s).sort()),r=this.doCompareOnValue(a,s,t)}}return r},doMayContainElement:function(e){var t=function(e,t){if(!t)return!1;for(var r=0,n=t.length;r<n;++r){var o=t[r],i=Kekule.IsotopesDataUtil.getIsotopeIdDetail(o).symbol;if(Kekule.ChemicalElementsDataUtil.getAtomicNumber(i)===e)return!0}return!1},r=this.getAllowedIsotopeIds();return r?t(e,r):(r=this.getDisallowedIsotopeIds())?!t(e,r):void 0},isDisallowedList:function(){return this.getDisallowedIsotopeIds()&&!this.getAllowedIsotopeIds()},isListEmpty:function(){var e=this.getAllowedIsotopeIds(),t=!e||!e.length;return t&&(t=!(e=this.getDisallowedIsotopeIds())||!e.length),t},fetchAllowedIsotopeIds:function(){return this.doGetAllowedIsotopeIds(!0)},fetchDisallowedIsotopeIds:function(){return this.doGetDisallowedIsotopeIds(!0)},_getIsotopesFromIds:function(e){if(!e)return null;for(var t=[],r=0,n=e.length;r<n;++r){var o=e[r],i=Kekule.IsotopeFactory.getIsotopeById(o);i&&t.push(i)}return t}}),Kekule.MolecularFormula=Class.create(ObjectEx,{CLASS_NAME:"Kekule.MolecularFormula",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("sections",[]),e&&this.setPropStoreFieldValue("parent",e),this.setBubbleEvent(!0)},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC}),this.defineProp("sections",{dataType:DataType.ARRAY,setter:null}),this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}}),this.defineProp("radical",{dataType:DataType.INT,getter:function(){return this.getPropStoreFieldValue("radical")||0}})},getHigherLevelObj:function(){return this.getParent()},isEmpty:function(){return this.getSectionCount()<=0},notifySectionsChanged:function(){this.notifyPropSet("sections",this.getPropStoreFieldValue("sections"))},createSectionItem:function(e,t,r){var n={obj:e,count:t||1};return r&&e.setCharge(r),e.setParent&&e.setParent(this.getParent()),n},getTotalCharge:function(){for(var e=0,t=this.getSections(),r=0,n=t.length;r<n;++r)t[r].obj.getCharge&&(e+=t[r].obj.getCharge()*(t.count||1));return this.getCharge()&&(e+=this.getCharge()),e},indexOfObj:function(e){for(var t=this.getSections(),r=0,n=t.length;r<n;++r)if(t[r].obj==e)return r;return-1},getSectionCount:function(){return this.getSections().length},getSectionAt:function(e){return this.getSections()[e]},getSectionCharge:function(e){var t,r=0;return(t="object"!=typeof e?this.getSectionAt(e):e).obj.getCharge&&(r+=t.obj.getCharge()||0),r},appendSection:function(e,t,r){var n=this.createSectionItem(e,t,r);return this.getSections().push(n),this.notifySectionsChanged(),n},insertSection:function(e,t,r,n){var o=this.createSectionItem(t,r,n);return this.getSections().splice(e,0,o),this.notifySectionsChanged(),o},removeSectionAt:function(e){var t=this.getSections().splice(e,1);return t&&this.notifySectionsChanged(),t},clear:function(){this.beginUpdate();try{this.setCharge(null),this.setRadical(null),this.setPropStoreFieldValue("sections",[]),this.notifySectionsChanged()}finally{this.endUpdate()}},removeObj:function(e){var t=this.indexOfObj(e);if(!(t>=0))return null;this.removeSectionAt(t);this.notifySectionsChanged()},getMaxNestedLevel:function(){for(var e=0,t=0,r=this.getSectionCount();t<r;++t){var n=this.getSectionAt(t);if(n.obj instanceof Kekule.MolecularFormula){var o=n.obj.getMaxNestedLevel()+1;o>e&&(e=o)}}return e},getSimpleIsotopeMaps:function(){}}),Kekule.StructureConnectionTable=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureConnectionTable",TRAVERS_VISITED_KEY:"__$ctabTraversVisited__",initialize:function(e,t){this.tryApplySuper("initialize"),e&&this.setOwner(e),t&&this.setPropStoreFieldValue("parent",t)},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!=this.getPropStoreFieldValue("owner")&&(this.setPropStoreFieldValue("owner",e),this.ownerChanged(e))}}),this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:function(e){e!=this.getPropStoreFieldValue("parent")&&(this.setPropStoreFieldValue("parent",e),this.parentChanged(e))}}),this.defineProp("nodes",{dataType:DataType.ARRAY}),this.defineProp("anchorNodes",{dataType:DataType.ARRAY,setter:null}),this.defineProp("connectors",{dataType:DataType.ARRAY}),this.defineProp("nonHydrogenNodes",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var n=this.getNodeAt(t);n instanceof Kekule.ChemStructureNode&&(n.isHydrogenAtom&&n.isHydrogenAtom()||e.push(n))}return e}}),this.defineProp("nonHydrogenConnectors",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){for(var e=[],t=0,r=this.getConnectorCount();t<r;++t){var n=this.getConnectorAt(t);n.isNormalConnectorToHydrogen&&n.isNormalConnectorToHydrogen()||e.push(n)}return e}}),this.defineProp("structureCache",{dataType:DataType.HASH,serializable:!1,setter:null,getter:function(e){var t=this.getParent();return t&&t.getStructureCache(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("nodes",[]),this.setPropStoreFieldValue("anchorNodes",[]),this.setPropStoreFieldValue("connectors",[])},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},doSaveProp:function(e,t,r,n,o,i,a,s){var l=t.name;switch(l){case"anchorNodes":for(var u=[],c=0,d=e.getAnchorNodeCount();c<d;++c){var h=e.getAnchorNodeAt(c),f=e.indexOfNode(h);u.push(f)}var m=o.createChildStorageNode(r,o.propNameToStorageName(l),!0);return o.saveObj(u,m,n,i,a,s),!0;case"connectors":for(m=o.createChildStorageNode(r,o.propNameToStorageName(l),!0),c=0,d=e.getConnectorCount();c<d;++c){var g=e.getConnectorAt(c),p=o.getNameForArrayItemStorageNode(g),C=o.appendArrayItemStorageNode(m,o.propNameToStorageName(p),o.isArray(g));o.setStorageNodeExplicitType(C,o.getValueExplicitType(g)),o.saveObj(g,C,n,i,a,s);for(var O=[],k=0,S=g.getConnectedObjCount();k<S;++k){var b=g.getConnectedObjAt(k);if((f=e.indexOfChild(b))>=0)O.push(f);else{var T=e.indexStackOfChild(b);null!=T&&O.push(T)}}if(O.length){var E=o.createChildStorageNode(C,o.propNameToStorageName("connectedObjs"),!0);o.saveObj(O,E,n,i,a,s)}}return!0;default:return!1}},doLoadProp:function(e,t,r,n,o,i,a){var s=t.name;switch(s){case"anchorNodes":var l=[],u=n.getChildStorageNode(r,n.propNameToStorageName(s));return n.loadObj(l,u,o,i,a),e.__load_anchorNodes_indexes=l,!0;case"connectors":u=n.getChildStorageNode(r,n.propNameToStorageName(s));for(var c,d=n.getAllArrayItemStorageNodes(u),h=0,f=d.length;h<f;++h){var m=d[h],g=n.getStorageNodeExplicitType(m)||n.getStorageNodeName(m);if(g){c=DataType.createInstance(g),n.loadObj(c,m,o,i,a);var p=n.getChildStorageNode(m,n.propNameToStorageName("connectedObjs"));if(p){var C=[];n.loadObj(C,p,o,i,a),c.__load_connectedObj_indexes=C}var O=n.getChildStorageNode(m,n.propNameToStorageName("connectedNodes"));if(O){var k=[];n.loadObj(k,O,o,i,a),c.__load_connectedNode_indexes=k}var S=n.getChildStorageNode(m,n.propNameToStorageName("connectedConnectors"));if(S){var b=[];n.loadObj(b,S,o,i,a),c.__load_connectedConnector_indexes=b}e.appendConnector(c)}}return!0;default:return!1}},loaded:function(e){if(this.__load_anchorNodes_indexes){for(var t=0,r=this.__load_anchorNodes_indexes.length;t<r;++t){var n=this.__load_anchorNodes_indexes[t];this.appendAnchorNode(this.getNodeAt(n))}delete this.__load_anchorNodes_indexes}for(t=0,r=this.getConnectorCount();t<r;++t){var o=this.getConnectorAt(t);if(o.__load_connectedObj_indexes){for(var i=0,a=o.__load_connectedObj_indexes.length;i<a;++i){var s;(s="object"==typeof(n=o.__load_connectedObj_indexes[i])?this.getChildAtIndexStack(n):this.getChildAt(n))&&o.appendConnectedObj(s)}delete o.__load_connectedObj_indexes}if(o.__load_connectedNode_indexes){for(i=0,a=o.__load_connectedNode_indexes.length;i<a;++i){"object"==typeof(n=o.__load_connectedNode_indexes[i])?o.appendConnectedObj(this.getNodeAtIndexStack(n)):o.appendConnectedObj(this.getNodeAt(n))}delete o.__load_connectedNode_indexes}if(o.__load_connectedConnector_indexes){for(i=0,a=o.__load_connectedConnector_indexes.length;i<a;++i){n=o.__load_connectedConnector_indexes[i];o.appendConnectedObj(this.getConnectorAt(n))}delete o.__load_connectedConnector_indexes}}this.ownerChanged(this.getOwner()),this.parentChanged(this.getParent()),this.tryApplySuper("loaded",[e])},notifyNodesChanged:function(){this.notifyPropSet("nodes",this.getPropStoreFieldValue("nodes"))},notifyAnchorNodesChanged:function(){this.notifyPropSet("anchorNodes",this.getPropStoreFieldValue("anchorNodes"))},notifyConnectorsChanged:function(){this.notifyPropSet("connectors",this.getPropStoreFieldValue("connectors"))},ownerChanged:function(e){for(var t=0,r=this.getNodeCount();t<r;++t)this.getNodeAt(t).setOwner(e);for(t=0,r=this.getConnectorCount();t<r;++t)this.getConnectorAt(t).setOwner(e)},parentChanged:function(e,t){for(var r=0,n=this.getNodeCount();r<n;++r)this.getNodeAt(r).setParent(e);for(r=0,n=this.getConnectorCount();r<n;++r)this.getConnectorAt(r).setParent(e)},isEmpty:function(){return this.getNodeCount()<=0&&this.getConnectorCount()<=0},getStructureCacheData:function(e){var t=this.getStructureCache();return t&&t[e]},setStructureCacheData:function(e,t){var r=this.getParent();return r&&r.setStructureCacheData&&r.setStructureCacheData(e,t),this},clearStructureCache:function(){var e=this.getParent();return e&&e.clearStructureCache(),this},getNodeById:function(e){for(var t=this.getNodes(),r=0,n=t.length;r<n;++r)if(t[r].getId()==e)return t[r];return null},getConnectorById:function(e){for(var t=this.getConnectors(),r=0,n=t.length;r<n;++r)if(t[r].getId()==e)return t[r];return null},getObjectById:function(e){var t=this.getNodeById(e);return t||this.getConnectorById(e)},getNodeCount:function(){return this.getNodes().length},getNodeAt:function(e){return this.getNodes()[e]},indexOfNode:function(e){return this.getNodes().indexOf(e)},hasNode:function(e,t){var r=this.indexOfNode(e)>=0;if(!r&&t)for(var n=0,o=this.getNodeCount();n<o;++n){var i=this.getNodeAt(n);if(i.hasNode&&(r=i.hasNode(e,!0)),r)break}return r},indexStackOfNode:function(e){var t=this.indexOfNode(e);if(t>=0)return t;for(var r=null,n=0,o=this.getNodeCount();n<o;++n){var i=this.getNodeAt(n);if(i.indexStackOfNode&&(r=i.indexStackOfNode(e),!Kekule.ObjUtils.isUnset(r)))return"object"!=typeof r&&(r=[r]),r.unshift(n),r}return r},getNodeAtIndexStack:function(e){if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getNodeAt(e[0]),r=1,n=e.length;r<n;++r){if(!t||!t.getNodeAt)return null;t=t.getNodeAt(e[r])}return t},insertNodeBefore:function(e,t){var r=this.indexOfNode(t);r?this.insertNodeAt(e,r):this.appendNode(e)},appendNode:function(e){var t=Kekule.ArrayUtils.pushUniqueEx(this.getNodes(),e);return t.isPushed&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent()),this.notifyNodesChanged()),t.index},insertNodeAt:function(e,t){var r=this.indexOfNode(e),n=this.getNodes();return(Kekule.ObjUtils.isUnset(t)||t<0)&&(t=n.length),r>=0?(n.splice(r,1),n.splice(t,0,e)):(n.splice(t,0,e),e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent())),this.notifyNodesChanged(),t},setNodeIndex:function(e,t){var r=this.getNodes(),n=this.indexOfNode(e);n>=0&&(r.splice(n,1),r.splice(t,0,e))},removeNodeAt:function(e,t){var r=this.getNodes()[e];r&&(t||r.removeThisFromLinkedConnector(),this.getNodes().splice(e,1),r.setOwner&&r.setOwner(null),r.setParent&&r.setParent(null),this.notifyNodesChanged())},removeNode:function(e,t){var r=this.getNodes().indexOf(e);r>=0&&this.removeNodeAt(r,t)},replaceNode:function(e,t){if(!this.hasNode(e))return this;this.insertBefore(t,e);var r=this.getAnchorNodes(),n=r.indexOf(e);n>=0&&r.splice(n,1,[t]);for(var o=Kekule.ArrayUtils.clone(e.getLinkedConnectors()),i=0,a=o.length;i<a;++i){(l=o[i]).replaceConnectedObj(e,t)}if(e.getNodes&&e.getCrossConnectors){var s=Kekule.ArrayUtils.clone(e.getCrossConnectors());for(i=0,a=s.length;i<a;++i){var l=s[i];if(this.indexOfConnector(l)>=0)for(var u=0,c=l.getConnectedObjCount();u<c;++u){var d=l.getConnectedObjAt(u);e.indexOfChild(d)>=0&&l.replaceConnectedObj(d,t)}l.replaceConnectedObj(e,t)}}this.removeNode(e)},clearNodes:function(){this.clearAnchorNodes(),this.setPropStoreFieldValue("nodes",[]),this.notifyAnchorNodesChanged(),this.notifyNodesChanged()},sortNodes:function(e){e?(this.getNodes().sort(e),this.notifyNodesChanged()):Kekule.error(Kekule.$L("ErrorMsg.SORT_FUNC_UNSET"))},nodesHasCoord2D:function(e,t){return this.nodesHasCoordOfMode(Kekule.CoordMode.COORD2D,e,t)},nodesHasCoord3D:function(e,t){return this.nodesHasCoordOfMode(Kekule.CoordMode.COORD3D,e,t)},nodesHasCoordOfMode:function(e,t,r){for(var n=Kekule.CoordUtils.isZero,o=0,i=this.getNodes(),a=0,s=i.length;a<s;++a)if(i[a].hasCoordOfMode(e,t)){if(!r)return!0;if(!n(i[a].getCoordOfMode(e,t)))return!0;++o}return!!(r&&o===i.length&&o<=1)},_createAtom:function(e,t,r,n){return new Kekule.Atom(null,e,t,r,n)},appendAtom:function(e,t,r,n){var o=this._createAtom(e,t,r,n);return o&&this.appendNode(o),o},getAnchorNodeCount:function(){return this.getAnchorNodes().length},indexOfAnchorNode:function(e){return this.getAnchorNodes().indexOf(e)},getAnchorNodeAt:function(e){return this.getAnchorNodes()[e]},appendAnchorNode:function(e){if(!e)return-1;if(this.getNodes().indexOf(e)>=0){var t=Kekule.ArrayUtils.pushUniqueEx(this.getAnchorNodes(),e);return t.isPushed&&this.notifyAnchorNodesChanged(),t.index}return-1},removeAnchorNodeAt:function(e){this.getAnchorNodes()[e]&&(this.getAnchorNodes().splice(e,1),this.notifyAnchorNodesChanged())},removeAnchorNode:function(e){var t=this.getAnchorNodes().indexOf(e);t>=0&&this.removeAnchorNodeAt(t)},clearAnchorNodes:function(){this.setPropStoreFieldValue("anchorNodes",[]),this.notifyAnchorNodesChanged()},getConnectorCount:function(){return this.getConnectors().length},indexOfConnector:function(e){return this.getConnectors().indexOf(e)},getConnectorAt:function(e){return this.getConnectors()[e]},indexStackOfConnector:function(e){var t=this.indexOfConnector(e);if(t>=0)return t;for(var r=null,n=0,o=this.getNodeCount();n<o;++n){var i=this.getNodeAt(n);if(i.indexStackOfConnector&&(r=i.indexStackOfConnector(e),!Kekule.ObjUtils.isUnset(r)))return"object"!=typeof r&&(r=[r]),r.unshift(n),r}return r},getConnectorAtIndexStack:function(e){if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;if(1===e.length)return this.getConnectorAt(e[0]);for(var t=e.length-1,r=this.getNodeAt(e[0]),n=1;n<t;++n){if(!r||!r.getNodeAt)return null;r=r.getNodeAt(e[n])}return r?r.getConnectorAt(e[t]):null},insertConnectorBefore:function(e,t){var r=this.indexOfConnector(t);r?this.insertConnectorAt(e,r):this.appendConnector(e)},appendConnector:function(e){var t=Kekule.ArrayUtils.pushUniqueEx(this.getConnectors(),e);return t.isPushed&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent()),this.notifyConnectorsChanged()),t.index},insertConnectorAt:function(e,t){var r=this.indexOfConnector(e),n=this.getConnectors();(Kekule.ObjUtils.isUnset(t)||t<0)&&(t=n.length),r>=0?(n.splice(r,1),n.splice(t,0,e)):(n.splice(t,0,e),e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this.getParent())),this.notifyConnectorsChanged()},setConnectorIndex:function(e,t){var r=this.getConnectors(),n=this.indexOfConnector(e);n>=0&&(r.splice(n,1),r.splice(t,0,e))},removeConnectorAt:function(e,t){var r=this.getConnectors()[e];r&&(t||r.removeThisFromConnectedObjs(),this.getConnectors().splice(e,1),r.setOwner&&r.setOwner(null),r.setParent&&r.setParent(null),this.notifyConnectorsChanged())},removeConnector:function(e,t){var r=this.getConnectors().indexOf(e);r>=0&&this.removeConnectorAt(r,t)},clearConnectors:function(){this.setPropStoreFieldValue("connectors",[]),this.notifyConnectorsChanged()},hasConnector:function(e,t){var r=this.indexOfConnector(e)>=0;if(!r&&t)for(var n=0,o=this.getNodeCount();n<o;++n){var i=this.getNodeAt(n);if(i.hasConnector&&(r=i.hasConnector(e,!0)),r)break}return r},sortConnectors:function(e){e?(this.getConnectors().sort(e),this.notifyConnectorsChanged()):Kekule.error(Kekule.$L("ErrorMsg.SORT_FUNC_UNSET"))},_createBond:function(e,t,r){for(var n=[],o=0,i=e.length;o<i;++o){var a=e[o];DataType.isSimpleValue(a)&&(a=this.getNodeAt(a)),n.push(a)}return new Kekule.Bond(null,n,t,null,r)},appendBond:function(e,t,r){var n=this._createBond(e,t,r);return n&&this.appendConnector(n),n},_getObjsNeedToBeCascadeRemoved:function(e,t){for(var r=[],n=e.getLinkedConnectors?e.getLinkedConnectors():[],o=0,i=n.length;o<i;++o){var a=n[o];(!t||t.indexOf(a)<0)&&a.getConnectedObjs().length<=2&&Kekule.ArrayUtils.pushUnique(r,a)}if(e instanceof Kekule.ChemStructureNode);else if(e instanceof Kekule.ChemStructureConnector){var s=e.getConnectedObjs();for(o=0,i=s.length;o<i;++o){var l=s[o];(!t||t.indexOf(l)<0)&&l instanceof Kekule.ChemStructureNode&&l.getLinkedConnectors().length<=1&&Kekule.ArrayUtils.pushUnique(r,l)}}var u=[].concat(r);u.push(e);var c=[];for(o=0,i=r.length;o<i;++o){if((l=r[o])!==e)var d=this._getObjsNeedToBeCascadeRemoved(l,u);Kekule.ArrayUtils.pushUnique(c,d)}return Kekule.ArrayUtils.pushUnique(r,c),r},removeChildObj:function(e,t,r){var n;t?(n=this._getObjsNeedToBeCascadeRemoved(e),Kekule.ArrayUtils.pushUnique(n,e)):n=[e];for(var o=0,i=n.length;o<i;++o){(a=n[o])instanceof Kekule.BaseStructureConnector?this.removeConnector(a):a instanceof Kekule.BaseStructureNode&&this.removeNode(a)}if(r)for(o=n.length-1;o>=0;--o){var a;(a=n[o]).finalize&&a.finalize()}},removeChild:function(e){return this.removeChildObj(e)||this.tryApplySuper("removeChild",[e])},deleteChildObj:function(e,t){return this.removeChildObj(e,t,!0)},hasChildObj:function(e){return this.hasNode(e)||this.hasConnector(e)},getNextSiblingOfChild:function(e){if(e instanceof Kekule.SimpleStructureNode){if((t=this.indexOfNode(e))>=0)return this.getNodeAt(t+1)}else if(e instanceof Kekule.BaseStructureConnector){var t;if((t=this.indexOfConnector(e))>=0)return this.getConnectorAt(t+1)}return null},insertBefore:function(e,t){if(e instanceof Kekule.SimpleStructureNode){var r=this.indexOfNode(t);return this.insertNodeAt(e,r)}if(e instanceof Kekule.BaseStructureConnector){r=this.indexOfConnector(t);return this.insertConnectorAt(e,r)}return-1},clear:function(){this.clearNodes(),this.clearConnectors()},getChildCount:function(){return this.getNodeCount()+this.getConnectorCount()},getChildAt:function(e){var t=this.getNodeCount();return e<t?this.getNodeAt(e):e<t+this.getConnectorCount()?this.getConnectorAt(e-t):null},indexOfChild:function(e){var t;if(e instanceof Kekule.BaseStructureNode)t=this.indexOfNode(e);else if(e instanceof Kekule.BaseStructureConnector){if((t=this.indexOfConnector(e))>=0)t+=this.getNodeCount()}else t=-1;return t},indexStackOfChild:function(e){var t;if(e instanceof Kekule.BaseStructureNode)t=this.indexStackOfNode(e);else if(e instanceof Kekule.BaseStructureConnector){var r=this.getNodeCount();(t=this.indexStackOfConnector(e)).length?t[t.length-1]+=r:t+=r}else t=-1;return t},getChildAtIndexStack:function(e){if((e=Kekule.ArrayUtils.toArray(e)).length<=0)return null;for(var t=this.getChildAt(e[0]),r=1,n=e.length;r<n;++r){if(!t||!t.getChildAt)return null;t=t.getChildAt(e[r])}return t},isSubFragment:function(e){return e.getNodeCount&&e.getNodeCount()>0},getSubFragments:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var n=this.getNodeAt(t);this.isSubFragment(n)&&e.push(n)}return e},hasSubFragments:function(){var e=this.getSubFragments();return e&&e.length},getLeafNodes:function(){for(var e=[],t=0,r=this.getNodeCount();t<r;++t){var n=this.getNodeAt(t);if(this.isSubFragment(n)){if(n.getLeafNodes){var o=n.getLeafNodes();e=e.concat(o)}}else e.push(n)}return e},findDirectChildOfObj:function(e){for(var t=e;t&&this.indexOfChild(t)<0;)t=t.getParent?t.getParent():null;return t},getAllChildConnectors:function(){for(var e=[].concat(this.getConnectors()),t=this.getSubFragments(),r=0,n=t.length;r<n;++r)t[r].getAllChildConnectors&&(e=e.concat(t[r].getAllChildConnectors()));return e},getAllContainingConnectors:function(){return this.getAllChildConnectors()},getIsotopeMaps:function(){var e=this.getNodes();if(e.length<=0)return[];for(var t=function(e,t,r,n){for(var o=!1,a=0,s=e.length;a<s;++a)t.isSame(e[a].isotope)&&(o=!0,e[a].count+=r,e[a].charge+=n||0);if(!o){var l={isotope:t,count:r,charge:i.getCharge()||0};e.push(l)}return e},r=[],n=0,o=e.length;n<o;++n){var i=e[n];if(i instanceof Kekule.StructureFragment){var a=i.getIsotopeMaps();for(n=0,o=a.length;n<o;++n)r=t(r,a[n].isotope,a[n].count,a[n].charge||0)}else if(i instanceof Kekule.Atom){i.getIsotope();r=t(r,i.getIsotope(),1,i.getCharge()||0);var s=i.getHydrogenCount();if(s>0)r=t(r,Kekule.IsotopeFactory.getIsotope(1),s,0)}}return r},calcFormula:function(){var e=this.getIsotopeMaps();if(e.length<=0)return null;for(var t=new Kekule.MolecularFormula,r=0,n=e.length;r<n;++r){var o=new Kekule.Atom;o.setIsotope(e[r].isotope),t.appendSection(o,e[r].count,e[r].charge)}return t},getNodesContainBox:function(e,t,r){for(var n=t===Kekule.CoordMode.COORD3D,o={},i=0,a=e.length;i<a;++i){var s=e[i].getAbsCoordOfMode(t,r);0==i?(o.x1=o.x2=s.x,o.y1=o.y2=s.y,n&&(o.z1=o.z2=s.z)):(s.x<o.x1?o.x1=s.x:s.x>o.x2&&(o.x2=s.x),s.y<o.y1?o.y1=s.y:s.y>o.y2&&(o.y2=s.y),n&&(s.z<o.z1?o.z1=s.z:s.z>o.z2&&(o.z2=s.z)))}return o},getContainerBox:function(e,t){return this.getNodesContainBox(this.getNodes(),e,t)},getContainerBox2D:function(e){var t=this.getContainerBox(Kekule.CoordMode.COORD2D,e);return t.width=t.x2-t.x1,t.height=t.y2-t.y1,t},getContainerBox3D:function(e){var t=this.getContainerBox(Kekule.CoordMode.COORD3D,e);return t.deltaX=t.x2-t.x1,t.deltaY=t.y2-t.y1,t.deltaZ=t.z2-t.z1,t},traverse:function(t,r,n,o){for(var i={nodes:[],connectors:[]},a=e.clone(o||this.getNodes()),s=0,l=a.length;s<l;++s)a[s][this.TRAVERS_VISITED_KEY]=!1;for(;a.length;){var u;u=r&&a.indexOf(r)>=0?r:a[0];var c=this._doTravers(t,u,n,o);i.nodes=i.nodes.concat(c.nodes),i.connectors=i.connectors.concat(c.connectors),a=e.exclude(a,c.nodes)}return i},_doTravers:function(t,r,n,o){var i={nodes:[],connectors:[]},a=r;a[this.TRAVERS_VISITED_KEY]||(i.nodes.push(a),a[this.TRAVERS_VISITED_KEY]=!0,t&&t(a,!1));var s=e.clone(a.getLinkedConnectors()),l=this.getConnectors();s.sort(function(e,t){return l.indexOf(e)-l.indexOf(t)});for(var u=[],c=0,d=s.length;c<d;++c){var h=s[c],f=a.getLinkedObjsOnConnector(h);o&&(f=e.intersect(f,o));for(var m=0,g=f.length;m<g;++m){var p=f[m];if(p instanceof Kekule.BaseStructureNode)break}if(p&&!p[this.TRAVERS_VISITED_KEY])if(i.nodes.push(p),i.connectors.push(h),p[this.TRAVERS_VISITED_KEY]=!0,t&&(t(h,!0),t(p,!1)),n)u.push(p);else{var C=this._doTravers(t,p,n,o);i.nodes=i.nodes.concat(C.nodes),i.connectors=i.connectors.concat(C.connectors)}}if(n)for(c=0,d=u.length;c<d;++c){var O=u[c];C=this._doTravers(t,O,n,o);i.nodes=i.nodes.concat(C.nodes),i.connectors=i.connectors.concat(C.connectors)}return i}}),Kekule.StructureFragment=Class.create(Kekule.ChemStructureNode,{CLASS_NAME:"Kekule.StructureFragment",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},doFinalize:function(){this.hasFormula()&&this.getFormula().finalize(),this.hasCtab()&&this.getCtab().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("formula",{dataType:"Kekule.MolecularFormula",getter:function(e){return this.getPropStoreFieldValue("formula")||e&&this.createFormula(),this.getPropStoreFieldValue("formula")},setter:function(e){var t=this.getPropStoreFieldValue("formula");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.addEventListener("change",function(e){this.notifyPropSet("formula",this.getFormula())},this)),this.setPropStoreFieldValue("formula",e)}}),this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",getter:function(e){return this.getPropStoreFieldValue("ctab")||e&&this.createCtab(),this.getPropStoreFieldValue("ctab")},setter:function(e){var t=this.getPropStoreFieldValue("ctab");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.setOwner(this.getOwner()),e.addEventListener("propValueSet",function(e){"nodes"!=e.propName&&"anchorNodes"!=e.propName&&"connectors"!=e.propName||this.notifyPropSet(e.propName,e.propValue)},this),e.setEnablePropValueSetEvent(!0)),this.setPropStoreFieldValue("ctab",e)}}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}}),this.defineProp("anchorNodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getAnchorNodes():[]}}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}}),this.defineProp("crossConnectors",{dataType:DataType.ARRAY,serializable:!1,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){for(var e=[].concat(this.getPropStoreFieldValue("linkedConnectors")),t=0,r=this.getNodeCount();t<r;++t)for(var n=this.getNodeAt(t).getLinkedConnectors()||[],o=0,i=n.length;o<i;++o)this.indexOfConnector(n[o])<0&&Kekule.ArrayUtils.pushUnique(e,n[o]);return e}}),this.defineProp("nonHydrogenNodes",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNonHydrogenNodes():[]}}),this.defineProp("nonHydrogenConnectors",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNonHydrogenConnectors():[]}}),this.defineProp("canonicalizationInfo",{dataType:DataType.OBJECT,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getStructureCacheData("canonicalizationInfo")},setter:function(e){this.setStructureCacheData("canonicalizationInfo",e)}}),this.defineProp("aromaticRings",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getStructureCacheData("aromaticRings");return e||(e=[],this.setStructureCacheData("aromaticRings",e)),e},setter:function(e){this.setStructureCacheData("aromaticRings",e)}}),this.defineProp("flattenedShadow",{dataType:"Kekule.StructureFragmentShadow",serializable:!1,scope:Class.PropertyScope.PRIVATE,getter:function(e){var t=null;if(Kekule.ObjUtils.isUnset(e)&&(e=!0),this.getFlattenedShadowOnSelf())return null;if(!(t=this.getPropStoreFieldValue("flattenedShadow"))&&e){var r=(t=new Kekule.StructureFragmentShadow(this)).getShadowFragment();r.unmarshalAllSubFragments(!0),this._copyAdditionalInfoToShadowFragment(r,t.getSourceToShadowMap(),t.getShadowToSourceMap()),this.setPropStoreFieldValue("flattenedShadow",t)}return t}}),this.defineProp("flattenedShadowOnSelf",{dataType:DataType.BOOL,serializable:!1,scope:Class.PropertyScope.PROVATE,setter:null,getter:function(){var e=this.setPropStoreFieldValue("flattenedShadowOnSelf");return Kekule.ObjUtils.isUnset(e)&&(e=!this.hasSubFragments(),this.setPropStoreFieldValue("flattenedShadowOnSelf",e)),e}})},getAutoIdPrefix:function(){return"f"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["ctab","formula","nodes","anchorNodes","connectors"])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){var n=this.hasCtab(),o=e.hasCtab&&e.hasCtab();if(!(r=n?o?0:1:o?-1:0)){var i=this.hasFormula(),a=e.hasFormula&&e.hasFormula();r=i?a?0:1:a?-1:0}if(!r&&this.hasCtab()){if(0===r&&this.getNonHydrogenNodes&&e.getNonHydrogenNodes){var s=function(e,t){var r;e instanceof Kekule.ChemStructureConnector?r=e.getConnectedNonHydrogenObjs():e instanceof Kekule.ChemStructureNode&&(r=e.getLinkedNonHydrogenObjs());for(var n=[],o=0,i=r.length;o<i;++o){var a=r[o],s=t.indexOfNode(a);s>=0&&n.push(s)}return n.sort(),n},l=this.getNonHydrogenNodes(),u=e.getNonHydrogenNodes();if(0===(r=l.length-u.length))for(var c=0,d=l.length;c<d&&0===(r=this.doCompareOnValue(l[c],u[c],t));++c){var h=s(l[c],this),f=s(u[c],e);if(0!==(r=Kekule.ArrayUtils.compare(h,f)))break}}if(0===r&&this.getConnectors&&e.getConnectors){var m=this.getNonHydrogenConnectors(),g=e.getNonHydrogenConnectors();if(0===(r=m.length-g.length))for(c=0,d=m.length;c<d&&0===(r=this.doCompareOnValue(m[c],g[c],t));++c){h=s(m[c],this),f=s(g[c],e);if(0!==(r=Kekule.ArrayUtils.compare(h,f)))break}}if(0===r){var p=this.getNonHydrogenNodes(),C=e.getNonHydrogenNodes(),O=this.traverse(null,p[p.length-1],!0,p),k=e.traverse(null,C[C.length-1],!0,C);for(c=0,d=O.nodes.length;c<d;++c){var S=O.nodes[c],b=k.nodes[c];if(0!==(r=this.doCompareOnValue(S,b,t)))break}if(0===r)for(c=0,d=O.connectors.length;c<d;++c){var T=O.connectors[c],E=k.connectors[c];if(0!==(r=this.doCompareOnValue(T,E,t)))break}}}}return r},structureChange:function(e){this.setPropStoreFieldValue("flattenedShadowOnSelf",null);var t=this.getFlattenedShadow(!1);t&&(t.finalize(),this.setPropStoreFieldValue("flattenedShadow",null)),this.tryApplySuper("structureChange",[e])},clearStructureFlags:function(){this.tryApplySuper("clearStructureFlags");for(var e=0,t=this.getChildCount();e<t;++e){var r=this.getChildAt(e);r.clearStructureFlags&&r.clearStructureFlags()}},ownerChanged:function(e,t){this.hasCtab()&&this.getCtab().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){if(this.hasFormula())this.getFormula()===e&&this.removeFormula();else if(this.hasCtab()){var t=this.getCtab();t===e?this.removeCtab():t.hasChildObj(e)&&t.removeChildObj(e)}this.tryApplySuper("_removeChildObj",[e])},isEmpty:function(){var e;return(e=!this.hasFormula())&&((e=!this.hasCtab())||(e=this.getCtab().isEmpty())),e},isCtabEmpty:function(){return!this.hasCtab()||this.getCtab().isEmpty()},doGetLinkedConnectors:function(){return this.getCrossConnectors()},appendLinkedConnector:function(e){var t=this.getCurrConnectableObj();return t&&t!==this?t.appendLinkedConnector(e):this.tryApplySuper("appendLinkedConnector",[e])},getCurrConnectableObj:function(){var e=this.getAnchorNodeCount()>0?this.getAnchorNodes():this.getNodes();if(e.length<=0)return this;for(var t=this.getCrossConnectors(),r=null,n=null,o=0,i=e.length;o<i;++o){var a=e[o],s=a.getLinkedConnectors(),l=Kekule.ArrayUtils.intersect(s,t).length;(null===r||r>l)&&(r=l,n=a)}return n},getActualConnectedObjToConnector:function(e){if(this.indexOfConnector(e)>=0)return null;if(e.indexOfConnectedObj(this)>=0)return this;for(var t=0,r=e.getConnectedObjCount();t<r;++t){var n=e.getConnectedObjAt(t);if(n.isChildOf(this))return n}return null},createCtab:function(){var e=new Kekule.StructureConnectionTable(this.getOwner(),this);this.setCtab(e)},createFormula:function(){var e=new Kekule.MolecularFormula(this);this.setFormula(e)},hasCtab:function(){return!!this.getPropStoreFieldValue("ctab")},hasFormula:function(){return!!this.getPropStoreFieldValue("formula")},removeFormula:function(){var e=this.getPropStoreFieldValue("formula");return e&&(e.finalize(),e=null,this.setPropStoreFieldValue("formula",null)),this},removeCtab:function(){var e=this.getPropStoreFieldValue("ctab");return e&&(e.finalize(),e=null,this.setPropStoreFieldValue("ctab",null)),this},getContainerBox:function(e,t){return this.hasCtab()?this.getCtab().getContainerBox(e,t):this.tryApplySuper("getContainerBox",[e])},getNodeById:function(e){return this.hasCtab()?this.getCtab().getNodeById(e):null},getConnectorById:function(e){return this.hasCtab()?this.getCtab().getConnectorById(e):null},getObjectById:function(e){var t=this.getNodeById(e);return t||this.getConnectorById(e)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(e){return this.hasCtab()?this.getCtab().getNodeAt(e):null},indexOfNode:function(e){return this.hasCtab()?this.getCtab().indexOfNode(e):-1},hasNode:function(e,t){return this.hasCtab()?this.getCtab().hasNode(e,t):null},indexStackOfNode:function(e){return this.hasCtab()?this.getCtab().indexStackOfNode(e):-1},getNodeAtIndexStack:function(e){return this.hasCtab()?this.getCtab().getNodeAtIndexStack(e):null},getDirectChildOfNestedNode:function(e){var t=e.getParent();if(t){if(t===this)return t;for(var r=e;t&&t.getParent&&t!==this;)r=t,t=t.getParent();return t===this?r:null}return null},insertNodeBefore:function(e,t){return this.doGetCtab(!0).insertNodeBefore(e,t)},appendNode:function(e){return this.doGetCtab(!0).appendNode(e)},insertNodeAt:function(e,t){return this.doGetCtab(!0).insertNodeAt(e,t)},removeNodeAt:function(e,t){return this.hasCtab()?this.getCtab().removeNodeAt(e,t):null},removeNode:function(e,t){return this.hasCtab()?this.getCtab().removeNode(e,t):null},replaceNode:function(e,t){return this.hasCtab()?this.getCtab().replaceNode(e,t):null},clearNodes:function(){if(this.hasCtab())return this.getCtab().clearNodes()},sortNodes:function(e){if(this.hasCtab())return this.getCtab().sortNodes(e)},nodesHasCoord2D:function(e,t){return!!this.hasCtab()&&this.getCtab().nodesHasCoord2D(e,t)},nodesHasCoord3D:function(e,t){return!!this.hasCtab()&&this.getCtab().nodesHasCoord3D(e,t)},nodesHasCoordOfMode:function(e,t,r){return!!this.hasCtab()&&this.getCtab().nodesHasCoordOfMode(e,t,r)},isNodeInAromaticRing:function(e){for(var t=this.getAromaticRings(),r=0,n=t.length;r<n;++r){if(t[r].nodes.indexOf(e)>=0)return!0}return!1},appendAtom:function(e,t,r,n){return this.doGetCtab(!0).appendAtom(e,t,r,n)},getAnchorNodeCount:function(){return this.hasCtab()?this.getCtab().getAnchorNodeCount():0},getAnchorNodeAt:function(e){return this.hasCtab()?this.getCtab().getAnchorNodeAt(e):null},indexOfAnchorNode:function(e){return this.hasCtab()?this.getCtab().indexOfAnchorNode(e):-1},appendAnchorNode:function(e){return this.doGetCtab(!0).appendAnchorNode(e)},removeAnchorNodeAt:function(e){return this.hasCtab()?this.getCtab().removeAnchorNodeAt(e):null},removeAnchorNode:function(e){return this.hasCtab()?this.getCtab().removeAnchorNode(e):null},clearAnchorNodes:function(){if(this.hasCtab())return this.getCtab().clearAnchorNodes()},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(e){return this.hasCtab()?this.getCtab().getConnectorAt(e):null},indexOfConnector:function(e){return this.hasCtab()?this.getCtab().indexOfConnector(e):-1},hasConnector:function(e,t){return this.hasCtab()?this.getCtab().hasConnector(e,t):null},insertConnectorBefore:function(e,t){return this.doGetCtab(!0).insertConnectorBefore(e,t)},appendConnector:function(e){return this.doGetCtab(!0).appendConnector(e)},insertConnectorAt:function(e,t){return this.doGetCtab(!0).insertConnectorAt(e,t)},removeConnectorAt:function(e,t){return this.hasCtab()?this.getCtab().removeConnectorAt(e,t):null},removeConnector:function(e,t){return this.hasCtab()?this.getCtab().removeConnector(e,t):null},clearConnectors:function(){if(this.hasCtab())return this.getCtab().clearConnectors()},sortConnectors:function(e){if(this.hasCtab())return this.getCtab().sortConnectors(e)},isConnectorInAromaticRing:function(e){for(var t=this.getAromaticRings(),r=0,n=t.length;r<n;++r){if(t[r].connectors.indexOf(e)>=0)return!0}return!1},appendBond:function(e,t,r){return this.doGetCtab(!0).appendBond(e,t,r)},_getObjsNeedToBeCascadeRemoved:function(e,t){return this.hasCtab()?this.getCtab()._getObjsNeedToBeCascadeRemoved(e,t):[]},removeChildObj:function(e,t,r){this.hasCtab()&&this.getCtab().removeChildObj(e,t,r)},hasChildObj:function(e){return!!this.hasCtab()&&this.getCtab().hasChildObj(e)},getNextSiblingOfChild:function(e){return this.hasCtab()&&this.getCtab().getNextSiblingOfChild(e)||this.tryApplySuper("getNextSiblingOfChild",[e])},getChildSubgroupNames:function(){return["node","connector"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.SimpleStructureNode?"node":e instanceof Kekule.BaseStructureConnector?"connector":this.tryApplySuper("getBelongChildSubGroupName",[e])},isSubFragment:function(e){return e.getNodeCount&&e.getNodeCount()>0},getSubFragments:function(){return this.hasCtab()?this.getCtab().getSubFragments():[]},hasSubFragments:function(){return!!this.hasCtab()&&this.getCtab().hasSubFragments()},getLeafNodes:function(){return this.hasCtab()?this.getCtab().getLeafNodes():[]},findDirectChildOfObj:function(e){return this.hasCtab()?this.getCtab().findDirectChildOfObj(e):null},getAllChildConnectors:function(){return this.hasCtab()?this.getCtab().getAllChildConnectors():[]},getAllContainingConnectors:function(){return this.hasCtab()?this.getCtab().getAllContainingConnectors():[]},getIsotopeMaps:function(){return this.hasCtab()?this.getCtab().getIsotopeMaps():[]},clear:function(){this.hasCtab()&&this.setCtab(void 0),this.hasFormula()&&this.setFormula(void 0)},clean:function(e){var t=Object.extend({},Kekule.globalOptions.algorithm.structureClean.structureCleanOptions);return t=Object.extend(t,e||{}),this.doClean(t)},doClean:function(e){if(e.hangingChemConnector)for(var t=this.getConnectorCount()-1;t>=0;--t){var r=this.getConnectorAt(t);r instanceof Kekule.ChemStructureConnector&&r.getConnectedObjCount()<2&&this.removeConnectorAt(t)}var n=this.getNodeCount();for(t=n-1;t>=0;--t){var o=this.getNodeAt(t);o instanceof Kekule.ChemStructureNode&&(this.isSubFragment(o)&&o.doClean?o.doClean(e):e.orphanChemNode&&o.getLinkedConnectorCount()<1&&n>1&&this.removeNodeAt(t))}return this},clearExplicitBondHydrogens:function(e,t){var r=this,n=function(e){var t=e.getLinkedConnectors(),r=1===t.length;if(r){var n=t[0];r=n.isSingleBond&&n.isSingleBond()&&n.getStereo&&(!n.getStereo()||n.getStereo()===Kekule.BondStereo.NONE)}return r},o=function(e,t){for(var n=e.getLinkedConnectors(),o=n.length;o>=0;--o){var i=n[o];r.hasConnector(i,!0)&&r.removeConnector(i,!1)}r.removeNodeAt(t,!1)},i=function(e,t,n){for(var o=e.getLinkedConnectors(),i=o.length;i>=0;--i){var a=o[i];if(r.hasConnector(a,!0)){if(n){var s=e.getLinkedObjsOnConnector(a)[0],l=s.getStructureCacheData("omittedBondHydrogenAtomCount")||0;s.setStructureCacheData("omittedBondHydrogenAtomCount",l+1)}r.removeConnector(a,!1)}}r.removeNodeAt(t,!1)};if(e){var a=this.getAutoClearStructureCache();this.setAutoClearStructureCache(!1)}this.beginUpdate();try{for(var s=this.getNodeCount()-1;s>=0;--s){var l=this.getNodeAt(s);l instanceof Kekule.ChemStructureNode&&(this.isSubFragment(l)&&l.clearExplicitBondHydrogens?(l.clearExplicitBondHydrogens(e,t),l.getNodeCount()<=0&&o(l,s)):l.isHydrogenAtom()&&(t||n(l))&&i(l,s,!0))}}finally{this.endUpdate(),e&&this.setAutoClearStructureCache(a)}return this},calcFormula:function(){return this.hasCtab()?this.getCtab().calcFormula():this.hasFormula()?this.getFormula():null},marshalSubFragment:function(e,t){if(this.hasCtab()){this.beginUpdate();try{this.appendNode(t);for(var r=[],n=[],o=[],i=[],a=0,s=e.length;a<s;++a){var l=e[a];if(!(this.indexOfNode(l)<0)){for(var u=!1,c=l.getLinkedConnectors(),d=0,h=c.length;d<h;++d){for(var f=c[d],m=!1,g=f.getConnectedObjs(),p=0,C=g.length;p<C;++p){var O=g[p];O!=l&&e.indexOf(O)<0&&(u=!0,m=!0)}m?Kekule.ArrayUtils.pushUnique(i,f):Kekule.ArrayUtils.pushUnique(o,f)}Kekule.ArrayUtils.pushUnique(r,l),u&&Kekule.ArrayUtils.pushUnique(n,l)}}for(a=o.length-1;a>=0;--a)this.removeConnector(o[a],!0);for(a=r.length-1;a>=0;--a)this.removeNode(r[a],!0);t.beginUpdate();try{for(a=0,s=r.length;a<s;++a)t.appendNode(r[a]);for(a=0,s=n.length;a<s;++a)t.appendAnchorNode(n[a]);for(a=0,s=o.length;a<s;++a)t.appendConnector(o[a])}finally{t.endUpdate()}}finally{this.endUpdate()}return t}return null},unmarshalSubFragment:function(e,t){if(this.hasCtab()){this.beginUpdate();try{e.beginUpdate();try{t&&e.unmarshalAllSubFragments&&e.unmarshalAllSubFragments(t);var r=this.getCtab();Kekule.StructureFragment.moveChildBetweenStructFragment(e,this,e.getNodes(),e.getConnectors(),!0),e.clear(),r.removeNode(e)}finally{e.endUpdate(),e.finalize()}}finally{this.endUpdate()}}},unmarshalAllSubFragments:function(e){var t=this.getSubFragments();if(t)for(var r=0,n=t.length;r<n;++r)this.unmarshalSubFragment(t[r],e)},recalcCoords:function(){if(this.hasCtab()){this.beginUpdate();try{for(var e={},t={},r=this.getAnchorNodeCount(),n=0,o=r;n<o;++n){var i=this.getAnchorNodeAt(n);e=Kekule.CoordUtils.add(e,i.getCoord2D()||{}),t=Kekule.CoordUtils.add(t,i.getCoord3D()||{})}var a=Kekule.ObjUtils.notUnset,s=a(e.x)||a(e.y),l=a(t.x)||a(t.y)||a(t.z);if(s){var u=Kekule.CoordUtils.substract({},e);this.setCoord2D(Kekule.CoordUtils.substract(this.fetchCoord2D(),u))}if(l){var c=Kekule.CoordUtils.substract({},t);this.setCoord3D(Kekule.CoordUtils.substract(this.fetchCoord3D(),c))}for(n=0,o=this.getNodeCount();n<o;++n){i=this.getNodeAt(n);s&&i.setCoord2D(Kekule.CoordUtils.add(i.fetchCoord2D(),u)),l&&i.setCoord3D(Kekule.CoordUtils.add(i.fetchCoord3D(),c))}}finally{this.endUpdate()}}},_copyAdditionalInfoToShadowFragment:function(e,t,r){var n=this.getAromaticRings();if(n&&n.length){for(var o=[],i=0,a=n.length;i<a;++i){for(var s=n[i],l=[],u=[],c=0,d=s.nodes.length;c<d;++c){(h=t.get(s.nodes[c]))&&l.push(h)}for(c=0,d=s.connectors.length;c<d;++c){var h;(h=t.get(s.connectors[c]))&&u.push(h)}var f=Object.extend({},s);f.nodes=l,f.connectors=u,o.push(f)}e.setAromaticRings(o)}},getFlattenedShadowFragment:function(e){if(this.getFlattenedShadowOnSelf())return this;var t=this.getFlattenedShadow(e);return t?t.getShadowFragment():null},getFlatternedShadowShadowObj:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t);return r?r.getShadowObj(e):null},getFlatternedShadowSourceObj:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t);return r?r.getSourceObj(e):null},getFlatternedShadowShadowObjs:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t),n=[];if(r)for(var o=0,i=e.length;o<i;++o)n.push(r.getShadowObj(e[o]));return n},getFlatternedShadowSourceObjs:function(e,t){if(this.getFlattenedShadowOnSelf())return e;var r=this.getFlattenedShadow(t),n=[];if(r)for(var o=0,i=e.length;o<i;++o)n.push(r.getSourceObj(e[o]));return n},createShadow:function(){var e=new Kekule.StructureFragmentShadow(this);return this._copyAdditionalInfoToShadowFragment(e.getShadowFragment(),e.getSourceToShadowMap(),e.getShadowToSourceMap()),e},traverse:function(e,t,r,n){return this.hasCtab()?this.getCtab().traverse(e,t,r,n):null}}),Kekule.StructureFragment.moveChildBetweenStructFragment=function(e,t,r,n,o){var i=Kekule.CoordUtils;e.beginUpdate(),t.beginUpdate();var a=e.getAnchorNodes();try{for(var s=e.getAbsCoord2D(),l=e.getAbsCoord3D(),u=t.getAbsCoord2D(),c=t.getAbsCoord3D(),d=i.substract(s,u),h=i.substract(l,c),f=Kekule.ArrayUtils.clone(r),m=Kekule.ArrayUtils.clone(n),g=0,p=f.length;g<p;++g){var C=f[g];if((T=e.indexOfNode(C))>=0){e.removeNodeAt(T,!0);var O=C.getCoord2D();if(O){var k=i.add(O,d);C.setCoord2D(k)}var S=C.getCoord3D();if(S){var b=i.add(S,h);C.setCoord2D(b)}t.appendNode(C),a.indexOf(C)>=0&&(e.removeAnchorNode(C),o||t.appendAnchorNode(C))}}for(g=0,p=m.length;g<p;++g){var T,E=m[g];(T=e.indexOfConnector(E))>=0&&(e.removeConnectorAt(T,!0),t.appendConnector(E))}}finally{t.endUpdate(),e.endUpdate()}},Kekule.StructureFragmentShadow=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureFragmentShadow",initialize:function(e){if(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("shadowToSourceMap",new Kekule.MapEx),this.setPropStoreFieldValue("sourceToShadowMap",new Kekule.MapEx);var t=this._createShadowFragment(e,this.getSourceToShadowMap(),this.getShadowToSourceMap());this.setPropStoreFieldValue("shadowFragment",t)}else Kekule.error(Kekule.$L("ErrorMsg.SOURCE_FRAGMENT_NOT_SET"))},doFinalize:function(){this.getShadowToSourceMap().finalize(),this.getSourceToShadowMap().finalize(),this.getShadowFragment().finalize(),this.setPropStoreFieldValue("shadowToSourceMap",null),this.setPropStoreFieldValue("sourceToShadowMap",null),this.setPropStoreFieldValue("shadowFragment",null),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("shadowFragment",{dataType:"Kekule.StructureFragment",setter:null}),this.defineProp("sourceToShadowMap",{dataType:"Kekule.MapEx",setter:null}),this.defineProp("shadowToSourceMap",{dataType:"Kekule.MapEx",setter:null})},_createShadowFragment:function(e,t,r){var n=e.clone();return this._mapFragmentChildren(e,n,t,r),n},_mapFragmentChildren:function(e,t,r,n){for(var o=0,i=e.getChildCount();o<i;++o){var a=e.getChildAt(o),s=t.getChildAt(o);r.set(a,s),n.set(s,a),a.getChildCount&&s.getChildCount&&this._mapFragmentChildren(a,s,r,n)}},getShadowObj:function(e){return this.getSourceToShadowMap().get(e)},getSourceObj:function(e){return this.getShadowToSourceMap().get(e)}}),Kekule.SubGroup=Class.create(Kekule.StructureFragment,{CLASS_NAME:"Kekule.SubGroup",initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e,n,o]),this.setPropStoreFieldValue("abbr",t),this.setPropStoreFieldValue("name",r)},initProperties:function(){this.defineProp("abbr",{dataType:DataType.STRING}),this.defineProp("formulaText",{dataType:DataType.STRING}),this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"g"},doPropChanged:function(e,t){return"anchorNodes"==e&&this.recalcCoords(),this.tryApplySuper("doPropChanged",[e,t])},getLabel:function(){return this.getName()||this.getAbbr()||this.getFormulaText()||Kekule.ChemStructureNodeLabels.SUBGROUP}}),Kekule.RGroup=Kekule.SubGroup,Kekule.Molecule=Class.create(Kekule.StructureFragment,{CLASS_NAME:"Kekule.Molecule",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("name",t),r&&this.setCtab(new Kekule.StructureConnectionTable)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"m"}}),Kekule.BaseStructureConnector=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.BaseStructureConnector",initialize:function(e,t){this.tryApplySuper("initialize",[e]),this.setConnectedObjs(t||[])},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLISHED,setter:function(e){var t=this.getPropStoreFieldValue("connectedObjs");t||(this.setPropStoreFieldValue("connectedObjs",[]),t=this.getPropStoreFieldValue("connectedObjs"));for(var r=0,n=t.length;r<n;++r)t[r].removeLinkedConnector(this);if(e){for(r=0,n=e.length;r<n;++r)this.assertConnectedObjLegal(e[r]);for(r=0,n=e.length;r<n;++r){var o=e[r],i=o.getCurrConnectableObj?o.getCurrConnectableObj():o;Kekule.ArrayUtils.pushUnique(t,i)}}else this.setPropStoreFieldValue("connectedObjs",[]);for(r=0,n=(t=this.getPropStoreFieldValue("connectedObjs")).length;r<n;++r)t[r].appendLinkedConnector(this);this.notifyConnectedObjsChanged()}}),this.defineProp("neighboringConnectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=this.getConnectedObjs(),r=0,n=t.length;r<n;++r){var o=t[r];o.getLinkedConnectors&&Kekule.ArrayUtils.pushUnique(e,o.getLinkedConnectors()||[])}return Kekule.ArrayUtils.remove(e,this),e}})},getAutoIdPrefix:function(){return"c"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["connectedObjs"])},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"connectedObjCount")){var n=this.getConnectedObjCount(),o=e.getConnectedObjCount&&e.getConnectedObjCount();r=this.doCompareOnValue(n,o,t)}return r},notifyConnectedObjsChanged:function(){this.notifyPropSet("connectedObjs",this.getPropStoreFieldValue("connectedObjs"))},assertConnectedObjLegal:function(e){if(e&&e.getOwner)return!e.getOwner()||e.getOwner()==this.getOwner()||(Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.UNABLE_ADD_DIFF_OWNER_OBJ"):"Object with different owner can not be linked to connector"),!1);Kekule.chemError(Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.UNABLE_ADD_MISTYPED_NODE"):"Unable to link mistyped node to connector")},connectedObjAdded:function(e){this.notifyConnectedObjsChanged()},getConnectedObjCount:function(){return this.getConnectedObjs().length},indexOfConnectedObj:function(e){return this.getConnectedObjs().indexOf(e)},getConnectedObjAt:function(e){return this.getConnectedObjs()[e]},setConnectedObjAt:function(e,t){this.assertConnectedObjLegal(t);var r=this.getConnectedObjs()[e];r&&r.removeLinkedConnector(this),this.insertConnectedObjAt(t,e),this.connectedObjAdded(t)},appendConnectedObj:function(e){this.assertConnectedObjLegal(e);var t=e.getCurrConnectableObj?e.getCurrConnectableObj():e,r=this._doAppendConnectedObj(t);return t&&t.appendLinkedConnector(this),r},_doAppendConnectedObj:function(e){var t=Kekule.ArrayUtils.pushUniqueEx(this.getConnectedObjs(),e);return t.isPushed&&this.connectedObjAdded(e),t.index},insertConnectedObjBefore:function(e,t){this.assertConnectedObjLegal(e);var r=t?t.getCurrConnectableObj?t.getCurrConnectableObj():t:null,n=r?this.indexOfConnectedObj(r):-1;return n<0?this.appendConnectedObj(e):this.insertConnectedObjAt(e,n)},insertConnectedObjAt:function(e,t){t||(t=0),this.assertConnectedObjLegal(e);var r=e.getCurrConnectableObj?e.getCurrConnectableObj():e,n=this.indexOfConnectedObj(r),o=this.getConnectedObjs();n>=0?(o.splice(n,1),o.splice(t,0,r),this.notifyConnectedObjsChanged()):(o.splice(t,0,r),r&&r.appendLinkedConnector(this),this.connectedObjAdded(r))},removeConnectedObjAt:function(e){var t=this.getConnectedObjs()[e];t&&(this._doRemoveConnectedObjAt(e),t._doRemoveLinkedConnectorAt(t.indexOfLinkedConnector(this)),this.notifyConnectedObjsChanged())},_doRemoveConnectedObjAt:function(e){this.getConnectedObjs().splice(e,1)},removeConnectedObj:function(e){var t=this.getConnectedObjs().indexOf(e);t>=0&&this.removeConnectedObjAt(t)},replaceConnectedObj:function(e,t){var r=this.indexOfConnectedObj(e);r>=0&&this.setConnectedObjAt(r,t)},clearConnectedObjs:function(){this.setConnectedObjs([])},hasConnectedObj:function(e){return this.getConnectedObjs().indexOf(e)>=0},isConnectingWithObj:function(e){return this.hasConnectedObj(e)},sortConnectedObjs:function(e){this.getConnectedObjs().sort(e)},reverseConnectedObjOrder:function(){this.setPropStoreFieldValue("connectedObjs",Kekule.ArrayUtils.reverse(this.getConnectedObjs())),this.notifyConnectedObjsChanged()},removeThisFromConnectedObjs:function(){for(var e=this.getConnectedObjCount()-1;e>=0;--e){this.getConnectedObjAt(e).removeLinkedConnector(this)}},getConnectedSiblings:function(){for(var e=this.getConnectedObjs(),t=[],r=this.getParent(),n=function(e){if(e.getParent){var t=e.getParent();return t===r?t:n(t)}return e},o=0,i=e.length;o<i;++o){var a=e[o];if(a.getParent&&a.getParent()!==r){var s=n(a);s&&t.push(s)}else t.push(a)}return t},isConnectingConnector:function(){for(var e=0,t=this.getConnectedObjCount();e<t;++e){if(this.getConnectedObjAt(e)instanceof Kekule.ChemStructureConnector)return!0}return!1}}),Kekule.ChemStructureConnector=Class.create(Kekule.BaseStructureConnector,{CLASS_NAME:"Kekule.ChemStructureConnector",initProperties:function(){this.defineProp("parity",{dataType:DataType.INT}),this.defineProp("connectedChemNodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=[],t=0,r=this.getConnectedObjCount();t<r;++t){var n=this.getConnectedObjAt(t);n instanceof Kekule.ChemStructureNode&&e.push(n)}return e}})},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof Kekule.ChemStructureNode||e instanceof Kekule.BaseStructureConnector)},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(t,"stereo")){var n=this.getParity()||Kekule.StereoParity.UNKNOWN,o=e.getParity&&e.getParity()||Kekule.StereoParity.UNKNOWN;r=this.doCompareOnValue(n,o,t)}return r},clearStructureFlags:function(){this.setParity(Kekule.StereoParity.NONE)},getConnectedChemNodeCount:function(){return this.getConnectedChemNodes().length},getConnectedNonHydrogenObjs:function(){for(var e=[],t=this.getConnectedObjs(),r=0,n=t.length;r<n;++r){var o=t[r];o.isHydrogenAtom&&o.isHydrogenAtom()||e.push(o)}return e},isNormalConnectorToHydrogen:function(){return this.getConnectedNonHydrogenObjs().length<=1}}),Kekule.BondStereo={NONE:0,UP:1,UP_INVERTED:2,DOWN:3,DOWN_INVERTED:4,UP_OR_DOWN:8,UP_OR_DOWN_INVERTED:9,CLOSER:10,E_OR_Z:20,E:21,Z:22,E_Z_BY_COORDINATES:23,CIS_OR_TRANS:30,CIS:31,TRANS:32,getInvertedDirection:function(e){var t=Kekule.BondStereo;switch(e){case t.UP:return t.UP_INVERTED;case t.UP_INVERTED:return t.UP;case t.DOWN:return t.DOWN_INVERTED;case t.DOWN_INVERTED:return t.DOWN;case t.UP_OR_DOWN:return t.UP_OR_DOWN_INVERTED;default:return e}}},Kekule.Bond=Class.create(Kekule.ChemStructureConnector,{CLASS_NAME:"Kekule.Bond",initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e,t||[]]),(r||n||o)&&this.setBondForm(Kekule.BondFormFactory.getBondForm(r,n,o))},initProperties:function(){this.defineProp("bondForm",{dataType:"Kekule.BondForm",serializable:!1,scope:Class.PropertyScope.PUBLIC}),this.defineProp("bondType",{dataType:DataType.STRING,enumSource:Kekule.BondType,getter:function(){var e=this.getBondForm();return e?e.getBondType():Kekule.BondType.DEFAULT},setter:function(e){this.changeBondForm(this.getBondOrder(),Kekule.ElectronSet.UNSET_ELECTRONCOUNT,e)}}),this.defineProp("bondOrder",{dataType:DataType.INT,enumSource:Kekule.BondOrder,getter:function(){var e=this.getBondForm();return e?e.getBondOrder():Kekule.BondOrder.UNSET},setter:function(e){this.changeBondForm(e,Kekule.ElectronSet.UNSET_ELECTRONCOUNT,this.getBondType())}}),this.defineProp("bondValence",{dataType:DataType.INT,serializable:!1,getter:function(){var e=this.getBondForm();return e?e.getBondValence():0},setter:null}),this.defineProp("electronCount",{dataType:DataType.FLOAT,getter:function(){if(this.isAromatic())return 3;var e=this.getBondForm();return e?e.getElectronCount():Kekule.ElectronSet.UNSET_ELECTRONCOUNT},setter:function(e){var t=this.getBondOrder();this.changeBondForm(t,e,this.getBondType())}}),this.defineProp("stereo",{dataType:DataType.INT,enumSource:Kekule.BondStereo,defaultValue:Kekule.BondStereo.NONE}),this.defineProp("isInAromaticRing",{dataType:DataType.BOOL,setter:null,getter:function(){var e=this.getParent();return!(!e||!e.isConnectorInAromaticRing)&&e.isConnectorInAromaticRing(this)}}),this.defineProp("neighboringBonds",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){for(var e=this.getNeighboringConnectors()||[],t=[],r=0,n=e.length;r<n;++r)e[r]instanceof Kekule.Bond&&t.push(e[r]);return t}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setPropStoreFieldValue("stereo",Kekule.BondStereo.NONE)},getAutoIdPrefix:function(){return"b"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["bondForm","stereo"])},clearStructureFlags:function(){this.setPropStoreFieldValue("isInAromaticRing",null)},doGetParity:function(){return this.isDoubleBond()?this.tryApplySuper("doGetParity"):null},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&this._getComparisonOptionFlagValue(e,"bondType")&&t.push("bondType"),t},doCompare:function(e,t){var r=this.tryApplySuper("doCompare",[e,t]);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE){if(this._getComparisonOptionFlagValue(t,"connectedObjCount")){var n=this.getConnectedObjCount(),o=e.getConnectedObjCount&&e.getConnectedObjCount();r=this.doCompareOnValue(n,o,t)}if(!r&&this._getComparisonOptionFlagValue(t,"bondOrder")){var i=Math.round(this.getElectronCount()),a=Math.round(e.getElectronCount());r=this.doCompareOnValue(i,a,t)}}return r},changeBondForm:function(e,t,r){this.setBondForm(Kekule.BondFormFactory.getBondForm(e,t,r))},canInvertBondDirection:function(){var e=Kekule.BondType,t=this.getBondType();return[e.COVALENT,e.IONIC,e.METALLIC,e.HYDROGEN,e.UNKNOWN].indexOf(t)>=0},invertBondDirection:function(){this.setStereo(Kekule.BondStereo.getInvertedDirection(this.getStereo()))},reverseConnectedObjOrder:function(){this.canInvertBondDirection()&&(this.tryApplySuper("reverseConnectedObjOrder"),this.invertBondDirection())},normalizeDirection:function(){var e=Kekule.BondStereo,t=[e.UP_INVERTED,e.DOWN_INVERTED,e.UP_OR_DOWN_INVERTED],r=this.getBondStereo();t.indexOf(r)>=0&&this.reverseConnectedObjOrder()},isCovalentBond:function(){return this.getBondType()===Kekule.BondType.COVALENT},isSingleBond:function(){return this.getBondType()===Kekule.BondType.COVALENT&&this.getBondOrder()===Kekule.BondOrder.SINGLE&&!this.getIsInAromaticRing()},isDoubleBond:function(){return this.getBondType()===Kekule.BondType.COVALENT&&this.getBondOrder()===Kekule.BondOrder.DOUBLE&&!this.getIsInAromaticRing()},isTripleBond:function(){return this.getBondType()===Kekule.BondType.COVALENT&&this.getBondOrder()===Kekule.BondOrder.TRIPLE},isAromatic:function(){return(!!this.getIsInAromaticRing()||this.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC)&&this.getBondType()===Kekule.BondType.COVALENT},isBondBetween:function(e,t){var r,n,o=this.getConnectedObjs();if(2!==o.length)return!1;for(var i=0,a=o.length;i<a;++i){var s=o[i];if(s instanceof Kekule.Atom&&(s.isElement(e)?r=!0:s.isElement(t)&&(n=!0),r&&n))return!0}return!1}}),Kekule.ChemStructureObjectGroup=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.ChemStructureObject","Kekule.ChemStructureObjectGroup"],initialize:function(e){this.tryApplySuper("initialize",[e]),this.setPropStoreFieldValue("items",[]),this.setPropStoreFieldValue("raiseExceptionOnTypeMismatch",[])},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY}),this.defineProp("raiseExceptionOnTypeMismatch",{dataType:DataType.BOOL,defaultValue:!0,scope:Class.PropertyScope.PUBLIC})},getAutoIdPrefix:function(){return"sg"},getStructureRelatedPropNames:function(){return this.tryApplySuper("getStructureRelatedPropNames").concat(["items"])},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&t.push("items"),t},ownerChanged:function(e,t){for(var r=this.getItems(),n=0,o=r.length;n<o;++n){var i=r[n].obj;i&&i.setOwner&&i.setOwner(e)}this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){var t=this.indexOfObj(e);t<0&&(t=this.indexOfItem(e)),t>=0&&this.removeObjAt(t),this.tryApplySuper("_removeChildObj",[e])},getObjectBaseClasses:function(){return this.getPrototype().ITEM_BASE_CLASSES},ensureItemClass:function(e){var t=this.getObjectBaseClasses();if(t.length>0){for(var r=0,n=t.length;r<n;++r)if(e instanceof ClassEx.findClass(t[r]))return!0;if(this.getRaiseExceptionOnTypeMismatch()){var o=Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH"):"Mismatched group item class";Kekule.raise(o)}return!1}return!0},notifyItemsChanged:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},indexOfItem:function(e){return this.getItems().indexOf(e)},indexOfObj:function(e){for(var t=this.getItems(),r=0,n=t.length;r<n;++r)if(t[r].obj==e)return r;return-1},hasObj:function(e){return this.indexOfObj(e)>=0},setAttributesAt:function(e,t){var r=this.getItems()[e];if(r)for(var n=Kekule.ObjUtils.getOwnedFieldNames(t),o=0,i=n.length;o<i;++o)r[n[o]]=t[n[o]]},getItemCount:function(){return this.getItems().length},getItemAt:function(e){return this.getItems()[e]},appendItem:function(e){return this.getItems().push(e),this},insertItem:function(e,t){return this.insertItemAt(e,t)},insertItemAt:function(e,t){return Kekule.ArrayUtils.insertUniqueEx(this.getItems(),e,t).index},removeItemAt:function(e){this.getItems()[e]&&(this.getItems().splice(e,1),this.notifyItemsChanged())},removeItem:function(e){var t=this.getItems().indexOf(e);t>=0&&this.removeItemAt(t)},getObjAt:function(e){var t=this.getItemAt(e);return t?t.obj:null},insertObj:function(e,t,r){return this.insertObjAt(e,t,r)},insertObjAt:function(e,t,r){if(e)if(this.indexOfObj(e)>=0);else if(this.ensureItemClass(e)){var n={obj:e};this.beginUpdate();try{var o=this.insertItem(n,t);r&&this.setAttributesAt(o,r),this.notifyItemsChanged()}finally{this.endUpdate()}return o}},appendObj:function(e,t){return this.insertObj(e,null,t)},removeObjAt:function(e){this.getItems()[e]&&(this.getItems().splice(e,1),this.notifyItemsChanged())},removeObj:function(e){var t=this.indexOfObj(e);t>=0&&this.removeObjAt(t)},getAllObjs:function(){for(var e=[],t=0,r=this.getItemCount();t<r;++t)e.push(this.getObjAt(t));return e},getChildSubgroupNames:function(){return["item"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return"item"},getNextSiblingOfChild:function(e){var t=this.indexOfItem(e);return t<0&&(t=this.indexOfObj(e)),t>=0?this.getChildAt(t+1):null},appendChild:function(e){return e instanceof Kekule.ChemObject?this.appendObj(e):this.appendItem(e)},insertChild:function(e,t){return e instanceof Kekule.ChemObject?this.insertObj(e,t):this.insertItem(e,t)},insertBefore:function(e,t){var r=this.indexOfItem(t);return r<0&&(r=this.indexOfObj(t)),this.insertChild(e,r)}}),Kekule.StructureFragmentGroup=Class.create(Kekule.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.StructureFragment","Kekule.StructureFragmentGroup"]}),Kekule.MoleculeGroup=Class.create(Kekule.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.MoleculeGroup",ITEM_BASE_CLASSES:["Kekule.Molecule","Kekule.MoleculeGroup"]}),Kekule.CompositeMolecule=Class.create(Kekule.Molecule,{CLASS_NAME:"Kekule.CompositeMolecule",initialize:function(e,t){this.tryApplySuper("initialize",[e,t])},initProperties:function(){this.defineProp("subMolecules",{dataType:"Kekule.MoleculeGroup",getter:function(){return this.getPropStoreFieldValue("subMolecules")||this.setPropStoreFieldValue("subMolecules",new Kekule.MoleculeGroup),this.getPropStoreFieldValue("subMolecules")}})},doGetComparisonPropNames:function(e){var t=this.tryApplySuper("doGetComparisonPropNames",[e]);return e.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&t.push("subMolecules"),t},ownerChanged:function(e,t){var r=this.getPropStoreFieldValue("subMolecules");r&&r.setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},getSubMoleculeCount:function(){var e=this.getPropStoreFieldValue("subMolecules");return e?e.length:0},hasCtab:function(){return!1},hasFormula:function(){return!1},getAllContainingConnectors:function(){for(var e=this.getSubMolecules(),t=[],r=0,n=e.getItemCount();r<n;++r){var o=e.getObjAt(r);if(o.getAllContainingConnectors){var i=o.getAllContainingConnectors();i&&i.length&&(t=t.concat(i))}}return t},getContainerBox:function(e){var t=null,r=this.getPropStoreFieldValue("subMolecules");if(r)for(var n=0,o=r.getItemCount();n<o;++n){var i=r.getObjAt(n).getContainerBox(e);i&&(t=t?Kekule.BoxUtils.getContainerBox(t,i):Kekule.BoxUtils.clone(i))}return t},doGetCtab:function(){return null},doSetCtab:function(){},doGetFormula:function(){return null},doSetFormula:function(){},getChildSubgroupNames:function(){return["subMolecule"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.Molecule?"subMolecule":this.tryApplySuper("getBelongChildSubGroupName",[e])},getNextSiblingOfChild:function(e){return this.getSubMolecules().getNextSiblingOfChild(e)},insertChild:function(e,t){return this.insertChildAt(e,t)}}),Kekule.MoleculeList=Class.create(Kekule.ChemObjList,{CLASS_NAME:"Kekule.MoleculeList",initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.Molecule])}}),Kekule.ChemStructureNodeLabels={ENABLE_ISOTOPE_ALIAS:!0,UNSET_ELEMENT:"?",DUMMY_ATOM:"Du",HETERO_ATOM:"Q",ANY_ATOM:"A",CUSTOM_ATOM:"@",VARIABLE_ATOM:"L",SUBGROUP:"R",ISO_LIST_LEADING_BRACKET:"[",ISO_LIST_TAILING_BRACKET:"]",ISO_LIST_DELIMITER:",",ISO_LIST_DISALLOW_PREFIX:"NOT"},Kekule.ChemStructureNodeFactory={CANDIDATE_CLASSES:[Kekule.SubGroup,Kekule.VariableAtom,Kekule.Pseudoatom],getClassByLabel:function(e,t){void 0===t&&(t=Kekule.Pseudoatom);for(var r,n=Kekule.ChemStructureNodeLabels,o=[[n.SUBGROUP],[n.VARIABLE_ATOM],[n.DUMMY_ATOM,n.HETERO_ATOM,n.ANY_ATOM,n.CUSTOM_ATOM]],i=Kekule.ChemStructureNodeFactory.CANDIDATE_CLASSES,a=0,s=i.length;a<s;++a){var l=i[a];if(o[a].indexOf(e)>=0){r=l;break}}return r||(r=Kekule.IsotopesDataUtil.isIsotopeIdAvailable(e)?Kekule.Atom:t),r},createByLabel:function(e){var t=new(Kekule.ChemStructureNodeFactory.getClassByLabel(e));return t instanceof Kekule.Pseudoatom?t.setSymbol(e):t instanceof Kekule.Atom&&t.setIsotopeId(e),t}}}(),Kekule.ChemStructureBuilder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructureBuilder",initialize:function(e){this.tryApplySuper("initialize"),e&&this.setTarget(e)},initProperties:function(){this.defineProp("target",{dataType:"Kekule.StructureFragment"})},setNodeCoord:function(){for(var e=Array.prototype.slice.call(arguments),t=e.shift(),r=e,n=0,o=r.length;n<o&&n<2;++n){var i=r[n];void 0!==i.z?t.setCoordOfMode(i,Kekule.CoordMode.COORD3D):t.setCoordOfMode(i,Kekule.CoordMode.COORD2D)}},createNode:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=e.shift(),n=e,o=new t(r);return this.setNodeCoord(o,n),this.appendNode(o),o},createConnector:function(e,t,r){var n=new e(t);return n.setConnectedObjs(r),n},appendNode:function(e){return e&&this.getTarget()?this.getTarget().appendNode(e):null},appendConnector:function(e){return e&&this.getTarget()?this.getTarget().appendConnector(e):null},createAtom:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),r=e.shift(),n=e.shift(),o=new Kekule.Atom(t,r,n);return e.unshift(o),this.setNodeCoord.apply(this,e),this.appendNode(o),o},createBond:function(e,t,r,n,o){var i=new Kekule.Bond(e,t,r);return i.changeBondForm(r,null,o),n&&i.setStereo(n),this.appendConnector(i),i},deleteNode:function(){},marshalSubGroup:function(e,t){var r=this.getTarget();if(r&&r.hasCtab()){var n=new Kekule.SubGroup(t);return r.marshalSubFragment(e,n),n}return null}}),Kekule.ReactionComponent={REACTANT:"reactant",PRODUCT:"product",SUBSTANCE:"substance",CONDITION:"condition"},Kekule.ReactionRole={REAGENT:"reagent",CATALYST:"catalyst",SOLVENT:"solvent",TEMPERATURE:"temperature",DURATION:"duration"},Kekule.ReactionDirection={FORWARD:1,BACKWARD:-1,BIDIRECTION:0},Kekule.Reaction=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Reaction",initialize:function(e){this.tryApplySuper("initialize",[e]),this.setDirection(Kekule.ReactionDirection.FORWARD)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING}),this.defineProp("title",{dataType:DataType.STRING}),this.defineProp("reactionType",{dataType:DataType.STRING}),this.defineProp("yield",{dataType:DataType.FLOAT}),this.defineProp("direction",{dataType:DataType.INT,defaultValue:Kekule.ReactionDirection.FORWARD,enumSource:Kekule.ReactionDirection}),this.defineProp("reactants",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("reactants");return!t&&e&&(t=[],this.setPropStoreFieldValue("reactants",t)),t}}),this.defineProp("products",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("products");return!t&&e&&(t=[],this.setPropStoreFieldValue("products",t)),t}}),this.defineProp("substances",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("substances");return!t&&e&&(t=[],this.setPropStoreFieldValue("substances",t)),t}}),this.defineProp("conditions",{dataType:DataType.ARRAY,setter:null,getter:function(e){var t=this.getPropStoreFieldValue("conditions");return!t&&e&&(t=[],this.setPropStoreFieldValue("conditions",t)),t}})},ownerChanged:function(e,t){for(var r=["reactants","products","substances","conditions"],n=0,o=r.length;n<o;++n){var i=r[n],a=this.getComponentArray(i);if(a)for(var s=0,l=a.length;s<l;++s){var u=a[s].item;u.setOwner&&u.setOwner(e)}}this.tryApplySuper("ownerChanged",[e,t])},assertAddingMolecule:function(e){e instanceof Kekule.Molecule||Kekule.chemError(Kekule.$L("ErrorMsg.UNABLE_ADD_NONMOLECULE_MAP"))},notifyReactantsChange:function(){this.notifyPropSet("reactants",this.getPropStoreFieldValue("reactants"))},notifyProductsChange:function(){this.notifyPropSet("products",this.getPropStoreFieldValue("products"))},notifySubstancesChange:function(){this.notifyPropSet("substances",this.getPropStoreFieldValue("substances"))},notifyConditionsChange:function(){this.notifyPropSet("conditions",this.getPropStoreFieldValue("conditions"))},notifyComponentChange:function(e){var t=this.componentToPropName(e);t&&this.notifyPropSet(t,this.getPropStoreFieldValue(t))},componentToPropName:function(e){return e+"s"},getComponentArray:function(e,t){var r=this.componentToPropName(e);if(!r)return null;switch(r){case"reactants":return this.doGetReactants(t);case"products":return this.doGetProducts(t);case"substances":return this.doGetSubstances(t);case"conditions":return this.doGetConditions(t);default:return null}},getComponentItemCount:function(e){var t=this.getComponentArray(e);return t?t.length:0},getMapAt:function(e,t){var r=this.getComponentArray(e);return r?r[t]:null},getMapItemAt:function(e,t){var r=this.getMapAt(e,t);return r?r.item:null},indexOfMap:function(e,t){var r=this.getComponentArray(e);return r?r.indexOf(t):-1},indexOfItem:function(e,t,r){var n=this.getComponentArray(e);if(n)for(var o=0,i=n.length;o<i;++o)if(n[o].item==t){if(void 0===r)return o;if(r===n[o].role)return o}return-1},appendMap:function(e,t){e!=Kekule.ReactionComponent.PRODUCT&&e!=Kekule.ReactionComponent.REACTANT||this.assertAddingMolecule(t.item);var r=Kekule.ArrayUtils.pushUniqueEx(this.getComponentArray(e,!0),t);return r.isPushed&&this.notifyComponentChange(e),r.index},appendItem:function(e,t,r,n){var o=this.indexOfItem(e,t,r);if(o<0){e!=Kekule.ReactionComponent.PRODUCT&&e!=Kekule.ReactionComponent.REACTANT||this.assertAddingMolecule(t);var i=Kekule.RoleMapUtils.createMap(t,r);n&&Object.extend(i,n);var a=Kekule.ArrayUtils.pushUniqueEx(this.getComponentArray(e,!0),i);return this.notifyComponentChange(e),a.index}return o},removeMapAt:function(e,t){var r=null,n=this.getComponentArray(e);return n&&(r=Kekule.ArrayUtils.removeAt(n,t))&&this.notifyComponentChange(e),r},removeMap:function(e,t){var r=null,n=this.getComponentArray(e);return n&&(r=Kekule.ArrayUtils.remove(n,t))&&this.notifyComponentChange(e),r},removeItem:function(e,t,r){var n=this.indexOfItem(e,t,r);return n>=0?this.removeMapAt(e,n):null},clearComponent:function(e){this.getComponentArray(e);this.notifyComponentChange(e)},getReactantCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.REACTANT)},getProductCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.PRODUCT)},getSubstancesCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.SUBSTANCE)},getConditionCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.CONDITION)},getReactantMapAt:function(e){return this.getMapAt(Kekule.ReactionComponent.REACTANT,e)},getProductMapAt:function(e){return this.getMapAt(Kekule.ReactionComponent.PRODUCT,e)},getSubstanceMapAt:function(e){return this.getMapAt(Kekule.ReactionComponent.SUBSTANCE,e)},getConditionMapAt:function(e){return this.getMapAt(Kekule.ReactionComponent.CONDITION,e)},getReactantItemAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.REACTANT,e)},getReactantAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.REACTANT,e)},getProductItemAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.PRODUCT,e)},getProductAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.PRODUCT,e)},getSubstanceItemAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.SUBSTANCE,e)},getSubstanceAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.SUBSTANCE,e)},getConditionItemAt:function(e){return this.getMapItemAt(Kekule.ReactionComponent.CONDITION,e)},indexOfReactantMap:function(e){return this.indexOfMap(Kekule.ReactionComponent.REACTANT,e)},indexOfProductMap:function(e){return this.indexOfMap(Kekule.ReactionComponent.PRODUCT,e)},indexOfSubstanceMap:function(e){return this.indexOfMap(Kekule.ReactionComponent.SUBSTANCE,e)},indexOfConditionMap:function(e){return this.indexOfMap(Kekule.ReactionComponent.CONDITION,e)},indexOfReactant:function(e,t){return this.indexOfItem(Kekule.ReactionComponent.REACTANT,e,t)},indexOfProduct:function(e,t){return this.indexOfItem(Kekule.ReactionComponent.PRODUCT,e,t)},indexOfSubstance:function(e,t){return this.indexOfItem(Kekule.ReactionComponent.SUBSTANCE,e,t)},indexOfCondition:function(e,t){return this.indexOfItem(Kekule.ReactionComponent.CONDITION,e,t)},appendReactantMap:function(e){return this.appendMap(Kekule.ReactionComponent.REACTANT,e)},appendProductMap:function(e){return this.appendMap(Kekule.ReactionComponent.PRODUCT,e)},appendSubstanceMap:function(e){return this.appendMap(Kekule.ReactionComponent.SUBSTANCE,e)},appendConditionMap:function(e){return this.appendMap(Kekule.ReactionComponent.CONDITION,e)},appendReactant:function(e,t,r,n){var o=n||{};return r&&(o.amount=r),this.appendItem(Kekule.ReactionComponent.REACTANT,e,t,o)},appendProduct:function(e,t,r,n){var o=n||{};return r&&(o.amount=r),this.appendItem(Kekule.ReactionComponent.PRODUCT,e,t,o)},appendSubstance:function(e,t,r,n){var o=n||{};return r&&(o.amount=r),this.appendItem(Kekule.ReactionComponent.SUBSTANCE,e,t,o)},appendCondition:function(e,t,r){return this.appendItem(Kekule.ReactionComponent.CONDITION,e,t,r)},removeReactantAt:function(e){return this.removeMapAt(Kekule.ReactionComponent.REACTANT,e)},removeProductAt:function(e){return this.removeMapAt(Kekule.ReactionComponent.PRODUCT,e)},removeSubstanceAt:function(e){return this.removeMapAt(Kekule.ReactionComponent.SUBSTANCE,e)},removeConditionAt:function(e){return this.removeMapAt(Kekule.ReactionComponent.CONDITION,e)},removeReactantMap:function(e){return this.removeMap(Kekule.ReactionComponent.REACTANT,e)},removeProductMap:function(e){return this.removeMap(Kekule.ReactionComponent.PRODUCT,e)},removeSubstanceMap:function(e){return this.removeMap(Kekule.ReactionComponent.SUBSTANCE,e)},removeConditionMap:function(e){return this.removeMap(Kekule.ReactionComponent.CONDITION,e)},removeReactant:function(e,t){return this.removeItem(Kekule.ReactionComponent.REACTANT,e,t)},removeProduct:function(e,t){return this.removeItem(Kekule.ReactionComponent.PRODUCT,e,t)},removeSubstance:function(e,t){return this.removeItem(Kekule.ReactionComponent.SUBSTANCE,e,t)},removeCondition:function(e,t){return this.removeItem(Kekule.ReactionComponent.CONDITION,e,t)},clearReactants:function(){return this.clearComponent(Kekule.ReactionComponent.REACTANT)},clearProducts:function(){return this.clearComponent(Kekule.ReactionComponent.PRODUCT)},clearSubstance:function(){return this.clearComponent(Kekule.ReactionComponent.SUBSTANCE)},clearConditions:function(){return this.clearComponent(Kekule.ReactionComponent.CONDITION)},clearAll:function(){this.clearProducts(),this.clearProducts(),this.clearSubstance(),this.clearConditions()},getAllContainingConnectors:function(){for(var e=Kekule.ReactionComponent,t=[e.REACTANT,e.PRODUCT,e.SUBSTANCE],r=[],n=0,o=t.length;n<o;++n)for(var i=t[n],a=0,s=this.getComponentItemCount(i);a<s;++a){var l=this.getMapItemAt(i,a);if(l.getAllContainingConnectors){var u=l.getAllContainingConnectors();u&&u.length&&(r=r.concat(u))}}return r}}),Kekule.ReactionList=Class.create(Kekule.ChemObjList,{CLASS_NAME:"Kekule.ReactionList",initialize:function(e){this.tryApplySuper("initialize",[e,Kekule.Reaction])}}),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.ChemStructureUtils={getConnectorLengthMedian:function(e,t,r){for(var n=[],o=0,i=e.length;o<i;++o){var a=e[o];if(a&&a.getLength){var s=a.getLength(t,r);s&&n.push(s)}}if(0===i)return 1;if(i<=1)return n[0];n.sort();var l=n.length;return l%2?n[l+1>>1]:(n[l>>1]+n[(l>>1)-1])/2},getChildStructureObjs:function(e,t){var r,n=!0;if(e instanceof Kekule.CompositeMolecule)r=e.getSubMolecules().getAllObjs();else if(e instanceof Kekule.ChemStructureObjectGroup)r=e.getAllObjs();else if(e instanceof Kekule.ChemObjList)r=e.getItems();else if(e instanceof Kekule.ChemSpaceElement)r=e.getChildren().getItems();else{if(!(e instanceof Kekule.ChemSpace))return n=!1,[e];r=e.getChildren()}if(r=[].concat(r),t&&n){for(var o=[],i=0,a=r.length;i<a;++i){var s=r[i],l=Kekule.ChemStructureUtils.getChildStructureObjs(s,t);!l.length||1===l.length&&l[0]===s?Kekule.ArrayUtils.pushUnique(o,s):Kekule.ArrayUtils.pushUnique(o,l)}r=o}return r},getAllStructFragments:function(e,t){if(e instanceof Kekule.StructureFragment)return[e];for(var r=Kekule.ChemStructureUtils.getChildStructureObjs(e,t),n=[],o=0,i=r.length;o<i;++o)r[o]instanceof Kekule.StructureFragment&&Kekule.ArrayUtils.pushUnique(n,r[o]);return n},getTotalStructFragment:function(e,t){var r=Kekule.ChemStructureUtils.getAllStructFragments(e,!0),n=r.length;return n<=0?null:1===n?r[0]:Kekule.ChemStructureUtils.mergeStructFragments(r,t)},getCascadeDeleteObjs:function(e){for(var t=[],r=e.getLinkedConnectors?e.getLinkedConnectors():[],n=0,o=r.length;n<o;++n){var i=r[n];if(i.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(t,i);var a=Kekule.ChemStructureUtils.getCascadeDeleteObjs(i);Kekule.ArrayUtils.pushUnique(t,a)}}if(e instanceof Kekule.ChemStructureNode);else if(e instanceof Kekule.ChemStructureConnector){var s=e.getConnectedObjs();for(n=0,o=s.length;n<o;++n){var l=s[n];l instanceof Kekule.ChemStructureNode&&l.getLinkedConnectors().length<=1&&Kekule.ArrayUtils.pushUnique(t,l)}}return t},moveChildBetweenStructFragment:function(e,t,r,n,o){return Kekule.StructureFragment.moveChildBetweenStructFragment(e,t,r,n,o)},_getCascadeConnectedNodesAndConnectors:function(e,t){for(var r=[],n=[],o=e.getConnectedObjs(),i=0,a=o.length;i<a;++i){var s=o[i];if(s!==e)if(t&&(s=t.findDirectChildOfObj(s)),s instanceof Kekule.ChemStructureNode)Kekule.ArrayUtils.pushUnique(n,s);else if(s instanceof Kekule.ChemStructureConnector){Kekule.ArrayUtils.pushUnique(r,s);var l=Kekule.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(s);Kekule.ArrayUtils.pushUnique(r,l.connectors),Kekule.ArrayUtils.pushUnique(n,l.nodes)}}return{connectors:r,nodes:n}},mergeStructFragments:function(e,t){if(e.length<=1)return e[0];for(var r=new(t||Kekule.Molecule),n=0,o=e.length;n<o;++n){var i=e[n].clone();Kekule.ChemStructureUtils.moveChildBetweenStructFragment(i,r,i.getNodes(),i.getConnectors())}return r},splitStructFragment:function(e){if(!e.hasCtab())return[e];var t=e.getNodes();if(t.length<=0)return[e];var r=e.getConnectors(),n=[],o=[t[0]],i=[],a=0;do{var s=o[a],l=s.getLinkedConnectors();s.getCrossConnectors&&l.concat(s.getCrossConnectors()||[]),Kekule.ArrayUtils.pushUnique(i,l);for(var u=0,c=l.length;u<c;++u){var d=Kekule.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(l[u],e);Kekule.ArrayUtils.pushUnique(i,d.connectors),Kekule.ArrayUtils.pushUnique(o,d.nodes)}++a}while(a<o.length);n.push(e);var h=Kekule.ArrayUtils.exclude(t,o),f=Kekule.ArrayUtils.exclude(r,i);if(h.length>0){var m=new(e.getClass());Kekule.ChemStructureUtils.moveChildBetweenStructFragment(e,m,h,f);var g=Kekule.ChemStructureUtils.splitStructFragment(m);n=n.concat(g)}return n},getAbsCoordVectorBetweenObjs:function(e,t,r,n){var o=e.getAbsCoordOfMode(r,n),i=t.getAbsCoordOfMode(r,n);return Kekule.CoordUtils.substract(i,o)},_getRef2DCoordOfObj:function(e,t){return e.getAbsBaseCoord2D?e.getAbsBaseCoord2D(t):e.getAbsCoord2D?e.getAbsCoord2D(t):e.getCoord2D(t)},_getStandardizedLinkedObj2DRelCoords:function(t,r,n,o,i){var a=[],s=Kekule.ChemStructureUtils._getRef2DCoordOfObj(t,n),l=i?t.getLinkedObjs():t.getLinkedExposedObjs();o&&t.getAttachedMarkers&&(l=l.concat(t.getAttachedMarkers()||[])),r&&r.length&&(l=e.exclude(l,r));for(var u=0,c=l.length;u<c;++u){var d=l[u],h=Kekule.ChemStructureUtils._getRef2DCoordOfObj(d,n),f=Kekule.CoordUtils.substract(h,s);f=Kekule.CoordUtils.standardize(f),a.push(f)}return a},_calcLinkedObj2DAnglesOfObj:function(e,t,r,n,o){for(var i=[],a=Kekule.ChemStructureUtils._getStandardizedLinkedObj2DRelCoords(e,t,r,n,o),s=0,l=a.length;s<l;++s){var u=a[s];if(0!==u.x||0!==u.y){var c=Math.atan2(u.y,u.x);c<0&&(c=2*Math.PI+c),i.push(c)}}return i.sort(),i},_getMostEmptyDirectionOfExistingAngles:function(e){var t=e.length;if(0===t)return 0;if(1===t)return Kekule.GeometryUtils.standardizeAngle(Math.PI+e[0]);for(var r=0,n=0,o=0;o<t;++o){var i=e[o],a=e[(o+1)%t]-i;a<0&&(a+=2*Math.PI),a>r&&(r=a,n=o)}return e[n]+r/2},getMostEmptyDirection2DAngleOfObj:function(e,t,r,n,o,i){var a=Kekule.ChemStructureUtils._calcLinkedObj2DAnglesOfObj(e,t,r,n,o);return i&&(a=a.concat(i)).sort(),Kekule.ChemStructureUtils._getMostEmptyDirectionOfExistingAngles(a)},isSameRing:function(t,r){return t.nodes.length===r.nodes.length&&(t.connectors.length===r.connectors.length&&(!(e.exclude(t.nodes,r.nodes).length>0)&&!(e.exclude(t.connectors,r.connectors).length>0)))},isInRings:function(e,t){for(var r=0,n=t.length;r<n;++r){var o=t[r];if(e===o)return!0;if(Kekule.ChemStructureUtils.isSameRing(e,o))return!0}return!1},getImplicitHydrogenCount:function(e,t){var r=Object.extend({coValenceBondValenceSum:0,otherBondValenceSum:0,charge:0,radicalECount:0},t||{},!0),n=Kekule.ValenceUtils.getImplicitValence(e,r.charge,r.coValenceBondValenceSum),o=(n-=r.radicalECount)-r.coValenceBondValenceSum-r.otherBondValenceSum;return r.allowNegative||(o=Math.max(n-r.coValenceBondValenceSum-r.otherBondValenceSum,0)),o}},Kekule.TokenAnalyzer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TokenAnalyzer",initialize:function(e){this.tryApplySuper("initialize"),this.setSrcText(e)},initProperties:function(){this.defineProp("srcText",{dataType:DataType.STRING,setter:function(e){var t=e||"";this.setPropStoreFieldValue("srcText",t),this.setPropStoreFieldValue("srcLength",t.length),this.setCurrPos(0)}}),this.defineProp("srcLength",{dataType:DataType.INT,setter:null,serializable:!1}),this.defineProp("currPos",{dataType:DataType.INT,serializable:!1})},getCharType:function(e){return 0},isCharTypeMatched:function(e,t){return e===t},nextCharInfo:function(){var e=this.getCurrPos();if(e>=this.getSrcLength())return null;var t=this.getSrcText().charAt(e);return this.setCurrPos(e+1),{char:t,charType:this.getCharType(t)}},nextTokenInfo:function(){var e=this.nextCharInfo();if(e){for(var t=e.char,r=e.charType,n=this.nextCharInfo();n&&this.isCharTypeMatched(n.charType,e.charType);)t+=n.char,e=n,n=this.nextCharInfo();return n&&this.setCurrPos(this.getCurrPos()-1),{token:t,tokenType:r}}return null},getAllTokenInfos:function(){for(var e=[],t=this.nextTokenInfo();t;)e.push(t),t=this.nextTokenInfo();return e}}),Kekule.ChemTextTypes={CT_ATOM_SYMBOL_LEADING:1,CT_ATOM_SYMBOL_FOLLOWING:2,CT_CHARGE_SYMBOL:3,CT_NUMBER:4,CT_BRACKET_LEADING:10,CT_BRACKET_TAILING:11,CT_SEPARATOR:20,CT_UNKNOWN:0};var t=Kekule.ChemTextTypes;Kekule.ChemTextAnalyzer=Class.create(Kekule.TokenAnalyzer,{CLASS_NAME:"Kekule.ChemTextAnalyzer",getCharType:function(e){return" "===e?t.CT_SEPARATOR:e>="0"&&e<="9"?t.CT_NUMBER:["+","-"].indexOf(e)>=0?t.CT_CHARGE_SYMBOL:["(","[","{"].indexOf(e)>=0?t.CT_BRACKET_LEADING:[")","]","}"].indexOf(e)>=0?t.CT_BRACKET_TAILING:e>="A"&&e<="Z"?t.CT_ATOM_SYMBOL_LEADING:e>="a"&&e<="z"?t.CT_ATOM_SYMBOL_FOLLOWING:t.CT_UNKNOWN},isCharTypeMatched:function(e,r){return!Kekule.ArrayUtils.intersect([t.CT_BRACKET_LEADING,t.CT_BRACKET_TAILING],[e,r]).length&&(e===r&&r!==t.CT_ATOM_SYMBOL_LEADING||r===t.CT_ATOM_SYMBOL_LEADING&&e===t.CT_ATOM_SYMBOL_FOLLOWING)}}),Kekule.FormulaUtils={FORMULA_BRACKETS:[["(",")"],["[","]"],["{","}"]],FORMULA_BRACKET_TYPE_COUNT:3,textToFormula:function(e,r,n){var o=n||null;o&&o.clear();var i=new Kekule.ChemTextAnalyzer(e);try{var a=i.getAllTokenInfos();o||(o=new Kekule.MolecularFormula(r));var s=a.length;if(s){var l,u,c=null,d=o;l={};for(var h=function(){l={}},f=function(){l&&l.obj&&d.appendSection(l.obj,l.count,l.charge)},m=0;m<s;++m){var g=a[m],p=g.tokenType,C=g.token,O=!1;if(p===t.CT_BRACKET_LEADING){f();var k=new Kekule.MolecularFormula(r);k._parentFormula=d,d=k,h(),O=!0}else if(p===t.CT_BRACKET_TAILING)f(),h(),l.obj=d,d=d._parentFormula,g.asSymbol=!0,O=!0;else if([t.CT_ATOM_SYMBOL_LEADING,t.CT_ATOM_SYMBOL_FOLLOWING].indexOf(p)>=0){l.obj&&(f(),h());var S=l.massNum;S||c&&!c.handled&&c.tokenType===t.CT_NUMBER&&(S=parseInt(c.token,10)||null);var b=""+(S||"")+C;l.obj=Kekule.ChemStructureNodeFactory.createByLabel(b),g.asSymbol=!0,O=!0}else if(p===t.CT_CHARGE_SYMBOL){if(u="+"===C?1:-1,g.asCharge=!0,c.tokenType===t.CT_NUMBER){var T;if(c.asCount)if(c.token.length>1){var E=c.token;T=E.substr(E.length-1),c.asCount&&(l.count=parseInt(E.substring(0,E.length-1),10))}else T=c.token,c.asCount&&(l.count=1);else T=c.token,c.asChargeCount=!0;u*=parseInt(T,10)}l.charge=u,O=!0}else if(p===t.CT_NUMBER){var I=parseInt(C,10);u&&c.tokenType===t.CT_CHARGE_SYMBOL&&c.asCharge?(u*=I,l.charge=u,g.asChargeCount=!0,O=!0):l.obj&&c.asSymbol?(l.count=I,g.asCount=!0,O=!0):l.obj||(l.massNum=I,O=!0)}g.handled=O,c=g}l&&l.obj&&f()}return o}finally{i.finalize()}},formulaToText:function(e,t,n){return Kekule.ObjUtils.isUnset(t)&&(t=!0),r._convFormulaToText(e,!1,t,n)},_convFormulaToText:function(e,t,n,o){var i="",a=e.getSections();if(t){var s=e.getMaxNestedLevel()%r.FORMULA_BRACKET_TYPE_COUNT,l=r.FORMULA_BRACKETS[s][0],u=r.FORMULA_BRACKETS[s][1];i+=l}for(var c=0,d=a.length;c<d;++c){var h=a[c].obj,f=e.getSectionCharge(a[c]),m=null;if(h instanceof Kekule.MolecularFormula)m=r._convFormulaToText(h,!0,!1,!1,o);else if(h.getLabel){m=h.getLabel();h.getMassNumber&&h.getMassNumber()&&(m=(i?" ":"")+m)}if(m){var g=!1;if(1!=a[c].count&&(m+=a[c].count,g=!0),n&&f)m+=(g?" ":"")+r._convChargeToText(f,o);i+=m}}(t&&(i+=u),n)&&((f=e.getCharge())&&(i+=r._convChargeToText(f,o)));return i},_convChargeToText:function(e,t){if(!e)return null;var r=e>0?"+":"-",n=Math.abs(e),o=r;return 1!=n&&(o=(t?Kekule.NumUtils.toDecimals(n,t):n.toString())+r),o}};var r=Kekule.FormulaUtils;ClassEx.defineProp(Kekule.MolecularFormula,"text",{dataType:DataType.STRING,serializable:!1,getter:function(){return r.formulaToText(this)},setter:function(e){r.textToFormula(e,this.getParent(),this)}})}(),function(){"use strict";Kekule.Glyph={},Kekule.Glyph.Base=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Glyph.Base",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){},getAutoIdPrefix:function(){return"g"},getAllowChildCoordStickTo:function(e,t){return!1},getChildAcceptCoordStickFrom:function(e,t){return!1},getChildUseCoordStickOffset:function(e,t){return null}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.Glyph.Base)}(),function(){"use strict";Kekule.Glyph.ElectronArrowGlyphUtils={isValidChemNodeOrConnectorStickTarget:function(e){var t=e instanceof Kekule.ChemStructureNode||e instanceof Kekule.ChemStructureConnector;if(!t&&e instanceof Kekule.ChemMarker.BaseMarker){var r=e.getParent&&e.getParent();r&&(t=r instanceof Kekule.ChemStructureNode||r instanceof Kekule.ChemStructureConnector)}return t},isValidElectronTarget:function(e){return Kekule.Glyph.ElectronArrowGlyphUtils.isValidChemNodeOrConnectorStickTarget(e)},getValidElectronTarget:function(e){var t=e&&e.getCoordStickTarget&&e.getCoordStickTarget();return t&&Kekule.Glyph.ElectronArrowGlyphUtils.isValidElectronTarget(t)?t:null},setValidElectronTarget:function(e,t){e.getAllowCoordStickTo&&e.getAllowCoordStickTo(t)&&(t?Kekule.Glyph.ElectronArrowGlyphUtils.isValidElectronTarget(t)&&e.setCoordStickTarget(t):e.setCoordStickTarget(null))},getValidElectronTargetNodeOrConnector:function(e){var t=null,r=Kekule.Glyph.ElectronArrowGlyphUtils.getValidElectronTarget(e);return r&&(t=r instanceof Kekule.ChemMarker.BaseMarker?r.getParent():r),t}}}(),function(){"use strict";var e=Kekule.CoordUtils,t=Kekule.CoordMode;Kekule.Glyph.PathGlyphNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphNode",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e]),r&&this.setCoord2D(r),n&&this.setCoord3D(n),this.setNodeType(t||Kekule.Glyph.NodeType.LOCATION)},initProperties:function(){this.defineProp("nodeType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC}),this.defineProp("pathNodeParams",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("pathNodeParams");return e||(e={},this.setPropStoreFieldValue("pathNodeParams",e)),e},setter:function(e){e?this.setPropStoreFieldValue("pathNodeParams",Object.extend({},e,!0)):this.setPropStoreFieldValue("pathNodeParams",null)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},getAllowCoordStickTo:function(e){if(!e||!this.isSiblingWith(e)){var t=this.getParent();if(t&&t.getAllowChildCoordStickTo)return t.getAllowChildCoordStickTo(this,e)}return!1},getAcceptCoordStickFrom:function(e){var t=this.getParent();return!(!t||!t.getChildAcceptCoordStickFrom)&&t.getChildAcceptCoordStickFrom(this,e)},notifyCoordStickTargetChanged:function(e,t){this.tryApplySuper("notifyCoordStickTargetChanged",[e,t]);var r=this.getParent();if(Kekule.ObjUtils.isUnset(this.getPathNodeParams().useStickingOffset)&&r.getChildUseCoordStickOffset){var n=r.getChildUseCoordStickOffset(this,t);Kekule.ObjUtils.notUnset(n)&&(this.getPathNodeParams().useStickingOffset=n)}r.notifyChildCoordStickTargetChanged&&r.notifyChildCoordStickTargetChanged(this.oldTarget,t)}}),Kekule.Glyph.NodeType={LOCATION:"location",CONTROLLER:"controller",HIDDEN:"hidden"},Kekule.Glyph.PathGlyphConnectorControlNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphConnectorControlNode",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setInteractMode(Kekule.ChemObjInteractMode.UNSELECTABLE)},getAutoIdPrefix:function(){return"cn"},getAcceptCoordStickFrom:function(e){return!1},getParentConnector:function(){var e=this.getParent();return e&&e instanceof Kekule.Glyph.PathGlyphConnector?e:null},isPositioned:function(e,r){return e||(e=t.COORD2D),this.doCheckIsPositioned(e,r)},doCheckIsPositioned:function(e,t){return!0},resetPosition:function(e){return e?this.doResetPosition(e):(this.doResetPosition(t.COORD2D),this.doResetPosition(t.COORD3D)),this},doResetPosition:function(e){}}),Kekule.Glyph.PathType={LINE:"L",ARC:"A"},Kekule.Glyph.ArrowType={NONE:null,OPEN:"open",TRIANGLE:"triangle"},Kekule.Glyph.ArrowSide={DEFAULT:0,BOTH:0,SINGLE:1,REVERSED:-1},Kekule.Glyph.PathGlyphConnector=Class.create(Kekule.BaseStructureConnector,{CLASS_NAME:"Kekule.Glyph.PathGlyphConnector",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,r]),this.setPathType(t)},initProperties:function(){this.defineProp("pathType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,enumSource:Kekule.Glyph.PathType}),this.defineProp("pathParams",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("pathParams");return e||(e={},this.setPropStoreFieldValue("pathParams",e)),e},setter:function(e){e?this.setPropStoreFieldValue("pathParams",Object.extend({},e,!0)):this.setPropStoreFieldValue("pathParams",null)}}),this.defineProp("controlPoints",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLISHED,getter:function(e){var t=this.getPropStoreFieldValue("controlPoints");return!t&&e&&(t=[],this.setPropStoreFieldValue("controlPoints",t)),t&&!t.length&&this.doFillDefaultControlPoints(t),t},setter:function(e){this.clearControlPoints(),this.setPropStoreFieldValue("controlPoints",e),this._controlPointsChanged()}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setInteractMode(Kekule.ChemObjInteractMode.UNSELECTABLE)},_appendChildObj:function(e){var t=this.tryApplySuper("_appendChildObj",[e]);return e instanceof Kekule.Glyph.PathGlyphConnectorControlNode&&this.tryResetControlPointPosition(e),t},doPropChanged:function(e,t){return"connectedObjs"===e&&this.tryResetAllControlPointPositions(),this.tryApplySuper("doPropChanged",[e,t])},getAbsCoord2D:function(e){return this.getAbsCoordOfMode(Kekule.CoordMode.COORD2D,e)},getAbsCoord3D:function(e){return this.getAbsCoordOfMode(Kekule.CoordMode.COORD2D,e)},getAbsCoordOfMode:function(e,t){for(var r=Kekule.CoordUtils,n={x:0,y:0},o=0,i=0,a=this.getConnectedObjCount();i<a;++i){var s=this.getConnectedObjAt(i);if(s&&s.getAbsCoordOfMode){var l=s.getAbsCoordOfMode(e,t);l&&(++o,n=r.add(n,l))}}return r.divide(n,o)},getChildSubgroupNames:function(){return["controlPoint"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.Glyph.PathGlyphArcConnectorControlNode?"controlPoint":this.tryApplySuper("getBelongChildSubGroupName",[e])},getControlPointCount:function(){var e=this.getControlPoints();return e&&e.length||0},getControlPointAt:function(e){return(this.getControlPoints()||[])[e]},indexOfControlPoint:function(e){var t=this.getControlPoints();return t?t.indexOf(e):-1},removeControlPointAt:function(e){var t=null,r=this.getControlPoints();return r&&e>=0&&e<r.length&&((t=r.splice(e,1)).setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this.notifyPropSet("controlPoints",this.getControlPoints())),t},removeControlPoint:function(e){var t=null,r=this.getControlPoints();if(r){var n=r.indexOf(e);n>=0&&(r.splice(n,1),e.setOwner&&e.setOwner(null),e.setParent&&e.setParent(null),t=e,this.notifyPropSet("controlPoints",this.getControlPoints()))}return t},insertControlPointAt:function(e,t){var r=this.getControlPoints();if(r&&t<r.length){var n=Kekule.ArrayUtils.insertUniqueEx(r,e,t);return n.isInserted&&(e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this),this.notifyPropSet("controlPoints",this.getControlPoints())),n.index}return-1},insertControlPointBefore:function(e,t){var r=this.getControlPoints();if(r){var n=t?this.indexOfControlPoint(t):-1;return n<0&&(n=r.length),this.insertControlPointAt(e,n)}return-1},tryResetControlPointPosition:function(e){if(e.isPositioned&&e.resetPosition)for(var r=[t.COORD2D,t.COORD3D],n=0,o=r.length;n<o;++n){var i=r[n];e.isPositioned(i,!0)||e.resetPosition(i)}},tryResetAllControlPointPositions:function(){for(var e=0,t=this.getControlPointCount();e<t;++e){var r=this.getControlPointAt(e);this.tryResetControlPointPosition(r)}},doFillDefaultControlPoints:function(e){},removeChildObj:function(e){return this.removeControlPoint(e)},hasChildObj:function(e){return this.hasChild(e)},getNextSiblingOfChild:function(e){var t=this.indexOfChild(e);return++t,this.getChildAt(t)},_controlPointsChanged:function(){this._updateControlPointsOwner(),this._updateControlPointsParent()},_updateControlPointsOwner:function(e){e||(e=this.getOwner());var t=this.getControlPoints();if(t)for(var r=0,n=t.length;r<n;++r){var o=t[r];o.setOwner&&o.setOwner(e)}},_updateControlPointsParent:function(e){e||(e=this);var t=this.getControlPoints();if(t)for(var r=0,n=t.length;r<n;++r){var o=t[r];o.setParent&&o.setParent(e)}},clearControlPoints:function(){var e=this.getControlPoints();if(e&&(e=Kekule.ArrayUtils.clone(e)),this.setPropStoreFieldValue("controlPoints",null),e)for(var t=0,r=e.length;t<r;++t){var n=e[t];n.setOwner&&n.setOwner(null),n.setParent&&n.setParent(null)}return this.notifyPropSet("controlPoints",null),this},modifyPathParams:function(e){if(e){var t=this.getPathParams();return t=Object.extend(t,e||{}),this.setPathParams(t),t}return null}}),Kekule.Glyph.PathGlyphArcConnectorControlNode=Class.create(Kekule.Glyph.PathGlyphConnectorControlNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphArcConnectorControlNode",initProperties:function(){this.defineProp("distanceToChord",{dataType:DataType.FLOAT})},doCheckIsPositioned:function(e,t){return this.getIndirectCoordRefCoords(e,t)&&Kekule.ObjUtils.notUnset(this.getDistanceToChord())},doResetPosition:function(r){if(r===t.COORD2D){var n=this.getIndirectCoordRefCoords(r,!0);if(n&&n[0]&&n[1]){var o=e.getDistance(n[0],n[1]);this.setDistanceToChord(.5*o),this.notifyPropSet("coord2D",this.getCoord2D())}}},doGetEnableIndirectCoord:function(){return!0},getIndirectCoordRefCoords:function(e,t){var r=this.getParentConnector();return r&&r.getConnectedObjCount()>=2?[r.getConnectedObjAt(0).getAbsCoordOfMode(t),r.getConnectedObjAt(1).getAbsCoordOfMode(t)]:this.tryApplySuper("getIndirectCoordRefCoords",[e])},calcIndirectCoordValue:function(r,n){if(r===t.COORD2D){var o=this.getDistanceToChord();if(Kekule.ObjUtils.notUnset(o)){var i=this.getIndirectCoordRefCoords();if(i){var a=i[0],s=i[1];if(a&&s){var l=e.substract(s,a),u=Math.sign(l.x),c=Math.sign(l.y);if(Kekule.NumUtils.isFloatEqual(l.x,0,1e-10))h={x:-o*c,y:0};else if(Kekule.NumUtils.isFloatEqual(l.y,0,1e-10))h={x:0,y:o*u};else{var d=-1/(l.y/l.x),h={x:-c*o/Math.sqrt(1+Math.sqr(d))};h.y=h.x*d}return h}}}}return this.tryApplySuper("calcIndirectCoordValue",[r,n])},saveIndirectCoordValue:function(r,n,o,i){if(r===t.COORD2D){var a=o,s=this.getIndirectCoordRefCoords();if(s){var l=s[0],u=s[1],c=e.substract(u,l),d=Math.atan2(c.y,c.x),h=(e.getDistance(l,u),e.substract(n,a)),f=Math.atan2(h.y,h.x),m=e.getDistance(n,a)*Math.sin(f-d),g=(this.getDistanceToChord()||0)+m;return this.setDistanceToChord(g),g}}return this.tryApplySuper("saveIndirectCoordValue",[r,n])}}),Kekule.Glyph.PathGlyphArcConnector=Class.create(Kekule.Glyph.PathGlyphConnector,{CLASS_NAME:"Kekule.Glyph.PathGlyphArcConnector",initialize:function(e,t){this.tryApplySuper("initialize",[e,Kekule.Glyph.PathType.ARC,t]);var r=this._createDefaultControlPoints();this.setControlPoints(r)},getControlPoint:function(){return(this.getControlPoints()||[])[0]},doFillDefaultControlPoints:function(e){var t=this._createDefaultControlPoints();Kekule.ArrayUtils.pushUnique(e,t)},_createDefaultControlPoints:function(){return[new Kekule.Glyph.PathGlyphArcConnectorControlNode(null,{x:0,y:0})]}}),Kekule.Glyph.PathGlyph=Class.create(Kekule.Glyph.Base,{CLASS_NAME:"Kekule.Glyph.PathGlyph",initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e,n,o]),this.createDefaultStructure(t||1,r||{})},doFinalize:function(){this.hasCtab()&&this.getCtab().finalize(),this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",scope:Class.PropertyScope.PUBLIC,getter:function(e){return this.getPropStoreFieldValue("ctab")||e&&this.createCtab(),this.getPropStoreFieldValue("ctab")},setter:function(e){var t=this.getPropStoreFieldValue("ctab");t&&(t.finalize(),t=null),e&&(e.setPropValue("parent",this,!0),e.setOwner(this.getOwner())),this.setPropStoreFieldValue("ctab",e)}}),this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}})},createDefaultStructure:function(e,t){e||(e=1);var r={},n=["startArrowLength","startArrowWidth","endArrowLength","endArrowWidth"];for(var o in t)n.indexOf(o)>=0?r[o]=t[o]*e:r[o]=t[o];return this.doCreateDefaultStructure(e,r)},doCreateDefaultStructure:function(e,t){},getAutoIdPrefix:function(){return"p"},ownerChanged:function(e,t){this.hasCtab()&&this.getCtab().setOwner(e),this.tryApplySuper("ownerChanged",[e,t])},_removeChildObj:function(e){if(this.hasCtab()){var t=this.getCtab();t===e?this.removeCtab():t.hasChildObj(e)&&t.removeChildObj(e)}this.tryApplySuper("_removeChildObj",[e])},isEmpty:function(){return this.getCtab().isEmpty()},createCtab:function(){var e=new Kekule.StructureConnectionTable(this.getOwner(),this);this.setPropStoreFieldValue("ctab",e),e.addEventListener("propValueSet",function(e){"nodes"==e.propName&&this.notifyPropSet(e.propName,e.propValue)},this),e.setEnablePropValueSetEvent(!0)},hasCtab:function(){return!!this.getPropStoreFieldValue("ctab")},getContainerBox:function(e,t){return this.hasCtab()?this.getCtab().getContainerBox(e,t):this.tryApplySuper("getContainerBox",[e])},getNodeById:function(e){return this.hasCtab()?this.getCtab().getNodeById(e):null},getConnectorById:function(e){return this.hasCtab()?this.getCtab().getConnectorById(e):null},getObjectById:function(e){var t=this.getNodeById(e);return t||this.getConnectorById(e)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(e){return this.hasCtab()?this.getCtab().getNodeAt(e):null},indexOfNode:function(e){return this.hasCtab()?this.getCtab().indexOfNode(e):-1},hasNode:function(e,t){return this.hasCtab()?this.getCtab().hasNode(e,t):null},appendNode:function(e){return this.doGetCtab(!0).appendNode(e)},insertNodeAt:function(e,t){return this.doGetCtab(!0).insertNodeAt(e,t)},insertNodeBefore:function(e,t){var r=t?this.indexOfNode(t):-1;return r<0?this.appendNode(e):this.doGetCtab(!0).insertNodeAt(e,r)},removeNodeAt:function(e,t){return this.hasCtab()?this.getCtab().removeNodeAt(e,t):null},removeNode:function(e,t){return this.hasCtab()?this.getCtab().removeNode(e,t):null},replaceNode:function(e,t){return this.hasCtab()?this.getCtab().replaceNode(e,t):null},clearNodes:function(){if(this.hasCtab())return this.getCtab().clearNodes()},nodesHasCoord2D:function(e){return!!this.hasCtab()&&this.getCtab().nodesHasCoord2D(e)},nodesHasCoord3D:function(e){return!!this.hasCtab()&&this.getCtab().nodesHasCoord3D(e)},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(e){return this.hasCtab()?this.getCtab().getConnectorAt(e):null},indexOfConnector:function(e){return this.hasCtab()?this.getCtab().indexOfConnector(e):-1},hasConnector:function(e,t){return this.hasCtab()?this.getCtab().hasConnector(e,t):null},appendConnector:function(e){return this.doGetCtab(!0).appendConnector(e)},insertConnectorAt:function(e,t){return this.doGetCtab(!0).insertConnectorAt(e,t)},insertConnectorBefore:function(e,t){var r=t?this.indexOfConnector(t):-1;return r<0?this.appendConnector(e):this.doGetCtab(!0).insertConnectorAt(e,r)},removeConnectorAt:function(e,t){return this.hasCtab()?this.getCtab().removeConnectorAt(e,t):null},removeConnector:function(e,t){return this.hasCtab()?this.getCtab().removeConnector(e,t):null},clearConnectors:function(){if(this.hasCtab())return this.getCtab().clearConnectors()},_getObjsNeedToBeCascadeRemoved:function(e,t){return this.hasCtab()?this.getCtab()._getObjsNeedToBeCascadeRemoved(e,t):[]},getChildSubgroupNames:function(){return["node","connector"].concat(this.tryApplySuper("getChildSubgroupNames"))},getBelongChildSubGroupName:function(e){return e instanceof Kekule.Glyph.PathGlyphNode?"node":e instanceof Kekule.Glyph.PathGlyphConnector?"connector":this.tryApplySuper("getBelongChildSubGroupName",[e])},removeChildObj:function(e,t,r){this.hasCtab()&&this.getCtab().removeChildObj(e,t,r)},hasChildObj:function(e){return!!this.hasCtab()&&this.getCtab().hasChildObj(e)},getNextSiblingOfChild:function(e){return this.hasCtab()?this.getCtab().getNextSiblingOfChild(e):null},getDirectManipulationTarget:function(){return null}})}(),function(){"use strict";var e=Kekule.ObjUtils,t=(Kekule.Glyph.NodeType,Kekule.Glyph.PathType),r=Kekule.CoordUtils,n=Kekule.CoordMode;Kekule.Glyph.StraightLine=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.StraightLine",initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e,t,r,n,o])},doCreateDefaultStructure:function(e,r){var n=Kekule.CoordUtils,o={x:0,y:0},i={x:0,y:0,z:0},a={x:e*(r.lineLength||1)},s=new Kekule.Glyph.PathGlyphNode(null,null,o,i),l=new Kekule.Glyph.PathGlyphNode(null,null,n.add(o,a),n.add(i,a)),u=new Kekule.Glyph.PathGlyphConnector(null,t.LINE,[s,l]);this._applyParamsToConnector(u,r),this.appendNode(s),this.appendNode(l),this.appendConnector(u)},_applyParamsToConnector:function(e,t){var r=Object.create(t);Kekule.ObjUtils.isUnset(t.autoOffset)&&(r.autoOffset=!1),e.setPathParams(r)},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)}}),Kekule.Glyph.Polygon=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.Polygon",initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e,t,r,n,o])},getRefLengthRatio:function(){return 1},doCreateDefaultStructure:function(e,r){for(var n,o,i=Kekule.CoordUtils,a={x:0,y:0},s={x:0,y:0,z:0},l=r.nodeProps,u=r.connectorProps,c=e*(r.lineLength||1)*this.getRefLengthRatio(),d=r.edgeCount||3,h=2*Math.PI/d,f=d%2?0:-h/2,m=0;m<d;++m){var g={x:c*Math.sin(f),y:c*Math.cos(f)},p=new Kekule.Glyph.PathGlyphNode(null,null,i.add(a,g),i.add(s,g));if(l&&p.setPropValues(l),this.appendNode(p),0===m&&(n=p),o){var C=new Kekule.Glyph.PathGlyphConnector(null,t.LINE,[o,p]);u&&C.setPropValues(u),this._applyParamsToConnector(C,r),this.appendConnector(C)}o=p,f+=h}C=new Kekule.Glyph.PathGlyphConnector(null,t.LINE,[p,n]);u&&C.setPropValues(u),this._applyParamsToConnector(C,r),this.appendConnector(C)},_applyParamsToConnector:function(e,t){e.setPathParams(t)}}),Kekule.Glyph.BaseArc=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.BaseArc",initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e,t,r,n,o])},doCreateDefaultStructure:function(e,t){var r=Kekule.CoordUtils,n={x:0,y:0},o={x:0,y:0,z:0},i={x:e*(t.lineLength||1)},a=new Kekule.Glyph.PathGlyphNode(null,null,n,o),s=new Kekule.Glyph.PathGlyphNode(null,null,r.add(n,i),r.add(o,i));this.appendNode(a),this.appendNode(s);var l=new Kekule.Glyph.PathGlyphArcConnector(null,[a,s]);this._applyParamsToConnector(l,t),this.appendConnector(l),l.setInteractMode(Kekule.ChemObjInteractMode.HIDDEN)},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)},_isValidChemNodeOrConnectorStickTarget:function(e){return Kekule.Glyph.ElectronArrowGlyphUtils.isValidChemNodeOrConnectorStickTarget(e)},_applyParamsToConnector:function(e,t){e.setPathParams(t)},getAllowChildCoordStickTo:function(e,t){return!t||this._isValidChemNodeOrConnectorStickTarget(t,e)&&!this._isChildrenStickingTo(t,[e])},getChildUseCoordStickOffset:function(e,t){return t instanceof Kekule.ChemStructureNode||t instanceof Kekule.ChemStructureConnector},_isChildrenStickingTo:function(e,t){for(var r=this.getNodes(),n=0,o=(r=Kekule.ArrayUtils.exclude(r,t||[])).length;n<o;++n){if(r[n].getCoordStickTarget()===e)return!0}return!1}}),Kekule.Glyph.BaseTwinArc=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.BaseTwinArc",DEF_MIN_PATH_END_DISTANCE_RATIO:.05,DEF_INIT_PATH_END_GAP_RATIO:.2,FIELD_ARC_END_NODE_FLAG:"__$arcEndNode$__",initialize:function(e,t,r,n,o){this.setPropStoreFieldValue("minPathEndDistanceRatio",this.DEF_MIN_PATH_END_DISTANCE_RATIO),this.tryApplySuper("initialize",[e,t,r,n,o])},initProperties:function(){this.defineProp("minPathEndDistanceRatio",{dataType:DataType.FLOAT}),this.defineProp("oppositePathEndArrowSides",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._isPathArrowSideOpposite("end")},setter:function(e){this._setPathArrowSideOpposite("end",!!e)}}),this.defineProp("oppositePathStartArrowSides",{dataType:DataType.BOOL,serializable:!1,getter:function(){return this._isPathArrowSideOpposite("start")},setter:function(e){this._setPathArrowSideOpposite("start",!!e)}})},loaded:function(e){var t=this.tryApplySuper("loaded",[e]);return this._isTwinArcSetup()&&(this._setupArcEndNode(this.getNodeAt(1)),this._setupArcEndNode(this.getNodeAt(2))),t},_isPathArrowSideOpposite:function(t){var r=this.getConnectorCount();if(r<2)return null;for(var n,o=null,i=0;i<r;++i){var a=this.getConnectorAt(i).getPathParams();if(a[t+"ArrowType"]===Kekule.Glyph.ArrowType.NONE)return null;var s=a[t+"ArrowSide"];if(s===Kekule.Glyph.ArrowSide.BOTH)return null;if(0===i)n=s;else{var l=n!==s;if(e.isUnset(o))o=l;else if(o!==l)return null;n=s}}return o},_setPathArrowSideOpposite:function(t,r){var n=this.getConnectorCount();if(n<2)return null;for(var o,i=Kekule.Glyph.ArrowSide,a=!0,s=0;s<n;++s){var l=this.getConnectorAt(s).getPathParams();l[t+"ArrowType"]===Kekule.Glyph.ArrowType.NONE&&(a=!1);var u,c=l[t+"ArrowSide"];if(c===Kekule.Glyph.ArrowSide.BOTH&&(a=!1),a)if(e.isUnset(o))o=c;else u=r?o===i.SINGLE?i.REVERSED:i.SINGLE:o,l[t+"ArrowSide"]=u,o=u;else o=null}return null},_isTwinArcSetup:function(){return 2===this.getConnectorCount()&&4===this.getNodeCount()},getDirectManipulationTarget:function(){return this.getNodeAt(this.getNodeCount()-1)},doCreateDefaultStructure:function(e,t){var n=Kekule.CoordUtils,o={x:0,y:0},i={x:0,y:0,z:0},a=t.lineLength||1,s=t.minPathEndDistanceRatio||this.getMinPathEndDistanceRatio()||this.DEF_MIN_PATH_END_DISTANCE_RATIO,l=a*s;this.setMinPathEndDistanceRatio(s);var u=t.pathEndGap||a*this.DEF_INIT_PATH_END_GAP_RATIO,c={x:e*((a-(u=Math.max(u,l)))/2)},d={x:e*u},h={x:e*a},f=new Kekule.Glyph.PathGlyphNode(null,null,o,i),m=new Kekule.Glyph.PathGlyphNode(null,null);this._setupArcEndNode(m);var g=new Kekule.Glyph.PathGlyphNode(null,null),p=new Kekule.Glyph.PathGlyphNode(null,null,n.add(o,h),n.add(i,h));this._setupArcEndNode(g),this.appendNode(f),this.appendNode(m),this.appendNode(g),this.appendNode(p),m.setCoord2D(n.add(o,c)).setCoord3D(n.add(i,c)),g.setCoord2D(n.add(o,r.add(c,d))).setCoord3D(n.add(i,r.add(c,d)));var C=new Kekule.Glyph.PathGlyphArcConnector(null,[f,m]),O=new Kekule.Glyph.PathGlyphArcConnector(null,[p,g]);this._applyParamsToConnector(C,t),this._applyParamsToConnector(O,t),O.getControlPointAt(0).setDistanceToChord(-O.getControlPointAt(0).getDistanceToChord()),this.appendConnector(C),this.appendConnector(O),C.setInteractMode(Kekule.ChemObjInteractMode.HIDDEN),O.setInteractMode(Kekule.ChemObjInteractMode.HIDDEN)},_applyParamsToConnector:function(e,t){e.setPathParams(t)},_setupArcEndNode:function(e){e[this.FIELD_ARC_END_NODE_FLAG]||(this._overwriteChildPathNodeMethods(e),e.setEnableIndirectCoord(!0),e[this.FIELD_ARC_END_NODE_FLAG]=!0)},_overwriteChildPathNodeMethods:function(e){e.overwriteMethod("getIndirectCoordRefLengths",this._insideNodeGetIndirectCoordRefLengths).overwriteMethod("getIndirectCoordRefCoords",this._insideNodeGetIndirectCoordRefCoords).overwriteMethod("calcIndirectCoordStorage",this._insideNodeCalcIndirectCoordStorage).overwriteMethod("calcIndirectCoordValue",this._insideNodeCalcIndirectCoordValue).overwriteMethod("_childPathNodeGetParentGlyph",this._childPathNodeGetParentGlyph).overwriteMethod("_childPathNodeGetGlyphMinPathEndDistanceRatio",this._childPathNodeGetGlyphMinPathEndDistanceRatio)},_getArrowStartingNodes:function(){var e=[];if(this._isTwinArcSetup())for(var t=0,r=this.getConnectorCount();t<r;++t){var n=this.getConnectorAt(t).getConnectedObjAt(0);n&&e.push(n)}return e},_childPathNodeGetParentGlyph:function(e){var t=this.getParent();return t instanceof Kekule.Glyph.BaseTwinArc?t:null},_childPathNodeGetGlyphMinPathEndDistanceRatio:function(e){var t=this._childPathNodeGetParentGlyph();return t&&t.getMinPathEndDistanceRatio()},_insideNodeGetIndirectCoordRefLengths:function(e,t,r){var n=this.getParent();if(!n||t!==Kekule.CoordMode.COORD2D)return e(t,r);var o=n.getNodeAt(0),i=n.getNodeAt(n.getNodeCount()-1);if(o&&i){var a=o.getAbsCoordOfMode(t),s=i.getAbsCoordOfMode(t),l=Kekule.CoordUtils.getDistance(s,a);return{x:l,y:l,length:l}}},_insideNodeGetIndirectCoordRefCoords:function(e,t,r){var o=this.getParent();if(!o||t!==n.COORD2D)return e(t,r);var i=o.getNodeAt(0),a=o.getNodeAt(o.getNodeCount()-1);return i&&a?[i.getCoordOfMode(t),a.getCoordOfMode(t)]:void 0},_insideNodeCalcIndirectCoordStorage:function(e,t,o,i,a){var s=this.getParent();if(s&&t===n.COORD2D){var l=this.getIndirectCoordRefCoords(t,a);if(l){var u=s.getNodeAt(0).getCoordOfMode(t),c=Kekule.GeometryUtils.getPerpendicularCrossPointFromCoordToLine(o,l[0],l[1],!1);if(!c)c=r.getDistance(o,l[0])<r.getDistance(o,l[1])?l[0]:l[1];var d=r.getDistance(u,c),h=r.getDistance(l[1],l[0]),f=h?d/h:0,m=this._childPathNodeGetGlyphMinPathEndDistanceRatio()||0;return f<m?f=m:f>1-m&&(f=1-m),{x:f,y:f,ratio:f}}}return e(t,o,i,a)},_insideNodeCalcIndirectCoordValue:function(e,t,o){var i=this.getParent();if(i&&t===n.COORD2D){var a=this.getIndirectCoordRefCoords(t,o);if(a){var s=r.substract(a[1],a[0]),l=i.getNodeAt(0).getCoordOfMode(t),u=this.getIndirectCoordStorageOfMode(t).ratio;if(Kekule.ObjUtils.notUnset(u)){var c=r.multiply(s,u);return r.add(l,c)}}}return e(t,o)},_isValidChemNodeOrConnectorStickTarget:function(e){var t=e instanceof Kekule.ChemStructureNode||e instanceof Kekule.ChemStructureConnector;if(!t&&e instanceof Kekule.ChemMarker.BaseMarker){var r=e.getParent&&e.getParent();r&&(t=r instanceof Kekule.ChemStructureNode||r instanceof Kekule.ChemStructureConnector)}return t},getAllowChildCoordStickTo:function(e,t){var r=this.indexOfNode(e);return(0===r||r===this.getNodeCount()-1)&&(!t||this._isValidChemNodeOrConnectorStickTarget(t,e)&&!this._isChildrenStickingTo(t,[e]))},getChildUseCoordStickOffset:function(e,t){return t instanceof Kekule.ChemStructureNode||t instanceof Kekule.ChemStructureConnector},_isChildrenStickingTo:function(e,t){for(var r=this._getArrowStartingNodes(),n=0,o=(r=Kekule.ArrayUtils.exclude(r,t||[])).length;n<o;++n){if(r[n].getCoordStickTarget()===e)return!0}return!1}}),Kekule.Glyph.Arc=Class.create(Kekule.Glyph.BaseArc,{CLASS_NAME:"Kekule.Glyph.Arc"}),Kekule.Glyph.TwinArc=Class.create(Kekule.Glyph.BaseTwinArc,{CLASS_NAME:"Kekule.Glyph.TwinArc"})}(),function(){"use strict";var e=Kekule.ObjUtils,t=(Kekule.Glyph.NodeType,Kekule.Glyph.PathType),r=Kekule.Glyph.ElectronArrowGlyphUtils;Kekule.Glyph.HeatSymbol=Class.create(Kekule.Glyph.Polygon,{CLASS_NAME:"Kekule.Glyph.HeatSymbol",initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e,t,r,n,o]),this.setRenderOption&&this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return.25},doCreateDefaultStructure:function(e,t){return t.edgeCount=3,t.nodeProps=Object.extend(t.nodeProps||{},{interactMode:Kekule.ChemObjInteractMode.HIDDEN}),t.connectorProps=Object.extend(t.connectorProps||{},{interactMode:Kekule.ChemObjInteractMode.HIDDEN}),this.tryApplySuper("doCreateDefaultStructure",[e,t])},_applyParamsToConnector:function(e,t){return this.tryApplySuper("_applyParamsToConnector",[e,t])}}),Kekule.Glyph.AddSymbol=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.AddSymbol",initialize:function(e,t,r,n,o){this.tryApplySuper("initialize",[e,t,r,n,o]),this.setRenderOption&&this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return.5},doCreateDefaultStructure:function(e,r){var n={interactMode:Kekule.ChemObjInteractMode.HIDDEN},o={interactMode:Kekule.ChemObjInteractMode.HIDDEN},i=Kekule.CoordUtils,a={x:0,y:0},s={x:0,y:0,z:0},l=e*this.getRefLengthRatio()*(r.lineLength||1)/2,u=new Kekule.Glyph.PathGlyphNode(null,null,a,s);u.setPropValues(n),this.appendNode(u);for(var c=[{x:-l,y:0},{x:0,y:-l},{x:l,y:0},{x:0,y:l}],d=0,h=c.length;d<h;++d){var f=c[d],m=new Kekule.Glyph.PathGlyphNode(null,null,i.add(a,f),i.add(s,f));m.setPropValues(n);var g=new Kekule.Glyph.PathGlyphConnector(null,t.LINE,[u,m]);g.setPropValues(o),this._applyParamsToConnector(g,r),this.appendNode(m),this.appendConnector(g)}},_applyParamsToConnector:function(e,t){e.setPathParams(t)}}),Kekule.Glyph.Segment=Class.create(Kekule.Glyph.StraightLine,{CLASS_NAME:"Kekule.Glyph.Segment"}),Kekule.Glyph.ReactionArrowType={NORMAL:"normal",REVERSIBLE:"reversible",RESONANCE:"resonance",RETROSYNTHESIS:"retrosynthesis",CUSTOM:"custom"},Kekule.Glyph.ReactionArrowType.getDefPathParamOfArrowType=function(e){var t,r=Kekule.Glyph.ReactionArrowType,n=Kekule.Glyph.ArrowType,o=Kekule.Glyph.ArrowSide;switch(e){case r.NORMAL:t={startArrowType:n.NONE,endArrowType:n.OPEN,endArrowSide:o.BOTH,lineCount:1};break;case r.REVERSIBLE:t={startArrowType:n.OPEN,startArrowSide:o.REVERSED,endArrowType:n.OPEN,endArrowSide:o.SINGLE,lineGap:.1,lineCount:2};break;case r.RESONANCE:t={startArrowType:n.OPEN,startArrowSide:o.BOTH,endArrowType:n.OPEN,endArrowSide:o.BOTH,lineCount:1};break;case r.RETROSYNTHESIS:t={startArrowType:n.NONE,endArrowType:n.OPEN,endArrowSide:o.BOTH,lineGap:.1,lineCount:2};break;default:t=null}return t},Kekule.Glyph.ReactionArrow=Class.create(Kekule.Glyph.StraightLine,{CLASS_NAME:"Kekule.Glyph.ReactionArrow",initProperties:function(){this.defineProp("reactionType",{dataType:DataType.STRING,enumSource:Kekule.Glyph.ReactionArrowType,setter:function(e){this.setPropStoreFieldValue("reactionType",e),this.reactionTypeChanged(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setReactionType(Kekule.Glyph.ReactionArrowType.NORMAL)},doCreateDefaultStructure:function(e,t){var r=t,n=t.reactionType||this.getReactionType();if(n){var o=this._getPathParamOfArrowType(n);r=Object.extend(o,t)}var i=this.tryApplySuper("doCreateDefaultStructure",[e,r]);return n&&this.setReactionType(n),i},reactionTypeChanged:function(e){var t=this._getPathParamOfArrowType(e);if(t){var r=this.getConnectorAt(0);r&&r.modifyPathParams(t)}},_getPathParamOfArrowType:function(e){return Kekule.Glyph.ReactionArrowType.getDefPathParamOfArrowType(e)}}),Kekule.Glyph.ElectronPushingArrow=Class.create(Kekule.Glyph.BaseArc,{CLASS_NAME:"Kekule.Glyph.ElectronPushingArrow",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.INT,getter:function(){var e=this._getValidArrowSide(),t=Kekule.Glyph.ArrowSide;return e===t.BOTH?2:[t.SINGLE,t.REVERSED].indexOf(e)>=0?1:null},setter:function(e){var t=Kekule.Glyph.ArrowSide,r=this._getValidArrowPos(),n=this.getConnectorAt(0);r||(n.getPathParams().endArrowType=Kekule.Glyph.ArrowType.OPEN,r="end");var o=n.getPathParams();e>=2?o[r+"ArrowSide"]=t.BOTH:1===e&&(o[r+"ArrowSide"]=t.SINGLE),n.setPathParams(o)}}),this.defineProp("directReceptor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(1);return this._getValidElectronTarget(e)},setter:function(e){var t=this.getNodeAt(1);this._setValidElectronTarget(t,e)}}),this.defineProp("directDonor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(0);return this._getValidElectronTarget(e)},setter:function(e){var t=this.getNodeAt(0);this._setValidElectronTarget(t,e)}}),this.defineProp("receptor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(1);return this._getValidElectronTargetNodeOrConnector(e)},setter:function(e){var t=this.getNodeAt(1);this._setValidElectronTarget(t,e)}}),this.defineProp("donor",{dataType:"Kekule.ChemStructureObject",getter:function(){var e=this.getNodeAt(0);return this._getValidElectronTargetNodeOrConnector(e)},setter:function(e){var t=this.getNodeAt(0);this._setValidElectronTarget(t,e)}})},doCreateDefaultStructure:function(e,t){var r=this.tryApplySuper("doCreateDefaultStructure",[e,t]);return t.electronCount&&this.setElectronCount(t.electronCount),r},_isValidElectronTarget:function(e){return this._isValidChemNodeOrConnectorStickTarget(e)},_getValidElectronTarget:function(e){return Kekule.Glyph.ElectronArrowGlyphUtils.getValidElectronTarget(e)},_setValidElectronTarget:function(e,t){return Kekule.Glyph.ElectronArrowGlyphUtils.setValidElectronTarget(e,t),this},_getValidElectronTargetNodeOrConnector:function(e){return Kekule.Glyph.ElectronArrowGlyphUtils.getValidElectronTargetNodeOrConnector(e)},_getValidArrowPos:function(){var e=this.getConnectorAt(0),t=e&&e.getPathParams();if(t){if(t.endArrowType)return"end";if(t.startArrowType)return"start"}return null},_getValidArrowSide:function(){var e=this.getConnectorAt(0),t=e&&e.getPathParams();if(t){if(t.endArrowType)return t.endArrowSide||Kekule.Glyph.ArrowSide.DEFAULT;if(t.startArrowType)return t.startArrowSide||Kekule.Glyph.ArrowSide.DEFAULT}return null},_applyParamsToConnector:function(e,t){var r=Object.create(t);Kekule.ObjUtils.isUnset(t.autoOffset)&&(r.autoOffset=!0),e.setPathParams(r)}}),Kekule.Glyph.BondFormingElectronPushingArrow=Class.create(Kekule.Glyph.BaseTwinArc,{CLASS_NAME:"Kekule.Glyph.BondFormingElectronPushingArrow",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.INT,getter:function(){for(var t=null,r=0,n=this.getConnectorCount();r<n;++r){var o=this._getConnectorElectronCount(this.getConnectorAt(r));if(e.notUnset(o))if(e.isUnset(t))t=o;else if(t!==o)return null}return t*this.getConnectorCount()},setter:function(e){if(e!==this.getElectronCount()){var t=this.getConnectorCount()?e/this.getConnectorCount():e;(t=Math.round(t))<=0&&(t=1);for(var r=Kekule.Glyph.ArrowSide,n=this.getConnectors(),o=0,i=n.length;o<i;++o){var a=n[o];a.getPathParams().endArrowType=Kekule.Glyph.ArrowType.OPEN,"end";var s=a.getPathParams();t>=2?s.endArrowSide=r.BOTH:1===t&&(s.endArrowSide=o%2?r.SINGLE:r.REVERSED),a.setPathParams(s)}}}}),this.defineProp("directDonors",{dataType:DataType.ARRAY,getter:function(){for(var e=this._getArrowStartingNodes(),t=[],n=0,o=e.length;n<o;++n){var i=r.getValidElectronTarget(e[n]);i&&t.push(i)}return t},setter:function(e){var t=this._getArrowStartingNodes();if(t.length)for(var n=0,o=t.length;n<o;++n){var i=t[n];e[n];r.setValidElectronTarget(i,e)}}}),this.defineProp("donors",{dataType:DataType.ARRAY,getter:function(){for(var e=this._getArrowStartingNodes(),t=[],n=0,o=e.length;n<o;++n){var i=r.getValidElectronTargetNodeOrConnector(e[n]);i&&t.push(i)}return t},setter:function(e){this.setDirectDonors(e)}})},_getConnectorElectronCount:function(e){var t=e&&e.getPathParams();if(t){var r=Kekule.Glyph.ArrowSide,n=t.endArrowType?t.endArrowSide||Kekule.Glyph.ArrowSide.DEFAULT:null;if(n===r.BOTH)return 2;if([r.SINGLE,r.REVERSED].indexOf(n)>=0)return 1}return null},doCreateDefaultStructure:function(e,t){var r=this.tryApplySuper("doCreateDefaultStructure",[e,t]);return this.setElectronCount(t.electronCount||1),r}})}(),function(){"use strict";Kekule.CoordMode,Kekule.CoordUtils;Kekule.ContentBlock=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ContentBlock",initialize:function(e,t,r){this.tryApplySuper("initialize",[e]),t&&this.setCoord2D(t),r&&this.setCoord3D(r)},initProperties:function(){this.defineProp("needRecalcSize",{dataType:DataType.BOOL})},getAutoIdPrefix:function(){return"b"},getCornerCoord1:function(e,t){return this.getCoordOfMode(e,t)},getCornerCoord2:function(e,t){var r=this.getCornerCoord1(e,t),n=this.getSizeOfMode(e,t);return Kekule.CoordUtils.add(r,n)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ContentBlock),Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.ContentBlock),Kekule.TextBlock=Class.create(Kekule.ContentBlock,{CLASS_NAME:"Kekule.TextBlock",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,r,n]),this.setText(t||"")},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"t"},doObjectChange:function(e){Kekule.ArrayUtils.intersect(["text","renderOptions"],e).length&&this.setNeedRecalcSize(!0)}}),Kekule.ImageBlock=Class.create(Kekule.ContentBlock,{CLASS_NAME:"Kekule.ImageBlock",initialize:function(e,t,r,n){this.tryApplySuper("initialize",[e,r,n]),t&&this.setSrc(t)},initProperties:function(){this.defineProp("src",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,setter:function(e){e!==this.getSrc()&&(this.setPropStoreFieldValue("src",e),this._clearCacheImg())}}),this.defineProp("cacheImg",{dataType:DataType.OBJECT,scope:Class.PropertyScope.PUBLIC,serializable:!1,setter:null,getter:function(){var e=this.getPropStoreFieldValue("cacheImg");return!e&&Kekule.$document&&(e=this._createCacheImg(this.getSrc())),e}})},getAutoIdPrefix:function(){return"g"},_createCacheImg:function(e){var t,r=Kekule.$document;return r&&r.body&&r.createElement&&((t=r.createElement("img")).src=e),t},_clearCacheImg:function(){var e=this.getPropStoreFieldValue("cacheImg");if(e){e.src="";try{delete e.width,delete e.height}catch(e){}}}})}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.ChemMarker={},ClassEx.extend(Kekule.ChemObject,{isAttachedMarker:function(){var e=this.getParent();return e&&e.hasMarker(this)},notifyAttachedMarkersChanged:function(){this.notifyPropSet("attachedMarkers",this.getPropStoreFieldValue("attachedMarkers"))},_attachedMarkerAdded:function(e){},_attachedMarkerRemoved:function(e){},getMarkerCount:function(){var e=this.getPropStoreFieldValue("attachedMarkers");return e?e.length:0},getMarkerAt:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return t?t[e]:null},getMarkerOfType:function(e,t){for(var r=0,n=this.getMarkerCount();r<n;++r){var o=this.getMarkerAt(r);if(t&&o.getClass()===e||o instanceof e)return o}return null},getMarkersOfType:function(e,t){for(var r=[],n=0,o=this.getMarkerCount();n<o;++n){var i=this.getMarkerAt(n);(t&&i.getClass()===e||i instanceof e)&&r.push(i)}return r},fetchMarkerOfType:function(e,t,r,n){var o=this.getMarkerOfType(e,r);if(!o&&t){(o=new e).beginUpdate();try{n&&o.setPropValues(n),this.appendMarker(o)}finally{o.endUpdate()}}return o},getUnplacedMarkers:function(e){for(var t=[],r=0,n=this.getMarkerCount();r<n;++r){var o=this.getMarkerAt(r);o.getCoordOfMode(e)||t.push(o)}return t},indexOfMarker:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return t?t.indexOf(e):-1},hasMarker:function(e){return this.indexOfMarker(e)>=0},hasMarkerOfType:function(e,t){return!!this.getMarkerOfType(e,t)},appendMarker:function(e){var t=this.indexOfMarker(e);if(t>=0)return t;var r=this.getAttachedMarkers(!0).push(e);e.beginUpdate();try{e.setOwner&&e.setOwner(this.getOwner()),e.setParent&&e.setParent(this),this._attachedMarkerAdded(e)}finally{e.endUpdate()}return this.notifyAttachedMarkersChanged(),r},insertMarkerBefore:function(e,t){var r=this.indexOfMarker(t);return this.insertMarkerAt(e,r)},insertMarkerAt:function(t,r){this.indexOfMarker(t);var n=this.getAttachedMarkers(!0);(Kekule.ObjUtils.isUnset(r)||r<0)&&(r=n.length);var o=e.insertUniqueEx(n,t,r);return o.isInserted&&(t.setOwner&&t.setOwner(this.getOwner()),t.setParent&&t.setParent(this),this._attachedMarkerAdded(t)),this.notifyAttachedMarkersChanged(),o.index},setMarkerIndex:function(e,t){var r=this.indexOfMarker(e);if(r>=0){var n=this.getPropStoreFieldValue("attachedMarkers");n.splice(r,1),n.splice(t,0,e)}},removeMarkerAt:function(e){var t=this.getMarkerAt(e);if(t){var r=this.getAttachedMarkers(!0).splice(e,1);return t.setOwner&&t.setOwner(null),t.setParent&&t.setParent(null),this._attachedMarkerRemoved(t),this.notifyAttachedMarkersChanged(),r}},removeMarker:function(e){var t=this.indexOfMarker(e);if(t>=0)return this.removeMarkerAt(t)},replaceMarker:function(e,t){var r=this.indexOfMarker(e);return r<0?this:(this.removeMarkerAt(r),this.insertMarkerAt(t,r),this)},clearMarkers:function(){var t=this.getPropStoreFieldValue("attachedMarkers");if(t&&(t=e.clone(t)),this.setPropStoreFieldValue("attachedMarkers",null),t)for(var r=0,n=t.length;r<n;++r){var o=t[r];o.setOwner&&o.setOwner(null),o.setParent&&o.setParent(null),this._attachedMarkerRemoved(o)}return this.notifyAttachedMarkersChanged(),this},autoSetMarker2DPos:function(e,t,r,n){if(this.hasMarker(e)){var o=Kekule.ChemStructureUtils.getMostEmptyDirection2DAngleOfObj(this,[e],r,!0,!1,n),i={x:t*Math.cos(o),y:t*Math.sin(o)};e.setCoord2D(i)}},_updateAttachedMarkersOwner:function(e){e||(e=this.getOwner());for(var t=0,r=this.getMarkerCount();t<r;++t){var n=this.getMarkerAt(t);n.setOwner&&n.setOwner(e)}},_updateAttachedMarkersParent:function(e){e||(e=this);for(var t=0,r=this.getMarkerCount();t<r;++t){var n=this.getMarkerAt(t);n.setParent&&n.setParent(e)}}}),ClassEx.extendMethod(Kekule.ChemObject,"ownerChanged",function($origin,e){$origin(e),this._updateAttachedMarkersOwner(e)}),ClassEx.extendMethod(Kekule.ChemObject,"removeChild",function($origin,e){var t=$origin(e);return t||(t=this.removeMarker(e)),t}),ClassEx.extendMethod(Kekule.ChemObject,"insertBefore",function($origin,e,t){var r=$origin(e,t);return r<0&&(t&&this.hasMarker(t)||e instanceof Kekule.ChemMarker.BaseMarker)&&(r=this.insertMarkerBefore(e,t)),r}),ClassEx.extendMethod(Kekule.ChemObject,"getChildSubgroupNames",function($origin){return $origin().concat("marker")}),ClassEx.defineProp(Kekule.ChemObject,"attachedMarkers",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLISHED,getter:function(e){var t=this.getPropStoreFieldValue("attachedMarkers");return!t&&e&&(t=[],this.setPropStoreFieldValue("attachedMarkers",t)),t},setter:function(e){this.clearMarkers(),this.setPropStoreFieldValue("attachedMarkers",e),this._updateAttachedMarkersOwner(),this._updateAttachedMarkersParent()}})}(),function(){"use strict";Kekule.ChemMarker.BaseMarker=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemMarker.BaseMarker",initialize:function(e,t,r){this.tryApplySuper("initialize",[e,t,r])},getAutoIdPrefix:function(){return"marker"},getAcceptCoordStickFrom:function(e){return!(this.isSiblingWith(e)||e instanceof Kekule.ChemStructureNode||e instanceof Kekule.BaseStructureConnector)}}),Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.ChemMarker.BaseMarker),Kekule.ChemMarker.UnbondedElectronSet=Class.create(Kekule.ChemMarker.BaseMarker,{CLASS_NAME:"Kekule.ChemMarker.UnbondedElectronSet",initProperties:function(){this.defineProp("electronCount",{dataType:DataType.VARIANT})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setElectronCount(2)},getAutoIdPrefix:function(){return"electron"}}),Kekule.ChemMarker.ChemPropertyMarker=Class.create(Kekule.ChemMarker.BaseMarker,{CLASS_NAME:"Kekule.ChemMarker.ChemPropertyMarker",initProperties:function(){this.defineProp("value",{dataType:DataType.VARIANT,serializable:!1,getter:function(){var e,t=this.getParent(),r=this.getPropertyName();return t&&r?(e=t.getPropValue(r),this.setPropStoreFieldValue("value",e)):e=this.getPropStoreFieldValue("value"),e},setter:function(e){this.setPropStoreFieldValue("value",e),this.setParentPropValue(e)}})},initPropValues:function(){this.tryApplySuper("initPropValues")},setParentPropValue:function(e){var t=this.getParent();if(t){var r=this.getPropertyName();r&&t&&t.setPropValue(r,e)}return this},resetParentPropValue:function(){return this.setParentPropValue(void 0)},getPropertyName:function(){return null},beforAddingByEditor:function(e,t){if(e){var r=this.getPropStoreFieldValue("value");Kekule.ObjUtils.notUnset(r)&&this.setParentPropValue(r)}this.tryApplySuper("beforAddingByEditor")},beforeRemovingByEditor:function(e){this.setPropStoreFieldValue("value",this.getValue()),this.resetParentPropValue()}}),Kekule.ChemMarker.Charge=Class.create(Kekule.ChemMarker.ChemPropertyMarker,{CLASS_NAME:"Kekule.ChemMarker.Charge",getPropertyName:function(){return"charge"},getAutoIdPrefix:function(){return"charge"}}),Kekule.ChemMarker.Radical=Class.create(Kekule.ChemMarker.ChemPropertyMarker,{CLASS_NAME:"Kekule.ChemMarker.Radical",getPropertyName:function(){return"radical"},getAutoIdPrefix:function(){return"radical"}}),ClassEx.extend(Kekule.ChemStructureNode,{fetchChargeMarker:function(e,t){return this.fetchMarkerOfType(Kekule.ChemMarker.Charge,e,!1,t)},fetchRadicalMarker:function(e,t){return this.fetchMarkerOfType(Kekule.ChemMarker.Radical,e,!1,t)}}),ClassEx.defineProp(Kekule.AbstractAtom,"lonePairCount",{dataType:DataType.INT,scope:Class.PropertyScope.PUBLISHED,serializable:!1,setter:null,getter:function(){for(var e=0,t=this.getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet),r=0,n=t.length;r<n;++r){2===t[r].getElectronCount()&&++e}return e}}),ClassEx.extendMethod(Kekule.AbstractAtom,"doCompare",function($origin,e,t){var r=$origin(e,t);if(!r&&t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&(this._getComparisonOptionFlagValue(t,"lonePair")||this._getComparisonOptionFlagValue(t,"unbondedElectron"))){var n=function(e){var t=[];if(e.getMarkersOfType)for(var r=e.getMarkersOfType(Kekule.ChemMarker.UnbondedElectronSet),n=0,o=r.length;n<o;++n){var i=r[n];t.push(i.getElectronCount())}return t.sort(),t},o=n(this),i=n(e);return Kekule.ArrayUtils.compare(o,i)}return r})}(),Kekule.TextLinesBuffer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TextLinesBuffer",LINEBREAK:"\n",initialize:function(e){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("lines",[]),e&&("string"==typeof e?this.setText(e):this.setLines(e)),this.setCurrLineNo(0)},initProperties:function(){this.defineProp("lines",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("text",{dataType:DataType.STRING,serializable:!1,getter:function(){return this.getLines().join(this.LINEBREAK)},setter:function(e){this.setPropStoreFieldValue("lines",[]),this.reset(),this.appendText(e)}}),this.defineProp("currLineNo",{dataType:DataType.INT,serializable:!1})},getUnreadLines:function(){var e=[].concat(this.getLines());return e.splice(0,this.getCurrLineNo()),e},getUnreadText:function(){return this.getUnreadLines().join(this.LINEBREAK)},appendText:function(e){var t=e.split(this.LINEBREAK);this.appendLines(t)},appendLines:function(e){this.setPropStoreFieldValue("lines",this.getLines().concat(e)),this.notifyPropSet("lines",this.getPropStoreFieldValue("lines"))},clear:function(){this.setLines([]),this.setCurrLineNo(0)},incCurrLineNo:function(e){null==e&&(e=1);var t=this.getCurrLineNo();t+=e,this.setCurrLineNo(t)},getLineAt:function(e){var t=this.getLines()[e];return t&&t.length&&"\r"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t},getCurrLine:function(){return this.getLineAt(this.getCurrLineNo())},readLine:function(){var e=this.getLineAt(this.getCurrLineNo());return this.incCurrLineNo(),e},writeLine:function(e){this.getLines().splice(this.getCurrLineNo(),0,e),this.incCurrLineNo()},writeLines:function(e){for(var t=0,r=e.length;t<r;++t)this.writeLine(e[t])},writeText:function(e){var t=e.split(this.LINEBREAK);this.writeLines(t)},eof:function(){return this.getCurrLineNo()>=this.getLines().length},reset:function(){this.setCurrLineNo(0)}}),function(){Kekule.globalOptions.add("IO",{}),Kekule.IO={},Kekule.IO.ChemDataType={TEXT:"text",DOM:"dom",JSON:"json",BINARY:"bin",OTHER:"other",UNKNOWN:"unknown",isBinaryType:function(e){var t=Kekule.IO.ChemDataType;return!e||e===t.BINARY||e===t.OTHER||e===t.UNKNOWN}},Kekule.IO.DataFormat={},Kekule.IO.MimeType={TEXT:"text/plain",HTML:"text/html",XML:"text/xml",JSON:"application/json",JAVASCRIPT:"application/javascript",GIF:"image/gif",JPEG:"image/jpeg",PNG:"image/png",XPNG:"image/x-png",OCTSTREAM:"application/octet-stream"},Kekule.IO.DataFormatsManager={_formats:{},register:function(t,r,n,o,i,a,s){var l=null;l||(l=e._formats[t]),l||(l={id:t},e._formats[t]=l),l.mimeType=r;var u=DataType.isArrayValue(n)?n:[n];return u=u.map(function(e){return e?e.toLowerCase():e}),l.fileExts?Kekule.ArrayUtils.pushUnique(l.fileExts,u):l.fileExts=u,o&&o!==Kekule.IO.ChemDataType.UNKNOWN&&(l.dataType=o),l.title=i,l.description=a,s&&(l=Object.extend(l,s)),l},unregister:function(t){e._formats[t]&&delete e._formats[t]},getAllIds:function(){return Kekule.ObjUtils.getOwnedFieldNames(e._formats)},getFormatInfo:function(t){return e._formats[t]||null},getMimeType:function(t){var r=e.getFormatInfo(t);return r?r.mimeType:null},getFileExts:function(t){var r=e.getFormatInfo(t);return r?r.fileExts:null},findFormat:function(t,r){if(!t&&!r)return null;for(var n=e.getAllIds(),o=!1,i=0,a=n.length;i<a;++i){var s=e.getFormatInfo(n[i]);if((o=t&&t===s.mimeType)||(o=r&&s.fileExts.indexOf(r.toLowerCase())>=0),o)return s}return null},findFormatId:function(e,t){var r=Kekule.IO.DataFormatsManager.findFormat(e,t);return r?r.id:null}};var e=Kekule.IO.DataFormatsManager;Kekule.IO.dataFormatsManager=Kekule.IO.DataFormatsManager,Kekule.IO.ChemDataReader=Class.create(ObjectEx,{initialize:function(e){this.tryApplySuper("initialize")},CLASS_NAME:"Kekule.IO.ChemDataReader",readData:function(e,t,r,n){if(!t){var o=Kekule.IO.DataFormatsManager.getFormatInfo(r);(t=o?o.dataType:null)||(t="string"==typeof e?Kekule.IO.ChemDataType.TEXT:e.getElementsByTagName?Kekule.IO.ChemDataType.DOM:Kekule.IO.ChemDataType.BINARY)}var i=this.doReadData(e,t,r,n||{});if(i instanceof Kekule.ChemObject&&i.getSrcInfo){var a=i.getSrcInfo();a.data=e,a.dataType=t;var s=Kekule.IO.DataFormatsManager.getFormatInfo(r);s&&(a.format=r,a.mimeType=s.mimeType,a.possibleFileExts=s.fileExts)}return i},doReadData:function(e,t,r,n){}}),Kekule.IO.ChemDataWriter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.ChemDataWriter",initialize:function(e){this.tryApplySuper("initialize")},writeData:function(e,t,r,n){if(!t){var o=Kekule.IO.DataFormatsManager.getFormatInfo(r);t=o?o.dataType:null}return this.doWriteData(e,t,r,n||{})},doWriteData:function(e,t,r,n){}}),Kekule.IO.ChemDataReaderManager={_readers:[],register:function(e,t,r,n){if(e&&t&&r&&(!DataType.isArrayValue(r)||r.length)){if(Kekule.IO.ChemDataReaderManager.getReaderInfoById(e))return Kekule.raise(Kekule.$L("ErrorMsg.READER_ID_ALREADY_EXISTS")),null;var o={id:e,readerClass:t,formatId:DataType.isArrayValue(r)?r:[r]};return o=Object.extend(o,n),Kekule.IO.ChemDataReaderManager._readers.push(o),o}},unregister:function(e){for(var t=-1,r=Kekule.IO.ChemDataReaderManager._readers,n=0,o=r.length;n<o;++n){if(r[n].id===e){t=n;break}}if(t>=0){var i=r[t];return r.splice(t,1),i}return null},getAllReadableFormatIds:function(){for(var e=[],t=Kekule.IO.ChemDataReaderManager._readers,r=0,n=t.length;r<n;++r){var o=t[r].formatId;Kekule.ArrayUtils.pushUnique(e,o)}return e},getAllReadableFormats:function(){for(var t=[],r=Kekule.IO.ChemDataReaderManager.getAllReadableFormatIds(),n=0,o=r.length;n<o;++n){var i=e.getFormatInfo(r[n]);i&&t.push(i)}return t},getAvailableReaderInfos:function(e){for(var t=[],r=Kekule.IO.ChemDataReaderManager._readers,n=r.length-1;n>=0;--n)Kekule.ObjUtils.match(r[n],e)&&t.push(r[n]);return t},getReaderInfo:function(e){for(var t=Kekule.IO.ChemDataReaderManager._readers,r=t.length-1;r>=0;--r)if(Kekule.ObjUtils.match(t[r],e))return t[r];return null},getReaderInfoById:function(e){return Kekule.IO.ChemDataReaderManager.getReaderInfo({id:e})},getReaderInfoByFormat:function(e,t){for(var r=Kekule.IO.ChemDataReaderManager._readers,n=r.length-1;n>=0;--n)if((!t||Kekule.ObjUtils.match(r[n],t))&&r[n].formatId.indexOf(e)>=0)return r[n];return null},getReaderInfoByFileExt:function(e,t){var r=Kekule.IO.DataFormatsManager.findFormatId(null,e);return r?Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(r,t):null},createReaderOfInfo:function(e){return new e.readerClass(e.createOptions)},getReaderOfInfo:function(e){return e.instance||(e.instance=Kekule.IO.ChemDataReaderManager.createReaderOfInfo(e)),e.instance},createReader:function(e){var t=Kekule.IO.ChemDataReaderManager.getReaderInfo(e);if(t)return Kekule.IO.ChemDataReaderManager.createReaderOfInfo(t)},getReader:function(e){var t=Kekule.IO.ChemDataReaderManager.getReaderInfo(e);if(t)return Kekule.IO.ChemDataReaderManager.getReaderOfInfo(t)},createReaderById:function(e){return Kekule.IO.ChemDataReaderManager.createReader({id:e})},getReaderById:function(e){return Kekule.IO.ChemDataReaderManager.getReader({id:e})},createReaderByFormat:function(e,t){var r=Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(e,t);return r?Kekule.IO.ChemDataReaderManager.createReaderOfInfo(r):null},getReaderByFormat:function(e,t){var r=Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(e,t);return r?Kekule.IO.ChemDataReaderManager.getReaderOfInfo(r):null},createReaderByFileExt:function(e,t){var r=Kekule.IO.ChemDataReaderManager.getReaderInfoByFileExt(e,t);return r?Kekule.IO.ChemDataReaderManager.createReaderOfInfo(r):null},getReaderByFileExt:function(e,t){var r=Kekule.IO.ChemDataReaderManager.getReaderInfoByFileExt(e,t);return r?Kekule.IO.ChemDataReaderManager.getReaderOfInfo(r):null},createReaderByMimeType:function(e){var t=Kekule.IO.DataFormatsManager.findFormatId(e,null);return t?Kekule.IO.ChemDataReaderManager.createReaderByFormat(t):null},getReaderByMimeType:function(e){var t=Kekule.IO.DataFormatsManager.findFormatId(e,null);return t?Kekule.IO.ChemDataReaderManager.getReaderByFormat(t):null}},Kekule.IO.ChemDataWriterManager={_writers:[],register:function(e,t,r,n,o){if(e&&t&&n&&(!DataType.isArrayValue(n)||n.length)){var i=Kekule.IO.ChemDataWriterManager.getWriterInfoById(e);if(i)return t===i.writerClass?(Kekule.ArrayUtils.pushUnique(i.srcClasses,r),Kekule.ArrayUtils.pushUnique(i.formatId,n),i):(Kekule.raise(Kekule.$L("ErrorMsg.WRITER_ID_ALREADY_EXISTS")),null);var a={id:e,writerClass:t,srcClasses:r,formatId:DataType.isArrayValue(n)?n:[n]};return a=Object.extend(a,o),Kekule.IO.ChemDataWriterManager._writers.push(a),a}},unregister:function(e){for(var t=-1,r=Kekule.IO.ChemDataWriterManager._writers,n=0,o=r.length;n<o;++n){if(r[n].id===e){t=n;break}}if(t>=0){var i=r[t];return r.splice(t,1),i}return null},getAllWritableFormatIds:function(){for(var e=[],t=Kekule.IO.ChemDataWriterManager._writers,r=0,n=t.length;r<n;++r){var o=t[r].formatId;Kekule.ArrayUtils.pushUnique(e,o)}return e},getAllWritableFormats:function(){for(var t=[],r=Kekule.IO.ChemDataWriterManager.getAllWritableFormatIds(),n=0,o=r.length;n<o;++n){var i=e.getFormatInfo(r[n]);i&&t.push(i)}return t},getAvailableWriterInfos:function(e,t){for(var r=[],n=ClassEx.isClass(t)?t:t.getClass?t.getClass():t?null:void 0,o=Kekule.IO.ChemDataWriterManager._writers,i=o.length-1;i>=0;--i)if(Kekule.ObjUtils.match(o[i],e))if(void 0!==n){if(n)for(var a=0,s=o[i].srcClasses.length;a<s;++a)ClassEx.isOrIsDescendantOf(n,o[i].srcClasses[a])&&r.push(o[i])}else r.push(o[i]);return r},getWriterInfo:function(e,t){for(var r=Kekule.IO.ChemDataWriterManager._writers,n=r.length-1;n>=0;--n)if(Kekule.ObjUtils.match(r[n],e)){if(t){for(var o=0,i=r[n].srcClasses.length;o<i;++o)if(t instanceof r[n].srcClasses[o])return r[n];return null}return r[n]}return null},getWriterInfoById:function(e,t){return Kekule.IO.ChemDataWriterManager.getWriterInfo({id:e},t)},getWriterInfoByFormat:function(e,t,r){for(var n=Kekule.IO.ChemDataWriterManager._writers,o=n.length-1;o>=0;--o)if((!t||Kekule.ObjUtils.match(n[o],t))&&n[o].formatId.indexOf(e)>=0){if(r){for(var i=0,a=n[o].srcClasses.length;i<a;++i)if(r instanceof n[o].srcClasses[i])return n[o];return null}return n[o]}return null},getWriterInfoByFileExt:function(e,t,r){var n=Kekule.IO.DataFormatsManager.findFormatId(null,e);return n?Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(n,t,r):null},createWriterOfInfo:function(e){return new e.writerClass(e.createOptions)},getWriterOfInfo:function(e){return e.instance||(e.instance=Kekule.IO.ChemDataWriterManager.createWriterOfInfo(e)),e.instance},createWriter:function(e,t){var r=Kekule.IO.ChemDataWriterManager.getWriterInfo(e,t);return r?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(r):null},getWriter:function(e,t){var r=Kekule.IO.ChemDataWriterManager.getWriterInfo(e,t);return r?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(r):null},createWriterById:function(e,t){return Kekule.IO.ChemDataWriterManager.createWriter({id:e},t)},getWriterById:function(e,t){return Kekule.IO.ChemDataWriterManager.getWriter({id:e},t)},createWriterByFormat:function(e,t,r){var n=Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,t,r);return n?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(n):null},getWriterByFormat:function(e,t,r){var n=Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,t,r);return n?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(n):null},createWriterByFileExt:function(e,t,r){var n=Kekule.IO.ChemDataWriterManager.getWriterInfoByFileExt(e,t,r);return n?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(n):null},getWriterByFileExt:function(e,t,r){var n=Kekule.IO.ChemDataWriterManager.getWriterInfoByFileExt(e,t,r);return n?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(n):null},createWriterByMimeType:function(e,t){var r=Kekule.IO.DataFormatsManager.findFormatId(e,null);return r?Kekule.IO.ChemDataWriterManager.createWriterByFormat(r,null,t):null},getWriterByMimeType:function(e){var t=Kekule.IO.DataFormatsManager.findFormatId(e,null);return t?Kekule.IO.ChemDataWriterManager.getWriterByFormat(t,null):null}},Kekule.IO.loadFormatData=function(e,t,r){var n=Kekule.IO.ChemDataReaderManager.getReaderByFormat(t);if(n){var o=n.readData(e,null,t,r);if(!1===o){var i=Kekule.$L("ErrorMsg.FAIL_TO_READ_FORMAT")+t;Kekule.raise(i)}return o}i=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FORMAT")+t;return Kekule.raise(i),null},Kekule.IO.loadMimeData=function(e,t,r){return Kekule.IO.loadTypedData(e,t,null,r)},Kekule.IO.loadTypedData=function(e,t,r,n){var o;r&&(o=Kekule.UrlUtils.extractFileExt(r));var i,a=Kekule.IO.DataFormatsManager.findFormatId(t||null,o);if(a&&(i=Kekule.IO.loadFormatData(e,a,n)),!1!==i){if(i instanceof Kekule.ChemObject&&i.getSrcInfo){var s=i.getSrcInfo();t&&(s.mimeType=t),o&&(s.fileExt=o),r&&(s.url=r,s.fileName=r)}return i}var l=t?Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_MIMETYPE")+t:Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+o;return Kekule.raise(l),null},Kekule.IO.loadFileData=function(e,t,r,n){if(Kekule.BrowserFeature.fileapi){var o,i=e.name,a=Kekule.UrlUtils.extractFileExt(i);if(!(o=r?Kekule.IO.DataFormatsManager.getFormatInfo(r):Kekule.IO.DataFormatsManager.findFormat(null,a))){var s=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+a;return void Kekule.raise(s)}var l=Kekule.IO.ChemDataType.isBinaryType(o.dataType),u=new FileReader;u.onload=function(e){var r=u.result,a=Kekule.IO.loadFormatData(r,o.id,n);a&&a.getSrcInfo&&(a.getSrcInfo().fileName=i);t(a,!1!==a,r)},l?u.readAsArrayBuffer(e):u.readAsText(e)}else Kekule.error(Kekule.$L("ErrorMsg.FILE_API_NOT_SUPPORTED"))},Kekule.IO.loadUrlData=function(e,t,r,n){if(!Kekule.Ajax)return Kekule.raise(Kekule.$L("ErrorMsg.AJAX_FILELOADER_NOT_FOUND")),null;Kekule.Ajax.sendRequest(e,function(o,i,a){if(o&&a){var s;if(r&&(s=Kekule.IO.DataFormatsManager.getFormatInfo(r)),!r){var l=Kekule.Ajax.getResponseMimeType(i);s=Kekule.IO.DataFormatsManager.findFormat(l)}if(!r){var u=Kekule.UrlUtils.extractFileExt(e);s=Kekule.IO.DataFormatsManager.findFormat(null,u)}if(!s){var c=Kekule.$L("ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT")+u;return void Kekule.raise(c)}var d=Kekule.IO.loadFormatData(o,s.id,n);d.getSrcInfo().fileName=e,t(d,a=!1!==d,o)}else Kekule.raise(Kekule.$L("ErrorMsg.FAIL_TO_LOAD_FILE_URL")+e)})},Kekule.IO.saveFormatData=function(e,t,r){var n=Kekule.IO.ChemDataWriterManager.getWriterByFormat(t,null,e);if(n)return n.writeData(e,null,t,r);var o=Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT")+t;return Kekule.raise(o),null},Kekule.IO.saveMimeData=function(e,t,r){return Kekule.IO.saveTypedData(e,t,null,r)},Kekule.IO.saveTypedData=function(e,t,r,n){var o;r&&((o=Kekule.UrlUtils.extractFileExt(r))||(o=r));var i,a=Kekule.IO.DataFormatsManager.findFormatId(t||null,o);if(a&&(i=Kekule.IO.saveFormatData(e,a,n)),Kekule.ObjUtils.isUnset(i)){var s=t?Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_MIMETYPE")+t:Kekule.$L("ErrorMsg.NO_SUITABLE_WRITER_FOR_FILEEXT")+o;return Kekule.raise(s),null}return i}}(),function(){"use strict";Kekule.globalOptions.add("IO.cml",{prettyPrint:!0,enableReadRootObjList:!0,defaultRootObjListHolder:Kekule.ChemSpace}),Kekule.IO.CML={CML2CORE_NAMESPACE_URI:"http://www.xml-cml.org/schema/cml2/core",CML3_SCHEMA_NAMESPACE_URI:"http://www.xml-cml.org/schema",ARRAY_VALUE_DELIMITER:" ",TYPED_ELEM_NAMES:["string","integer","float"],TYPED_ARRAY_ELEM_NAMES:["stringArray","integerArray","floatArray"],ATOMS_REF_ATTRIBS:["atomRef","atomRefs2","atomRefs3","atomRefs4","atomRefs","atomRefArray"],BONDS_REF_ATTRIBS:["bondRef","bondRefs","bondRefArray"],MOL_REF_ATTRIBS:["moleculeRef","moleculeRefs"],DEFAULT_VALUE_DELIMITER_PATTERN:/\s+/gm},Kekule.IO.CML.LEGAL_CORE_NAMESPACE_URIS=[Kekule.IO.CML.CML2CORE_NAMESPACE_URI,Kekule.IO.CML.CML3_SCHEMA_NAMESPACE_URI],Kekule.IO.CmlUtils={_cmlUnitConvMap:[["m","m","m",!0],["second","s","sec",!0],["hour","h","hr",!1],["kg","kg","kg",!0],["k","K","K",!0],["mol","mol","mol",!0],["candela","cd","cd",!0],["radian","rad","rad",!0],["steradian","sr","sr",!0],["hertz","Hz","Hz",!0],["newton","N","N",!0],["joule","J","J",!0],["watt","W","W",!0],["pascal","Pa","Pa",!0],["coulomb","C","C",!0],["volt","V","V",!0],["ampere","A","A",!0],["ohm","[Omega]","",!0],["farad","F","F",!0],["siemens","S","S",!0],["weber","Wb","Wb",!0],["tesla","T","T",!0],["henry","H","H",!0],["becquerel","Bq","Bq",!0],["gray","Gy","Gy",!0],["sievert","Sv","Sv",!0],["katal","kat","kat",!0],["molarity","_i_M__i_","mol/L",!0],["molality","_i_m__i_","mol/kg",!0],["m2","m2","m2",!0],["m3","m3","m3",!0],["m.s-1","m.s-1","m/s",!0],["m.s-2","m.s-2","ms-2",!0],["rad.s-1","rad.s-1","rad/s",!0],["n.s","N.s","Ns",!0],["n.m.s","N.m.s","Nms",!0],["n.m","N.m","Nm",!0],["m-1","m-1","m-1",!0],["kg.m-3","kg.m-3","kgm-3",!0],["kg-1.m3","kg-1.m3","kg-1m3",!0],["m-3.mol","m-3.mol","m-3mol",!0],["m3.mol-1","m3.mol-1","m3/mol",!0],["j.k-1","J.K-1","J/K",!0],["j.k-1.mol-1","J.K-1.mol-1","JK-1mol-1",!0],["j.k-1.kg-1","J.K-1.kg-1","JK-1kg-1",!0],["j.mol-1","J.mol-1","J/mol",!0],["j.kg-1","J.kg-1","J/kg",!0],["j.m-3","J.m-3","Jm-3",!0],["n.m-1","N.m-1 = J.m-2","N/m",!0],["w.m-2","W.m-2","Wm-2",!0],["w.m-1.k-1","W.m-1.K-1","Wm-1K-1",!0],["m2.s-1","m2.s-1","m2/s",!0],["pa.s","Pa.s","Pas",!0],["pa.s","N.s.m-2","Pas",!0],["c.m-3","C.m-3","Cm-3",!0],["a.m-2","A.m-2","Am-2",!0],["s.m-1","S.m-1","S/m",!0],["s.m2.mol-1","S.m2.mol-1","Sm2/mol",!0],["f.m-1","F.m-1","F/m",!0],["h.m-1","H.m-1","H/m",!0],["v.m-1","V.m-1","V/m",!0],["a.m-1","A.m-1","A/m",!0],["cd.m-2","cd.m-2","cdm-2",!0],["c.kg-1","C.kg-1","C/kg",!0],["gy.s-1","Gy.s-1","Gy/s",!0],["j.m-1","J.m-1","J/m",!0],["ang","[Aring]","",!1],["deg","[deg]","deg",!1],["ang3","A3","3",!1],["celsius","[deg]C","",!1],["debye","D","D",!1],["electron","e","e",!1],["hartree","hart","hart",!1],["gpa","GPa","GPa",!1],["gpa-1","GPa-1","GPa-1",!1],["atmosphere","atm","atm",!1],["kcal.mol-1.ang-1","kcal mol-1 ang-1","kcalmol-1ang-1",!1],["kj.mol-1","kj mol-1","kj/mol",!1],["l","L","L",!1],["ml","mL","mL",!1],["kcal.ang-1","kcal.ang-1","kcal/",!1],["kcal.rad-1","kcal.rad-1","kcal/rad",!1],["ph","pH","pH",!1],["centipoise","cp","cp",!1],["km.s-1","km/s","km/s",!1],["arbitrary","arb","arb",!1]],tryParseFloat:function(e){var t=parseFloat(e);return Kekule.NumUtils.isNormalNumber(t)?t:e},convertSimpleValueByDataType:function(e,t,r){var n;switch(t){case"xsd:boolean":n=Kekule.StrUtils.strToBool(e);break;case"xsd:float":case"xsd:double":case"xsd:duration":case"xsd:decimal":n=parseFloat(e);break;case"xsd:integer":case"xsd:nonPositiveInteger":case"xsd:negativeInteger":case"xsd:long":case"xsd:int":case"xsd:short":case"xsd:byte":case"xsd:nonNegativeInteger":case"xsd:unsignedLong":case"xsd:unsignedInt":case"xsd:unsignedShort":case"xsd:unsignedByte":case"xsd:positiveInteger":n=parseInt(e);break;default:n=e}return n},getCmlTypeForDataType:function(e){return e==DataType.INT?"xsd:integer":e==DataType.FLOAT?"xsd:float":e==DataType.BOOL?"xsd:boolean":null},cmlNsTokenToKekule:function(e){return e.replace(/\:/g,".")},kekuleNsTokenToCml:function(e){return e.replace(/\./g,":")},getCmlNsValueDetails:function(e){var t=e.indexOf(":");return{namespace:t>=0?e.substring(0,t):"",localName:t>=0?e.substr(t+1):e}},getCmlNsValueLocalPart:function(e){var t=e.indexOf(":");return t>=0?e.substr(t+1):e},cmlUnitStrToMetricsUnitSymbol:function(e){for(var t,r,n=Kekule.IO.CmlUtils.getCmlNsValueLocalPart(e),o=n.toLowerCase(),i=o.length>3&&o.endsWith("s")?o.substr(0,o.length-1):null,a=(Kekule.Unit,Kekule.IO.CmlUtils._cmlUnitConvMap),s=0,l=a.length;s<l;++s)if(n===a[s][0]||n===a[s][1]){t=a[s][2];break}if(!t)for(s=0,l=a.length;s<l;++s)if(o===a[s][0].toLowerCase()||o===a[s][1].toLowerCase()){t=a[s][2];break}if(!t&&i)for(s=0,l=a.length;s<l;++s)if(i===a[s][0].toLowerCase()||i===a[s][1].toLowerCase()){t=a[s][2];break}t||(t=(r=Kekule.Unit.getUnit(n,!0))&&r.symbol);t||(t=(r=Kekule.Unit.getUnitByName(n,!0))&&r.symbol);!t&&i&&(t=(r=Kekule.Unit.getUnitByName(i,!0))&&r.symbol);return t||n},metricsUnitSymbolToCmlUnitStr:function(e){for(var t,r=Kekule.IO.CmlUtils._cmlUnitConvMap,n=0,o=r.length;n<o;++n){var i=r[n];if(e===i[2]){t=(i[3]?"siUnits:":"units:")+i[0];break}}return t||(t="units:"+e),t},cmlBondOrderToKekule:function(e){var t=parseInt(e);if(t!=t)switch(e.toUpperCase()){case"A":t=Kekule.BondOrder.EXPLICIT_AROMATIC;break;case"D":t=Kekule.BondOrder.DOUBLE;break;case"T":t=Kekule.BondOrder.TRIPLE;break;case"S":default:t=Kekule.BondOrder.SINGLE}return t},kekuleBondOrderToCml:function(e){switch(e){case Kekule.BondOrder.EXPLICIT_AROMATIC:return"A";case Kekule.BondOrder.QUAD:return"4";case Kekule.BondOrder.DOUBLE:return"D";case Kekule.BondOrder.TRIPLE:return"T";default:return"S"}},cmlBondStereoToKekule:function(e){var t;switch(e.toUpperCase()){case"E":t=Kekule.BondStereo.E;break;case"Z":t=Kekule.BondStereo.Z;break;case"C":t=Kekule.BondStereo.CIS;break;case"T":t=Kekule.BondStereo.TRANS;break;case"W":t=Kekule.BondStereo.UP;break;case"H":t=Kekule.BondStereo.DOWN;break;default:t=Kekule.BondStereo.NONE}return t},kekuleBondStereoToCml:function(e){switch(e){case Kekule.BondStereo.UP:return{value:"W"};case Kekule.BondStereo.UP_INVERTED:return{value:"W",invert:!0};case Kekule.BondStereo.DOWN:return{value:"H"};case Kekule.BondStereo.DOWN_INVERTED:return{value:"H",invert:!0};case Kekule.BondStereo.E:return{value:"E"};case Kekule.BondStereo.Z:return{value:"Z"};case Kekule.BondStereo.CIS:return{value:"C"};case Kekule.BondStereo.TRANS:return{value:"T"};default:return{value:null}}},reagentRoleToKekule:function(e){var t=Kekule.ReactionRole;switch(e){case"reagent":return t.REAGENT;case"catalyst":case"solvent":return t.CATALYST;default:return e}},kekuleReagentRoleToCml:function(e){var t=Kekule.ReactionRole;switch(e){case t.REAGENT:return"reagent";case t.CATALYST:return"catalyst";case t.SOLVENT:return"solvent";default:return e}},isDummyElementType:function(e){return"Du"==e||"Dummy"==e},isRGroupElementType:function(e){return"R"==e},isAtomListElementType:function(e){return"L"==e},getNodeElementType:function(e){if(e instanceof Kekule.Atom)return e.getSymbol();if(!(e instanceof Kekule.Pseudoatom))return e instanceof Kekule.VariableAtom?"R":e instanceof Kekule.StructureFragment?"R":e.getSymbol?e.getSymbol():"*";switch(e.getAtomType()){case Kekule.PseudoatomType.DUMMY:return"Du";case Kekule.PseudoatomType.ANY:return"A";case Kekule.PseudoatomType.HETERO:return"Q";case Kekule.PseudoatomType.CUSTOM:default:return e.getSymbol()}},createNodeByCmdElementType:function(e,t,r){return Kekule.IO.CmlUtils.isDummyElementType(t)?new Kekule.Pseudoatom(e,Kekule.PseudoatomType.DUMMY):Kekule.IO.CmlUtils.isRGroupElementType(t)?new Kekule.RGroup(e):Kekule.IO.CmlUtils.isAtomListElementType(t)?new Kekule.VariableAtom(e):Kekule.Element.isElementSymbolAvailable(t)||t==Kekule.Element.UNSET_ELEMENT?new Kekule.Atom(e,t,Math.round(r)):new Kekule.Pseudoatom(e,Kekule.PseudoatomType.CUSTOM,t)}};var e=Kekule.IO.CmlUtils;Kekule.IO.CmlDomUtils={splitCmlArrayValue:function(e){return"object"==typeof e&&e.length?e:Kekule.StrUtils.normalizeSpace(Kekule.StrUtils.trim(e)).split(Kekule.IO.CML.ARRAY_VALUE_DELIMITER)},mergeToCmlArrayValue:function(e){return e.join(" ")},analysisCmlFormulaConciseValue:function(e){for(var t,r=Kekule.IO.CmlDomUtils.splitCmlArrayValue(e),n=0,o=r.length,i=[],a=null;n<o;){var s=r[n],l=parseFloat(s);l!=l?(a&&i.push(a),a={elementType:s}):a?(a.count=l,i.push(a),a=null):n==o-1&&(t=l),++n}return{isotopes:i,formalCharge:t}},getCmlBuiltinElemInfo:function(e,t,r){var n=e.getAttribute("builtin");return!n&&t&&(e.getAttributeNS?n=e.getAttributeNS(t,"builtin"):r&&(n=r.getAttributeNS(t,"builtin",e))),n?{name:n,value:Kekule.DomUtils.getElementText(e)}:null},readCmlTypedPropertyElem:function(e,t,r){var n;if(!(n=e.getAttribute("builtin"))&&t&&(e.getAttributeNS?n=e.getAttributeNS(t,"builtin"):r&&(n=r.getAttributeNS(t,"builtin",e))),n){var o=Kekule.DomUtils.getElementText(e);switch(Kekule.DomUtils.getLocalName(e)){case"float":o=parseFloat(o);break;case"integer":o=parseInt(o)}return{name:n,value:o}}return null},readCmlTypedPropertyArrayElem:function(e,t,r){var n;if(!(n=e.getAttribute("builtin"))&&t&&(e.getAttributeNS?n=e.getAttributeNS(t,"builtin"):r&&(n=r.getAttributeNS(t,"builtin",e))),n){var o=Kekule.DomUtils.getElementText(e),i=Kekule.IO.CmlDomUtils.splitCmlArrayValue(o);switch(Kekule.DomUtils.getLocalName(e)){case"float":for(var a=0,s=i.length;a<s;++a)i[a]=parseFloat(i[a]);break;case"integer":for(a=0,s=i.length;a<s;++a)i[a]=parseInt(i[a])}return{name:n,values:i}}return null},hasDirectCmlTypedElemChildren:function(e,t){for(var r=0,n=Kekule.IO.CML.TYPED_ELEM_NAMES.length;r<n;++r){var o=Kekule.IO.CML.TYPED_ELEM_NAMES[r];if(Kekule.DomUtils.getDirectChildElems(e,null,o,t).length>0)return!0}return!1},hasDirectCmlTypedArrayElemChildren:function(e,t){for(var r=0,n=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES.length;r<n;++r){var o=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES[r];if(Kekule.DomUtils.getDirectChildElems(e,null,o,t).length>0)return!0}return!1},isCmlTypedElem:function(e,t){var r=Kekule.IO.CML.TYPED_ELEM_NAMES.indexOf(Kekule.DomUtils.getLocalName(e))>=0;return t&&(r=r&&e.namespaceURI==t),r},isCmlTypedArrayElem:function(e,t){var r=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES.indexOf(Kekule.DomUtils.getLocalName(e))>=0;return t&&(r=r&&e.namespaceURI==t),r},isCmlBuiltInMarkedElem:function(e,t){var r=Kekule.DomUtils.hasAttribute(e,"builtin");return t&&r&&(r=e.namespaceURI===t),r},FILTER_TYPED_ELEM:1,FILTER_TYPEDARRAY_ELEM:2,FILTER_ALL:3,getCmlTypedElem:function(e,t,r){var n=e.namespaceURI,o=Kekule.DomUtils.getDirectChildElemsOfAttribValues(e,[{builtin:t}],null,null,n);if(o&&o.length>0)for(var i=o.length-1;i>=0;--i){if(r&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedElem(o[i],n))return o[i];if(r&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(o[i],n))return o[i]}return null},getCmlTypedElems:function(e,t,r){var n=[],o=e.namespaceURI,i=Kekule.DomUtils.getDirectChildElemsOfAttribValues(e,[{builtin:t}],null,null,o);if(i&&i.length>0)for(var a=i.length-1;a>=0;--a)r&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedElem(i[a],o)?n.push(i[a]):r&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(i[a],o)&&n.push(i[a]);return n.length?n:null},getCmlTypedElemValue:function(e,t,r,n){r||(r=Kekule.IO.CmlDomUtils.FILTER_ALL);var o=Kekule.IO.CmlDomUtils.getCmlTypedElem(e,t,r);if(o)return Kekule.DomUtils.getElementText(o)},getMultipleCmlTypedElemValues:function(e,t,r,n){r||(r=Kekule.IO.CmlDomUtils.FILTER_ALL);var o=Kekule.IO.CmlDomUtils.getCmlTypedElems(e,t,r);if(o){for(var i=[],a=0,s=o.length;a<s;++a)i.push(Kekule.DomUtils.getElementText(o[a]));return i}return null},getCmlElemAttribute:function(e,t,r,n){r||(r=Kekule.IO.CmlDomUtils.FILTER_ALL);var o=Kekule.DomUtils.getSameNSAttributeValue(e,t,n);return o||(o=Kekule.IO.CmlDomUtils.getCmlTypedElemValue(e,t,r,n)),o},getMultipleCmlElemAttribute:function(e,t,r,n){r||(r=Kekule.IO.CmlDomUtils.FILTER_ALL);var o=Kekule.DomUtils.getSameNSAttributeValue(e,t,n);return o||(o=Kekule.IO.CmlDomUtils.getMultipleCmlTypedElemValues(e,t,r,n)),o},setCmlElemAttribute:function(e,t,r,n){return Kekule.DomUtils.setSameNSAttributeValue(e,t,r,n)},fetchCmlElemAttributeValuesToJson:function(e,t,r,n){t||(t=Kekule.IO.CmlDomUtils.FILTER_ALL);for(var o=e.namespaceURI,i=Kekule.DomUtils.fetchAttributeValuesToJson(e,o,!0),a=Kekule.DomUtils.getDirectChildElems(e,null,null,o),s=0,l=a.length;s<l;++s){var u=a[s];if(t&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM&&(Kekule.IO.CmlDomUtils.isCmlTypedElem(u,o)||Kekule.IO.CmlDomUtils.isCmlBuiltInMarkedElem(u,o)))(c=Kekule.IO.CmlDomUtils.readCmlTypedPropertyElem(u,o,n))&&(i[c.name]&&r?i[c.name]+=Kekule.IO.CML.ARRAY_VALUE_DELIMITER+c.value:i[c.name]=c.value);else if(t&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(u,o)){var c;(c=Kekule.IO.CmlDomUtils.getCmlBuiltinElemInfo(u,o,n))&&(i[c.name]&&r?i[c.name]+=Kekule.IO.CML.ARRAY_VALUE_DELIMITER+c.value:i[c.name]=c.value)}}return i},isScalarElem:function(e,t){var r="scalar"==Kekule.DomUtils.getLocalName(e);return t&&(r=r&&e.namespaceURI==t),r},getCmlId:function(e,t){return Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"id",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,t)},setCmlId:function(e,t,r){return Kekule.IO.CmlDomUtils.setCmlElemAttribute(e,"id",t,r)},getCmlTitle:function(e,t){return Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"title",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,t)},setCmlTitle:function(e,t,r){return Kekule.IO.CmlDomUtils.setCmlElemAttribute(e,"title",t,r)}};var t=Kekule.IO.CmlDomUtils;Kekule.IO.CmlElementReaderFactory={_readers:{},register:function(e,t){if(Kekule.ArrayUtils.isArray(e))for(var r=0,n=e.length;r<n;++r)Kekule.IO.CmlElementReaderFactory.register(e[r],t);else Kekule.IO.CmlElementReaderFactory._readers[e.toLowerCase()]=t},getReader:function(e){var t;t="string"!=typeof e?Kekule.DomUtils.getLocalName(e):e;var r=Kekule.IO.CmlElementReaderFactory._readers[t.toLowerCase()];return r?new r:null}},Kekule.IO.CmlElementWriterFactory={_writers:{},register:function(e,t){if(Kekule.ArrayUtils.isArray(e))for(var r=0,n=e.length;r<n;++r)Kekule.IO.CmlElementWriterFactory.register(e[r],t);else Kekule.IO.CmlElementWriterFactory._writers[e]=t},getWriter:function(e){var t;t="string"!=typeof e?DataType.getType(e):e;var r=Kekule.IO.CmlElementWriterFactory._writers[t];if(!r&&e.getClassName)for(var n=e,o=Kekule.ObjUtils.getOwnedFieldNames(Kekule.IO.CmlElementWriterFactory._writers),i=o.length-1;i>=0;--i){var a=ClassEx.findClass(o[i]);if(a&&n instanceof a){r=Kekule.IO.CmlElementWriterFactory._writers[o[i]];break}}return r?new r:null}},Kekule.IO.CmlElementHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.CmlElementHandler",initialize:function(){this.tryApplySuper("initialize"),this._childHandlers=[]},doFinalize:function(){for(var e=this._childHandlers.length-1;e>=0;--e){var t=this._childHandlers[e];t&&t.finalize&&t.finalize()}this.tryApplySuper("doFinalize")},initProperties:function(){this.defineProp("domHelper",{dataType:"Kekule.DomHelper",serializable:!1,getter:function(){return this.getPropStoreFieldValue("domHelper")||this.setPropStoreFieldValue("domHelper",new Kekule.DomHelper),this.getPropStoreFieldValue("domHelper")}}),this.defineProp("coreNamespaceURI",{dataType:DataType.STRING,serializable:!1}),this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:!1}),this.defineProp("rootEvoker",{dataType:DataType.Object,serializable:!1})},getPrefixForNamespaceUri:function(e){var t=this.getNamespaces();if(t)for(var r=0,n=t.length;r<n;++r)if(t[r].namespaceURI===e)return t[r].prefix},matchCoreNamespace:function(e){var t;return t=e?"string"!=typeof e?e.namespaceURI:e:"",!this.getCoreNamespaceURI()&&!t||this.getCoreNamespaceURI()&&this.getCoreNamespaceURI()==t},copySettingsToChildHandler:function(e){e.setDomHelper(this.getDomHelper()),e.setCoreNamespaceURI(this.getCoreNamespaceURI()),e.setNamespaces(this.getNamespaces()),e.setRootEvoker(this.getRootEvoker())},_appendChildHandler:function(e){Kekule.ArrayUtils.pushUnique(this._childHandlers,e)},_iterateChildHandlers:function(e,t,r){if(e)for(var n=0,o=this._childHandlers.length;n<o;++n){var i=this._childHandlers[n];i&&(e.apply(t,[i]),r&&i._iterateChildHandlers&&i._iterateChildHandlers(e,t,r))}}}),Kekule.IO.CmlElementReader=Class.create(Kekule.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementReader",readElement:function(e,t,r,n){var o=this.doReadElement(e,t,r,n);if(o&&o.getId&&!o.getId()&&o.setId){var i=Kekule.IO.CmlDomUtils.getCmlId(e,this.getDomHelper);i&&this.setObjId(o,i)}return o},doReadElement:function(e,t,r,n){},readChildElement:function(e,t,r){return this.doReadChildElement(e,t,r)},doReadChildElement:function(e,t,r){return this.doReadChildElementDef(e,t,r)},readChildElementDef:function(e,t,r){return this.doReadChildElementDef(e,t,r)},doReadChildElementDef:function(e,t,r){var n=this.doGetChildElementReader(e,t,r);if(!n)return null;try{return n.readElement(e,t,r)}finally{}},doGetChildElementReader:function(e,t,r){var n=Kekule.IO.CmlElementReaderFactory.getReader(e);return n&&(this.copySettingsToChildHandler(n),this._appendChildHandler(n)),n},iterateChildElements:function(e,t,r,n){for(var o=[],i=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),a=0,s=i.length;a<s;++a){var l=this.readChildElement(i[a],t,r);l&&(o.push({element:i[a],result:l}),n&&n(i[a],l,t,r))}return o},doneReadingDocument:function(e){this.doDoneReadingDocument(),e&&this._iterateChildHandlers(function(t){t&&t.doneReadingDocument&&t.doneReadingDocument(e)})},doDoneReadingDocument:function(){},getLoadedObjById:function(e){var t=this.getRootEvoker();return t&&t.getLoadedObjById&&t.getLoadedObjById(e)},setObjIdMapValue:function(e,t){var r=this.getRootEvoker();r.setObjIdMapValue&&r.setObjIdMapValue(e,t)},setObjId:function(e,t){e.setId&&e.setId(t);var r=e.getId&&e.getId();r&&this.setObjIdMapValue(r,e)},_createChildObjsHolder:function(e,t){for(var r=new t,n=0,o=e.length;n<o;++n)r.appendChild(e[n]);return r}}),Kekule.IO.CmlElementWriter=Class.create(Kekule.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementWriter",writeObject:function(e,t,r){if(!t&&!n)return Kekule.error(Kekule.$L("ErrorMsg.CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT")),null;var n=t.ownerDocument;this.getDomHelper().getDocument!=n&&this.getDomHelper().setDocument(n);var o=this.doCreateElem(e,t,n);o?t.appendChild(o):o=t;var i=this.doWriteObject(e,o,r)||o;return i&&e&&(this.writeObjId(e,i),this.writeObjAdditionalInfo(e,i,r)),i},writeObjId:function(e,t){if(e.getId){var r=e.getId();!r&&e.setId&&(r=this.autoIdentifyForObj(e)),Kekule.IO.CmlDomUtils.setCmlId(t,r,this.getDomHelper())}},autoIdentifyForObj:function(e){return e.getId&&!e.getId()&&e.setId&&(e.getOwner&&e.getOwner()&&e.getOwner().getAutoId?e.setId(e.getOwner().getAutoId(e)):e.setId(this.getAutoIdForObj(e))),e.getId&&e.getId()},getAutoIdForObj:function(e){var t=e.getAutoIdPrefix?e.getAutoIdPrefix():"obj";return Kekule.IO.CmlElementWriter._UID_SEED||(Kekule.IO.CmlElementWriter._UID_SEED=(new Date).getTime()),++Kekule.IO.CmlElementWriter._UID_SEED,""+t+Kekule.IO.CmlElementWriter._UID_SEED.toString()},writeScalarAttribs:function(e,t,r){if(e.getScalarAttribs){var n=this.doGetChildObjectWriter("Kekule.Scalar");if(n)for(var o=0,i=e.getScalarAttribCount();o<i;++o)n.writeObject(e.getScalarAttribAt(o),t,r)}},writeObjInfoValues:function(e,t,r){if(e.getInfo){var n,o=this.getObjInfoKeysNeedToSaveToMetaList(e);if(!o||!o.length)return;for(var i=0,a=o.length;i<a;++i){var s=o[i],l=e.getInfoValue(o[i]);s&&l&&!Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,s,this.getDomHelper())&&(n||(n=this.getOrCreateChildElem("metaDataList",t)),this.doWriteObjInfoValueItem(s,l,e,n,r))}}},doWriteObjInfoValueItem:function(e,t,r,n,o){return this.writeObjMetaValueToListElem(r,e,null,t,n)},writeObjMetaValueToListElem:function(e,t,r,n,o,i,a){i||(i="metaData");var s=this.createChildElem(i,o);return Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"name",t,this.getDomHelper()),Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"content",DataType.StringUtils.serializeValue(r),this.getDomHelper()),n&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(s,"metadataType",n,this.getDomHelper()),s},getObjInfoKeysNeedToSaveToMetaList:function(e){return e.getInfoKeys?e.getInfoKeys():null},writeObjAdditionalInfo:function(e,t,r){this.writeScalarAttribs(e,t,r),this.writeObjInfoValues(e,t,r)},doCreateElem:function(e,t){},createChildElem:function(e,t,r){var n=r||this.getCoreNamespaceURI(),o=this.getDomHelper().createElementNS(n,e);return t&&t.appendChild(o),o},getOrCreateChildElem:function(e,t,r){var n=this.getDomHelper().getElementsByTagNameNS(r,e,t)[0];return n||(n=this.createChildElem(e,t,r)),n},doWriteObject:function(e,t,r){},doGetChildObjectWriter:function(e,t,r){var n=Kekule.IO.CmlElementWriterFactory.getWriter(e);return n&&(this.copySettingsToChildHandler(n),this._appendChildHandler(n)),n},reportTypeMismatchError:function(e){Kekule.error(Kekule.$L("ErrorMsg.CML_ELEM_WRITER_TYPE_INPROPER").format(this.getClassName(),DataType.getType(e)))},addNamespace:function(e,t,r,n){this.getDomHelper().addNamespace(e,t,r,n)},addNamespaces:function(e,t,r){for(var n=0,o=t.length;n<o;++n)this.addNamespace(e,t[n].prefix,t[n].namespaceURI,r)},doneWritingDocument:function(e){this.doDoneWritingDocument(),e&&this._iterateChildHandlers(function(t){t&&t.doneWritingDocument&&t.doneWritingDocument(e)})},doDoneWritingDocument:function(){}}),Kekule.IO.CmlBaseListReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlBaseListReader",doReadElement:function(e,t,r,n){var o=this.doCreateList(e);return o=this.doReadList(o,e,t,r,this.getDomHelper())},doCreateList:function(e){return[]},doAppendObjToList:function(e,t){return t&&t.push&&t.push(e),t},doReadChildElem:function(e,t,r,n,o){return t.readElement(e,o,this)},doReadList:function(e,t,r,n,o){var i=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI());if(i)for(var a=0,s=i.length;a<s;++a){var l=i[a],u=this.doGetChildElementReader(l,r,this);if(u){var c=this.doReadChildElem(l,u,r,n,e);c&&this.doAppendObjToList(c,e)}}return e}}),Kekule.IO.CmlBaseListWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlBaseListWriter",doCreateElem:function(e,t){var r=this.doGetListElemTagName(e,t);return r?this.createChildElem(r,t):null},doGetListElemTagName:function(e,t){return"list"},doWriteObject:function(e,t,r){var n=Kekule.ChemStructureUtils.getChildStructureObjs(e,!1);return this.writeList(n,t,r)},writeList:function(e,t,r){for(var n=0,o=e.length;n<o;++n){var i=e[n];if(i){var a=this.doGetChildObjectWriter(i);a&&a.writeObject(i,t,r)}}return t}}),Kekule.IO.CmlNameReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlNameReader",initialize:function(){this.tryApplySuper("initialize")},doReadElement:function(e,t,r,n){var o=Kekule.DomUtils.getElementText(e),i=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"convention");if(o){var a={};return a.name=o,i?a.convention=i:t&&t.setName&&t.setName(o),a}return null}}),Kekule.IO.CmlScalarReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlScalarReader",doReadElement:function(e,t,r,n){var o=this.readScalar(e);return t&&t.appendScalarAttrib&&t.appendScalarAttrib(o),o},readScalar:function(e){var t,r=Kekule.DomUtils.fetchAttributeValuesToJson(e,this.getCoreNamespaceURI(),!0);if((s=Kekule.DomUtils.getElementText(e))&&(r.value=s),r.value&&(r.dataType?(r.value=Kekule.IO.CmlUtils.convertSimpleValueByDataType(r.value,r.dataType),r.errorValue&&(r.errorValue=Kekule.IO.CmlUtils.convertSimpleValueByDataType(r.errorValue,r.dataType,!0))):r.value=Kekule.IO.CmlUtils.tryParseFloat(r.value)),r){t=new Kekule.Scalar;for(var n=Kekule.ObjUtils.getOwnedFieldNames(r),o=0,i=n.length;o<i;++o){var a=n[o],s=r[a];switch(a){case"value":t.setValue(s);break;case"errorValue":t.setErrorValue(s);break;case"units":t.setUnit(Kekule.IO.CmlUtils.cmlUnitStrToMetricsUnitSymbol(s));break;case"title":t.setTitle(s);break;case"dictRef":t.setName(Kekule.IO.CmlUtils.cmlNsTokenToKekule(s)),t.setInfoValue("dictRef",s);break;default:t.setInfoValue(a,s)}}}return t}}),Kekule.IO.CmlScalarWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlScalarWriter",doCreateElem:function(e,t){return this.createChildElem("scalar",t)},doWriteObject:function(t,r,n){if(!(t instanceof Kekule.Scalar))return this.reportTypeMismatchError(t),null;var o;if(Kekule.ObjUtils.isUnset(t.getValue())||(Kekule.DomUtils.setElementText(r,t.getValue()),o=DataType.getType(t.getValue())),t.getName()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"dictRef",Kekule.IO.CmlUtils.kekuleNsTokenToCml(t.getName()),this.getDomHelper()),t.getErrorValue()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"errorValue",t.getErrorValue(),this.getDomHelper()),t.getUnit()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"units",Kekule.IO.CmlUtils.metricsUnitSymbolToCmlUnitStr(t.getUnit()),this.getDomHelper()),t.getTitle()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"title",t.getTitle(),this.getDomHelper()),o){var i=e.getCmlTypeForDataType(o);i&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(r,"datatype",i,this.getDomHelper())}}}),Kekule.IO.CmlArrayReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlArrayReader",initProperties:function(){this.defineProp("expandSteppedArray",{dataType:DataType.BOOL,serializable:!1}),this.defineProp("defaultItemDataType",{dataType:DataType.STRING,serializable:!1})},doReadElement:function(e,t,r,n){return this.readArray(e)},readArray:function(e){var t=Kekule.DomUtils.fetchAttributeValuesToJson(e,this.getCoreNamespaceURI(),!0);if(t.size&&(t.size=parseInt(t.size)),Kekule.ObjUtils.notUnset(t.start)&&Kekule.ObjUtils.notUnset(t.end))t.start=parseFloat(t.start),t.end=parseFloat(t.end),t.stepSize&&(t.stepSize=parseFloat(t.stepSize)),!t.size&&t.stepSize?t.size=Math.round(Math.abs((arrayJson.end-arrayJson.start)/t.stepSize)):t.size&&!t.stepSize&&(t.stepSize=(t.end-t.start)/t.size);else{var r=Kekule.DomUtils.getElementText(e);t.values=this._generateExplicitArray(t,r)}return t},_generateSteppedArray:function(e){var t=null;if(this.getExpandSteppedArray()){var r=e.size,n=e.stepSize,o=e.start;t=[o];for(var i=0;i<r;++i){if((o+=n)>e.end){t.push(e.end);break}t.push(o)}}return t},_generateExplicitArray:function(e,t){var r=!!e.delimiter,n=r?e.delimiter:Kekule.IO.CML.DEFAULT_VALUE_DELIMITER_PATTERN,o=t.split(n);r&&(o.shift(),o.pop());for(var i=e.dataType||this.getDefaultItemDataType(),a=[],s=0,l=o.length;s<l;++s){var u=o[s].trim();!r&&u&&(i?a.push(Kekule.IO.CmlUtils.convertSimpleValueByDataType(u,i)):a.push(u))}return a}}),Kekule.IO.CmlArrayWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlArrayWriter",DEF_TAGNAME:"array",DEF_DELIMITER:" ",initProperties:function(){this.defineProp("defaultItemDataType",{dataType:DataType.STRING,serializable:!1}),this.defineProp("defaultItemDataUnit",{dataType:DataType.STRING,serializable:!1})},getArrayTagName:function(){return this.DEF_TAGNAME},getDefaultArrayValueDelimiter:function(){return this.DEF_DELIMITER},doCreateElem:function(e,t){return this.createChildElem(this.getArrayTagName(),t)},doWriteObject:function(e,t,r){var n;if(DataType.isObjectValue(e))n=Object.extend({},e);else{if(!DataType.isArrayValue(e))return this.reportTypeMismatchError(e),null;n={values:e}}return n=Object.extend(n,{unit:n.unit||r.unit||this.getDefaultItemDataUnit(),dataType:n.dataType||r.dataType||this.getDefaultItemDataType(),delimiter:n.delimiter||r.delimiter||this.getDefaultArrayValueDelimiter()}),this.writeArrayObj(n,t,r)},writeArrayObj:function(r,n,o){for(var i=this.getDomHelper(),a=["id","title","dictRef"],s=0,l=a.length;s<l;++s){var u=r[a[s]];Kekule.ObjUtils.notUnset(u)&&t.setCmlElemAttribute(n,a[s],u,i)}r.unit&&t.setCmlElemAttribute(n,"units",e.metricsUnitSymbolToCmlUnitStr(r.unit),i),r.dataType&&t.setCmlElemAttribute(n,"dataType",e.getCmlTypeForDataType(r.dataType),i);var c=r.values,d=c?c.length:r.size;if(d&&t.setCmlElemAttribute(n,"size",d,i),c){var h=r.delimiter||this.getDefaultArrayValueDelimiter();Kekule.DomUtils.setElementText(n,c.join(h)),h!==this.getDefaultArrayValueDelimiter()&&t.setCmlElemAttribute(n,"delimiter",h,i)}else Kekule.ObjUtils.notUnset(r.start)&&t.setCmlElemAttribute(n,"start",r.start,i),Kekule.ObjUtils.notUnset(r.end)&&t.setCmlElemAttribute(n,"end",r.end,i)}}),Kekule.IO.CmlMetaDataReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlMetaReader",doReadElement:function(e,t,r,n){var o=this.readMeta(e);return t&&t.setInfoValue&&o.key&&o.value&&t.setInfoValue(o.key,o.value),o},readMeta:function(e){var t=Kekule.DomUtils.fetchAttributeValuesToJson(e,this.getCoreNamespaceURI(),!0);return{key:t.name,value:DataType.StringUtils.deserializeValue(t.content),metadataType:t.metadataType}}}),Kekule.IO.CmlMetaDataListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlMetaListReader",doReadChildElem:function(e,t,r,n,o){return t.readElement(e,r,this)}}),Kekule.IO.CmlConditionListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlConditionListReader"}),Kekule.IO.CmlParameterReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlParameterReader",doReadElement:function(e,t,r,n){return this.readParameter(e,t,r)},readParameter:function(e,t,r){var n=Kekule.DomUtils.fetchAttributeValuesToJson(e,this.getCoreNamespaceURI(),!0),o={key:n.name||n.dictRef,value:DataType.StringUtils.deserializeValue(n.value),title:n.title};this.iterateChildElements(e,t,r,function(e,t){"scalar"===Kekule.DomUtils.getLocalName(e).toLowerCase()&&(o.value=t)});return o}}),Kekule.IO.CmlParameterListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlParameterListReader"}),Kekule.IO.CmlChemStructureReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlChemStructureReader",initialize:function(){this.tryApplySuper("initialize")},hasAtomChildren:function(e,t){return t.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",e).length},getAtomChildren:function(e,t){return t.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",e)},atomInfoToJSON:function(e,t){return Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(e,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,!0,t)},arrayedAtomInfosToJSON:function(e,t){for(var r=["id","atomID","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"],n=["id","id","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"],o=[],i=0,a=r.length;i<a;++i){var s,l=[];(s=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,r[i],Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,t))&&(l=Kekule.IO.CmlDomUtils.splitCmlArrayValue(s));for(var u=0,c=l.length;u<c;++u)o[u]||(o[u]={}),l[u]&&(o[u][n[i]]=l[u])}return o}}),Kekule.IO.CmlFormulaReader=Class.create(Kekule.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlFormulaReader",doReadElement:function(e,t,r,n){return this.readFormula(e,this.getDomHelper())},readFormula:function(e,t){var r=new Kekule.MolecularFormula,n=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"formalCharge",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,t);n&&r.setCharge(parseFloat(n));var o=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"concise",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,t),i=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"inline",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,t);if(o)this.setConcise(r,o);else if(i)this.setInlineFormula(r,i);else for(var a=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),s=0,l=a.length;s<l;++s)switch(Kekule.DomUtils.getLocalName(a[s])){case"formula":this.readSubFormula(r,a[s],t);break;case"atomArray":this.readAtomArray(r,a[s],t);break;default:Kekule.IO.CmlDomUtils.isCmlTypedElem(e)||Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(e)||this.readChildElementDef(e,r)}return r},readConsice:function(e){var t=null;return e&&(t=new Kekule.MolecularFormula,this.setConcise(t,e)),t},setConcise:function(e,t){var r=Kekule.IO.CmlDomUtils.analysisCmlFormulaConciseValue(t);return r.isotopes&&r.isotopes.length&&this.createSectionsFromAtomAttribs(e,r.isotopes),r.formalCharge&&e.setCharge(r.formalCharge),e},setInlineFormula:function(e,t){return Kekule.FormulaUtils.textToFormula(t,null,e),e},readAtomArray:function(e,t,r){var n=[],o=this.getAtomChildren(t,r);if(o.length>0)for(var i=0,a=o.length;i<a;++i){var s=o[i],l=this.atomInfoToJSON(s,r);n.push(l)}else n=this.arrayedAtomInfosToJSON(t,r);return this.createSectionsFromAtomAttribs(e,n),e},createSectionsFromAtomAttribs:function(e,t){for(var r=0,n=t.length;r<n;++r){var o=t[r].elementType;if(o){var i=Kekule.IO.CmlUtils.createNodeByCmdElementType(null,o),a=t[r].formalCharge||0,s=t[r].count;e.appendSection(i,s,a)}}},readSubFormula:function(e,t,r){var n=this.readElement(t,r),o=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"count",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,r);e.appendSection(n,parseFloat(o)||1,n.getCharge()||0)}}),Kekule.IO.CmlFormulaWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlFormulaWriter",doCreateElem:function(e,t){return this.createChildElem("formula",t)},doWriteObject:function(e,t,r){if(!(e instanceof Kekule.MolecularFormula))return this.reportTypeMismatchError(e),null;for(var n=[],o=[],i=[],a=0,s=e.getSectionCount();a<s;++a){var l=e.getSectionAt(a);if(l.obj instanceof Kekule.MolecularFormula){this.createAtomArrayElem(n,o,i,t),n=[],o=[],i=[];this.writeSubFormula(l.obj,l.count||1,t,r)}else n.push(Kekule.IO.CmlUtils.getNodeElementType(l.obj)),o.push(l.count||1),i.push(e.getSectionCharge(l)||0),a==s-1&&this.createAtomArrayElem(n,o,i,t)}e.getCharge()&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"formalCharge",e.getCharge(),this.getDomHelper())},writeSubFormula:function(e,t,r,n){var o=this.createChildElem("formula",r);return this.doWriteObject(e,o,n),t>1&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,"count",t,this.getDomHelper()),o},createAtomArrayElem:function(e,t,r,n){if(!(e.length<=0)){var o=this.createChildElem("atomArray",n),i=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(e),a=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(t);Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,"elementType",i,this.getDomHelper()),Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,"count",a,this.getDomHelper());for(var s=!1,l=0,u=r.length;l<u;++l)if(r[l]){s=!0;break}if(s){var c=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(t);Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,"formalCharge",c,this.getDomHelper())}return o}}}),Kekule.IO.CmlMoleculeReader=Class.create(Kekule.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlMoleculeReader",initialize:function(){this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("structureBuilder",{dataType:"Kekule.ChemStructureBuilder",serializable:!1,getter:function(){return this.getPropStoreFieldValue("structureBuilder")||this.setPropStoreFieldValue("structureBuilder",new Kekule.ChemStructureBuilder),this.getPropStoreFieldValue("structureBuilder")},setter:null})},doReadElement:function(e,t,r,n){return this.readMolecule(e,r,this.getDomHelper())},doReadChildElement:function(e,t,r){if("molecule"==Kekule.DomUtils.getLocalName(e)&&this.matchCoreNamespace(e)){if(t&&t.getSubMolecules){var n=this.readElement(e,t,r);if(n){var o=Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"amount",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM)||Kekule.IO.CmlDomUtils.getCmlElemAttribute(e,"count",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM),i=o?{amount:parseFloat(o)}:null;t.getSubMolecules().appendObj(n,i)}return n}return null}return this.tryApplySuper("doReadChildElement",[e,t,r])},hasSubMolecule:function(e){return Kekule.DomUtils.getDirectChildElems(e,null,"molecule",this.getCoreNamespaceURI()).length>0},readMolecule:function(e,t,r){var n;return this.hasSubMolecule(e)?(n=new Kekule.CompositeMolecule,this.iterateChildElements(e,n,t)):n=this.readMoleculeCore(e,r),this.readMoleculeAttribs(n,e,r),n},readMoleculeAttribs:function(e,t,r){for(var n=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,null,!0,r),o=Kekule.ObjUtils.getOwnedFieldNames(n),i=0,a=o.length;i<a;++i){var s=o[i],l=n[s];switch(s){case"id":this.setObjId(e,l);break;case"title":e.setInfoValue("title",l);break;case"formalCharge":l&&e.setCharge(parseFloat(l));break;case"formula":this.readFormulaAttrib(e,l);break;case"amount":case"count":break;default:e.setInfoValue(s,l)}}},readMoleculeCore:function(e,t){var r=new Kekule.Molecule;this.getStructureBuilder().setTarget(r);for(var n=e.firstChild;n;){if(n.nodeType!=Node.ELEMENT_NODE);else if(this.matchCoreNamespace(n))switch(Kekule.DomUtils.getLocalName(n)){case"atomArray":this.readMoleculeAtomArray(r,n,this.getStructureBuilder(),t);break;case"bondArray":this.readMoleculeBondArray(r,n,this.getStructureBuilder(),t);break;case"formula":this.readFormula(r,n,t);break;case"atom":this.getStructureBuilder().setTarget(r);var o=this.readAtom(n,t);this.getStructureBuilder().appendNode(o);break;case"bond":this.getStructureBuilder().setTarget(r);var i=this.readBond(r,n,t);this.getStructureBuilder().appendConnector(i);break;case"molecule":break;default:Kekule.IO.CmlDomUtils.isCmlTypedElem(n)||Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(n)||this.readChildElementDef(n,r)}else;n=n.nextSibling}return r.hasCtab()&&this.connectUpBondAndAtom(r),r},connectUpBondAndAtom:function(e){for(var t=e.getConnectors(),r=0,n=t.length;r<n;++r){var o=t[r],i=o[this._BOND_ATOM_REF_TEMP_FIELD];if(i&&i.length)for(var a=0,s=i.length;a<s;++a){var l=e.getNodeById(i[a]);l?o.appendConnectedObj(l):Kekule.raise((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.ATOMID_NOT_EXISTS"):"Atom id not exists: ")+i[a])}delete o[this._BOND_ATOM_REF_TEMP_FIELD];var u=o[this._BOND_BOND_REF_TEMP_FIELD];if(u&&u.length)for(a=0,s=u.length;a<s;++a){var c=e.getConnectorById(u[a]);c?o.appendConnectedObj(c):Kekule.raise((Kekule.hasLocalRes()?Kekule.$L("ErrorMsg.BONDID_NOT_EXISTS"):"Bond id not exists: ")+u[a])}delete o[this._BOND_BOND_REF_TEMP_FIELD]}},readMoleculeAtomArray:function(e,t,r,n){r.setTarget(e);var o=this.getAtomChildren(t,n);if(o.length>0)for(var i=0,a=o.length;i<a;++i){var s=o[i],l=this.readAtom(s,n);r.appendNode(l)}else{var u=this.readArrayedAtoms(t,n);for(i=0,a=u.length;i<a;++i)r.appendNode(u[i])}},readAtom:function(e,t){var r,n=!Kekule.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(e,this.getCoreNamespaceURI()),o=this.atomInfoToJSON(e,t);if(r=this.createStructureNodeOfAttribs(o),n)for(var i=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),a=0,s=i.length;a<s;++a){e=i[a];this.readChildElementDef(e,r)}return r},readArrayedAtoms:function(e,t){for(var r=this.arrayedAtomInfosToJSON(e,t),n=[],o=0,i=r.length;o<i;++o){var a=this.createStructureNodeOfAttribs(r[o]);a&&n.push(a)}return n},createStructureNodeOfAttribs:function(e){var t;e.elementType||(e.elementType=Kekule.Element.UNSET_ELEMENT);var r=null;void 0!==e.id&&(r=e.id),delete e.id;var n,o,i=e.isotope?Math.round(e.isotope):null;if(t=Kekule.IO.CmlUtils.createNodeByCmdElementType(r,e.elementType,i),delete e.elementType,void 0!==e.hydrogenCount&&t.setExplicitHydrogenCount&&t.setExplicitHydrogenCount(parseInt(e.hydrogenCount,10)),delete e.hydrogenCount,e.formalCharge&&t.setCharge(parseInt(e.formalCharge)),delete e.formalCharge,e.title&&t.setInfoValue("title",e.title),delete e.title,e.role&&t.setInfoValue("role",e.role),delete e.role,void 0!==e.x2&&void 0!==e.y2)n={x:parseFloat(e.x2),y:parseFloat(e.y2)};else if(e.xy2){var a=Kekule.IO.CmlDomUtils.splitCmlArrayValue(e.xy2);2==a.length&&(n={x:parseFloat(a[0]),y:parseFloat(a[1])})}if(delete e.x2,delete e.y2,delete e.xy2,void 0!==e.x3&&void 0!==e.y3&&void 0!==e.z3)o={x:parseFloat(e.x3),y:parseFloat(e.y3),z:parseFloat(e.z3)};else if(e.xyz3){var s=Kekule.IO.CmlDomUtils.splitCmlArrayValue(e.xyz3);3==s.length&&(n={x:parseFloat(s[0]),y:parseFloat(s[1]),z:parseFloat(s[2])})}for(var l in delete e.x3,delete e.y3,delete e.z3,delete e.xyz3,n&&t.setCoord2D(n),o&&t.setCoord3D(o),e)e.hasOwnProperty(l)&&"string"==typeof e[l]&&t.setInfoValue(l,e[l]);return t},_BOND_ATOM_REF_TEMP_FIELD:"__cml_atomRefs",_BOND_BOND_REF_TEMP_FIELD:"__cml_bondRefs",readMoleculeBondArray:function(e,t,r,n){r.setTarget(e);var o=n.getElementsByTagNameNS(this.getCoreNamespaceURI(),"bond",t);if(o.length>0)for(var i=0,a=o.length;i<a;++i){var s=o[i],l=this.readBond(e,s,n);r.appendConnector(l)}else{var u=this.readArrayedBonds(e,t,n);for(i=0,a=u.length;i<a;++i)r.appendConnector(u[i])}},readBond:function(e,t,r){var n,o,i;if(i=!Kekule.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(t,this.getCoreNamespaceURI()),o=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,Kekule.IO.CmlUtils.FILTER_TYPED_ELEM,!0,r),n=this.createStructureConnectorOfAttribs(e,o),i)for(var a=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI()),s=0,l=a.length;s<l;++s){t=a[s];if("bondStereo"==Kekule.DomUtils.getLocalName(t)){var u=Kekule.DomUtils.getElementText(t);u||(u=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"conversionValue",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,r)),u||(u=Kekule.IO.CmlUtils.getCmlNsValueLocalPart(Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,"dictRef",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,r)));var c=Kekule.IO.CmlUtils.cmlBondStereoToKekule(u);c!=Kekule.BondStereo.NONE&&n.setStereo&&n.setStereo(c)}else this.readChildElementDef(t,n)}return n},readArrayedBonds:function(e,t,r){var n=["id","bondID","atomRef1","atomRef2","order","bondStereo"],o=["id","id","atomRefs2","atomRefs2","order","bondStereo"],i=[],a=Kekule.IO.CmlDomUtils.getMultipleCmlElemAttribute(t,"atomRefs",Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,r);if(a&&a.length)for(var s=0,l=a.length;s<l;++s)for(var u=a[s],c=0,d=(h=Kekule.IO.CmlDomUtils.splitCmlArrayValue(u)).length;c<d;++c)i[c]||(i[c]={}),null==i[c].atomRefs&&(i[c].atomRefs=[]),i[c].atomRefs.push(h[c]);for(s=0,l=n.length;s<l;++s){var h=[];(u=Kekule.IO.CmlDomUtils.getCmlElemAttribute(t,n[s],Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,r))&&(h=Kekule.IO.CmlDomUtils.splitCmlArrayValue(u));for(c=0,d=h.length;c<d;++c)i[c]||(i[c]={}),h[c]&&("atomRef1"==n[s]||"atomRef2"==n[s]?(null==i[c].atomRefs2&&(i[c].atomRefs2=[]),"atomRef1"==n[s]?i[c].atomRefs2[0]=h[c]:i[c].atomRefs2[1]=h[c]):i[c][o[s]]=h[c])}var f=[];for(s=0,l=i.length;s<l;++s){var m=this.createStructureConnectorOfAttribs(e,i[s]);m&&f.push(m)}return f},createStructureConnectorOfAttribs:function(e,t){var r,n,o;if(t.id&&(n=t.id),delete t.id,void 0!==t.order&&(o=Kekule.IO.CmlUtils.cmlBondOrderToKekule(t.order)),delete t.order,r=new Kekule.Bond(n,null,o),t.bondStereo){var i=Kekule.IO.CmlUtils.cmlBondStereoToKekule(t.bondStereo);i!=Kekule.BondStereo.NONE&&r.setStereo&&r.setStereo(i)}delete t.bondStereo;for(var a=0,s=Kekule.IO.CML.ATOMS_REF_ATTRIBS.length;a<s;++a){if(null!=t[u=Kekule.IO.CML.ATOMS_REF_ATTRIBS[a]]){var l=Kekule.IO.CmlDomUtils.splitCmlArrayValue(t[u]);l.length>0&&(r[this._BOND_ATOM_REF_TEMP_FIELD]=l),delete t[u];break}}for(a=0,s=Kekule.IO.CML.BONDS_REF_ATTRIBS.length;a<s;++a){var u;if(null!=t[u=Kekule.IO.CML.BONDS_REF_ATTRIBS[a]]){var c=Kekule.IO.CmlDomUtils.splitCmlArrayValue(t[u]);c.length>0&&(r[this._BOND_BOND_REF_TEMP_FIELD]=c),delete t[u];break}}for(var d in t)t.hasOwnProperty(d)&&"string"==typeof t[d]&&r.setInfoValue(d,t[d]);return r},readFormula:function(e,t,r){var n=this.doGetChildElementReader(t);if(n){this.copySettingsToChildHandler(n);var o=n.readElement(t,e,this);o&&e.setFormula(o)}},readFormulaAttrib:function(e,t){var r=this.doGetChildElementReader("formula");if(r){var n=r.readConsice?r.readConsice(t):null;n&&e.setFormula(n)}}}),Kekule.IO.CmlMoleculeWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlMoleculeWriter",initProperties:function(){this.defineProp("allowCascadeGroup",{dataType:DataType.BOOL})},doCreateElem:function(e,t){return this.createChildElem("molecule",t)},doWriteObject:function(e,t,r){return this.writeMolecule(e,t,r)},writeMolecule:function(e,t,r){return this.writeMoleculeAttribs(e,t),e instanceof Kekule.CompositeMolecule?this.writeCompositeMolecule(e,t,r):this.writeMoleculeCore(e,t,r)},writeMoleculeAttribs:function(e,t){var r=[];e.getCharge()&&r.push({key:"formalCharge",value:e.getCharge()});for(var n=["title","dictRef","chirality","ref","spinMultiplicity","symmetryOriented","role"],o=0,i=n.length;o<i;++o){var a=n[o],s=e.getInfoValue(a);Kekule.ObjUtils.isUnset(s)||r.push({key:a,value:e.getInfoValue(a)})}for(o=0,i=r.length;o<i;++o)Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,r[o].key,r[o].value,this.getDomHelper())},writeCompositeMolecule:function(e,t,r){for(var n=e.getSubMolecules(),o=0,i=n.getItemCount();o<i;++o){var a=n.getItemAt(o),s=a.obj,l=this.writeObject(s,t,r);a.amount&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(l,"amount",a.amount,this.getDomHelper())}return t},writeMoleculeCore:function(e,t,r){if(e.hasFormula()){var n=e.getFormula();this.doGetChildObjectWriter(n).writeObject(n,t,r)}e.hasCtab()&&this.writeCtab(e.getCtab(),e,t,r)},writeCtab:function(e,t,r,n){this.identifyObjsInCtab(e,t);var o=this.getAllowCascadeGroup()?e.getNodes():e.getLeafNodes();if(o.length>0)for(var i=this.createChildElem("atomArray",r),a=0,s=o.length;a<s;++a)this.writeCtabNode(o[a],i,n);var l=this.getAllowCascadeGroup()?e.getConnectors():e.getAllChildConnectors();if(l.length>0){var u=this.createChildElem("bondArray",r);for(a=0,s=l.length;a<s;++a)this.writeCtabConnector(l[a],u,n)}},writeCtabNode:function(e,t,r){var n=this.createChildElem("atom",t);this.writeObjId(e,n);var o=Kekule.IO.CmlUtils.getNodeElementType(e);Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"elementType",o,this.getDomHelper());var i=e.getMassNumber?e.getMassNumber():null;i&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"isotope",i,this.getDomHelper());var a=e.getExplicitHydrogenCount?e.getExplicitHydrogenCount():null;Kekule.ObjUtils.isUnset(a)||Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"hydrogenCount",a,this.getDomHelper());var s=e.getCharge?e.getCharge():null;s&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"formalCharge",s,this.getDomHelper());e.getParity&&e.getParity();var l=e.getInfoValue?e.getInfoValue("title"):null;l&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"title",l,this.getDomHelper());var u=e.getInfoValue?e.getInfoValue("role"):null;if(u&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"role",u,this.getDomHelper()),e.hasCoord2D&&e.hasCoord2D()){var c=e.getAbsCoord2D();!Kekule.ObjUtils.isUnset(c.x)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"x2",c.x,this.getDomHelper()),!Kekule.ObjUtils.isUnset(c.y)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"y2",c.y,this.getDomHelper())}if(e.hasCoord3D&&e.hasCoord3D()){var d=e.getAbsCoord3D();!Kekule.ObjUtils.isUnset(d.x)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"x3",d.x,this.getDomHelper()),!Kekule.ObjUtils.isUnset(d.y)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"y3",d.y,this.getDomHelper()),!Kekule.ObjUtils.isUnset(d.z)&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,"z3",d.z,this.getDomHelper())}for(var h=["occupancy","xFract","xyzFract","yFract","convention","dictRef","ref"],f=0,m=h.length;f<m;++f){var g=h[f],p=e.getInfoValue(g);p&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(n,g,p,this.getDomHelper())}return this.writeObjAdditionalInfo(e,n,r),n},writeCtabConnector:function(e,t,r){var n=!1,o=this.createChildElem("bond",t);this.writeObjId(e,o);var i=e.getBondOrder?e.getBondOrder():null;if(i){var a=Kekule.IO.CmlUtils.kekuleBondOrderToCml(i);a&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,"order",a,this.getDomHelper())}var s,l=e.getStereo?e.getStereo():null;if(l){var u=Kekule.IO.CmlUtils.kekuleBondStereoToCml(l);if(u.value){var c=this.createChildElem("bondStereo",o);Kekule.DomUtils.setElementText(c,u.value),u.invert&&(n=!0)}}for(var d=[],h=[],f=0,m=e.getConnectedObjCount();f<m;++f){var g=e.getConnectedObjAt(f);if(g.getId&&g.getId()){var p=g.getId();g instanceof Kekule.ChemStructureNode?n?d.unshift(p):d.push(p):g instanceof Kekule.ChemStructureConnector&&h.push(p)}}if(s=d.length){var C=1==s?"atomRefs":s>=2&&s<=4?"atomRefs"+s:"atomRefs";Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,C,Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(d),this.getDomHelper())}if(s=h.length){C="bondRefs";Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,C,Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(h),this.getDomHelper())}var O=["convention","dictRef","ref"];for(f=0,m=O.length;f<m;++f){var k=O[f],S=e.getInfoValue(k);S&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,k,S,this.getDomHelper())}return this.writeObjAdditionalInfo(e,o,r),o},identifyObjsInCtab:function(e,t){for(var r=0,n=e.getNodeCount();r<n;++r){var o=e.getNodeAt(r);o.getId()||this.autoIdentifyForObj(o,t),e.isSubFragment(o)&&o.hasCtab&&o.hasCtab()&&this.identifyObjsInCtab(o.getCtab(),t)}for(r=0,n=e.getConnectorCount();r<n;++r){var i=e.getConnectorAt(r);i.getId()||this.autoIdentifyForObj(i,t)}}}),Kekule.IO.CmlMoleculeWriter._UID_SEED=null,Kekule.IO.CmlReactionReagentReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReagentReader",doReadElement:function(e,t,r,n){return this.readReagent(e,r,this.getDomHelper())},readReagent:function(e,t,r){var n=null,o=Kekule.DomUtils.getDirectChildElems(e,null,"molecule",this.getCoreNamespaceURI());if(o&&o.length){var i=o[o.length-1],a=this.doGetChildElementReader(i).readElement(i,null,this);a&&(n={},Kekule.RoleMapUtils.setItem(n,a),this.readReagentAttribs(n,e,r))}return n},readReagentAttribs:function(e,t,r){for(var n=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(t,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,!0,r),o=Kekule.ObjUtils.getOwnedFieldNames(n),i=0,a=o.length;i<a;++i){var s=o[i],l=n[s];switch(s){case"role":e.role=Kekule.IO.CmlUtils.reagentRoleToKekule(l);break;case"amount":case"count":e.amount=parseFloat(l);break;default:e[s]=l}}return e}}),Kekule.IO.CmlReactionReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReader",doReadElement:function(e,t,r,n){return this.readReaction(e,this.getDomHelper())},readReaction:function(e,t){for(var r=new Kekule.Reaction,n=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI()),o=0,i=n.length;o<i;++o)this.isComponentListElem(n[o])?this.readComponentList(r,n[o],t):this.readChildElement(n[o],r);var a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(e,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,null,this.getDomHelper()),s=Kekule.ObjUtils.getOwnedFieldNames(a);for(o=0,i=s.length;o<i;++o){var l=s[o],u=a[l];switch(l){case"name":r.setName(u);break;case"title":r.setTitle(u);break;case"type":r.setReactionType(u);break;case"yield":r.setYield(parseFloat(u));break;default:r.setInfoValue(l,u)}}return r},readComponentList:function(e,t,r){var n=this.getListElemComponentName(t),o=e.getComponentArray(n,!0);if(o)for(var i=Kekule.DomUtils.getDirectChildElems(t,null,null,this.getCoreNamespaceURI()),a=0,s=i.length;a<s;++a){var l=this.readChildElement(i[a],o);l&&(n==Kekule.ReactionComponent.CONDITION&&l instanceof ObjectEx?e.appendItem(n,l):e.appendMap(n,l))}},isComponentListElem:function(e){return["reactantList","productList","substanceList","conditionList"].indexOf(Kekule.DomUtils.getLocalName(e))>=0},getListElemComponentName:function(e){switch(Kekule.DomUtils.getLocalName(e)){case"reactantList":return Kekule.ReactionComponent.REACTANT;case"productList":return Kekule.ReactionComponent.PRODUCT;case"conditionList":return Kekule.ReactionComponent.CONDITION;default:return Kekule.ReactionComponent.SUBSTANCE}}}),Kekule.IO.CmlReactionWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlReactionWriter",doCreateElem:function(e,t){return this.createChildElem("reaction",t)},doWriteObject:function(e,t,r){return this.writeReaction(e,t,r)},writeReaction:function(e,t,r){for(var n=[Kekule.ReactionComponent.REACTANT,Kekule.ReactionComponent.PRODUCT,Kekule.ReactionComponent.SUBSTANCE,Kekule.ReactionComponent.CONDITION],o=0,i=n.length;o<i;++o)this.writeCompList(e,n[o],t,r);return this.writeReactionAttribs(e,t,r),t},writeReactionAttribs:function(e,t,r){var n=[];e.getName()&&n.push({key:"name",value:e.getName()}),e.getTitle()&&n.push({key:"title",value:e.getTitle()}),e.getReactionType()&&n.push({key:"type",value:e.getReactionType()}),e.getYield()&&n.push({key:"yield",value:e.getYield()});for(var o=["dictRef","convention","format","ref","role","type","state","yield","atomMap","electronMap"],i=0,a=o.length;i<a;++i)Kekule.ObjUtils.isUnset(e.getInfoValue(o[i]))||n.push({key:o[i],value:e.getInfoValue(o[i])});for(i=0,a=n.length;i<a;++i)Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,n[i].key,n[i].value,this.getDomHelper())},writeCompList:function(e,t,r,n){if(e.getComponentItemCount(t)<=0)return null;for(var o=this.getReactionComponentCmlName(t),i=this.createChildElem(o+"List",r),a=0,s=e.getComponentItemCount(t);a<s;++a){var l=e.getMapAt(t,a),u=e.getMapItemAt(t,a);if(l&&u){var c;t!=Kekule.ReactionComponent.CONDITION?(c=this.createChildElem(o,i),Kekule.ObjUtils.isUnset(l.amount)||Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"amount",l.amount,this.getDomHelper()),l.role&&Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"role",Kekule.IO.CmlUtils.kekuleReagentRoleToCml(l.role),this.getDomHelper())):c=i;var d=this.doGetChildObjectWriter(u);d&&d.writeObject(u,c,n)}}},getReactionComponentCmlName:function(e){switch(e){case Kekule.ReactionComponent.REACTANT:return"reactant";case Kekule.ReactionComponent.PRODUCT:return"product";case Kekule.ReactionComponent.CONDITION:return"condition";default:return"substance"}}}),Kekule.IO.CmlListReader=Class.create(Kekule.IO.CmlBaseListReader,{CLASS_NAME:"Kekule.IO.CmlListReader",doCreateList:function(e){switch(Kekule.DomUtils.getLocalName(e)){case"moleculeList":return new Kekule.MoleculeList;case"reactionList":return new Kekule.ReactionList;default:return new Kekule.ChemObjList}},doAppendObjToList:function(e,t){return t&&t.append?t.append(e):this.tryApplySuper("doAppendObjToList",[e,t]),t}}),Kekule.IO.CmlListWriter=Class.create(Kekule.IO.CmlBaseListWriter,{CLASS_NAME:"Kekule.IO.CmlListWriter",doGetListElemTagName:function(e,t){var r;switch(DataType.getType(e)){case"Kekule.MoleculeList":r="moleculeList";break;case"Kekule.ReactionList":r="reactionList";break;default:r=this.tryApplySuper("doGetListElemTagName",[e,t])}return r}}),Kekule.IO.CmlTransparentListWriter=Class.create(Kekule.IO.CmlBaseListWriter,{CLASS_NAME:"Kekule.IO.CmlTransparentListWriter",doGetListElemTagName:function(e,t){return null}}),Kekule.IO.CmlRootReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlRootReader",doReadElement:function(e,t,r,n){var o;if(this.analysisElem(e),"cml"!=Kekule.DomUtils.getLocalName(e)&&(o=this.getReader(e)),o)return o.readElement(e,null,this,n);var i=n.defaultRootObjListHolder&&n.enableReadRootObjList,a=[],s=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI());if(s){for(var l=0,u=s.length;l<u;++l)if(o=this.getReader(s[l])){var c=o.readElement(s[l],null,this,n);if(!i)return c;a.push(c)}return a.length<=0?null:a.length<=1?a[0]:this._createChildObjsHolder(a,n.defaultRootObjListHolder)}return null},getReader:function(e){return this.doGetChildElementReader(e)},analysisElem:function(e){var t=this.getDomHelper();t.setForceAnalysisDoc(!0),this.getDomHelper().setRootElement(e);for(var r=t.getNamespaces(),n=null,o=0,i=r.length;o<i;++o){var a=r[o].namespaceURI;if(Kekule.IO.CML.LEGAL_CORE_NAMESPACE_URIS.indexOf(a)>=0){n=a;break}}this.setCoreNamespaceURI(n||null),this.setNamespaces(r)}}),Kekule.IO.CmlRootWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlRootWriter",getWriter:function(e){return this.doGetChildObjectWriter(e)},writeObject:function(e,t,r){var n;this.getDomHelper().setForceAnalysisDoc(!0),this.getDomHelper().setRootElement(t),n=e instanceof Kekule.ChemSpace?e.getRoot():e;var o=this.getWriter(n);return o?o.writeObject(n,t,r):null}}),Kekule.IO.CmlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.CmlReader",initProperties:function(){this.defineProp("objIdMap",{dataType:DataType.HASH,serializable:!1})},doReadData:function(e,t,r,n){var o,i;t!=Kekule.IO.ChemDataType.DOM?o=DataType.XmlUtility.parse(e).documentElement:o=e.documentElement?e.documentElement:e;var a=Kekule.IO.CmlElementReaderFactory.getReader("cml");if(a)try{this.setObjIdMap({}),a.setRootEvoker(this);var s=Object.extend({},Kekule.globalOptions.IO.cml);s=Object.extend(s,n||{}),i=a.readElement(o,null,null,s),a.doneReadingDocument(!0)}finally{a.finalize(),this.setObjIdMap(null)}return i},getLoadedObjById:function(e){var t=this.getObjIdMap();return t&&t[e]},setObjIdMapValue:function(e,t){var r=this.getObjIdMap();r&&(r[e]=t)}}),Kekule.IO.CmlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.CmlWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(t.prettyPrint)?Kekule.globalOptions.IO.cml.prettyPrint:t.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0}),this.defineProp("rootElemWriter",{dataType:DataType.OBJECT,setter:null,serializable:!1})},doWriteData:function(e,t,r,n){var o=Kekule.IO.CML.CML3_SCHEMA_NAMESPACE_URI,i=DataType.XmlUtility.newDocument("cml",o),a=Kekule.IO.CmlElementWriterFactory.getWriter("Kekule.ChemDocument");if(a){var s;try{this.setPropStoreFieldValue("rootElemWriter",a);var l=Object.extend({},Kekule.globalOptions.IO.cml);l=Object.extend(l,n||{}),a.setCoreNamespaceURI(o),s=a.writeObject(e,i.documentElement,l),a.doneWritingDocument(!0),t==Kekule.IO.ChemDataType.TEXT&&(s=DataType.XmlUtility.serializeNode(i.documentElement,{prettyPrint:l.prettyPrint||this.getPrettyPrint()}))}finally{this.setPropStoreFieldValue("rootElemWriter",null),a.finalize()}return s}return Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_OUTPUT_AS_CML").format(DataType.getType(e))),null}}),function(){Kekule.IO.MimeType.CML="chemical/x-cml";var e=Kekule.IO.CmlElementReaderFactory;e.register("name",Kekule.IO.CmlNameReader),e.register("scalar",Kekule.IO.CmlScalarReader),e.register("metaData",Kekule.IO.CmlMetaDataReader),e.register("metaDataList",Kekule.IO.CmlMetaDataListReader),e.register("formula",Kekule.IO.CmlFormulaReader),e.register("molecule",Kekule.IO.CmlMoleculeReader),e.register(["reactant","product","substance"],Kekule.IO.CmlReactionReagentReader),e.register("reaction",Kekule.IO.CmlReactionReader),e.register(["list","moleculeList","reactionList"],Kekule.IO.CmlListReader),e.register(["conditionlist"],Kekule.IO.CmlConditionListReader),e.register(["parameter"],Kekule.IO.CmlParameterReader),e.register(["parameterlist"],Kekule.IO.CmlParameterListReader),e.register(["array"],Kekule.IO.CmlArrayReader),e.register("cml",Kekule.IO.CmlRootReader);var t=Kekule.IO.CmlElementWriterFactory;t.register(DataType.ARRAY,Kekule.IO.CmlArrayWriter),t.register("Kekule.Scalar",Kekule.IO.CmlScalarWriter),t.register("Kekule.MolecularFormula",Kekule.IO.CmlFormulaWriter),t.register(["Kekule.ChemStructureFragment","Kekule.Molecule","Kekule.CompositeMolecule"],Kekule.IO.CmlMoleculeWriter),t.register("Kekule.Reaction",Kekule.IO.CmlReactionWriter),t.register(["Kekule.ChemObjList","Kekule.ChemStructureObjectGroup"],Kekule.IO.CmlListWriter),t.register(["Kekule.ChemSpaceElement","Kekule.ChemSpace"],Kekule.IO.CmlTransparentListWriter),t.register("Kekule.ChemDocument",Kekule.IO.CmlRootWriter),Kekule.IO.DataFormat.CML="cml",Kekule.IO.DataFormatsManager.register("cml",Kekule.IO.MimeType.CML,"cml",Kekule.IO.ChemDataType.TEXT,"Chemical Markup Language");var r=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.CML);Kekule.IO.ChemDataReaderManager.register("cml",Kekule.IO.CmlReader,[r]),Kekule.IO.ChemDataWriterManager.register("cml",Kekule.IO.CmlWriter,[Kekule.Scalar,Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemSpace],[r])}()}(),Kekule.IO.MdlVersion={V2000:2,V3000:3},Kekule.IO.MDL={VER2000:"V2000",VER3000:"V3000",SYMBOL_ANYATOM:"A",SYMBOL_STARATOM:"*",SYMBOL_HETEROATOM:"Q",SYMBOL_RGROUP:"R",SYMBOL_RGROUP2:"R#",SYMBOL_LONEPAIR:"LP",SYMBOL_ATOMLIST:"L",SYMBOL_DUMMYATOM:"Du",SD_DATA_HEAD_PREFIX:">",MOL_DELIMITER:"$$$$"},Kekule.IO.MdlUtils={isUnspecifiedAtomSymbol:function(e){return e===Kekule.IO.MDL.SYMBOL_ANYATOM||e===Kekule.IO.MDL.SYMBOL_STARATOM},isHeteroAtomSymbol:function(e){return e===Kekule.IO.MDL.SYMBOL_HETEROATOM},isRGroupSymbol:function(e){return e===Kekule.IO.MDL.SYMBOL_RGROUP||e===Kekule.IO.MDL.SYMBOL_RGROUP2},isLonePairSymbol:function(e){return e===Kekule.IO.MDL.SYMBOL_LONEPAIR},isAtomListSymbol:function(e){return e===Kekule.IO.MDL.SYMBOL_ATOMLIST},analysisMdlDateTimeStr:function(e,t){var r=new Date,n=0,o=2,i=(parseInt(e.substr(n,o).trim(),10)||1)-1;n+=o;var a=parseInt(e.substr(n,o).trim(),10)||0;n+=o,o=t?4:2;var s=parseInt(e.substr(n,o),10)||0;t||(s+=s>=70?1900:2e3),r.setFullYear(s,i,a),n+=o,o=2;var l=parseInt(e.substr(n,o),10)||0;n+=o;var u=parseInt(e.substr(n,o),10)||0;return r.setHours(l,u),r},generateMdlDateTimeStr:function(e,t){var r="";return r+=(e.getMonth()+1).toString().lpad(2,"0"),r+=e.getDate().toString().lpad(2,"0"),r+=t?e.getFullYear().toString().lpad(4,"0"):(e.getFullYear()%100).toString().lpad(2,"0"),r+=e.getHours().toString().lpad(2,"0"),r+=e.getMinutes().toString().lpad(2,"0")},mdlRadicalToKekule:function(e){return e},kekuleRadicalToMdl:function(e){return e},bondTypeToKekuleOrder:function(e){switch(e){case 1:return Kekule.BondOrder.SINGLE;case 2:return Kekule.BondOrder.DOUBLE;case 3:return Kekule.BondOrder.TRIPLE;case 4:return Kekule.BondOrder.EXPLICIT_AROMATIC;case 5:return Kekule.BondOrder.SINGLE_OR_DOUBLE;case 6:return Kekule.BondOrder.SINGLE_OR_AROMATIC;case 7:return Kekule.BondOrder.DOUBLE_AROMATIC;case 8:return Kekule.BondOrder.ANY;default:return Kekule.BondOrder.UNSET}},kekuleBondOrderToMdlType:function(e){switch(e){case Kekule.BondOrder.SINGLE:return 1;case Kekule.BondOrder.DOUBLE:return 2;case Kekule.BondOrder.TRIPLE:return 3;case Kekule.BondOrder.EXPLICIT_AROMATIC:return 4;case Kekule.BondOrder.SINGLE_OR_DOUBLE:return 5;case Kekule.BondOrder.SINGLE_OR_AROMATIC:return 6;case Kekule.BondOrder.DOUBLE_AROMATIC:return 7;case Kekule.BondOrder.ANY:return 8;default:return 1}},getRxnMarkVersion:function(e){var t=e.substr(0,4);return"$RXN"!=t?null:(t=e.substr(4).trim())==Kekule.IO.MDL.VER3000?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000},assertIlegalForCtabOutput:function(e){return e instanceof Kekule.StructureFragment?!!e.hasCtab()||(Kekule.error(Kekule.$L("ErrorMsg.MOLECULE_HAS_NO_CTAB_TO_OUTPUT")),!1):(Kekule.error(Kekule.$L("ErrorMsg.CAN_NOT_WRITE_NON_MOLECULE_TO_MOL")),!1)}},Kekule.IO.MdlStructureUtils={fillFragment:function(e,t,r){if(e.clear(),t){var n;if(n=r&&r!=Kekule.CoordMode.UNKNOWN?r==Kekule.CoordMode.COORD3D:t.atomInfos.isCoord3D,t.atomInfos)for(var o=0,i=t.atomInfos.length;o<i;++o){if(u=t.atomInfos[o]){var a=Kekule.IO.MdlStructureUtils.createStructureNode(e,u,n);a?e.appendNode(a):Kekule.raise(Kekule.$L("ErrorMsg.MDL_CTAB_ATOM_CANNOT_CREATE"))}}if(t.bondInfos)for(o=0,i=t.bondInfos.length;o<i;++o){if(u=t.bondInfos[o]){var s=Kekule.IO.MdlStructureUtils.createStructureConnector(e,u);s?e.appendConnector(s):Kekule.raise(Kekule.$L("ErrorMsg.MDL_CTAB_BOND_CANNOT_CREATE"))}}if(t.sgInfos&&t.sgInfos.length){var l=[];for(o=0,i=t.sgInfos.length;o<i;++o){var u;if((u=t.sgInfos[o])&&"SUP"==u.sgType){for(var c=[],d=0,h=u.atomIndexes.length;d<h;++d)c.push(e.getNodeAt(u.atomIndexes[d]));c.length&&l.push({atoms:c,text:u.label})}}for(o=0,i=l.length;o<i;++o){if((c=l[o].atoms).length){var f=e.marshalSubFragment(c,new Kekule.SubGroup),m=l[o].text;f.setFormulaText&&m.match(/.+\d/)?f.setFormulaText(l[o].text):f.setAbbr(l[o].text)}}}}return e},createStructureNode:function(e,t,r){var n;if(t.atomListInfo||Kekule.IO.MdlUtils.isAtomListSymbol(t.symbol)){n=new Kekule.VariableAtom;var o=[];t.atomListInfo&&t.atomListInfo.symbols&&(o=o.concat(t.atomListInfo.symbols),t.atomListInfo.isAllowList?n.setAllowedIsotopeIds(o):n.setDisallowedIsotopeIds(o))}else if(Kekule.IO.MdlUtils.isRGroupSymbol(t.symbol))n=new Kekule.RGroup;else if(Kekule.IO.MdlUtils.isHeteroAtomSymbol(t.symbol))n=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.HETERO);else if(Kekule.IO.MdlUtils.isUnspecifiedAtomSymbol(t.symbol))n=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY);else{var i=Kekule.ChemicalElementsDataUtil.getElementInfo(t.symbol);if(i){var a=null;if(t.massNumber)a=t.massNumber;else if(t.massDiff&&i){var s=i.naturalMass,l=(a=Math.round(s+t.massDiff),Kekule.IsotopesDataUtil.getIsotopeInfo(i.atomicNumber,a));l||(a=Math.floor(s+t.massDiff),l=Kekule.IsotopesDataUtil.getIsotopeInfo(i.atomicNumber,a)),l||(a=Math.ceil(s+t.massDiff),l=Kekule.IsotopesDataUtil.getIsotopeInfo(i.atomicNumber,a)),l||(a=null)}n=new Kekule.Atom(null,t.symbol,a)}else{var u=Kekule.IsotopesDataUtil.getIsotopeInfo(t.symbol);n=u?new Kekule.Atom(null,u.atomicNumber,u.massNumber):new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY)}}return t.charge&&n.setCharge(t.charge),t.radical&&n.setRadical(t.radical),t.parity&&n.setParity&&n.setParity(t.parity),void 0!==t.hydrongenCount&&n.setExplicitHydrogenCount&&n.setExplicitHydrogenCount(t.hydrongenCount),r?n.setCoord3D({x:t.x,y:t.y,z:t.z}):n.setCoord2D({x:t.x,y:t.y}),n},createStructureConnector:function(e,t){var r=e.getNodeAt(t.atomIndex1),n=e.getNodeAt(t.atomIndex2);if(r&&n){var o=[r,n];if(t.endAtomIndexes)for(var i=0,a=t.endAtomIndexes.length;i<a;++i){var s=e.getNodeAt(t.endAtomIndexes[i]);s&&o.push(s)}var l=new Kekule.Bond(null,o,t.order);return void 0!==t.stereo&&l.setStereo(t.stereo),l}return null},isNodeVariableAtom:function(e){return e instanceof Kekule.VariableAtom},getAtomTypeStr:function(e,t){if(e instanceof Kekule.Atom)return e.getSymbol();if(!(e instanceof Kekule.Pseudoatom)){if(e instanceof Kekule.RGroup)return Kekule.IO.MDL.SYMBOL_RGROUP;if(e instanceof Kekule.VariableAtom){if(t)return Kekule.IO.MDL.SYMBOL_ATOMLIST;var r="[",n=e.getAllowedIsotopeIds();if(n&&n.length||(r="NOT[",n=e.getDisallowedIsotopeIds()),n&&n.length){for(var o=[],i=0,a=n.length;i<a;++i){var s=Kekule.IsotopesDataUtil.getIsotopeIdDetail(n[i]);s&&s.symbol&&o.push(s.symbol)}return r=r+o.join(",")+"]"}return Kekule.IO.MDL.SYMBOL_ATOMLIST}return"?"}switch(e.getAtomType()){case Kekule.PseudoatomType.ANY:return Kekule.IO.MDL.SYMBOL_ANYATOM;case Kekule.PseudoatomType.HETERO:return Kekule.IO.MDL.SYMBOL_HETEROATOM;default:return Kekule.IO.MDL.SYMBOL_DUMMYATOM}},getMoleculeCtabStructureInfo:function(e){var t={};t.atoms=e.getLeafNodes(),t.bonds=e.getAllChildConnectors(),t.subGroups=e.getSubFragments();for(var r=0,n=0,o=0,i=t.atoms.length;o<i;++o)t.atoms[o].hasCoord3D()&&++n,t.atoms[o].hasCoord2D()&&++r;return t.coordMode=r>n?Kekule.CoordMode.COORD2D:Kekule.CoordMode.COORD3D,t},splitConnectedNodes:function(e){for(var t={primaryNodes:[]},r=0,n=e.getConnectedObjs(),o=0,i=n.length;o<i;++o)n[o]instanceof Kekule.ChemStructureNode&&(r<2?(t.primaryNodes.push(n[o]),++r):(t.remainNodes||(t.remainNodes=[]),t.remainNodes.push(n[o])));return t},generateClassicStyleCountLine:function(e,t){if(t==Kekule.IO.MdlVersion.V3000)return"  0  0  0     0  0              0 V3000";var r="";r+=e.atoms.length.toString().lpad(3),r+=e.bonds.length.toString().lpad(3),r+="0".lpad(3),r+="0".lpad(3),r+="0".lpad(3),r+="0".lpad(3);for(var n=0;n<4;++n)r+="0".lpad(3);return r+="999",r+=Kekule.IO.MDL.VER2000.lpad(6)}},Kekule.IO.MdlBlockHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.MdlBlockHandler",initProperties:function(){this.defineProp("textBuffer",{dataType:"Kekule.TextLinesBuffer",serializable:!1,getter:function(){var e=this.getPropStoreFieldValue("textBuffer");return e||(e=this.createTextBuffer(),this.setPropStoreFieldValue("textBuffer",e)),e},setter:null})},createTextBuffer:function(){return new Kekule.TextLinesBuffer}}),Kekule.IO.MdlBlockReader=Class.create(Kekule.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockReader",readBlock:function(e,t){return"string"==typeof e?this.getTextBuffer().setText(e):this.getTextBuffer().setLines(e),this.getTextBuffer().reset(),this.doReadBlock(this.getTextBuffer())},doReadBlock:function(e,t){}}),Kekule.IO.MdlBlockWriter=Class.create(Kekule.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockWriter",writeBlock:function(e){return this.getTextBuffer().clear(),this.doWriteBlock(e,this.getTextBuffer()),this.getTextBuffer().getText()},doWriteBlock:function(e,t){}}),Kekule.IO.Mdl2kUtils={atomLineChargeToKekule:function(e){switch(e){case 1:return 3;case 2:return 2;case 3:return 1;case 5:return-1;case 6:return-2;case 7:return-3;default:return 0}},chargeToMdlAtomLineValue:function(e){switch(e){case 1:return 3;case 2:return 2;case 3:return 1;case-1:return 5;case-2:return 6;case-3:return 7;default:return 0}},atomLineChargeToRadical:function(e){return 4==e?Kekule.RadicalOrder.DOUBLET:0},radicalToMdlAtomLineValue:function(e){return e==Kekule.RadicalOrder.DOUBLET?4:0},chargeOrRadicalToMdlAtomLineValue:function(e,t){return e?Kekule.IO.Mdl2kUtils.chargeToMdlAtomLineValue(e):t?Kekule.IO.Mdl2kUtils.radicalToMdlAtomLineValue(e):0},bondStereoToKekule:function(e,t){if(t==Kekule.BondOrder.SINGLE)switch(e){case 1:return Kekule.BondStereo.UP;case 4:return Kekule.BondStereo.UP_OR_DOWN;case 6:return Kekule.BondStereo.DOWN;default:return Kekule.BondStereo.NONE}else{if(t!=Kekule.BondOrder.DOUBLE)return Kekule.BondStereo.NONE;switch(e){case 3:return Kekule.BondStereo.E_Z_BY_COORDINATES;default:return Kekule.BondStereo.NONE}}},bondStereoToMdlBondLineValue:function(e,t,r){var n=Kekule.BondStereo,o={};if(t==Kekule.BondOrder.SINGLE)if(r&&[n.UP_INVERTED,n.DOWN_INVERTED].indexOf(e)>=0&&(o.inverted=!0),o.inverted)e===n.UP_INVERTED?o.stereo=1:e===n.DOWN_INVERTED&&(o.stereo=6);else switch(e){case n.DOWN_INVERTED:case n.UP:o.stereo=1;break;case n.UP_INVERTED:case n.DOWN:o.stereo=6;break;case n.UP_OR_DOWN_INVERTED:case n.UP_OR_DOWN:o.stereo=4;break;default:o.stereo=0}else if(t==Kekule.BondOrder.DOUBLE)switch(e){case Kekule.BondStereo.E_Z_BY_COORDINATES:o.stereo=3;break;default:o.stereo=0}else o.stereo=0;return o},coordToStr:function(e){return(e||0).toFixed(4)},getMassDiff:function(e){var t=Kekule.ChemicalElementsDataUtil.getElementInfo(e.getAtomicNumber()).naturalMass;return Math.round(e.getMassNumber()-t)},getAtomListPropLineValue:function(e){var t="",r=e.getAllowedIsotopeIds();if(r&&r.length?t=" F ":(t=" T ",r=e.getDisallowedIsotopeIds()),r&&r.length){for(var n=[],o=0,i=r.length;o<i;++o){var a=Kekule.IsotopesDataUtil.getIsotopeIdDetail(r[o]);a&&a.symbol&&n.push(a.symbol.rpad(4))}var s=n.join("");return t=n.length.toString().lpad(3)+t+s}return null},getCtabPropLineTag:function(e,t){return(t||"M")+"  "+e},getCtabPropLineCountTag:function(e,t,r){var n=(r||"M")+"  "+e;return t&&(n+=t.toString().lpad(3)),n},generateCtabPropLine:function(e,t,r,n){return Kekule.IO.Mdl2kUtils.getCtabPropLineCountTag(t,r,n)+" "+e.join(" ")}},Kekule.IO.Mdl2kCTabReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl2kCTabReader",doReadBlock:function(e,t){return this.analysisCTab(e)},analysisCTab:function(e){var t={},r=e.readLine(),n=this.analysisCountLine(r),o=[];o.isCoord3D=!1;for(var i=0;i<n.atomCount;++i){r=e.readLine();var a=this.analysisAtomLine(r);a.z&&(o.isCoord3D=!0),o.push(a)}var s=[];for(i=0;i<n.bondCount;++i){r=e.readLine();var l=this.analysisBondLine(r);s.push(l)}for(i=0;i<n.atomListCount;++i){r=e.readLine();var u=this.analysisAtomListInfoLine(r);o[u.atomIndex]&&(o[u.atomIndex].atomListInfo=u)}for(i=0;i<n.stextCount;++i)r=e.readLine(),r=e.readLine();for(var c=[];!e.eof();){r=e.readLine();var d=this.analysisPropertyLine(r,o,c);if("END"===d.prop)break;if("SKP"===d.prop)for(i=0;i<d.count&&!e.eof();++i)r=e.readLine();else if("A"===d.leading){if(e.eof())break;var h=d.atomIndex;r=e.readLine(),o[h].symbol=r.trim()}}return t.countInfo=n,t.atomInfos=o,t.bondInfos=s,t.sgInfos=c,t},analysisCountLine:function(e){var t={},r=e.substr(33,6).trim();return r&&r!=Kekule.IO.MDL.VER2000?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL2000_FORMAT_DATA")),null):(r=e.substr(0,3),t.atomCount=parseInt(r,10),r=e.substr(3,3),t.bondCount=parseInt(r,10),r=e.substr(12,3),t.isChiral=0!=parseInt(r,10),r=e.substr(15,3),t.stextCount=parseInt(r,10),t)},analysisAtomLine:function(e){var t={},r=e.substr(0,10);t.x=parseFloat(r),r=e.substr(10,10),t.y=parseFloat(r),r=e.substr(20,10),t.z=parseFloat(r),r=e.substr(31,3),t.symbol=r.trim(),r=e.substr(34,2),t.massDiff=parseInt(r,10),r=e.substr(36,3);var n=parseInt(r,10),o=Kekule.IO.Mdl2kUtils.atomLineChargeToRadical(n);return o?t.radical=o:t.charge=Kekule.IO.Mdl2kUtils.atomLineChargeToKekule(n),r=e.substr(39,3),(n=parseInt(r,10))&&(t.parity=n),r=e.substr(42,3),(n=parseInt(r,10))>0&&(t.hydrongenCount=n-1),t},analysisBondLine:function(e){var t={},r=e.substr(0,3);t.atomIndex1=parseInt(r,10)-1,r=e.substr(3,3),t.atomIndex2=parseInt(r,10)-1,r=e.substr(6,3),t.order=Kekule.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(r,10)),r=e.substr(9,3);var n=Kekule.IO.Mdl2kUtils.bondStereoToKekule(parseInt(r,10),t.order);return n&&(t.stereo=n),t},analysisAtomListInfoLine:function(e){var t={},r=e.substr(0,3);t.atomIndex=parseInt(r,10)-1,r=e.substr(4,1),t.isAllowList="f"==r.toLowerCase(),r=e.substr(9,1);var n=Math.min(parseInt(r,10),5);t.atomicNumbers=[];for(var o=11,i=0;i<n;++i){o+=4*i,r=e.substr(o,3);var a=parseInt(r,10);a&&t.atomicNumbers.push(a)}return t},analysisPropertyLine:function(e,t,r){var n={},o=e.substr(0,1);if(n.leading=o,"M"==o){var i,a,s=e.substr(3,3).trim();if(n.prop=s,"END"===s)return n;if(["CHG","RAD","ISO"].indexOf(s)>=0){var l=parseInt(e.substr(6,3).trim());n.entryCount=l,n.entries=[];for(var u="CHG"===s?"charge":"RAD"===s?"radical":"massNumber",c=10,d=0;d<l;++d){var h=parseInt(e.substr(c,3).trim(),10)-1,f=parseInt(e.substr(c+4,3).trim(),10);c+=8,n.entries.push({atomIndex:h,propName:f}),t[h][u]=f}}else["STY","SLB"].indexOf(s)>=0?a=r[i=parseInt(e.substr(10,3),10)-1]:["SAL","SBL","SMT","SCL","SAP","SBV"].indexOf(s)>=0&&(a=r[i=parseInt(e.substr(7,3),10)-1]);switch(s){case"ALS":var m={},g=e.substr(7,3).trim();m.atomIndex=parseInt(g,10)-1,n.atomIndex=m.atomIndex;var p=parseInt(e.substr(10,3)),C=e.substr(14,1);m.isAllowList="f"==C.toLowerCase(),m.symbols=[];for(d=0;d<p;++d)C=e.substr(16+4*d,4).trim(),m.symbols.push(C);n.atomListInfo=m;var O=t[m.atomIndex].atomListInfo;O?O.isAllowList!==m.isAllowList?t[m.atomIndex].atomListInfo=m:O.symbols=Kekule.ArrayUtils.pushUnique(O.symbols,m.symbols):t[m.atomIndex].atomListInfo=m;break;case"STY":"SUP"==e.substr(14,3)&&(r[i]={sgType:"SUP"});break;case"SLB":a&&(a.labelId=e.substr(14).trim());break;case"SAL":if(a){var k=parseInt(e.substr(10,3));a.atomIndexes||(a.atomIndexes=[]);for(d=0;d<k;++d){C=e.substr(14+4*d,3),h=parseInt(C)-1;a.atomIndexes.push(h)}}break;case"SBL":if(a&&"SUP"==a.sgType){var S=parseInt(e.substr(10,3));a.crossBondIndexes||(a.crossBondIndexes=[]);for(d=0;d<S;++d){C=e.substr(14+4*d,3);var b=parseInt(C)-1;a.crossBondIndexes.push(b)}}break;case"SMT":a&&("SUP"==a.sgType?a.label=e.substr(11).trim():a.subscript=e.substr(11).trim());break;case"SCL":a&&(a.sgClass=e.substr(11).trim());break;case"SBV":if(a){var T=parseInt(e.substr(11,3),10)-1;a.bondVectors||(a.bondVectors=[]),a.bondVectors[T]={bondIndex:T,x:parseFloat(e.substr(14,10)),y:parseFloat(e.substr(24,10))};var E=e.substr(34,10).trim();E&&(a.bondVectors[T].z=parseFloat(E)||0)}}}else if("A"===o){c=3,h=parseInt(e.substr(c,3).trim(),10)-1;n.atomIndex=h}else if("V"===o);else if("G"===o);else if("S"===o){s=e.substr(3,3).trim();n.prop=s,n.count=parseInt(e.substr(6,3),10)}return n}}),Kekule.IO.Mdl2kCTabWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl2kCTabWriter",initialize:function(e){this.tryApplySuper("initialize"),this.setCoordMode(e||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:Kekule.CoordMode.UNKNOWN})},doWriteBlock:function(e,t){return Kekule.IO.MdlUtils.assertIlegalForCtabOutput(e),this.outputCtab(e,t)},outputCtab:function(e,t){var r=[],n=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(e);if(this.getCoordMode()!=Kekule.CoordMode.UNKNOWN&&(n.coordMode=this.getCoordMode()),t.writeLine(this.generateCountLine(n)),this.outputAtomBlock(e,n,t,r),this.outputBondBlock(e,n,t),r.length)for(var o=0,i=r.length;o<i;++o)t.writeLine(r[o]);this.outputSubgroupsPropLines(e,n,t),t.writeLine(Kekule.IO.Mdl2kUtils.getCtabPropLineTag("END"))},generateCountLine:function(e){return Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(e,Kekule.IO.MdlVersion.V2000)},outputAtomBlock:function(e,t,r,n){for(var o=0,i=t.atoms.length;o<i;++o){var a=t.atoms[o],s=this.generateAtomLine(o,t.coordMode,a,n);r.writeLine(s)}},generateAtomLine:function(e,t,r,n){var o=Kekule.IO.Mdl2kUtils.coordToStr,i="",a=(e+1).toString().lpad(3),s=t==Kekule.CoordMode.COORD3D?r.getAbsCoord3D():r.getAbsCoord2D();if(i+=o(s.x).lpad(10)+o(s.y).lpad(10)+o(s.z).lpad(10),i+=" "+Kekule.IO.MdlStructureUtils.getAtomTypeStr(r,!0).rpad(3),Kekule.IO.MdlStructureUtils.isNodeVariableAtom(r)){var l=Kekule.IO.Mdl2kUtils.getAtomListPropLineValue(r);if(l){var u=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("ALS")+" "+a+l;n.push(u)}}if(r.getMassNumber&&r.getMassNumber()){i+=(Kekule.IO.Mdl2kUtils.getMassDiff(r.getIsotope())||0).toString().lpad(2);u=Kekule.IO.Mdl2kUtils.generateCtabPropLine([a,r.getMassNumber().toString().lpad(3)],"ISO",1);n.push(u)}else i+="0".lpad(2);if(i+=Kekule.IO.Mdl2kUtils.chargeOrRadicalToMdlAtomLineValue(r.getCharge?r.getCharge():null,r.getRadical?r.getRadical():null).toString().lpad(3),r.getCharge&&r.getCharge()){u=Kekule.IO.Mdl2kUtils.generateCtabPropLine([a,r.getCharge().toString().lpad(3)],"CHG",1);n.push(u)}if(r.getRadical&&r.getRadical()){u=Kekule.IO.Mdl2kUtils.generateCtabPropLine([a,Kekule.IO.MdlUtils.kekuleRadicalToMdl(r.getRadical()).toString().lpad(3)],"RAD",1);n.push(u)}i+=(r.getParity&&r.getParity()||0).toString().lpad(3);var c=r.getExplicitHydrogenCount?r.getExplicitHydrogenCount():null;i+=(Kekule.ObjUtils.isUnset(c)?"0":(c+1).toString()).lpad(3);for(var d=0,h="0".lpad(3);d<8;++d)i+=h;return i},outputBondBlock:function(e,t,r){for(var n=0,o=t.bonds.length;n<o;++n){var i=t.bonds[n],a=this.generateBondLine(n,i,t.atoms);r.writeLine(a)}},generateBondLine:function(e,t,r){var n,o,i="";t.getStereo&&t.getBondOrder?n=(o=Kekule.IO.Mdl2kUtils.bondStereoToMdlBondLineValue(t.getStereo(),t.getBondOrder(),!0)).stereo.toString().lpad(3):(o={},n+="0".lpad(3));var a,s,l=Kekule.IO.MdlStructureUtils.splitConnectedNodes(t);return a=(r.indexOf(l.primaryNodes[0])+1).toString().lpad(3),s=(r.indexOf(l.primaryNodes[1])+1).toString().lpad(3),o&&o.inverted?i+=s+a:i+=a+s,t.getBondOrder?i+=Kekule.IO.MdlUtils.kekuleBondOrderToMdlType(t.getBondOrder()).toString().lpad(3):i+="0".lpad(3),i+=n,i+="0".lpad(3),i+="0".lpad(3),i+="0".lpad(3)},outputSubgroupsPropLines:function(e,t,r){for(var n=0,o=t.subGroups.length;n<o;++n)for(var i=this.generateSgroupLines(n,t.subGroups[n],t),a=0,s=i.length;a<s;++a)r.writeLine(i[a])},generateSgroupLines:function(e,t,r){var n=[],o=(e+1).toString().lpad(3),i=Kekule.IO.Mdl2kUtils.generateCtabPropLine([o,"SUP"],"STY",1);n.push(i),i=Kekule.IO.Mdl2kUtils.generateCtabPropLine([o,o],"SLB",1),n.push(i);var a=t.getAbbr&&t.getAbbr()||t.getFormulaText&&t.getFormulaText()||t.getName&&t.getName();a&&(i=Kekule.IO.Mdl2kUtils.generateCtabPropLine([o,a],"SMT"),n.push(i));for(var s=[],l=0,u=(p=t.getLeafNodes()).length;l<u;++l){(e=r.atoms.indexOf(p[l]))>=0&&s.push((e+1).toString().lpad(3))}s=s.sort();var c=Kekule.ArrayUtils.divide(s,15);for(l=0,u=c.length;l<u;++l){var d=c[l];i=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SAL")+" "+o+d.length.toString().lpad(3)+" "+d.join(" "),n.push(i)}var h=t.getCrossConnectors(),f=[],m=[],g=Kekule.IO.Mdl2kUtils.coordToStr;for(l=0,u=h.length;l<u;++l){if((e=r.bonds.indexOf(h[l]))>=0){f.push((e+1).toString().lpad(3));var p,C=[e+1],O={};2==(p=Kekule.IO.MdlStructureUtils.splitConnectedNodes(h[l]).primaryNodes).length&&(r.coordMode==Kekule.CoordMode.COORD2D?(O=Kekule.CoordUtils.substract(p[0].getAbsCoord2D(),p[1].getAbsCoord2D()),C=C.concat([g(O.x).lpad(10),g(O.y).lpad(10)])):(O=Kekule.CoordUtils.substract(p[0].getAbsCoord3D(),p[1].getAbsCoord3D()),C=C.concat([g(O.x),g(O.y),g(O.z)]))),m.push(C)}}f=f.sort();var k=Kekule.ArrayUtils.divide(f,15);for(l=0,u=k.length;l<u;++l){var S=k[l];i=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SBL")+" "+o+S.length.toString().lpad(3)+" "+S.join(" "),n.push(i)}for(l=0,u=m.length;l<u;++l){var b=m[l].shift(),T=m[l].join("");i=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SBV")+" "+o+" "+b.toString().lpad(3)+T,n.push(i)}return n}}),Kekule.IO.Mdl3kUtils={get3kBlockStartTag:function(e){return"BEGIN "+e.toUpperCase()},get3kBlockEndTag:function(e){return"END "+e.toUpperCase()},isAtomList:function(e){return e.search(/\[.+\]/)>=0},analysisAtomList:function(e){var t=/\[(.+)\]/g.exec(e);if(t&&t.length>=2){t=t[1].split(",");var r={};r.isAllowList=!(0==e.trim().indexOf("NOT")),r.symbols=[];for(var n=0,o=t.length;n<o;++n)r.symbols.push(t[n].trim());return r}return null},bondCfgToKekule:function(e){switch(e){case 0:return Kekule.BondStereo.NONE;case 1:return Kekule.BondStereo.UP;case 2:return Kekule.BondStereo.UP_OR_DOWN;case 3:return Kekule.BondStereo.DOWN;default:return Kekule.BondStereo.NONE}},bondStereoToMdlCfg:function(e,t){var r=Kekule.BondStereo,n={};if(t&&[r.UP_INVERTED,r.DOWN_INVERTED].indexOf(e)>=0&&(n.inverted=!0),n.inverted)e===r.UP_INVERTED?n.cfg=1:e===r.DOWN_INVERTED&&(n.cfg=3);else switch(e){case r.UP:case r.DOWN_INVERTED:n.cfg=1;break;case r.UP_OR_DOWN:n.cfg=2;break;case r.DOWN:case r.UP_INVERTED:n.cfg=3;break;default:n.cfg=0}return n},coordToStr:function(e){return(e||0).toFixed(6)}},Kekule.IO.Mdl3kValueUtils={SEPARATOR:" ",KEYVALUE_CONNECTOR:"=",STR_QUOTE:'"',ESC_QUOTE:'""',VALUELIST_PATTERN:/\(.+\)/g,split:function(e,t){for(var r=t||Kekule.IO.Mdl3kValueUtils.SEPARATOR,n=Kekule.IO.Mdl3kValueUtils.STR_QUOTE,o=[],i=!1,a=!1,s=!1,l="",u=0,c=e.length;u<c;++u){var d=e.charAt(u);d==n?!i&&e.charAt(u+1)==n||i&&e.charAt(u-1)==n||(i=!i):"["==d?a=!0:"]"==d?a=!1:"("==d?s=!0:")"==d&&(s=!1),d==r?i||a||s||!l?l+=d:(o.push(l),l=""):l+=d}return l&&o.push(l),o},merge:function(e,t){var r=t||Kekule.IO.Mdl3kValueUtils.SEPARATOR;return e.join(r)},isKeyValuePair:function(e){return e.indexOf(Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR)>=0},splitKeyValue:function(e){var t={},r=Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR,n=e.indexOf(r);return n<0?t.value=e:(t.key=e.substr(0,n),t.value=e.substr(n+r.length)),t},mergeKeyValue:function(e,t){return t?""+t+Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR+e:e},isValueList:function(e){return e.search(Kekule.IO.Mdl3kValueUtils.VALUELIST_PATTERN)>=0},splitValueList:function(e){var t=/\((.+)\)/.exec(e);if(t&&t.length>1){var r=t[1],n=Kekule.IO.Mdl3kValueUtils.split(r);return n.shift(),n}return[e]},mergeValueList:function(e){for(var t="("+e.length,r=0,n=e.length;r<n;++r)t+=Kekule.IO.Mdl3kValueUtils.SEPARATOR+e[r];return t+=")"},unquoteValue:function(e){var t=Kekule.IO.Mdl3kValueUtils.STR_QUOTE,r=e.trim();r.substr(0,t.length)==t&&(r=r.substr(t.length)),r.substr(r.length-t.length)==t&&(r=r.substr(0,r.length-t.length));var n=new RegExp(t+t,"g");return r=r.replace(n,t),Kekule.IO.Mdl3kValueUtils.isValueList(r)&&(r=Kekule.IO.Mdl3kValueUtils.splitValueList(r)),r},quoteValue:function(e){var t=Kekule.IO.Mdl3kValueUtils.STR_QUOTE,r=""+e,n=new RegExp(t,"g");return(r=r.replace(n,t+t)).indexOf(Kekule.IO.Mdl3kValueUtils.SEPARATOR)>=0&&(r=t+r+t),r},splitValues:function(e){for(var t=[],r=Kekule.IO.Mdl3kValueUtils.split(e),n=0,o=r.length;n<o;++n){var i=Kekule.IO.Mdl3kValueUtils.splitKeyValue(r[n]);i.value&&(i.value=Kekule.IO.Mdl3kValueUtils.unquoteValue(i.value)),t.push(i)}return t},mergeValues:function(e){for(var t,r=0,n=e.length;r<n;++r){var o,i,a,s=e[r];"object"!=typeof s||Kekule.ArrayUtils.isArray(s)?i=s:(o=s.key,i=s.value),a=Kekule.ArrayUtils.isArray(i)?Kekule.IO.Mdl3kValueUtils.mergeValueList(i):Kekule.IO.Mdl3kValueUtils.quoteValue(i),o&&(a=Kekule.IO.Mdl3kValueUtils.mergeKeyValue(a,o)),t=Kekule.IO.Mdl3kValueUtils.appendToken(t,a)}return t},appendToken:function(e,t,r){var n=r||Kekule.IO.Mdl3kValueUtils.SEPARATOR,o=e||"";return o&&o.substr(o.length-n.length,n.length)!=n?o+=Kekule.IO.Mdl3kValueUtils.SEPARATOR+t:o=t,o}},Kekule.IO.Mdl3kTextBuffer=Class.create(Kekule.TextLinesBuffer,{CLASS_NAME:"Kekule.Mdl3kTextBuffer",LEADING_TAG:"M  V30 ",LINE_CONTI_MARK:"-",MAX_COL_WIDTH:80,initialize:function(e){this.tryApplySuper("initialize",[e])},isStartWithLeadingTag:function(e){return e.substr(0,this.LEADING_TAG.length)==this.LEADING_TAG},isEndWithContinueMark:function(e){var t=e.trim();return t.substr(t.length-this.LINE_CONTI_MARK.length)==this.LINE_CONTI_MARK},getLineWithout3kTag:function(e){if(!e)return e;var t=this.LEADING_TAG.length;return e.substr(0,t)==this.LEADING_TAG?e.substr(t):e},getLineAtEx:function(e){var t=this.getLineAt(e),r=1;if(t&&this.isEndWithContinueMark(t)&&this.isStartWithLeadingTag(this.getLines()[e])){var n=t.lastIndexOf(this.LINE_CONTI_MARK);t=t.substr(0,n);var o=this.getLineAtEx(e+1);t+=o.line,r+=o.lineCount}return{line:t,lineCount:r}},getLineAt:function(e){var t=this.tryApplySuper("getLineAt",[e]);return this.getLineWithout3kTag(t)},readLine:function(){var e=this.getLineAtEx(this.getCurrLineNo());return this.incCurrLineNo(e.lineCount),e.line||""},writeLine:function(e,t){if(t)return this.tryApplySuper("writeLine",[e]);var r,n=e;if(this.isStartWithLeadingTag(e)||(n=this.LEADING_TAG+n),n.length>this.MAX_COL_WIDTH){var o=this.LINE_CONTI_MARK,i=(Kekule.IO.Mdl3kValueUtils.SEPARATOR,this.MAX_COL_WIDTH-o.length);r=n.substr(i),n=n.substr(0,i),n+=o}var a=this.tryApplySuper("writeLine",[n]);return r&&(a=this.writeLine(r,t)),a},writeLines:function(e,t){for(var r=0,n=e.length;r<n;++r)this.writeLine(e[r],t)},getBlockBuffer:function(e,t){for(var r,n=Kekule.IO.Mdl3kUtils.get3kBlockStartTag(e),o=Kekule.IO.Mdl3kUtils.get3kBlockEndTag(e),i=this.getCurrLineNo(),a=this.readLine().trim();a!=n&&!this.eof();)a=this.readLine().trim();if(this.eof())r=null;else{var s=this.getCurrLineNo(),l=this.getCurrLineNo();for(a=this.readLine().trim();a!=o&&!this.eof();)l=this.getCurrLineNo(),a=this.readLine().trim();if(a==o)var u=this.getLines().slice(s,l);else u=this.getLines().slice(s);r=new Kekule.IO.Mdl3kTextBuffer(u)}return t&&this.setCurrLineNo(i),r}}),Kekule.IO.Mdl3kBlockReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kBlockReader",createTextBuffer:function(){return new Kekule.IO.Mdl3kTextBuffer},doReadBlock:function(e,t){var r,n=!(e instanceof Kekule.IO.Mdl3kTextBuffer);n?(r=new Kekule.IO.Mdl3kTextBuffer).setLines(e.getUnreadLines()):r=e;var o=r.getCurrLineNo(),i=this.doRead3kBlock(r,t),a=r.getCurrLineNo();if(n){var s=a-o;e.incCurrLineNo(s)}return i},doRead3kBlock:function(e,t){}}),Kekule.IO.Mdl3kBlockWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kBlockWriter",createTextBuffer:function(){return new Kekule.IO.Mdl3kTextBuffer},writeStartTag:function(e,t){t.writeLine(Kekule.IO.Mdl3kUtils.get3kBlockStartTag(e))},writeEndTag:function(e,t){t.writeLine(Kekule.IO.Mdl3kUtils.get3kBlockEndTag(e))},doWriteBlock:function(e,t){var r,n=!(t instanceof Kekule.IO.Mdl3kTextBuffer);n?((r=new Kekule.IO.Mdl3kTextBuffer).setLines(t.getUnreadLines()),r.reset()):r=t;var o=this.doWrite3kBlock(e,r);return n&&t.appendLines(n.getLines()),o},doWrite3kBlock:function(e,t){}}),Kekule.IO.Mdl3kCTabReader=Class.create(Kekule.IO.Mdl3kBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kCTabReader",doRead3kBlock:function(e,t){var r=e.getBlockBuffer("CTAB");return r||(r=e).reset(),this.analysisCTab(r)},analysisCTab:function(e){var t={},r=e.readLine(),n=this.analysisCountLine(r);if(!n)return null;var o,i,a=[],s=e.getBlockBuffer("ATOM");if(!s)return Kekule.raise(Kekule.$L("ErrorMsg.MDL3000_ATOMBLOCK_NOT_FOUND")),null;o=this.analysisAtomBlock(s,a);var l,u=e.getBlockBuffer("BOND");u&&(i=this.analysisBondBlock(u,a));var c=e.getBlockBuffer("SGROUP");return c&&(l=this.analysisSGroupBlock(c,a)),t.countInfo=n,t.atomInfos=o,t.atomIndexMap=a,i&&(t.bondInfos=i),l&&(t.sgInfos=l),t},analysisCountLine:function(e){var t={},r=Kekule.IO.Mdl3kValueUtils.splitValues(e);if("COUNTS"==r.shift().value){var n=r.shift().value;return t.atomCount=parseInt(n,10),n=r.shift().value,t.bondCount=parseInt(n,10),n=r.shift().value,t.sgroupCount=parseInt(n,10),n=r.shift().value,t.isChiral=0!=parseInt(n,10),t}Kekule.raise(Kekule.$L("ErrorMsg.MALFORMED_MDL3000_COUNTLINE"))},analysisAtomBlock:function(e,t){for(var r=Kekule.CoordMode.COORD2D,n=[];!e.eof();){var o=e.readLine(),i=this.analysisAtomLine(o),a=n.push(i)-1;t[i.index]=a,i.z&&(r=Kekule.CoordMode.COORD3D)}return n.coordMode=r,n.isCoord3D=r==Kekule.CoordMode.COORD3D,n},analysisAtomLine:function(e,t){var r={},n=Kekule.IO.Mdl3kValueUtils.splitValues(e);r.index=parseInt(n.shift().value,10);var o=n.shift().value.trim();if(Kekule.IO.Mdl3kUtils.isAtomList(o)){var i=Kekule.IO.Mdl3kUtils.analysisAtomList(o);i&&(r.atomListInfo=i,r.symbol="L")}else r.symbol=o;r.x=parseFloat(n.shift().value),r.y=parseFloat(n.shift().value),r.z=parseFloat(n.shift().value),n.shift();for(var a=0,s=n.length;a<s;++a){var l=n[a],u=l.key,c=l.value;switch(u){case"CHG":(d=parseInt(c,10))&&(r.charge=d);break;case"RAD":(d=parseInt(c,10))&&(r.radical=d);break;case"CFG":(d=parseInt(c,10))&&(r.parity=d);break;case"MASS":r.massNumber=parseFloat(c);break;case"VAL":break;case"HCOUNT":(d=parseInt(c,10))&&(r.hydrongenCount=-1==d?0:d-1);break;case"RGROUPS":var d;(d=parseInt(c,10))&&(r.rgroupCount=d)}}return r},analysisBondBlock:function(e,t){for(var r=[];!e.eof();){var n=e.readLine(),o=this.analysisBondLine(n,t);r[o.index]=o}return r},analysisBondLine:function(e,t){var r={},n=Kekule.IO.Mdl3kValueUtils.splitValues(e);r.index=parseInt(n.shift().value,10);var o=n.shift().value;r.order=Kekule.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(o,10)),r.atomIndex1=t[parseInt(n.shift().value,10)],r.atomIndex2=t[parseInt(n.shift().value,10)];for(var i=0,a=n.length;i<a;++i){var s=n[i].key,l=n[i].value;switch(s){case"CFG":var u=parseInt(l,10);r.stereo=Kekule.IO.Mdl3kUtils.bondCfgToKekule(u);break;case"ENDPTS":if(Kekule.ArrayUtils.isArray(l)){r.endAtomIndexes=[];for(var c=0,d=l.length;c<d;++c)r.endAtomIndexes.push(t[parseInt(l[c],10)])}else r.endAtomIndexes=[t[parseInt(l,10)]]}}return r},analysisSGroupBlock:function(e,t){var r=[],n=null,o=e.getCurrLineNo(),i=e.readLine();for("DEFAULT"==Kekule.IO.Mdl3kValueUtils.splitValues(i).shift().value?n=this.fetchSGroupOptionalValues(i,t):e.setCurrLineNo(o);!e.eof();){i=e.readLine();var a=this.analysisSGroupLine(i,t,n);r[a.index]=a}return r},analysisSGroupLine:function(e,t,r){var n={},o=Kekule.IO.Mdl3kValueUtils.splitValues(e);n.index=parseInt(o.shift().value,10),n.sgType=o.shift().value.trim(),n.extIndex=parseInt(o.shift().value,10);var i=this.fetchSGroupOptionalValues(o,t);return r&&(i=Object.extend(r,i)),n=Object.extend(n,i)},fetchSGroupOptionalValues:function(e,t){for(var r={},n=0,o=e.length;n<o;++n){var i=e[n].key,a=e[n].value;switch(i){case"ATOMS":r.atomIndexes=[];for(var s=0,l=a.length;s<l;s++)r.atomIndexes.push(t[a[s]]);break;case"XBONDS":r.crossBondIndexes=[].concat(a);break;case"SUBTYPE":r.subType=a;break;case"LABEL":r.label=a;break;case"CSTATE":r.bondVectors||(r.bondVectors=[]);var u=parseInt(a.shift(),10),c=parseFloat(a.shift())||0,d=parseFloat(a.shift())||0,h=parseFloat(a.shift())||0;r.bondVectors[u]={bondIndex:u,x:c,y:d,z:h};break;case"CLASS":r.sgClass=a}}return r}}),Kekule.IO.Mdl3kCTabWriter=Class.create(Kekule.IO.Mdl3kBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kCTabWriter",initialize:function(e){this.tryApplySuper("initialize"),this.setCoordMode(e||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:Kekule.CoordMode.UNKNOWN})},doWrite3kBlock:function(e,t){return Kekule.IO.MdlUtils.assertIlegalForCtabOutput(e),this.outputCtab(e,t)},outputCtab:function(e,t){var r=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(e);this.writeStartTag("CTAB",t),this.getCoordMode()!=Kekule.CoordMode.UNKNOWN&&(r.coordMode=this.getCoordMode()),t.writeLine(this.generateCountLine(r)),this.outputAtomBlock(e,r,t),this.outputBondBlock(e,r,t),this.outputSgroupBlock(e,r,t),this.writeEndTag("CTAB",t)},generateCompatibilityCountLine:function(e){return Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(e,Kekule.IO.MdlVersion.V3000)},generateCountLine:function(e){var t=["COUNTS"];return t.push(e.atoms.length),t.push(e.bonds.length),t.push(e.subGroups.length),t.push(0),t.push(0),Kekule.IO.Mdl3kValueUtils.mergeValues(t)},outputAtomBlock:function(e,t,r){this.writeStartTag("ATOM",r);for(var n=0,o=t.atoms.length;n<o;++n){var i=t.atoms[n],a=this.generateAtomLine(n,t.coordMode,i);r.writeLine(a)}this.writeEndTag("ATOM",r)},generateAtomLine:function(e,t,r){var n=Kekule.IO.Mdl3kUtils.coordToStr,o=[e+1,Kekule.IO.MdlStructureUtils.getAtomTypeStr(r)];if(t==Kekule.CoordMode.COORD2D){var i=r.getAbsCoord2D();o=o.concat([n(i.x),n(i.y),n(0)])}else{i=r.getAbsCoord3D();o=o.concat([n(i.x),n(i.y),n(i.z)])}return o.push(0),r.getCharge&&r.getCharge()&&o.push({key:"CHG",value:r.getCharge()}),r.getRadical&&r.getRadical()&&o.push({key:"RAD",value:r.getRadical()}),r.getParity&&r.getParity()&&o.push({key:"CFG",value:r.getParity()}),r.getMassNumber&&r.getMassNumber()&&o.push({key:"MASS",value:r.getMassNumber()}),r.getExplicitHydrogenCount&&!Kekule.ObjUtils.isUnset(r.getExplicitHydrogenCount())&&o.push({key:"HCOUNT",value:r.getExplicitHydrogenCount()+1}),Kekule.IO.Mdl3kValueUtils.mergeValues(o)},outputBondBlock:function(e,t,r){if(!(t.bonds.length<=0)){this.writeStartTag("BOND",r);for(var n=0,o=t.bonds.length;n<o;++n){var i=t.bonds[n],a=this.generateBondLine(n,i,t.atoms);r.writeLine(a)}this.writeEndTag("BOND",r)}},generateBondLine:function(e,t,r){var n=[e+1,Kekule.IO.MdlUtils.kekuleBondOrderToMdlType(t.getBondOrder?t.getBondOrder():Kekule.BondOrder.UNSET)],o=t.getStereo&&t.getStereo()?Kekule.IO.Mdl3kUtils.bondStereoToMdlCfg(t.getStereo(),!0):{},i=[],a=[],s=Kekule.IO.MdlStructureUtils.splitConnectedNodes(t),l=r.indexOf(s.primaryNodes[0])+1,u=r.indexOf(s.primaryNodes[1])+1;if(i=o.inverted?[u,l]:[l,u],s.remainNodes&&s.remainNodes.length)for(var c=0,d=s.remainNodes.length;c<d;++c)a.push(r.indexOf(s.remainNodes[c])+1);return n=n.concat(i),o&&o.cfg&&n.push({key:"CFG",value:o.cfg}),a.length>0&&(n.push({key:"ENDPTS",value:a}),n.push({key:"ATTACH",value:"ALL"})),Kekule.IO.Mdl3kValueUtils.mergeValues(n)},outputSgroupBlock:function(e,t,r){if(!(t.subGroups.length<=0)){this.writeStartTag("SGROUP",r);for(var n=0,o=t.subGroups.length;n<o;++n){var i=this.generateSgroupLine(n,t.subGroups[n],t);r.writeLine(i)}this.writeEndTag("SGROUP",r)}},generateSgroupLine:function(e,t,r){for(var n=r.atoms,o=r.bonds,i=[e+1,"SUP",e+1],a=[],s=0,l=(m=t.getLeafNodes()).length;s<l;++s){(e=n.indexOf(m[s]))>=0&&a.push(e+1)}a=a.sort(),i.push({key:"ATOMS",value:a});var u=t.getAbbr&&t.getAbbr()||t.getFormulaText&&t.getFormulaText()||t.getName&&t.getName();u&&i.push({key:"LABEL",value:u});var c=t.getCrossConnectors(),d=[],h=[],f=Kekule.IO.Mdl3kUtils.coordToStr;for(s=0,l=c.length;s<l;++s){if((e=o.indexOf(c[s]))>=0){d.push(e+1);var m,g=[e+1],p={};2==(m=Kekule.IO.MdlStructureUtils.splitConnectedNodes(c[s]).primaryNodes).length&&(r.coordMode==Kekule.CoordMode.COORD2D?(p=Kekule.CoordUtils.substract(m[0].getAbsCoord2D(),m[1].getAbsCoord2D()),g=g.concat([f(p.x),f(p.y),0])):(p=Kekule.CoordUtils.substract(m[0].getAbsCoord3D(),m[1].getAbsCoord3D()),g=g.concat([f(p.x),f(p.y),f(p.z)]))),h.push(g)}}d=d.sort(),i.push({key:"XBONDS",value:d});for(s=0,l=h.length;s<l;++s)i.push({key:"CSTATE",value:h[s]});return Kekule.IO.Mdl3kValueUtils.mergeValues(i)}}),Kekule.globalOptions.add("IO.mdl",{mdlVersion:Kekule.IO.MdlVersion.V2000,coordMode:Kekule.CoordMode.UNKNOWN}),Kekule.IO.MdlStructureFragmentReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentReader",initialize:function(e){this.tryApplySuper("initialize"),this.setCoordMode(e||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},createFragment:function(e){},createCtabReader:function(e){return e==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kCTabReader:new Kekule.IO.Mdl2kCTabReader},getCtabVersion:function(e){var t=e.getCurrLineNo(),r=e.readLine();e.setCurrLineNo(t);var n=r.substr(33,6).trim();return"V3000"==n?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000},createStructureFromJson:function(e,t){var r=this.createFragment();return r&&Kekule.IO.MdlStructureUtils.fillFragment(r,e,this.getCoordMode()),r},doReadBlock:function(e,t){var r=this.getCtabVersion(e);if(!r)return null;var n=this.createCtabReader(r).doReadBlock(e,t);return n.atomInfos.coordMode&&(this._forceCoordMode=n.atomInfos.coordMode),this.createStructureFromJson(n,t)}}),Kekule.IO.MdlStructureFragmentWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentWriter",initialize:function(e,t){this.tryApplySuper("initialize"),this.setMdlVersion(e||Kekule.IO.MdlVersion.V2000),this.setCoordMode(t||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},createCtabWriter:function(e){return e==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kCTabWriter(this.getCoordMode()):new Kekule.IO.Mdl2kCTabWriter(this.getCoordMode())},doWriteBlock:function(e,t){var r=this.createCtabWriter(this.getMdlVersion()).writeBlock(e);t.writeText(r)}}),Kekule.IO.Mdl3kMoleculeCTabReader=Class.create(Kekule.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabReader",createFragment:function(e){return new Kekule.Molecule},doReadBlock:function(e,t){var r=this.createCtabReader(Kekule.IO.MdlVersion.V3000).doReadBlock(e,t);return this.createStructureFromJson(r,t)}}),Kekule.IO.Mdl3kMoleculeCTabWriter=Class.create(Kekule.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabWriter",initialize:function(e){this.tryApplySuper("initialize",[Kekule.IO.MdlVersion.V3000,e])},doWriteBlock:function(e,t){var r=new Kekule.IO.Mdl3kCTabWriter(this.getCoordMode()).writeBlock(e);t.writeText(r)}}),Kekule.IO.MdlMoleculeReader=Class.create(Kekule.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.MdlMoleculeReader",createFragment:function(e){return new Kekule.Molecule},readHeaderInfo:function(e,t){var r={},n=e.readLine();n&&(r.name=n);var o=e.readLine(),i=this.readInfoLine(o);i&&(r=Object.extend(r,i));var a=e.readLine();return a&&(r.comment=a),r},readInfoLine:function(e){var t={};if(e.trim()){var r=e.substr(0,2).trim();r&&(t.userAbbr=r),(r=e.substr(2,8).trim())&&(t.programName=r),(r=e.substr(10,10)).trim()&&(t.date=Kekule.IO.MdlUtils.analysisMdlDateTimeStr(r,!1)),r=e.substr(20,2),t.coordMode="3D"==r?Kekule.CoordMode.COORD3D:"2D"==r?Kekule.CoordMode.COORD2D:Kekule.CoordMode.UNKNOWN}return t},doReadBlock:function(e,t){var r=this.readHeaderInfo(e,t);r&&void 0!==r.coordMode&&this.setCoordMode(r.coordMode);var n=this.tryApplySuper("doReadBlock",[e,t]);(n&&r&&(r.name&&n.setName(r.name),r.userAbbr&&n.setInfoValue("author",r.userAbbr),r.programName&&n.setInfoValue("generator",r.programName),r.date&&n.setInfoValue("date",r.date),r.comment&&n.setInfoValue("comment",r.comment)),e.eof())||"M  END"===e.getCurrLine().trim().toUpperCase()&&e.readLine();return n}}),Kekule.IO.MdlMoleculeWriter=Class.create(Kekule.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.MdlMoleculeWriter",writeHeaderInfo:function(e,t){t.writeLine(e.getName()||Kekule.$L("Texts.UNNAMED")||"");var r=this.generateInfoLine(e);t.writeLine(r);var n=e.getInfoValue("comment");t.writeLine(n||"")},generateInfoLine:function(e){var t="",r=e.getInfoValue("author");t+=r?r.toString().substr(0,2).rpad(2):"  ";var n=e.getInfoValue("generator");t+=n?n.toString().substr(0,8).rpad(8):Kekule.LIBNAME_CORE.rpad(8);var o=e.getInfoValue("date")||new Date;return t+=Kekule.IO.MdlUtils.generateMdlDateTimeStr(o,!1),t+=this.getCoordMode()==Kekule.CoordMode.COORD3D?"3D":"2D"},getMolecule:function(e){return Kekule.ChemStructureUtils.getTotalStructFragment(e)},doWriteBlock:function(e,t){var r=this.getMolecule(e);if(r){var n=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(r);this.setCoordMode(n.coordMode),this.writeHeaderInfo(r,t),this.getMdlVersion()==Kekule.IO.MdlVersion.V3000&&t.writeLine(Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(n,this.getMdlVersion())),this.tryApplySuper("doWriteBlock",[r,t]),this.getMdlVersion()==Kekule.IO.MdlVersion.V3000&&t.writeLine("M  END")}}}),Kekule.IO.MdlStructDataReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructDataReader",DATA_HEAD_PREFIX:Kekule.IO.MDL.SD_DATA_HEAD_PREFIX,DATA_DBFIELD_PATTERN:/\bDT(\d+)\b/,DATA_KEY_NAME_PATTERN:/\<(.+)\>/,MOL_DELIMITER:Kekule.IO.MDL.MOL_DELIMITER,doReadBlock:function(e,t){var r=new Kekule.IO.MdlMoleculeReader;try{for(var n,o,i,a=[];!e.eof();){try{i=r.doReadBlock(e,null)}catch(e){i=null}if(!i)break;for(a.push(i),n=null,o=null;!e.eof();){var s=this.analysisDataLine(e.readLine());if(s){var l=s.lineType;if("dataheader"===l)n=s.key;else if("datavalue"===l)n&&(o=s.value,i.setInfoValue(n,o));else if("moldelimiter"===l)break}}}if(a.length>1){for(var u=new Kekule.ChemObjList,c=0,d=a.length;c<d;++c)u.append(a[c]);return u}return a[0]}finally{r.finalize()}},analysisDataLine:function(e){var t,r=e.trim();return r.startsWith(this.DATA_HEAD_PREFIX)?("dataheader",(t=this.getDataHeaderKey(e))?{lineType:"dataheader",key:t}:null):r.startsWith(this.MOL_DELIMITER)?{lineType:"moldelimiter"}:r?{lineType:"datavalue",value:e}:null},getDataHeaderKey:function(e){var t=this.DATA_KEY_NAME_PATTERN.exec(e);return t&&t.length>1?t[1]:(t=this.DATA_DBFIELD_PATTERN.exec(e))&&t.length>1?t[1]:e},doReadDataBlock:function(e,t){e.readLine()}}),Kekule.IO.MdlStructDataWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructDataWriter",IGNORED_INFO_FIELDS:["generator","author","date","comment"],initialize:function(e,t){this.tryApplySuper("initialize"),this.setMdlVersion(e||Kekule.IO.MdlVersion.V2000),this.setCoordMode(t||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteBlock:function(e,t){var r=this.getChildMols(e),n=new Kekule.IO.MdlMoleculeWriter;n.setMdlVersion(this.getMdlVersion()),n.setCoordMode(this.getCoordMode());for(var o=0,i=r.length;o<i;++o){var a=r[o];try{var s=n.writeBlock(a);t.writeText(s);var l=this.getMolData(a);this.doWriteDataBlock(l,t),t.writeLine(Kekule.IO.MDL.MOL_DELIMITER)}catch(e){}}},doWriteDataBlock:function(e,t){for(var r=Kekule.ObjUtils.getOwnedFieldNames(e),n=0,o=r.length;n<o;++n){var i=r[n];if(this.IGNORED_INFO_FIELDS.indexOf(i)<0){var a=Kekule.IO.MDL.SD_DATA_HEAD_PREFIX+" <"+i+">",s=e[i];a&&s&&(t.writeLine(a),t.writeLine(s),t.writeLine(""))}}},getChildMols:function(e){for(var t=Kekule.ChemStructureUtils.getChildStructureObjs(e,!0),r=[],n=0,o=t.length;n<o;++n){var i=t[n];i instanceof Kekule.StructureFragment&&r.push(i)}return r},getMolData:function(e){return e.getInfo?e.getInfo()||{}:null}}),Kekule.IO.MdlBaseReactionReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlBaseReactionReader",readHeaderBlock:function(e,t){var r,n={},o=e.readLine().trim();return"$RXN"!=(r=o.substr(0,4))?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL_RXN_DATA")),null):(r=o.substr(4).trim(),n.version="V3000"==r?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000,(o=e.readLine().trim())&&(n.name=o),(r=(o=e.readLine()).substr(0,6).trim())&&(n.userAbbr=r),(r=o.substr(6,9).trim())&&(n.programName=r),(r=o.substr(15,10)).trim()&&(n.date=Kekule.IO.MdlUtils.analysisMdlDateTimeStr(r,!0)),(o=e.readLine().trim())&&(n.comment=o),n)},readSubstanceCountLine:function(e){},readMolBlock:function(e){},doReadBlock:function(e,t){for(var r=this.readHeaderBlock(e,null),n=this.readSubstanceCountLine(e.readLine()),o=new Kekule.Reaction,i=0;i<n.reactantCount;++i){(a=this.readMolBlock(e))&&o.appendReactant(a)}for(i=0;i<n.productCount;++i){var a;(a=this.readMolBlock(e))&&o.appendProduct(a)}return o&&r&&(r.name&&o.setName(r.name),r.userAbbr&&o.setInfoValue("author",r.userAbbr),r.programName&&o.setInfoValue("generator",r.programName),r.date&&o.setInfoValue("date",r.date),r.comment&&o.setInfoValue("comment",r.comment)),o}}),Kekule.IO.Mdl2kReactionReader=Class.create(Kekule.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl2kReactionReader",readHeaderBlock:function(e,t){var r=this.tryApplySuper("readHeaderBlock",[e,t]);return r.version!=Kekule.IO.MdlVersion.V2000?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL2000_RXN_DATA")),null):r},readSubstanceCountLine:function(e){var t={};return t.reactantCount=parseInt(e.substr(0,3),10)||0,t.productCount=parseInt(e.substr(3,3),10)||0,t},readMolBlock:function(e){for(var t=e.readLine();"$MOL"!==t&&!e.eof();)t=e.readLine();if(e.eof())return null;var r=[];for(t=e.getCurrLine();"$MOL"!==t&&!e.eof();)r.push(t),e.incCurrLineNo(),t=e.getCurrLine();return(new Kekule.IO.MdlMoleculeReader).readBlock(r,null)}}),Kekule.IO.Mdl3kReactionReader=Class.create(Kekule.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl3kReactionReader",createTextBuffer:function(){return new Kekule.IO.Mdl3kTextBuffer},readHeaderBlock:function(e,t){var r=this.tryApplySuper("readHeaderBlock",[e,t]);return r.version!=Kekule.IO.MdlVersion.V3000?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL3000_RXN_DATA")),null):r},readSubstanceCountLine:function(e){var t={},r=Kekule.IO.Mdl3kValueUtils.splitValues(e);return"COUNTS"!=r.shift().value.trim()?(Kekule.error(Kekule.$L("ErrorMsg.NOT_MDL3000_RXN_COUNTLINE")),null):(t.reactantCount=parseInt(r.shift().value,10)||0,t.productCount=parseInt(r.shift().value,10)||0,t)},readMolBlock:function(e){if(e.getBlockBuffer){var t=e.getBlockBuffer("CTAB");return(new Kekule.IO.Mdl3kMoleculeCTabReader).doReadBlock(t)}return null}}),Kekule.IO.MdlReactionReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlReactionReader",doReadBlock:function(e,t){return(Kekule.IO.MdlUtils.getRxnMarkVersion(e.getCurrLine())==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kReactionReader:new Kekule.IO.Mdl2kReactionReader).readBlock(e.getUnreadLines(),t)}}),Kekule.IO.MdlReactionWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlReactionWriter",initialize:function(e,t){this.tryApplySuper("initialize"),this.setMdlVersion(e||Kekule.IO.MdlVersion.V2000),this.setCoordMode(t||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},writeHeaderBlock:function(e,t){var r;r="$RXN"+(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?" "+Kekule.IO.MDL.VER3000:""),t.writeLine(r),t.writeLine(e.getName()||""),r=(e.getInfoValue("author")||"").substr(0,6).rpad(6),r+=(e.getInfoValue("generator")||"").substr(0,9).rpad(9);var n=e.getInfoValue("date")||new Date;r+=Kekule.IO.MdlUtils.generateMdlDateTimeStr(n,!0),t.writeLine(r);var o=e.getInfoValue("comment")||"";t.writeLine(o)},generateSubstanceCountLine:function(e){return this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?"M  V30 COUNTS "+Kekule.IO.Mdl3kValueUtils.mergeValues([e.getReactantCount(),e.getProductCount()]):e.getReactantCount().toString().lpad(3)+e.getProductCount().toString().lpad(3)},writeMolDelimiterLine:function(e){this.getMdlVersion()==Kekule.IO.MdlVersion.V2000&&e.writeLine("$MOL")},writeMolBlock:function(e,t){var r=(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kMoleculeCTabWriter(this.getCoordMode()):new Kekule.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode())).writeBlock(e);t.writeText(r)},doWriteBlock:function(e,t){var r=this.getMdlVersion()==Kekule.IO.MdlVersion.V3000;this.writeHeaderBlock(e,t);var n=this.generateSubstanceCountLine(e);t.writeLine(n),r&&t.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockStartTag("REACTANT"));for(var o=0;o<e.getReactantCount();++o)this.writeMolDelimiterLine(t),this.writeMolBlock(e.getReactantAt(o),t);r&&t.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockEndTag("REACTANT")),r&&t.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockStartTag("PRODUCT"));for(o=0;o<e.getProductCount();++o)this.writeMolDelimiterLine(t),this.writeMolBlock(e.getProductAt(o),t);r&&(t.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockEndTag("PRODUCT")),t.writeLine("M  END"))}}),Kekule.IO.BaseMdlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.BaseMdlReader",doReadData:function(e,t,r){return t!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT")),null):this.doReadMdlData(e)},doReadMdlData:function(e){return null}}),Kekule.IO.BaseMdlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.BaseMdlWriter",initialize:function(e){this.tryApplySuper("initialize",[e]),e||(e={}),this.setMdlVersion(e.mdlVersion||Kekule.globalOptions.IO.mdl.mdlVersion),this.setCoordMode(e.coordMode||Kekule.globalOptions.IO.mdl.coordMode)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteData:function(e,t,r){var n=t||Kekule.IO.ChemDataType.TEXT;return n!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.MDL_OUTPUT_DATATYPE_NOT_TEXT")),null):this.tryApplySuper("doWriteData",[e,n,r])}}),Kekule.IO.MdlMolReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlMolReader",doReadMdlData:function(e){return(new Kekule.IO.MdlMoleculeReader).readBlock(e,null)}}),Kekule.IO.MdlMolWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlMolWriter",doWriteData:function(e,t,r){return new Kekule.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(e)}}),Kekule.IO.MdlSdReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlSdReader",doReadMdlData:function(e){return(new Kekule.IO.MdlStructDataReader).readBlock(e,null)}}),Kekule.IO.MdlSdWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlSdWriter",doWriteData:function(e,t,r){return new Kekule.IO.MdlStructDataWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(e)}}),Kekule.IO.MdlRxnReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlRxnReader",doReadMdlData:function(e){return(new Kekule.IO.MdlReactionReader).readBlock(e,null)}}),Kekule.IO.MdlRxnWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlRxnWriter",doWriteData:function(e,t,r){return new Kekule.IO.MdlReactionWriter(this.getMdlVersion(),this.getCoordMode()).writeBlock(e)}}),Kekule.IO.MdlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.MdlReader",doReadData:function(e,t,r){return t!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT")),null):("$RXN"==e.substr(0,4)?new Kekule.IO.MdlReactionReader:new Kekule.IO.MdlMoleculeReader).readBlock(e,null)}}),Kekule.IO.MdlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.MdlWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setMdlVersion(t.mdlVersion||Kekule.globalOptions.IO.mdl.mdlVersion),this.setCoordMode(t.coordMode||Kekule.globalOptions.IO.mdl.coordMode)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000}),this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteData:function(e,t,r){var n;if(e instanceof Kekule.Reaction)n=new Kekule.IO.MdlRxnWriter(this.getMdlVersion(),this.getCoordMode());else{if(!(e instanceof Kekule.StructureFragment)){var o=e&&e.getClassName?e.getClassName():typeof e;return Kekule.error(Kekule.$L("ErrorMsg.UNABLE_TO_OUTPUT_AS_MDL").format(o)),null}n=new Kekule.IO.MdlMolWriter(this.getMdlVersion(),this.getCoordMode())}if(n)return n.writeData(e)}}),function(){Kekule.IO.DataFormat.MOL="mol",Kekule.IO.DataFormat.RXN="rxn",Kekule.IO.DataFormat.SD="sd",Kekule.IO.DataFormat.MOL3K="mol3k",Kekule.IO.DataFormat.RXN3K="rxn3k",Kekule.IO.MimeType.MDL_MOL="chemical/x-mdl-molfile",Kekule.IO.MimeType.MDL_RXN="chemical/x-mdl-rxnfile",Kekule.IO.MimeType.MDL_SD="chemical/x-mdl-sdfile",Kekule.IO.DataFormatsManager.register("mol",Kekule.IO.MimeType.MDL_MOL,"mol",Kekule.IO.ChemDataType.TEXT,"MDL Mol 2000 format"),Kekule.IO.DataFormatsManager.register("rxn",Kekule.IO.MimeType.MDL_RXN,"rxn",Kekule.IO.ChemDataType.TEXT,"MDL Reaction 2000 format"),Kekule.IO.DataFormatsManager.register("sd",Kekule.IO.MimeType.MDL_SD,["sd","sdf"],Kekule.IO.ChemDataType.TEXT,"MDL Structure-Data format"),Kekule.IO.DataFormatsManager.register("mol3k",Kekule.IO.MimeType.MDL_MOL,"mol",Kekule.IO.ChemDataType.TEXT,"MDL Mol 3000 format"),Kekule.IO.DataFormatsManager.register("rxn3k",Kekule.IO.MimeType.MDL_RXN,"rxn",Kekule.IO.ChemDataType.TEXT,"MDL Reaction 3000 format"),Kekule.IO.ChemDataReaderManager.register("MDL-mol",Kekule.IO.MdlMolReader,["mol","mol3k"]),Kekule.IO.ChemDataReaderManager.register("MDL-rxn",Kekule.IO.MdlRxnReader,["rxn","rxn3k"]),Kekule.IO.ChemDataReaderManager.register("MDL-general",Kekule.IO.MdlReader,["mol","mol3k","rxn","rxn3k"]),Kekule.IO.ChemDataReaderManager.register("MDL-sd",Kekule.IO.MdlSdReader,"sd");var e=[Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.ChemDataWriterManager.register("MDL-mol",Kekule.IO.MdlMolWriter,e,"mol"),Kekule.IO.ChemDataWriterManager.register("MDL-mol3k",Kekule.IO.MdlMolWriter,e,"mol3k",{createOptions:{mdlVersion:Kekule.IO.MdlVersion.V3000}}),Kekule.IO.ChemDataWriterManager.register("MDL-rxn",Kekule.IO.MdlRxnWriter,[Kekule.Reaction],"rxn"),Kekule.IO.ChemDataWriterManager.register("MDL-rxn3k",Kekule.IO.MdlRxnWriter,[Kekule.Reaction],"rxn3k"),Kekule.IO.ChemDataWriterManager.register("MDL-sd",Kekule.IO.MdlSdWriter,e,"sd")}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.IO.SMILES={ATOM_BRACKET_LEFT:"[",ATOM_BRACKET_RIGHT:"]",ATOM_WILDCARD:"*",ATOM_H:"H",ORGAN_SUBSET_ATOMS:["B","C","N","O","S","P","F","Cl","Br","I"],AROMATIC_SUBSET_ATOMS:["B","C","N","O","S","P"],BOND_SINGLE:"-",BOND_DOUBLE:"=",BOND_TRIPLE:"#",BOND_QUAD:"$",BOND_AROMATIC:":",BOND_FAKE:".",RING_BOND_TWO_DIGIT_NO_PREFIX:"%",BRANCH_BRACKET_LEFT:"(",BRANCH_BRACKET_RIGHT:")",ROTATION_DIR_CLOCKWISE:"@@",ROTATION_DIR_ANTICLOCKWISE:"@",DIRECTION_BOND_SYMBOLS:["/","\\"]};var t=Kekule.IO.SMILES;Kekule.IO.SmilesUtils={createGraphDepthSpanningTreesEx:function(t,r){for(var n=function(e){var t={vertexes:[],edges:[],longestPath:{vertexes:[],edges:[],length:0}},r=e;r.getData("__$visitedEx__")||(t.vertexes.push(r),r.setData("__$visitedEx__",!0));for(var o,i=r.getEdges(),a=0,s=i.length;a<s;++a){var l=i[a],u=r.getNeighborOnEdge(l);if(!u.getData("__$visitedEx__")){t.vertexes.push(u),t.edges.push(l),u.setData("__$visitedEx__",!0);var c=n(u);t.vertexes=t.vertexes.concat(c.vertexes),t.edges=t.edges.concat(c.edges),(c.longestPath.length>t.longestPath.length||!t.longestPath.length)&&(t.longestPath.vertexes=c.longestPath.vertexes,t.longestPath.edges=c.longestPath.edges,t.longestPath.length=c.longestPath.length,o=l)}}return o&&(t.longestPath.edges.unshift(o),t.longestPath.length=(t.longestPath.length||0)+1),t.longestPath.vertexes.unshift(r),t},o=e.clone(t.getVertexes()),i=0,a=o.length;i<a;++i)o[i].setData("__$visitedEx__",!1);for(var s=[];o.length;){var l;l=r&&o.indexOf(r)>=0?r:o[0];var u={vertexes:[],edges:[],longestPath:{vertexes:[],edges:[],length:0}},c=n(l);u.vertexes=u.vertexes.concat(c.vertexes),u.edges=u.edges.concat(c.edges),u.longestPath.length=(u.longestPath.length||0)+c.longestPath.length,u.longestPath.vertexes=u.longestPath.vertexes.concat(c.longestPath.vertexes),u.longestPath.edges=u.longestPath.edges.concat(c.longestPath.edges),o=e.exclude(o,c.vertexes),s.push(u)}return s}},Kekule.IO.SmilesMolWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.SmilesMolWriter",doWriteData:function(e,t,r,n){var o=this.getMolecule(e);return o?this.writeStructFragment(o,n):""},getMolecule:function(e){return Kekule.ChemStructureUtils.getTotalStructFragment(e)},writeStructFragment:function(r,n){if(r.hasCtab()&&!r.isEmpty()){var o=r.clone();o.standardize&&o.standardize();var i=[],a=[];if(o.getAromaticRings)for(var s=o.getAromaticRings(),l=0,u=s.length;l<u;++l){var c=s[l];e.pushUnique(i,c.nodes),e.pushUnique(a,c.connectors)}var d,h=Kekule.GraphAdaptUtils.ctabToGraph(o.getCtab(),null,{expandSubStructures:!0,ignoreBondedHydrogen:!0}),f=h.getVertexes(),m=(h.getEdges(),f[f.length-1]),g=Kekule.IO.SmilesUtils.createGraphDepthSpanningTreesEx(h,m),p=this._prepareStereoBondsInformation(o.getCtab(),n),C=[];for(l=0,u=g.length;l<u;++l){var O,k=g[l],S=k.longestPath,b=S.vertexes[0];O=this._writeMolVertex(b,null,S.edges,k.edges,C,i,a,{bondStereoDirMap:p},n),0===l?d=O:d+=t.BOND_FAKE+O}return d}return""},_prepareStereoBondsInformation:function(e,t){var r=t.ignoreStereoBond;if(Kekule.ObjUtils.isUnset(r)&&(r=t.ignoreStereo||!1),r)return null;for(var n=0,o=new Kekule.MapEx,i=0,a=e.getConnectorCount();i<a;++i){var s=e.getConnectorAt(i);if(s.getParity&&s.getParity()){++n;for(var l=Kekule.MolStereoUtils.getStereoBondKeyNeighborConnectors(s),u=this._getStereoDoubleBondInitialDirectionSymbols(s),c=[],d=0,h=0,f=l.length;h<f;++h)o.has(l[h])&&(c[h]=!0,u[h]!==o.get(l[h])&&++d);if(d<2)for(h=0,f=l.length;h<f;++h)if(!c[h]){var m=1===d?this._getInvertBondDirectionSymbol(u[h]):u[h];o.set(l[h],m)}}}return n?o:null},_writeMolVertex:function(e,r,n,o,i,a,s,l,u){var c,d,h=e.getData("object"),f=e.getEdges(),m=[],g=[],p=[],C=[],O=u.ignoreStereoBond;Kekule.ObjUtils.isUnset(O)&&(O=u.ignoreStereo||!1);for(var k=f.length-1;k>=0;--k){var S=f[k];if(S!==r){var b=S.getData("object");if(o.indexOf(S)>=0){var T=e.getNeighborOnEdge(S),E=this._writeMolVertex(T,S,n,o,i,a,s,l,u);n.indexOf(S)>=0?(d=T,c=E):(g.push(T),m.push(E))}else{var I=i.indexOf(S);I<0&&(I=i.length,i.push(S)),C.push(e.getNeighborOnEdge(S));var A=this._outputConnectorStr(b,S.getVertexes()[0].getData("object"),S.getVertexes()[1].getData("object"),a,s,l.bondStereoDirMap);A+=(I+=1)<10?I:t.RING_BOND_TWO_DIGIT_NO_PREFIX+I,p.push(A)}}}var _,N="";if(r){"",_=e.getNeighborOnEdge(r).getData("object");var y=r.getData("object");N+=this._outputConnectorStr(y,r.getVertexes()[0].getData("object"),r.getVertexes()[1].getData("object"),a,s,l.bondStereoDirMap)}for(var v=[],M=(k=0,C.length);k<M;++k)v.push(C[k].getData("object"));for(k=0,M=g.length;k<M;++k)v.push(g[k].getData("object"));d&&v.push(d.getData("object")),N+=this._outputNodeStr(h,a.indexOf(h)>=0,_,v,u);for(k=0,M=p.length;k<M;++k)N+=p[k];!c&&m.length&&(c=m.shift());for(k=0,M=m.length;k<M;++k)N+=t.BRANCH_BRACKET_LEFT+m[k]+t.BRANCH_BRACKET_RIGHT;return N+="",c&&(N+=c),N},_outputNodeStr:function(e,r,n,o,i){var a,s;e instanceof Kekule.Atom?(a=s=e.getSymbol(),r&&(a=a.toLowerCase())):a=t.ATOM_WILDCARD;var l,u=i.ignoreStereoAtom;if(Kekule.ObjUtils.isUnset(u)&&(u=i.ignoreStereo||!1),!u&&e.getParity&&e.getParity()&&o&&o.length){var c=e.getLinkedHydrogenAtomsWithSingleBond();c&&1===c.length&&o.indexOf(c[0])<0&&o.push(c[0]);var d=e.getHydrogenCount&&e.getHydrogenCount(!1)||0;if(c.length&&d)l="";else{var h=Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirection(null,e,n,o,!!d,!1,{allowExplicitHydrogen:!0,allowExplicitVerticalHydrogen:!0});l=h===Kekule.RotationDir.CLOCKWISE?t.ROTATION_DIR_CLOCKWISE:h===Kekule.RotationDir.ANTICLOCKWISE?t.ROTATION_DIR_ANTICLOCKWISE:""}l&&(a+=l)}var f=this._getNodeHydrogenCount(e,i),m=!0,g=e.getRadical?Math.round(e.getRadical()||0):0;if(l);else if(g);else if(e instanceof Kekule.Atom)if(f&&r&&"C"!==s);else if((i.ignoreExplicitHydrogens||i.ignoreImplicitHydrogens)&&f!==this._getNodeHydrogenCount(e,{}));else{var p=e.getValence&&e.getValence()||0,C=Kekule.ValenceUtils.getMaxPossibleValence(e.getAtomicNumber(),e.getCharge())||0;if(p)if(p>C&&f);else if(e.hasExplicitHydrogens())(e.getExplicitHydrogenCount()||0)===(e.getImplicitHydrogenCount()||0)&&(m=!1);else(e.getValence&&e.getValence({ignoreExplicitHydrogens:!0,ignoreBondHydrogens:!0})||0)<p||(m=!1)}m&&((d=Math.round(f))>0&&(a+=t.ATOM_H),d>1&&(a+=d));var O=Math.round(e.getCharge());if(O){var k=O>0?"+":"-";(O>1||O<-1)&&(k=Math.abs(O)+k),a+=k}var S=e.getMassNumber?e.getMassNumber():null;S&&(a=Math.abs(S)+a);var b=!1;return m||O||S||l||g||(!r&&t.ORGAN_SUBSET_ATOMS.indexOf(s)>=0||r&&t.AROMATIC_SUBSET_ATOMS.indexOf(s)>=0)&&(b=!0),b||(a=t.ATOM_BRACKET_LEFT+a+t.ATOM_BRACKET_RIGHT),a},_getNodeHydrogenCount:function(e,t){var r=e.getLinkedHydrogenAtomsWithSingleBondCount&&e.getLinkedHydrogenAtomsWithSingleBondCount(!0)||0,n=e.getExplicitHydrogenCount&&e.getExplicitHydrogenCount();(t.ignoreExplicitHydrogens||(r+=n||0),Kekule.ObjUtils.isUnset(n)&&!t.ignoreImplicitHydrogens)&&(r+=e.getImplicitHydrogenCount&&e.getImplicitHydrogenCount()||0);return r},_outputConnectorStr:function(e,r,n,o,i,a){if(e instanceof Kekule.Bond&&e.getBondType()===Kekule.BondType.COVALENT){if(i.indexOf(e)>=0)return"";var s=o.indexOf(r)>=0&&o.indexOf(n)>=0,l=e.getBondOrder(),u=Kekule.BondOrder,c=l===u.DOUBLE?t.BOND_DOUBLE:l===u.TRIPLE?t.BOND_TRIPLE:l===u.QUAD?t.BOND_QUAD:s?t.BOND_SINGLE:"";return a&&a.has(e)&&(c+=a.get(e)),c}return t.BOND_FAKE},_getStereoDoubleBondInitialDirectionSymbols:function(e){var r=e.getParity();return r?r===Kekule.StereoParity.EVEN?[t.DIRECTION_BOND_SYMBOLS[0],t.DIRECTION_BOND_SYMBOLS[0]]:[t.DIRECTION_BOND_SYMBOLS[0],t.DIRECTION_BOND_SYMBOLS[1]]:["",""]},_getInvertBondDirectionSymbol:function(e){return e===t.DIRECTION_BOND_SYMBOLS[1]?t.DIRECTION_BOND_SYMBOLS[0]:t.DIRECTION_BOND_SYMBOLS[1]}}),Kekule.IO.MimeType.SMILES="chemical/x-daylight-smiles",Kekule.IO.DataFormat.SMILES="smi";Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.SMILES,Kekule.IO.MimeType.SMILES,["smi","smiles"],Kekule.IO.ChemDataType.TEXT,"SMILES format");var r=[Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.ChemDataWriterManager.register("SMILES",Kekule.IO.SmilesMolWriter,r,[Kekule.IO.DataFormat.SMILES])}(),Kekule.globalOptions.add("IO.kekuleNative",{prettyPrint:!0}),Kekule.IO.KcjReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcjReader",readData:function(e,t){var r,n=t||Kekule.IO.ChemDataType.TEXT;return n==Kekule.IO.ChemDataType.JSON&&(r=e),n!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT")),null):(r=DataType.JsonUtility.parse(e),this.tryApplySuper("readData",[r,Kekule.IO.ChemDataType.JSON]))},doReadData:function(e,t){var r=Class.ObjSerializerFactory.getSerializer("json");return r?r.load(null,e):(Kekule.error(Kekule.$L("ErrorMsg.JSON_SERIALIZER_NOT_EXISTS")),null)}}),Kekule.IO.KcjWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcjWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(t.prettyPrint)?Kekule.globalOptions.IO.kekuleNative.prettyPrint:t.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0})},writeData:function(e,t,r,n){var o=t||Kekule.IO.ChemDataType.TEXT;if(o!=Kekule.IO.ChemDataType.JSON&&o!=Kekule.IO.ChemDataType.TEXT)return Kekule.error(Kekule.$L("ErrorMsg.KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT")),null;var i=this.tryApplySuper("writeData",[e,Kekule.IO.ChemDataType.JSON]);if(o==Kekule.IO.ChemDataType.JSON)return i;if(o==Kekule.IO.ChemDataType.TEXT){var a=n&&Kekule.ObjUtils.notUnset(n.prettyPrint)?n.prettyPrint:this.getPrettyPrint();return DataType.JsonUtility.serializeToStr(i,{prettyPrint:a})}},doWriteData:function(e,t,r,n){var o=Class.ObjSerializerFactory.getSerializer("json");if(!o)return Kekule.error(Kekule.$L("ErrorMsg.JSON_SERIALIZER_NOT_EXISTS")),null;var i={};return o.save(e,i),i}}),Kekule.IO.KcxReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcxReader",readData:function(e,t){var r,n=t||Kekule.IO.ChemDataType.TEXT;return n==Kekule.IO.ChemDataType.DOM&&(r=e),n!=Kekule.IO.ChemDataType.TEXT?(Kekule.error(Kekule.$L("ErrorMsg.KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT")),null):(r=DataType.XmlUtility.parse(e).documentElement,this.tryApplySuper("readData",[r,Kekule.IO.ChemDataType.DOM]))},doReadData:function(e,t){var r=Class.ObjSerializerFactory.getSerializer("xml");return r?r.load(null,e):(Kekule.error(Kekule.$L("ErrorMsg.XML_SERIALIZER_NOT_EXISTS")),null)}}),Kekule.IO.KcxWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcxWriter",initialize:function(e){this.tryApplySuper("initialize",[e]);var t=e||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(t.prettyPrint)?Kekule.globalOptions.IO.kekuleNative.prettyPrint:t.prettyPrint),this.setRootTag(t.rootTag||"kcx")},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:!0}),this.defineProp("rootTag",{dataType:DataType.STRING})},writeData:function(e,t){var r=t||Kekule.IO.ChemDataType.TEXT;if(r!=Kekule.IO.ChemDataType.DOM&&r!=Kekule.IO.ChemDataType.TEXT)return Kekule.error(Kekule.$L("ErrorMsg.KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT")),null;var n=this.tryApplySuper("writeData",[e,Kekule.IO.ChemDataType.DOM]);if(r==Kekule.IO.ChemDataType.DOM)return n;if(r==Kekule.IO.ChemDataType.TEXT){var o={prettyPrint:this.getPrettyPrint()};return DataType.XmlUtility.serializeNode(n,o)}},doWriteData:function(e,t){var r=Class.ObjSerializerFactory.getSerializer("xml");if(!r)return Kekule.error(Kekule.$L("ErrorMsg.XML_SERIALIZER_NOT_EXISTS")),null;var n=DataType.XmlUtility.newDocument(this.getRootTag());return r.save(e,n.documentElement),n.documentElement}}),function(){Kekule.IO.MimeType.KEKULE_JSON="chemical/x-kekule-json",Kekule.IO.MimeType.KEKULE_XML="chemical/x-kekule-xml",Kekule.IO.DataFormat.KEKULE_JSON="Kekule-JSON",Kekule.IO.DataFormat.KEKULE_XML="Kekule-XML",Kekule.IO.DataFormatsManager.register("JSON",Kekule.IO.MimeType.JSON,"json",Kekule.IO.ChemDataType.TEXT,"JSON format"),Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.KEKULE_JSON,Kekule.IO.MimeType.KEKULE_JSON,"kcj",Kekule.IO.ChemDataType.TEXT,"Kekule Chemical JSON format"),Kekule.IO.DataFormatsManager.register(Kekule.IO.DataFormat.KEKULE_XML,Kekule.IO.MimeType.KEKULE_XML,"kcx",Kekule.IO.ChemDataType.TEXT,"Kekule Chemical XML format");var e=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.JSON),t=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.KEKULE_JSON),r=Kekule.IO.DataFormatsManager.findFormatId(Kekule.IO.MimeType.KEKULE_XML);Kekule.IO.ChemDataReaderManager.register("json",Kekule.IO.KcjReader,e),Kekule.IO.ChemDataReaderManager.register("kcj",Kekule.IO.KcjReader,t),Kekule.IO.ChemDataReaderManager.register("kcx",Kekule.IO.KcxReader,r),Kekule.IO.ChemDataWriterManager.register("kcj",Kekule.IO.KcjWriter,[Kekule.ChemObject],t,{createOptions:{prettyPrint:!1}}),Kekule.IO.ChemDataWriterManager.register("kcx",Kekule.IO.KcxWriter,[Kekule.ChemObject],r,{createOptions:{prettyPrint:!0}})}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.GraphElement=Class.create(ObjectEx,{CLASS_NAME:"Kekule.GraphElement",initialize:function(){this.tryApplySuper("initialize"),this._data={}},initProperties:function(){this.defineProp("storedData",{dataType:DataType.HASH,getter:function(){return this._data},setter:function(e){this._data=e||{}}})},getData:function(e){return e?this._data[e]:this._data},setData:function(e,t){return e&&(this._data[e]=t),this},removeData:function(e){return this._data[e]&&delete this._data[e],this}}),Kekule.GraphVertex=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphVertex",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("edges",{dataType:DataType.ARRAY,serializable:!1,setter:null})},getEdgeCount:function(){return this.getEdges().length},getNeighbors:function(){for(var t=[],r=this.getEdges(),n=0,o=r.length;n<o;++n){var i=r[n].getVertexes();e.pushUnique(t,e.exclude(i,this))}return t},getNeighborOnEdge:function(e){for(var t=e.getVertexes(),r=0,n=t.length;r<n;++r)if(t[r]!==this)return t[r]},getEdgeTo:function(e){for(var t=this.getEdges(),r=0,n=t.length;r<n;++r){if(t[r].getVertexes().indexOf(e)>=0)return t[r]}return null},doAppendEdge:function(e){return Kekule.ArrayUtils.pushUnique(this.getEdges(),e),this},doRemoveEdge:function(e){return Kekule.ArrayUtils.remove(this.getEdges(),e),this},doClearEdges:function(){for(var e=this.getEdges(),t=e.length-1;t>=0;--t)this.removeEdge(e[t]);return this}}),Kekule.GraphEdge=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphEdge",initialize:function(){this.setPropStoreFieldValue("weight",1),this.tryApplySuper("initialize"),this.setPropStoreFieldValue("vertexes",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("weight",{dataType:DataType.NUMBER})},replaceVertex:function(e,t){var r=this.getVertexes(),n=r.indexOf(e),o=r.indexOf(t);n<0||o>=0||(r.splice(n,1,t),e.doRemoveEdge(this),t.doAppendEdge(this))}}),Kekule.GraphTraverseMode={DEPTH_FIRST:0,BREADTH_FIRST:1},Kekule.Graph=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Graph",VISITED_KEY:"__$visited__",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("vertexes",[]),this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("edges",{dataType:DataType.ARRAY,serializable:!1,setter:null})},addVertex:function(e){return Kekule.ArrayUtils.pushUnique(this.getVertexes(),e),this},newVertex:function(){var e=new Kekule.GraphVertex;return this.addVertex(e),e},removeVertex:function(e){if(Kekule.ArrayUtils.remove(this.getVertexes(),e))for(var t=Kekule.ArrayUtils.clone(e.getEdges()),r=0,n=t.length;r<n;++r)this.removeEdge(t[r])},addEdge:function(e,t,r){return Kekule.ArrayUtils.pushUnique(this.getEdges(),e)&&(e.setPropStoreFieldValue("vertexes",[t,r]),t.doAppendEdge(e),r.doAppendEdge(e)),this},newEdge:function(e,t){var r=new Kekule.GraphEdge;return this.addEdge(r,e,t),r},removeEdge:function(e){for(var t=e.getVertexes(),r=0,n=t.length;r<n;++r){t[r].doRemoveEdge(e)}return Kekule.ArrayUtils.remove(this.getEdges(),e),this},traverse:function(t,r,n){for(var o=[],i=e.clone(this.getVertexes()),a=0,s=i.length;a<s;++a)i[a].setData(this.VISITED_KEY,!1);for(;i.length;){var l,u={vertexes:[],edges:[]};l=n&&i.indexOf(n)>=0?n:i[0];var c=this._doTravers(t,r,l);u.vertexes=u.vertexes.concat(c.vertexes),u.edges=u.edges.concat(c.edges),i=e.exclude(i,c.vertexes),o.push(u)}return o},_doTravers:function(e,t,r){var n={vertexes:[],edges:[]},o=r;o.getData(this.VISITED_KEY)||(n.vertexes.push(o),o.setData(this.VISITED_KEY,!0),e&&e(o,!1));for(var i=o.getEdges(),a=[],s=t===Kekule.GraphTraverseMode.BREADTH_FIRST,l=0,u=i.length;l<u;++l){var c=i[l],d=o.getNeighborOnEdge(c);if(!d.getData(this.VISITED_KEY))if(n.vertexes.push(d),n.edges.push(c),d.setData(this.VISITED_KEY,!0),e&&(e(c,!0),e(d,!1)),s)a.push(d);else{var h=this._doTravers(e,t,d);n.vertexes=n.vertexes.concat(h.vertexes),n.edges=n.edges.concat(h.edges)}}if(s)for(l=0,u=a.length;l<u;++l){var f=a[l];h=this._doTravers(e,t,f);n.vertexes=n.vertexes.concat(h.vertexes),n.edges=n.edges.concat(h.edges)}return n}}),Kekule.globalOptions.add("algorithm.molToGraph",{expandSubStructures:!0,ignoreBondedHydrogen:!0}),Kekule.GraphAdaptUtils={ctabToGraph:function(e,t,r){var n=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.molToGraph),r||{}),o=e,i=Kekule.ArrayUtils,a=null,s=n.expandSubStructures;if(o){for(var l=n.nodeFilter||function(e,t){if(n.nodeClasses){var r=e.getClass();if(!ClassEx.isOrIsDescendantOfClasses(r,n.nodeClasses))return!1}if(n.ignoreBondedHydrogen&&e.isHydrogenAtom&&e.isHydrogenAtom()){var o=e.getLinkedConnectors();if(t&&(o=i.intersect(o,t)),o.length<=1){var a=o[0];if(!a)return!1;if(a.isSingleBond&&a.isSingleBond())return!1}}return!0},u=n.connectorFilter||function(e,t){if(n.connectorClasses){var r=e.getClass();if(!ClassEx.isOrIsDescendantOfClasses(r,n.connectorClasses))return!1}return!(e.getBondType&&n.bondTypes&&n.bondTypes.indexOf(e.getBondType())<0)},c=(a=t||new Kekule.Graph,s?o.getAllContainingConnectors():o.getConnectors()),d=s?o.getLeafNodes():o.getNodes(),h=[],f=new Kekule.MapEx,m=0,g=c.length;m<g;++m){var p=c[m];if(u(p))for(var C=[],O=s?p.getConnectedObjs():p.getConnectedSiblings(),k=0,S=O.length;k<S;++k){var b=O[k];if(d.indexOf(b)>=0&&(l(b,c)?C.push(b):i.pushUnique(h,b),C.length>=2)){for(var T=i.exclude(C,h),E=0,I=T.length;E<I;++E){(_=a.newVertex()).setData("object",T[E]),f.set(T[E],_)}a.newEdge(f.get(C[0]),f.get(C[1])).setData("object",p),i.pushUnique(h,C);break}}}var A=i.exclude(d,h);for(m=0,g=A.length;m<g;++m){var _,N=A[m];if(l(N,c))(_=a.newVertex()).setData("object",N)}f.finalize()}return a},molToGraph:function(e,t,r){Kekule.ArrayUtils;if(!e||!e.hasCtab())return null;var n=e.getCtab();return n?Kekule.GraphAdaptUtils.ctabToGraph(n,t,r):null},chemObjToGraph:function(e,t,r){for(var n=Kekule.ChemStructureUtils.getAllStructFragments(e,!0),o=t||new Kekule.Graph,i=0,a=n.length;i<a;++i)Kekule.GraphAdaptUtils.molToGraph(n[i],o,r);return o}},Kekule.GraphAlgorithmUtils={SEQ_KEY:"__$seq__",RESD_DEGREE_KEY:"__$resdDegree__",VISIT_EDGE_DEGREE_KEY:"__$visitedEdgeDegree__",TYPE_KEY:"__$type__",TYPE_CYCLE:"cycle",TYPE_BRIDGE:"bridge",VISITED_KEY:"__$visited",createSpanningTrees:function(e,t){return e.traverse(null,t)},calcMinDistances:function(e,t){var r,n,o=e.getVertexes();DataType.isSimpleValue(t)?r=o[n=t]:(r=t,n=o.indexOf(r));for(var i=[],a=[],s=0,l=o.length;s<l;++s){var u=o[s];if(s===n)i[s]=0,a[s]=r;else(p=r.getEdgeTo(u))?(i[s]=p.getWeight(),a[s]=r):(i[s]=1/0,a[s]=null)}var c=[n];for(s=0,l=o.length;s<l;++s)if(s!==n){for(var d,h=1/0,f=-1,m=0,g=o.length;m<g;++m)m!==n&&c.indexOf(m)<0&&i[m]<h&&(h=i[m],f=m,d=o[m]);c.push(f);for(m=0,g=o.length;m<g;++m)if(c.indexOf(m)<0){var p,C=h+((p=d.getEdgeTo(o[m]))?p.getWeight():1/0);C<i[m]&&(i[m]=C)}}return i},findCycleBlocks:function(t){for(var r=[],n=Kekule.GraphAlgorithmUtils,o=n.SEQ_KEY,i=n.RESD_DEGREE_KEY,a=n.VISIT_EDGE_DEGREE_KEY,s=n.TYPE_KEY,l=n.TYPE_CYCLE,u=n.TYPE_BRIDGE,c=t.getEdges(),d=0,h=c.length;d<h;++d)c[d].removeData(o);var f=t.getVertexes();for(d=0,h=f.length;d<h;++d)f[d].removeData(s);var m=1,g=1,p=[],C=[],O=[];for(t.traverse(function(e,t){t?(e.setData(o,m),C.push(e),++m):(e.setData(o,g),++g,p.push(e))}),d=0,h=p.length;d<h;++d){var k=p[d],S=k.getEdges();k.setData(i,S.length);for(var b=0,T=0,E=S.length;T<E;++T){S[T].getData(o)&&++b}k.setData(a,b),b<S.length&&O.push(k)}for(var I=function(e,t){if(t&&e.getData(o)<=1)return null;for(var r=e.getEdges(),n=null,i=null,a=0,s=r.length;a<s;++a){var l=r[a].getData(o);l&&(i?l<i&&(n=r[a],i=l):(n=r[a],i=l))}return n||null},A=function(e){for(var t=e.getEdges(),r=0,n=t.length;r<n;++r)if(!t[r].getData(o)&&!t[r].getData(s))return t[r];return null},_=function(t){var r=[],n=[],o=t.getData(a),u=(f=t.getData(i))-o;if(u>0){t.setData(s,l),e.pushUnique(r,t);for(var c=0;c<u;++c){t.setData(i,f+1);var d=A(t);if(d){d.setData(s,l),e.pushUnique(n,d);var h=t.getNeighborOnEdge(d);for(h.setData(i,h.getData(i)+1),h.setData(s,l),e.pushUnique(r,h);;){var f;if((o=h.getData(a))<(f=h.getData(i))){var m=_(h);e.pushUnique(r,m.vertexes),e.pushUnique(n,m.edges)}var g=I(h,!1);if(!g)break;g.setData(s,l),e.pushUnique(n,g);var p=h.getNeighborOnEdge(g);if(p.getData(s))break;p.setData(s,l),e.pushUnique(r,p),h=p}}}}return{vertexes:r,edges:n}},N=p.shift();N;){if(N.getData(s));else{var y=N.getData(a);if(N.getData(i)-y>0){var v=_(N);r.push(v)}else{N.setData(s,u);var M=I(N,!0);M&&M.setData(s,u)}}N=p.shift()}return r},findEndChains:function(e){for(var t=Kekule.ArrayUtils,r={vertexes:[],edges:[]},n=t.clone(e.getVertexes()),o=[],i=0,a=n.length;i<a;++i){var s=n[i],l=s.getEdgeCount();s.setData("__$currConnectivity__",l),l<=1&&o.push(s)}if(o.length){var u=o.pop();for(t.remove(n,u),r.vertexes.push(u);n.length;){var c=!1,d=t.exclude(u.getEdges(),r.edges);if(d.length){r.edges=r.edges.concat(d);var h=u.getNeighborOnEdge(d[0]);l=h.getData("__$currConnectivity__")-1;h.setData("__$currConnectivity__",l),l<=1&&(u=h,t.remove(n,u),r.vertexes.push(u),c=!0)}if(!c){if(!o.length)break;u=o.pop();t.remove(n,u),r.vertexes.push(u)}}}return r},removeEndChains:function(e){for(var t=Kekule.GraphAlgorithmUtils.findEndChains(e),r=0,n=t.vertexes.length;r<n;++r)e.removeVertex(t.vertexes[r]);return t},findBridgeChains:function(t){for(var r=t.getVertexes(),n=t.getEdges(),o=Kekule.GraphAlgorithmUtils.findCycleBlocks(t),i=0,a=o.length;i<a;++i)r=e.exclude(r,o[i].vertexes),n=e.exclude(n,o[i].edges);return{vertexes:r,edges:n}},removeBridgeChains:function(e){for(var t=Kekule.GraphAlgorithmUtils.findBridgeChains(e),r=0,n=t.vertexes.length;r<n;++r)e.removeVertex(t.vertexes[r]);return t},findAllRings:function(t){var r,n=Kekule.GraphAlgorithmUtils,o=[];r=t instanceof Kekule.Graph?n.findCycleBlocks(t):[t];for(var i,a=function(e,t){var r=e.vertexes,n=r.length;return n&&(r[0]===t||r[n-1]===t)},s=function(t,r,n){var o=e.clone(t.vertexes),i=e.clone(r.vertexes),a=e.clone(t.edges),s=e.clone(r.edges);o[0]===n&&(o.reverse(),a.reverse()),i[i.length-1]===n&&(i.reverse(),s.reverse()),o.pop();var l=o.concat(i),u=a.concat(s);return{vertexCount:t.vertexCount+r.vertexCount-1,vertexes:l,edges:u}},l=function(t){for(var r=[],n=e.clone(t.vertexes),o=t.edges,i=0,l=n.length;i<l;++i){var u=n[i],c=e.intersect(u.getEdges(),o);u.setData("__$vertextPartDegree__",c.length)}n.sort(function(e,t){return e.getData("__$vertextPartDegree__")-t.getData("__$vertextPartDegree__")});var d,h,f,m,g=[];for(i=0,l=t.edges.length;i<l;++i){var p=t.edges[i],C=p.getVertexes();g.push({vertexCount:C.length,vertexes:[C[0],C[1]],edges:[p]})}for(;n.length;){var O=n.shift(),k=null;for(i=g.length-1;i>=0;--i){var S=g[i];if(a(S,O)){k=S;for(var b=i-1;b>=0;--b){S=g[b];if(a(S,O)&&(d=k,h=S,f=void 0,m=void 0,f=e.clone(d.vertexes),m=e.clone(h.vertexes),f.shift(),f.pop(),m.shift(),m.pop(),!(e.intersect(f,m).length>=1))){var T=s(k,S,O),E=T.vertexes;E[0]===E[E.length-1]?(E.pop(),r.push(T)):g.push(T)}}g.splice(i,1)}}}return r},u=0,c=r.length;u<c;++u){var d=r[u];if((i=d).vertexes.length===i.edges.length)o.push({vertexes:e.clone(d.vertexes),edges:e.clone(d.edges)});else for(var h=l(d),f=0,m=h.length;f<m;++f){var g=h[f];o.push({vertexes:e.clone(g.vertexes),edges:e.clone(g.edges)})}}return o},findSSSR:function(t,r){var n,o=Kekule.GraphAlgorithmUtils,i=[];t instanceof Kekule.Graph?(n=o.findCycleBlocks(t),r=null):n=[t];for(var a=function(t,r){var n=[],i=t.edges.length-t.vertexes.length+1;if(i<=0)return[];var a=r?e.clone(r):o.findAllRings(t);a.sort(function(e,t){return e.vertexes.length-t.vertexes.length});var s,l=function(e){n.push(e)},u=[],c=Kekule.RingVectorUtils;c.prepareConvertRingToVector(t);var d=a.shift();for(l(d),s=c.convertRingToVector(d,t),u.push(s);n.length<i&&a.length;)d=a.shift(),s=c.convertRingToVector(d,t),c.isLinearDependant(s,u)||(u.push(s),l(d));return n},s=0,l=n.length;s<l;++s){var u=a(n[s],r);i=i.concat(u)}return i},analysisRings:function(e){for(var t,r=Kekule.GraphAlgorithmUtils,n=[],o=0,i=(t=e instanceof Kekule.Graph?r.findCycleBlocks(e):[e]).length;o<i;++o){var a=t[o],s=r.findAllRings(a),l=r.findSSSR(a,s);n.push({vertexes:a.vertexes,edges:a.edges,allRings:s,sssrRings:l})}return n}},Kekule.RingVectorUtils={MAX_INT_BITNUM:23,EDGE_INDEX_FIELD:"__$index__",prepareConvertRingToVector:function(e){for(var t=e.edges,r=0,n=t.length;r<n;++r)t[r][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]=r},convertRingToVector:function(e,t){var r,n=t.edges.length,o=e.edges;if(n<Kekule.RingVectorUtils.MAX_INT_BITNUM){r=0;for(var i=0,a=o.length;i<a;++i){r+=1<<o[i][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]}}else{r=[];for(i=0,a=o.length;i<a;++i){r[o[i][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]]=!0}}return r},vectorNotNull:function(e){if(DataType.isSimpleValue(e))return!!e;for(var t=0;t<e.length;++t)if(e[t])return!0;return!1},getVectorLength:function(e){return DataType.isSimpleValue(e)?e.toString(2).length:e.length},ringVectorAnd:function(e,t){if(DataType.isSimpleValue(e))return e&t;for(var r=[],n=Math.min(e.length,t.length),o=0;o<n;++o)r[o]=e[o]&&t[o];return r},ringVectorAndAll:function(e){if(e.length<2)return e[0];for(var t=Kekule.RingVectorUtils,r=t.ringVectorAnd(e[0],e[1]),n=2,o=e.length;n<o;++n)r=t.ringVectorAnd(r,e[n]);return r},ringVectorOr:function(e,t){if(DataType.isSimpleValue(e))return e|t;for(var r=[],n=Math.max(e.length,t.length),o=0;o<n;++o)r[o]=e[o]||t[o];return r},ringVectorOrAll:function(e){if(e.length<2)return e[0];for(var t=Kekule.RingVectorUtils,r=t.ringVectorOr(e[0],e[1]),n=2,o=e.length;n<o;++n)r=t.ringVectorOr(r,e[n]);return r},ringVectorXor:function(e,t){if(DataType.isSimpleValue(e))return e^t;for(var r=[],n=Math.max(e.length,t.length),o=0;o<n;++o)r[o]=!!(e[o]^t[o]);return r},ringVectorXorAll:function(e){if(e.length<2)return e[0];for(var t=Kekule.RingVectorUtils,r=t.ringVectorXor(e[0],e[1]),n=2,o=e.length;n<o;++n)r=t.ringVectorXor(r,e[n]);return r},ringVectorNot:function(e){if(DataType.isSimpleValue(e))return~e;for(var t=[],r=0,n=e.length;r<n;++r)t[r]=!e[r];return t},isLinearDependant:function(e,t){var r=Kekule.RingVectorUtils,n=r.ringVectorOrAll(t),o=r.ringVectorAnd(e,r.ringVectorNot(n));if(r.vectorNotNull(o))return!1;for(var i=t.length,a=function(e){for(var t=[],r=0;r<e;++r)t[r]=e-r-1;return t},s=function(e,t,r){var n=e[t],o=++n;if(o>=r-t)return!(t>=e.length-1)&&s(e,t+1,r);e[t]=o;for(var i=o,a=t-1;a>=0;--a)++i,e[a]=i;return!0},l=!1,u=2;u<=i;++u){for(var c=a(u);;){0;for(var d=[],h=0,f=c.length;h<f;++h)d.push(t[c[h]]);var m=r.ringVectorXorAll(d);if(!r.vectorNotNull(r.ringVectorXor(m,e))){l=!0;break}if(!s(c,0,i)){l=!1;break}}if(l)break}return l},isLinearDependant_wrong:null}}(),function(){"use strict";Kekule.ChemStructObjContainer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructObjContainer",initialize:function(){this.tryApplySuper("initialize"),this.setPropStoreFieldValue("nodes",[]),this.setPropStoreFieldValue("connectors",[])},initProperties:function(){this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:!1,setter:null}),this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:!1,setter:null})},clear:function(){return this.getNodes().length=0,this.getConnectors().length=0,this},add:function(e){var t=null;return e instanceof Kekule.ChemStructureConnector?t=this.getConnectors():e instanceof Kekule.ChemStructureNode&&(t=this.getNodes()),t?Kekule.ArrayUtils.pushUnique(t,e):Kekule.error(Kekule.$L("ErrorMsg.CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER")),this},remove:function(e){var t=null;return t=e instanceof Kekule.ChemStructureConnector?this.getConnectors():this.getNodes(),Kekule.ArrayUtils.remove(t,e),this}})}(),function(){var e=Kekule.ArrayUtils;Kekule.BondType;Kekule.CanonicalizationIndexer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationIndexer",initialize:function(){this.tryApplySuper("initialize")},execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t):null},doExecute:function(e){}}),Kekule.CanonicalizationNodeSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationNodeSorter",execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getNodes()):null},doExecute:function(e){}}),Kekule.CanonicalizationConnectorSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationConnectorSorter",execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getConnectors()):null},doExecute:function(e){}}),Kekule.CanonicalizationConnectorConnectedObjsSorter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationConnectorConnectedObjsSorter",execute:function(e){var t=e instanceof Kekule.StructureFragment?e.getCtab():e;return t?this.doExecute(t,t.getConnectors()):null},doExecute:function(e){}}),Kekule.CanonicalizationCustomExecutor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.CanonicalizationCustomExecutor",execute:function(e){var t=this.doExecute(e);return t&&this.doCanonicalizeConnectedObjs(t),t},doExecute:function(e){return e},doCanonicalizeConnectedObjs:function(e){e&&(new Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter).execute(e)}}),Kekule.CanonicalizationGeneralConnectorSorter=Class.create(Kekule.CanonicalizationConnectorSorter,{CLASS_NAME:"Kekule.CanonicalizationGeneralConnectorSorter",doExecute:function(t){var r=new Kekule.MapEx;try{for(var n=0,o=t.getConnectorCount();n<o;++n){for(var i=t.getConnectorAt(n),a=i.getConnectedObjs(),s=[],l=0,u=a.length;l<u;++l){var c,d=a[l];d instanceof Kekule.ChemStructureNode&&(c=t.indexOfNode(d),s.push(c))}s.sort(function(e,t){return e-t}),r.set(i,s)}t.sortConnectors(function(t,n){var o=r.get(t),i=r.get(n),a=e.compare(o,i);return 0===a&&(a=-(t.getConnectedObjCount()-n.getConnectedObjCount())),a})}finally{r.finalize()}}}),Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter=Class.create(Kekule.CanonicalizationConnectorConnectedObjsSorter,{CLASS_NAME:"Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter",doExecute:function(e){var t=new Kekule.MapEx;try{for(var r=0,n=e.getConnectorCount();r<n;++r){var o=e.getConnectorAt(r);if(2===o.getConnectedObjCount()){var i=o.getConnectedObjAt(0),a=o.getConnectedObjAt(1),s=e.indexOfChild(i),l=e.indexOfChild(a);(s<0||l<0)&&(s=(i.getCanonicalizationIndex?-i.getCanonicalizationIndex():0)||0,l=(a.getCanonicalizationIndex?-a.getCanonicalizationIndex():0)||0),s>l&&o.reverseConnectedObjOrder()}else o.sortConnectedObjs(function(t,r){var n=e.indexOfChild(t),o=e.indexOfChild(r);(n<0||o<0)&&(i=((n=(t.getCanonicalizationIndex?-t.getCanonicalizationIndex():0)||0)||0)-((o=(r.getCanonicalizationIndex?-r.getCanonicalizationIndex():0)||0)||0));var i=e.indexOfChild(t)-e.indexOfChild(r);return i})}}finally{t.finalize()}}}),Kekule.CanonicalizationMorganIndexer=Class.create(Kekule.CanonicalizationIndexer,{CLASS_NAME:"Kekule.CanonicalizationMorganIndexer",doExecute:function(e){var t=this.doCalcGraphAndEcResult(e);this.doExecuteOnGraphEcResult(t.graph,t.ecMapping,t.vertexGroup)},doCalcGraphAndEcResult:function(e){var t=Kekule.GraphAdaptUtils.ctabToGraph(e,null,{expandSubStructures:!0,ignoreBondedHydrogen:!0});if(!t)return null;var r=this._calcGraphFinalECs(t);return{graph:t,ecMapping:r.ecMapping,vertexGroup:r.vertexGroup}},doExecuteOnGraphEcResult:function(e,t,r){var n=this._sortNodeByEcMapping(e,t,r);this._setCanonicalizationIndexToNodeGroups(n),this._fillSpanningTreeInfo(e)},_fillSpanningTreeInfo:function(e){if((n=e.getVertexes())&&n.length){n.sort(function(e,t){var r=e.getData("object"),n=t.getData("object");if(r||n){if(r){if(n){var o=(n.getCanonicalizationIndex()||-1)-(r.getCanonicalizationIndex()||-1);if(0===o&&r.hasCoord3D(!0)&&n.hasCoord3D(!0)){var i=Kekule.CoordUtils.substract(n.getAbsCoord3D(!0),r.getAbsCoord3D(!0));o=i.z||i.y||i.x}return o}return-1}return 1}return 0});var t=e.getEdges();if(t&&t.length){var r=function(e,t){for(var r=t.length,n=[],o=e.getVertexes(),i=0,a=o.length;i<a;++i){var s=t.indexOf(o[i]);s<0&&(s=r),n.push(s)}return n.sort(),n},n=e.getVertexes();t.sort(function(e,t){var o=r(e,n),i=r(t,n);return Kekule.ArrayUtils.compare(o,i)})}for(var o=0,i=(n=e.getVertexes()).length;o<i;++o){n[o].getEdges().sort(function(e,r){return t.indexOf(e)-t.indexOf(r)})}}this._setSpanningTreeIndexToNodeOfGraph(e)},_sortNodeByEcMapping:function(e,t,r){return this._doSortNodeByEcMapping(e,t,r)},_doSortNodeByEcMapping:function(t,r,n){for(var o=this._doSortNodeByEcMappingDirectly(n),i=this._doSortNodeBySortedNodeList(o),a=[],s=0,l=i.length;s<l;++s){var u=i[s];e.isArray(u)&&1===u.length?a.push(u[0]):a.push(u)}return a},_doSortNodeByEcMappingDirectly:function(t){for(var r=[],n=t,o=0,i=n.length;o<i;++o){var a=n[o],s=this._vertexesToNodes(a.vertexes);if(1===s.length)e.pushUnique(r,s[0]);else{var l=this._groupNodesWithSameEcValue(s,r);r=r.concat(l)}}return r},_doSortNodeBySortedNodeList:function(e){var t=(r=this._doSortNodeBySortedNodeListCore(e)).length;do{var r,n=r,o=t;t=(r=this._doSortNodeBySortedNodeListCore(n)).length}while(t>o);return n},_doSortNodeBySortedNodeListCore:function(t){for(var r=[],n=[],o=0,i=t.length;o<i;++o){var a=t[o];if(e.isArray(a)){var s=function(t,r){for(var n=0,o=r.length;n<o;++n)if(e.isArray(r[n])){if(r[n].indexOf(t)>=0)return n}else if(r[n]===t)return n;return-1},l=function(e,t,r){for(var n=[],o=0,i=t.length;o<i;++o)n.push(s(t[o],r));return n.sort(function(e,t){return t-e}),n},u=e.group(a,function(o,i){var a=e.intersect(o.getLinkedObjs(),n),s=e.intersect(i.getLinkedObjs(),n);if(0==(d=a.length-s.length)&&a.length>0){var u=l(0,a,r),c=l(0,s,r);d=e.compare(u,c)}if(0===d){var d;a=e.intersect(o.getLinkedObjs(),t),s=e.intersect(i.getLinkedObjs(),t),0==(d=a.length-s.length)&&(u=l(0,a,t),c=l(0,s,t),d=e.compare(u,c))}return d});r=r.concat(u),n=n.concat(a)}else r.push([a]),n.push(a)}return r},_setCanonicalizationIndexToNodeGroups:function(t){for(var r=0,n=t.length;r<n;++r){var o=r+1,i=t[r];if(e.isArray(i))for(var a=0,s=i.length;a<s;++a)i[a].setCanonicalizationIndex(o);else i.setCanonicalizationIndex(o)}},_setSpanningTreeIndexToNodeOfGraph:function(e){for(var t=Kekule.GraphAlgorithmUtils.createSpanningTrees(e,Kekule.GraphTraverseMode.DEPTH_FIRST),r=0,n=t.length;r<n;++r){var o=t[r];if(o.vertexes)for(var i=o.vertexes.length,a=0;a<i;++a){var s=o.vertexes[a].getData("object");s&&s.setCanonicalizationAssocIndex&&s.setCanonicalizationAssocIndex(i-a)}}},_vertexesToNodes:function(e){for(var t=[],r=0,n=e.length;r<n;++r){var o=e[r].getData("object");t.push(o)}return t},_processECs:function(t,r,n,o){if(o)return this._initECs(t,r);for(var i=[],a=[],s=t.getVertexes(),l=0,u=s.length;l<u;++l){var c=s[l],d=this._usePrimeECs?1:0;if(this._usePrimeECs)var h=this._getPrimeArray();for(var f=c.getNeighbors(),m=0,g=f.length;m<g;++m)this._usePrimeECs?d*=h[n.get(f[m])-1||0]:d+=n.get(f[m])||0;e.pushUnique(i,d),a[d]?a[d].push(c):a[d]=[c]}i.sort(function(e,t){return e-t});var p=[];for(l=0,u=i.length;l<u;++l){var C=i[l];a[C]&&p.push(a[C])}return this._setECValueByVertexGroup(p,r),p.length},_initECs:function(t,r){for(var n=[],o=0,i=(u=t.getVertexes()).length;o<i;++o){var a=u[o],s=a.getEdgeCount();n[s]?n[s].push(a):n[s]=[a]}var l=[];for(o=0,i=n.length;o<i;++o){var u;if(u=n[o])if(1===u.length)l.push(u);else for(var c=e.group(u,function(e,t){var r=e.getData("object"),n=t.getData("object"),o=(r.getLinkedNonHydrogenConnectors()||[]).length-(n.getLinkedNonHydrogenConnectors()||[]).length;return o||(o=r.compareStructure(n))||(o=(r.getHydrogenCount?r.getHydrogenCount(!0):0)-(n.getHydrogenCount?n.getHydrogenCount(!0):0)),o}),d=0,h=c.length;d<h;++d)l.push(e.toArray(c[d]))}return this._setECValueByVertexGroup(l,r),l.length},_setECValueByVertexGroup:function(e,t){for(var r=0,n=e.length;r<n;++r)for(var o=e[r],i=0,a=o.length;i<a;++i)t.set(o[i],r+1)},_getPrimeArray:function(){return Kekule.CanonicalizationMorganIndexer.primes||(Kekule.CanonicalizationMorganIndexer.primes=Kekule.NumUtils.getPrimes(1e4)),Kekule.CanonicalizationMorganIndexer.primes},_calcGraphFinalECs:function(e){var t=[new Kekule.MapEx,new Kekule.MapEx];try{e.getVertexes().length<this._getPrimeArray().length?this._usePrimeECs=!0:this._usePrimeECs=!1;for(var r,n,o=0,i=t[0],a=t[0],s=0,l=[],u=this._processECs(e,i,a,!0),c=!0;c;)s=u,r=n,a=i,i=t[++o%2],u=this._processECs(e,i,a),n=null,c=u>s,u===s?(n=this._groupVertexesByEcValue(e,i),!r&&a&&(r=this._groupVertexesByEcValue(e,a)),l.push(r),c=!this._hasVertexGroup(n,l)):l=[]}finally{i.finalize()}return{ecMapping:a,ecCount:s,vertexGroup:r||this._groupVertexesByEcValue(e,a)}},_groupVertexesByEcValue:function(t,r){for(var n=[],o=[],i=t.getVertexes(),a=0,s=i.length;a<s;++a){var l=i[a],u=r.get(l);e.pushUnique(o,u),n[u]||(n[u]=[]),n[u].push(l)}o.sort(function(e,t){return e-t});var c=[];for(a=0,s=o.length;a<s;++a){var d=n[o[a]];c.push({ecValue:o[a],vertexes:d,vertexesCount:d.length})}return c},_hasVertexGroup:function(e,t){for(var r=0,n=t.length;r<n;++r)if(0===this._compareEcVertexGroup(e,t[r]))return!0;return!1},_compareEcVertexGroup:function(t,r){var n=t.length,o=n-r.length;if(0===o)for(var i=0;i<n&&(0===(o=t[i].vertexes.length-r[i].vertexes.length)&&(o=e.exclude(t[i].vertexes,r[i].vertexes).length),0===o);++i);return o},_groupNodesWithSameEcValue:function(t,r){var n=function(t,r){for(var n=e.flatten(r),o=t.getLinkedObjs(),i=e.intersect(o,n),a=[],s=[],l=0,u=i.length;l<u;++l){var c=i[l],d=e.indexStackOfElem(c,r);a.push(d)}a.sort(function(t,r){return e.compare(t,r)});for(l=0,u=a.length;l<u;++l){(c=e.getElemByIndexStack(r,a[l]))||console.error("not found",c,a[l]);var h=t.getConnectorTo(c);s.push(h)}return{nodeIndexValues:a,connectors:s}};return e.group(t,function(t,o){var i=t.compareStructure(o);if(0===i){var a=n(t,r),s=n(o,r);i=e.compare(a.nodeIndexValues,s.nodeIndexValues);for(var l=a.connectors,u=s.connectors,c=0,d=l.length;c<d&&0===(i=l[c].compareStructure(u[c]));++c);if(0===i){var h=t.getBelongedSssrRings&&t.getBelongedSssrRings()||[],f=o.getBelongedSssrRings&&o.getBelongedSssrRings()||[];if(0===(i=h.length-f.length)){var m=[],g=[];for(c=0,d=h.length;c<d;++c)m.push(h[c].nodes.length),g.push(f[c].nodes.length);m.sort(),g.sort(),i=e.compare(m,g)}}}return i})}}),Kekule.CanonicalizationMorganNodeSorter=Class.create(Kekule.CanonicalizationNodeSorter,{CLASS_NAME:"Kekule.CanonicalizationMorganNodeSorter",doExecute:function(e){var t=this._getNodeSortedArray(e),r=t.length,n=this;e.sortNodes(function(e,o){var i=t.indexOf(e),a=t.indexOf(o);i<0&&(i=r),a<0&&(a=r);var s=i-a;return 0===s&&i===r&&(s=n._getNeighborNodesMinIndex(e,t)-n._getNeighborNodesMinIndex(o,t)),s})},_getNeighborNodesMinIndex:function(e,t){for(var r=e.getLinkedChemNodes(),n=t.length,o=0,i=r.length;o<i;++o){var a=t.indexOf(r[o]);a>0&&a<n&&(n=a)}return n},_getNodeSortedArray:function(t){var r=function(e,t,r,n){var o;if(0===(o=(t.getCanonicalizationIndex()||-1)-(r.getCanonicalizationIndex()||-1))){if(e){var i=e.getConnectorTo(t),a=e.getConnectorTo(r);o=i.compareStructure(a)}if(0===o)if(n)o=(n.get(t)||1/0)-(n.get(r)||1/0);if(0===o)o=(t.getCanonicalizationAssocIndex()||-1)-(r.getCanonicalizationAssocIndex()||-1);if(0===o&&t.hasCoord3D(!0)&&r.hasCoord3D(!0)){var s=Kekule.CoordUtils.substract(t.getAbsCoord3D(!0),r.getAbsCoord3D(!0));o=s.z||s.y||s.x}}return o};try{for(var n,o=e.clone(t.getNodes()),i=0,a=o.length;i<a;++i){var s=o[i];c?r(null,s,c)>0&&(c=s,n=i):(c=s,n=i)}o.splice(n,1);var l=[],u=[];c&&l.push(c);for(i=0;i<l.length;++i){var c=l[i];if(0!==i){var d=o.indexOf(c);d>=0&&(l.push(c),o.splice(d,1))}var h=c.getLinkedObjs();if((h=e.intersect(h,o)).length){h.sort(function(e,t){return r(c,e,t)});for(var f=h.length-1;f>=0;--f){var m=h[f];if((d=o.indexOf(m))>=0){var g=m.getCanonicalizationIndex();Kekule.ObjUtils.isUnset(g)?u.push(m):l.push(m),o.splice(d,1)}}}}return l=l.concat(u)}finally{}}}),Kekule.Canonicalizer=Class.create({CLASS_NAME:"Kekule.Canonicalizer",initialize:function(){this._executorClasses={},this._executorInstances={},this._defExecutorId=null},registerExecutor:function(t,r,n){e.isArray(r)?this._executorClasses[t]={indexer:r[0],nodeSorter:r[1],connectorSorter:r[2]||Kekule.CanonicalizationGeneralConnectorSorter,connectorConnectedObjsSorter:r[3]||Kekule.CanonicalizationGeneralConnectorConnectedObjsSorter}:this._executorClasses[t]={customExecutor:r},n&&(this._defExecutorId=t)},getExecutor:function(e){if(!e)return null;var t=this._executorInstances[e];if(!t){var r=this._executorClasses[e];r&&(t=r.customExecutor?{customExecutor:new r.customExecutor}:{indexer:new r.indexer,nodeSorter:new r.nodeSorter,connectorSorter:new r.connectorSorter,connectorConnectedObjsSorter:new r.connectorConnectedObjsSorter},this._executorInstances[e]=t)}return t},canonicalize:function(e,t){e.beginUpdate();try{var r=t||this._defExecutorId,n=this.getExecutor(r);if(n){var o=e instanceof Kekule.StructureFragment?e:null,i=o.getCanonicalizationInfo();if(i&&i.id===r)return e;var a=e.getCtab?e.getCtab():e;if(!a||a.isEmpty())return e;var s=a.getParent();n.customExecutor?n.customExecutor.execute(a):this._doDefaultCanonicalize(n,a,s),o.setCanonicalizationInfo({id:r})}else Kekule.error(Kekule.$L("ErrorMsg.REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND"))}finally{e.endUpdate()}return e},_doDefaultCanonicalize:function(e,t,r){var n=r.getFlattenedShadowFragment();(t=n.getCtab()).beginUpdate();try{e.indexer.execute(t),e.nodeSorter.execute(t),e.connectorSorter.execute(t),e.connectorConnectedObjsSorter.execute(t)}finally{t.endUpdate()}if(!r.getFlattenedShadowOnSelf()){r.beginUpdate();try{this._sortSrcStructBaseOnShadow(r,n),e.connectorConnectedObjsSorter.execute(r.getCtab())}finally{r.endUpdate()}}},_sortSrcStructBaseOnShadow:function(e,t){var r=function(e){return e.__$flattern_index$__},n=function(e,t){e.__$flattern_index$__=t},o=function(t,i,a,s){n(i,a);var l=i.getParent();if(l.isChildOf(e)){var u=r(l),c=a+s;(Kekule.ObjUtils.isUnset(u)||u>c)&&o(t,l,c,s)}},i=function(e){e.beginUpdate();try{e.sortNodes(function(e,t){return r(e)-r(t)}),e.sortConnectors(function(e,t){return r(e)-r(t)});for(var t=0,n=e.getNodeCount();t<n;++t){var o=e.getNodeAt(t);o instanceof Kekule.StructureFragment&&i(o)}}finally{e.endUpdate()}};e.cascadeOnChildren(function(e){e&&n(e,null)});var a=t.getChildCount();e.beginUpdate();try{for(var s=0;s<a;++s){var l=t.getChildAt(s);if(l instanceof Kekule.ChemStructureNode){var u=l,c=e.getFlatternedShadowSourceObj(u);c&&(o(e,c,s,a),c.setCanonicalizationIndex(u.getCanonicalizationIndex()))}else if(l instanceof Kekule.ChemStructureConnector){var d=l,h=e.getFlatternedShadowSourceObj(d);n(h,s)}}i(e)}finally{e.endUpdate()}}}),Kekule.ClassUtils.makeSingleton(Kekule.Canonicalizer),Kekule.canonicalizer=Kekule.Canonicalizer.getInstance(),ClassEx.extend(Kekule.ChemObject,{canonicalize:function(e){for(var t=Kekule.ChemStructureUtils.getAllStructFragments(this,!0),r=0,n=t.length;r<n;++r)t[r].canonicalize(e);return this}}),ClassEx.extend(Kekule.StructureConnectionTable,{canonicalize:function(e){return Kekule.canonicalizer.canonicalize(this),this}}),ClassEx.extend(Kekule.StructureFragment,{canonicalize:function(e){return Kekule.canonicalizer.canonicalize(this),this}}),ClassEx.defineProp(Kekule.ChemStructureObject,"canonicalizationIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLISHED}),ClassEx.defineProp(Kekule.ChemStructureObject,"canonicalizationAssocIndex",{dataType:DataType.INT,serializable:!1,scope:Class.PropertyScope.PUBLISHED}),Kekule.canonicalizer.registerExecutor("morgan",[Kekule.CanonicalizationMorganIndexer,Kekule.CanonicalizationMorganNodeSorter],!0)}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.GraphAlgorithmUtils,r=Kekule.ChemStructureUtils,n=Kekule.BondType;Kekule.globalOptions.add("algorithm.ringSearch",{bondTypes:[n.COVALENT]}),ClassEx.extend(Kekule.StructureConnectionTable,{getGraph:function(e){var t=Class.create(e);return t.connectorClasses=[Kekule.Bond],Kekule.GraphAdaptUtils.ctabToGraph(this,null,t)},extractStructObjs:function(e){for(var t=e.edges,r=e.vertexes,n=[],o=[],i=0,a=r.length;i<a;++i){(s=r[i].getData("object"))instanceof Kekule.BaseStructureNode&&n.push(s)}for(i=0,a=t.length;i<a;++i){var s;(s=t[i].getData("object"))instanceof Kekule.BaseStructureConnector&&o.push(s)}return{nodes:n,connectors:o}},findCycleBlocks:function(){var e=this.getRingInfo();return e?e.cycleBlocks:[]},findAllRings:function(){var e=this.getRingInfo(),t=[];if(e)for(var r=0,n=e.cycleBlocks.length;r<n;++r){var o=e.cycleBlocks[r].allRings;t=t.concat(o)}return t},findSSSR:function(){var e=this.getRingInfo(),t=[];if(e)for(var r=0,n=e.cycleBlocks.length;r<n;++r){var o=e.cycleBlocks[r].sssrRings;t=t.concat(o)}return t},analysisRings:function(e){var r=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.ringSearch),e),n=this.getGraph(r);if(n){for(var o=[],i=t.analysisRings(n),a=0,s=i.length;a<s;++a){var l=i[a],u=this.extractStructObjs(l);o.push(u),u.allRings=[];for(var c=l.allRings,d=0,h=c.length;d<h;++d){var f=c[d],m=this.extractStructObjs(f);u.allRings.push(m)}u.sssrRings=[];var g=l.sssrRings;for(d=0,h=g.length;d<h;++d){f=g[d];var p=c.indexOf(f);if(p>=0)u.sssrRings.push(u.allRings[p]);else{m=this.extractStructObjs(f);u.sssrRings.push(m)}}}return{cycleBlocks:o}}return null}}),ClassEx.defineProps(Kekule.StructureConnectionTable,[{name:"ringInfo",dataType:DataType.HASH,serializable:!1,getter:function(e){var t=this.getStructureCacheData("ringInfo");return t||e||(t=this.analysisRings(),this.setStructureCacheData("ringInfo",t)),t},setter:null}]),ClassEx.extend(Kekule.StructureFragment,{findCycleBlocks:function(){return this.hasCtab()?this.getCtab().findCycleBlocks():null},findAllRings:function(){return this.hasCtab()?this.getCtab().findAllRings():null},findSSSR:function(){return this.hasCtab()?this.getCtab().findSSSR():null},analysisRings:function(e){return this.hasCtab()?this.getCtab().analysisRings(e):null}}),ClassEx.defineProps(Kekule.StructureFragment,[{name:"ringInfo",dataType:DataType.HASH,serializable:!1,getter:function(e){return this.hasCtab()?this.getCtab().getRingInfo(e):null},setter:null}]),ClassEx.extendMethod(Kekule.StructureFragment,"_copyAdditionalFragmentInfo",function($origin,e,t,r){var n=function(e){for(var r={nodes:[],connectors:[]},n=0,o=e.nodes.length;n<o;++n){(i=t.get(e.nodes[n]))&&r.nodes.push(i)}for(n=0,o=e.connectors.length;n<o;++n){var i;(i=t.get(e.connectors[n]))&&r.connectors.push(i)}return r};$origin(e,t,r);var o=this.getRingInfo(!0);if(o){for(var i={cycleBlocks:[]},a=0,s=o.cycleBlocks.length;a<s;++a){for(var l=o.cycleBlocks[a],u={allRings:[],sssrRings:[]},c=l.allRings,d=0,h=c.length;d<h;++d){var f=c[d];u.allRings.push(n(f))}var m=l.sssrRings;for(d=0,h=m.length;d<h;++d){f=m[d];u.sssrRings.push(n(f))}i.cycleBlocks.push(u)}e.setPropStoreFieldValue("ringInfo",i)}}),ClassEx.extend(Kekule.ChemStructureObject,{getBelongedSssrRings:function(){var e=[],t=this.getParent();if(t&&t.findSSSR)for(var r=t.findSSSR(),n=0,o=r.length;n<o;++n){var i=r[n];this instanceof Kekule.BaseStructureConnector?i.connectors.indexOf(this)>=0&&e.push(i):i.nodes.indexOf(this)>=0&&e.push(i)}return e},getBelongedRingMinSize:function(){var e=null,t=this.getBelongedSssrRings();if(t&&t.length)for(var r=0,n=t.length;r<n;++r){var o=t[r].nodes.length;e=e?Math.min(e,o):o}return e},isInRing:function(t){var r=t&&e.toArray(t);if(!r){var n=this.getParent();n&&n.findSSSR&&(r=n.findSSSR())}if(r&&r.length){for(var o=0,i=r.length;o<i;++o){var a=r[o];if(this instanceof Kekule.BaseStructureConnector){if(a.connectors.indexOf(this)>=0)return!0}else if(a.nodes.indexOf(this)>=0)return!0}return!1}return!1}}),ClassEx.extend(Kekule.ChemObject,{findCycleBlocks:function(){for(var e=r.getAllStructFragments(this),t=[],n=0,o=e.length;n<o;++n){var i=e[n].findCycleBlocks();i&&(t=t.concat(i))}return t.length?t:null},findAllRings:function(){for(var e=r.getAllStructFragments(this),t=[],n=0,o=e.length;n<o;++n){var i=e[n].findAllRings();i&&(t=t.concat(i))}return t.length?t:null},findSSSR:function(){for(var e=r.getAllStructFragments(this),t=[],n=0,o=e.length;n<o;++n){var i=e[n].findSSSR();i&&(t=t.concat(i))}return t.length?t:null},analysisRings:function(e){for(var t=r.getAllStructFragments(this),n=[],o=0,i=t.length;o<i;++o){var a=t[o].analysisRings(e);a&&(n=n.concat(a))}return n.length?n:null}})}(),function(){"use strict";var e=Kekule.ObjUtils,t=Kekule.ArrayUtils,r=Kekule.BondType,n=Kekule.BondOrder,o=Kekule.ChemStructureUtils,i=-1,a=-16,s=-32;Kekule.AromaticTypes={NONAROMATIC:0,EXPLICIT_AROMATIC:1,ANTIAROMATIC:-1,UNCERTAIN:64},ClassEx.extend(Kekule.Atom,{isSulfoneOrSulfoxideSulphur:function(){if("S"===this.getSymbol()){var e=this.getLinkedMultipleBonds();if(e.length>=1)for(var t=0,r=e;t<r;++t)for(var n=this.getLinkedObjsOnConnector(e[t]),o=0,i=n.length;o<i;++o){var a=n[o];if(a instanceof Kekule.Atom&&"O"===a.getSymbol())return!0}}return!1},isEsterCarbon:function(){if("C"===this.getSymbol())for(var e,t,o=this.getLinkedBonds(r.COVALENT),i=0,a=o.length;i<a;++i){var s=o[i];if(s.isBondBetween("C","O")&&(t||s.getBondOrder()!==n.SINGLE?e||s.getBondOrder()!==n.DOUBLE||(e=!0):t=!0,t&&e))return!0}return!1}}),Kekule.globalOptions.add("algorithm.aromaticRingsPerception",{allowUncertainRings:!1}),ClassEx.extend(Kekule.StructureConnectionTable,{_getPossibleRingNodePiElectronCounts:function(e,r,n){var o=function(e,r,n,o){var l=e,u=Kekule.IsotopeFactory.getIsotope(l),c=r.getCharge();if(!(r.isSaturated&&r.isSaturated())){var d,h,f,m=r.getLinkedMultipleBonds();if(r.isSulfoneOrSulfoxideSulphur&&r.isSulfoneOrSulfoxideSulphur())return s;if(r.isEsterCarbon&&r.isEsterCarbon())return a;if(o?f=(h=t.intersect(m,o)).length:(h=null,f=1),f)if(2===f&&h[0].getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC)d=u.isHetero&&u.isHetero()?[1,2]:1;else if(1===f&&h&&h[0].getBondOrder()===Kekule.BondOrder.DOUBLE)d=1;else{if(1!==f||h)return-1;d=1}else if("C"===l){for(var g=!1,p=0,C=m.length;p<C;++p){var O=m[p],k=r.getLinkedObjsOnConnector(O);if(1===k.length)if(k[0].getPrimaryIsotope().isHetero()){g=!0;break}}d=g?0:1}else d=1;if(t.isArray(d)){for(p=0,C=d.length;p<C;++p)d[p]=Math.min(Math.max(d[p]-c,0),2);return d}return Math.min(Math.max(d-c,0),2)}return r.getRadical&&r.getRadical()===Kekule.RadicalOrder.DOUBLET?1:u.isHetero()?Math.min(Math.max(2-c,0),2):"C"===l?c>0?0:c<0?2:i:0};if(e instanceof Kekule.VariableAtom){var l=e.getAllowedIsotopeIds();if(l&&l.length){for(var u=[],c=0,d=l.length;c<d;++c){var h=l[c],f=Kekule.IsotopeFactory.getIsotopeById(h).getSymbol();t.pushUnique(u,o(f,e,0,n))}return u}return[0,1,2]}var m=e.getPrimaryIsotope();return m?o(f=m.getSymbol(),e,0,n):[0,1,2]},_checkRingAromaticType:function(e,r,n){if(r){for(var o=n&&Kekule.ChemStructureUtils.isInRings(e,n),i=e.nodes,a=i.length,s=a>6&&a<16,l=[],u=[],c=i.length,d=0;d<c;++d){var h=i[d],f=r.get(h);t.isArray(f)?l.push(f):l.push([f]),u[d]=0}var m,g=function(e,t){var r=t[e],n=++r;return n>=l[e].length?!(e>=t.length-1)&&(t[e]=0,g(e+1,t)):(t[e]=n,!0)},p=null,C=null;do{0;var O=0,k=null;for(d=0;d<c;++d){var S=l[d][u[d]];if(!(S>=0)){k=Kekule.AromaticTypes.NONAROMATIC;break}O+=S}if(null===k){var b=parseInt(O/4),T=O%4;b<=5&&(2!==b||!(s&&o))&&(2===T?(k=Kekule.AromaticTypes.EXPLICIT_AROMATIC,C=t.clone(u)):T||(k=Kekule.AromaticTypes.ANTIAROMATIC))}if(null!==p){if(k&&p!==k&&(p===Kekule.AromaticTypes.EXPLICIT_AROMATIC||k===Kekule.AromaticTypes.EXPLICIT_AROMATIC)){m=Kekule.AromaticTypes.UNCERTAIN;break}}else p=k}while(g(0,u));if(m||(m=p),C)for(var E=new Kekule.MapEx,I=(d=0,C.length);d<I;++d)E.set(i[d],l[d][C[d]]);return{result:m,eMap:E}}},_calcPossibleRingNodesPElectronCounts:function(e,r,n){var o=[],i=[],a=[];if(n){for(s=0,l=n.length;s<l;++s)t.pushUnique(o,n[s].nodes),t.pushUnique(i,n[s].connectors);for(s=0,l=r.length;s<l;++s)t.pushUnique(a,r[s].nodes)}else{for(var s=0,l=r.length;s<l;++s)t.pushUnique(o,r[s].nodes),t.pushUnique(i,r[s].connectors);a=o}for(s=0,l=a.length;s<l;++s){var u=a[s],c=u.getStructureCacheData("piElectronCount");if(Kekule.ObjUtils.notUnset(c))e.set(u,[c]);else{var d=this._getPossibleRingNodePiElectronCounts(u,o,i);e.set(u,d)}}},_storeAromaticCacheToRingInfo:function(e,t,r){if(e.aromaticType=t,t===Kekule.AromaticTypes.EXPLICIT_AROMATIC)for(var n=e.nodes,o=0,i=n.length;o<i;++o){var a=n[o];if(Kekule.ObjUtils.isUnset(a.getStructureCacheData("piElectronCount"))&&r){var s=r.get(a);Kekule.ObjUtils.notUnset(s)&&a.setStructureCacheData("piElectronCount",s)}}},perceiveAromaticRings:function(e,t){Kekule.ObjUtils.isUnset(e)&&(e=Kekule.globalOptions.algorithm.aromaticRingsPerception.allowUncertainRings);var r=this.findSSSR(),n=t||r,o=[],i=new Kekule.MapEx;try{this._calcPossibleRingNodesPElectronCounts(i,n,null);for(var a=0,s=n.length;a<s;++a){var l,u=n[a];if(Kekule.ObjUtils.notUnset(u.aromaticType))l=u.aromaticType;else{var c=this._checkRingAromaticType(u,i,r);l=c.result,this._storeAromaticCacheToRingInfo(u,l,c.eMap)}(l===Kekule.AromaticTypes.EXPLICIT_AROMATIC||e&&l===Kekule.AromaticTypes.UNCERTAIN)&&o.push(u)}return o}finally{i.finalize()}},findAromaticRings:function(e,t){return this.perceiveAromaticRings(e,t)},getRingAromaticType:function(e,t){if(Kekule.ObjUtils.notUnset(e.aromaticType))return e.aromaticType;var r,n=this.findSSSR();t||(t=n);var o=new Kekule.MapEx;try{this._calcPossibleRingNodesPElectronCounts(o,[e],t);var i=this._checkRingAromaticType(e,o,n);r=i.result,this._storeAromaticCacheToRingInfo(e,r,i.eMap)}finally{o.finalize()}return r},getHucklizationChanges:function(e,t){for(var r=t&&t.allowUncertainRings,n=Kekule.BondOrder,o=[],i=(this.getParent(),this.findAromaticRings(r)),a=0,s=i.length;a<s;++a)for(var l=i[a].connectors,u=0,c=l.length;u<c;++u){var d=l[u];if(!e||e.indexOf(d)>=0){var h=d.getBondOrder&&d.getBondOrder();h!==n.SINGLE&&h!==n.DOUBLE||d.setBondOrder&&o.push({bond:d,bondOrder:Kekule.BondOrder.EXPLICIT_AROMATIC})}}return o},hucklize:function(e,t){t&&t.allowUncertainRings,Kekule.BondOrder;var r=[],n=this.getParent();n.setAutoClearStructureCache(!1),n.beginUpdate();try{var o=this.getHucklizationChanges(e,t);if(o)for(var i=0,a=o.length;i<a;++i){var s=o[i].bond,l=o[i].bondOrder;s.setBondOrder&&(s.setBondOrder(l),r.push(s))}}finally{n.endUpdate(),n.setAutoClearStructureCache(!0)}return r},getKekulizationChanges:function(e,t){var r,o=Object.extend({doAromaticTests:!1,includingSubFragments:!0,expandSubFragments:!1,useShadow:!0},t||{}),i=[],a=this.getParent();if(o.doAromaticTests&&this.perceiveAromaticRings(),o.useShadow){var s=a.createShadow();r=s.getShadowFragment()}else r=a;try{var l;if(o.expandSubFragments&&o.useShadow&&r.unmarshalAllSubFragments(!0),e)if(l=[],o.useShadow)for(var u=0,c=e.length;u<c;++u){var d=s.getShadowObj(e[u]);d&&l.push(d)}else l=e;else l=o.includingSubFragments&&!o.expandSubFragments?r.getAllContainingConnectors():r.getConnectors();var h=[];for(u=0,c=l.length;u<c;++u){var f=l[u];f.getBondType()===Kekule.BondType.COVALENT&&f.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC&&2===f.getConnectedChemNodeCount()&&h.push(f)}r.setAutoClearStructureCache(!1),r.beginUpdate();try{var m=this._splitConnectorsToContinuousParts(h)||[];for(u=0,c=m.length;u<c;++u){var g=m[u];if(this._kekulizeContinousBonds(g,s,r,a))for(var p=0,C=g.length;p<C;++p){var O=g[p].getBondOrder();if(O!==n.EXPLICIT_AROMATIC){var k=o.useShadow?s.getSourceObj(g[p]):g[p];i.push({bond:k,bondOrder:O})}}}}finally{r.endUpdate(),r.setAutoClearStructureCache(!0)}}finally{o.useShadow&&s.finalize()}return i._useShadow=o.useShadow,i},kekulize:function(e,t){var r=[],n=this.getKekulizationChanges(e,t);if(n&&n._useShadow){var o=this.getParent();try{o.setAutoClearStructureCache(!1),o.beginUpdate();for(var i=0,a=n.length;i<a;++i){var s=n[i];s.bond.setBondOrder(s.bondOrder),r.push(s.bond)}}finally{o.endUpdate(),o.setAutoClearStructureCache(!0)}}return r},_kekulizeContinousBonds:function(r,n,o,i){for(var a=[],s=0,l=r.length;s<l;++s){var u=r[s].getConnectedChemNodes()||[];t.pushUnique(a,u)}var c=new Kekule.MapEx(!1);for(s=0,l=a.length;s<l;++s){var d=a[s],h=n?n.getSourceObj(d):d,f=h&&h.getStructureCacheData("piElectronCount");e.notUnset(f)&&c.set(d,{cachedPiElectronCount:f})}return this._doKekulizeContinousBondSys(0,r,a,c)},_doKekulizeContinousBondSys:function(r,o,i,a){var s=this,l=function(t){var r,n=a.get(t);return n?r=n.bondOrder:o.indexOf(t)<0&&(r=t.getBondOrder()),e.notUnset(r)?r:null},u=function(e){var t=l(e);return t>n.SINGLE&&t<=n.QUAD},c=function(r){var i=a.get(r),u=i&&i.cachedPiElectronCount;if(e.isUnset(u)){var c=r.getLinkedBonds(Kekule.BondType.COVALENT);if(function(e){var r=t.intersect(e,o),n=!r||!r.length;if(!n){n=!0;for(var i=0,s=r.length;i<s;++i){var l=r[i];if(!a.get(l)){n=!1;break}}}return n}(c)){var d=t.toArray(s._getPossibleRingNodePiElectronCounts(r,null,null));return!d||!d.length||d[0]<0?-1:d[0]}for(var h=0,f=0,m=c.length;f<m;++f){var g=c[f],p=l(g);e.notUnset(p)&&(p===n.DOUBLE||p===n.TRIPLE||p===n.QUAD?++h:0)}h&&(u=1===h?1:-1)}return u},d=o[r],h=d.getConnectedChemNodes(),f=[];if(!a.get(d)){if(function(e){for(var t=e.getNeighboringBonds(),r=0,n=t.length;r<n;++r)if(e=t[r],u(e))return!0;return!1}(d))f=[n.SINGLE];else{var m=function(t,r){for(var n=0,o=0,i=0,a=r.length;i<a;++i){var s=c(r[i]);e.notUnset(s)&&(s>=2?++n:++o)}return n>0||!(o>=2)&&null}(0,h);f=m?[n.SINGLE]:null!==m?[n.DOUBLE]:[n.DOUBLE,n.SINGLE]}for(var g,p=0,C=f.length;p<C;++p){g=!0;var O=f[p];a.set(d,{bondOrder:O}),d.setBondOrder(O);for(var k=0,S=h.length;k<S;++k){var b=h[k];if(c(b)<0){g=!1;break}}if(g){if(!(r<o.length-1)){g=!0;break}if(g=this._doKekulizeContinousBondSys(r+1,o,i,a))break}}return!!g||(d.setBondOrder(n.EXPLICIT_AROMATIC),a.remove(d),!1)}},_splitConnectorsToContinuousParts:function(e){if(!e||!e.length)return null;for(var r=function(e,t){var n=t.indexOf(e);if(n<0)return[];t.splice(n,1);for(var o=[e],i=e.getNeighboringConnectors(),a=0,s=i.length;a<s;++a){var l=i[a];t.indexOf(l)>=0&&(o=o.concat(r(l,t)))}return o},n=[],o=t.clone(e);o.length;){var i=o[0],a=r(i,o);a&&a.length&&n.push(a)}return n}}),ClassEx.extend(Kekule.StructureFragment,{perceiveAromaticRings:function(e,t){var r=this.hasCtab()?this.getCtab().perceiveAromaticRings(e,t):[];return this.setAromaticRings(r||[]),r},findAromaticRings:function(e,t){return this.perceiveAromaticRings(e,t)},getRingAromaticType:function(e,t){return this.hasCtab()?this.getCtab().getRingAromaticType(e,t):null},getHucklizationChanges:function(e,t){return this.hasCtab()?this.getCtab().getHucklizationChanges(e,t):[]},hucklize:function(e,t){return this.hasCtab()?this.getCtab().hucklize(e,t):[]},getKekulizationChanges:function(e,t){return this.hasCtab()?this.getCtab().getKekulizationChanges(e,t):[]},kekulize:function(e,t){return this.hasCtab()?this.getCtab().kekulize(e,t):[]}}),ClassEx.extend(Kekule.ChemObject,{perceiveAromaticRings:function(e,t){for(var r=o.getAllStructFragments(this),n=[],i=0,a=r.length;i<a;++i){var s=r[i].perceiveAromaticRings(e,t);s&&(n=n.concat(s))}return n.length?n:null},findAromaticRings:function(e,t){return this.perceiveAromaticRings(e,t)},_groupActualTargetBondsOfKekulizationOrHucklization:function(e,t,r){var n=[];if(t)for(l=0,u=t.length;l<u;++l)for(var o=t[l],i=0,a=e.length;i<a;++i){var s=e[i];o.isChildOf(s)&&(n[i]?n[i].bonds.push(o):n[i]={structFragment:s,bonds:[o]})}else for(var l=0,u=e.length;l<u;++l)n.push({structFragment:e[l],bonds:null});return n},getHucklizationChanges:function(e,t){for(var r=[],n=o.getAllStructFragments(this),i=this._groupActualTargetBondsOfKekulizationOrHucklization(n,e,t),a=0,s=i.length;a<s;++a){var l=i[a];l&&(r=r.concat(l.structFragment.getHucklizationChanges(l.bonds,t)||[]))}return r},hucklize:function(e,t){for(var r=[],n=o.getAllStructFragments(this),i=this._groupActualTargetBondsOfKekulizationOrHucklization(n,e,t),a=0,s=i.length;a<s;++a){var l=i[a];l&&(r=r.concat(l.structFragment.hucklize(l.bonds,t)||[]))}return r},getKekulizationChanges:function(e,t){for(var r=[],n=o.getAllStructFragments(this),i=this._groupActualTargetBondsOfKekulizationOrHucklization(n,e,t),a=0,s=i.length;a<s;++a){var l=i[a];l&&(r=r.concat(l.structFragment.getKekulizationChanges(l.bonds,t)||[]))}return r},kekulize:function(e,t){for(var r=[],n=o.getAllStructFragments(this),i=this._groupActualTargetBondsOfKekulizationOrHucklization(n,e,t),a=0,s=i.length;a<s;++a){var l=i[a];l&&(r=r.concat(l.structFragment.kekulize(l.bonds,t)||[]))}return r}})}(),function(){"use strict";Kekule.globalOptions.add("algorithm.molStandardization",{cleanStructure:!0,clearHydrogens:!0,unmarshalSubFragments:!0,doCanonicalization:!0,doAromaticPerception:!0,doStereoPerception:!0}),Kekule.MolStandardizer={standardize:function(e,t){var r=Object.extend({},Kekule.globalOptions.algorithm.molStandardization),n=e,o=Object.extend(r,t);return o.unmarshalSubFragments&&n.unmarshalAllSubFragments(!0),o.cleanStructure&&n.clean(),o.doCanonicalization&&Kekule.canonicalizer.canonicalize(n,o.canonicalizerExecutorId||null),o.doAromaticPerception&&n.perceiveAromaticRings(),o.doStereoPerception&&n.perceiveStereos(null,!0,o),o.clearHydrogens&&n.clearExplicitBondHydrogens(!0),n}},Object.extend(Kekule.ChemStructureUtils,{compareStructFragment:function(e,t,r){var n=e.clone(!1),o=t.clone(!1);n.setCanonicalizationIndex(null),o.setCanonicalizationIndex(null);var i=Object.create(r||{});return n=Kekule.MolStandardizer.standardize(n,i),o=Kekule.MolStandardizer.standardize(o,i),i.doStandardize=!1,i.extraComparisonProperties=["canonicalizationIndex"],n.compareStructure(o,i)},isSameStructure:function(e,t,r){return 0===Kekule.ChemStructureUtils.compareStructFragment(e,t,r)}}),ClassEx.extend(Kekule.ChemObject,{standardize:function(e){for(var t=Kekule.ChemStructureUtils.getAllStructFragments(this,!0),r=0,n=t.length;r<n;++r)t[r].standardize(e);return this}}),ClassEx.extend(Kekule.StructureFragment,{standardize:function(e){return Kekule.MolStandardizer.standardize(this,e)},isSameStructureWith:function(e,t){return Kekule.ChemStructureUtils.isSameStructure(this,e,t)}}),ClassEx.extendMethod(Kekule.StructureFragment,"compare",function($origin,e,t){return t.method===Kekule.ComparisonMethod.CHEM_STRUCTURE&&!1!==t.doStandardize&&e instanceof Kekule.StructureFragment?Kekule.ChemStructureUtils.compareStructFragment(this,e,t):$origin(e,t)})}(),function(){"use strict";var e=Kekule.ArrayUtils;Kekule.globalOptions.add("algorithm.structureSearch",{doStandardize:!0}),Kekule.ChemStructureSearcher={findSubStructure:function(r,n,o){var i=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.structureSearch),o);if(i.exactMatch)return!!n.isSameStructureWith(r,i)&&[].concat(n.getNodes()).concat(n.getConnectors());i=Object.extend({level:Kekule.StructureComparationLevel.CONSTITUTION,compareLinkedConnectorCount:!1,compareHydrogenCount:!1,compareConnectedObjCount:!1},i);var a=i=Kekule.ObjComparer.getStructureComparisonDetailOptions(i);if(i.doStandardize){var s={unmarshalSubFragments:!1,doCanonicalization:!0,doAromaticPerception:!0};i.compareStereo||(s.doCanonicalization=!1),r.standardize(s),n.standardize(s)}for(var l=n.getFlattenedShadowFragment(!0),u=r.getFlattenedShadowFragment(!0).getNonHydrogenNodes()[0],c=l.getNonHydrogenNodes(),d=c.length,h=0,f=[],m=[],g=!1;!g&&h<d;)g=t._compareNode(u,c[h],f,m,a),++h;if(g){var p=e.toUnique(g);return n.getFlatternedShadowSourceObjs(p)}return!1},_addToComparedObjs:function(e,t,r){t.push(e)},_removeFromComparedObjs:function(e,t,r){var n=t.indexOf(e);t.length=n},_isSameMappedObj:function(e,t,r,n){var o=n.indexOf(t),i=r.indexOf(e);return o>=0&&o===i},_compareComparedNeighbors:function(e,t,r,n){if(e.length>t.length)return!1;for(var o=[],i=0,a=e.length;i<a;++i)o.push(r.indexOf(e[i]));var s=[];for(i=0,a=t.length;i<a;++i)s.push(n.indexOf(t[i]));for(i=0,a=o.length;i<a;++i)if(s.indexOf(o[i])<0)return!1;return!0},_compareNode:function(r,n,o,i,a){if(0!==r.compareStructure(n,a))return!1;var s=r.getLinkedNonHydrogenConnectors(),l=n.getLinkedNonHydrogenConnectors();if(s.length>l.length)return!1;var u=e.clone(o),c=e.clone(i);t._addToComparedObjs(r,u,"target"),t._addToComparedObjs(n,c,"src");var d=e.intersect(s,u),h=e.intersect(l,c),f=!0;t._compareComparedNeighbors(d,h,u,c)?(s=e.exclude(s,d),l=e.exclude(l,h),s.length>l.length&&(f=!1)):f=!1;for(var m=[];f&&s.length;){for(var g,p=!1,C=s.shift(),O=0;l.length&&!p&&O<l.length;)g=l[O],(p=t._compareConnector(C,g,u,c,a))&&(m=m.concat(p)),++O;if(!p){f=!1;break}e.remove(l,g)}return f&&(f=[n].concat(m)),f},_compareConnector:function(r,n,o,i,a){if(0!==r.compareStructure(n,a))return!1;if(r.getConnectedObjCount()>n.getConnectedObjCount())return!1;var s=e.clone(o),l=e.clone(i);t._addToComparedObjs(r,s,"target"),t._addToComparedObjs(n,l,"src");var u=e.clone(r.getConnectedObjs()),c=e.clone(n.getConnectedObjs()),d=e.intersect(u,s),h=e.intersect(c,l),f=!0;t._compareComparedNeighbors(d,h,s,l)?(u=e.exclude(u,d),c=e.exclude(c,h),u.length>c.length&&(f=!1)):f=!1;for(var m=[];f&&u.length;){for(var g,p=!1,C=u.shift(),O=0;c.length&&!p&&O<c.length;)(p=(g=c[O]).getClass()===C.getClass()&&(g instanceof Kekule.ChemStructureNode?t._compareNode(C,g,s,l,a):g instanceof Kekule.ChemStructureConnector&&t._compareConnector(C,g,s,l,a)))&&(m=m.concat(p)),++O;if(!p){f=!1;break}e.remove(c,g)}return f&&(f=[n].concat(m)),f}};var t=Kekule.ChemStructureSearcher;ClassEx.extend(Kekule.StructureFragment,{search:function(e,r){return t.findSubStructure(e,this,r)}})}(),function(){"use strict";var e=Kekule.ArrayUtils,t=Kekule.CoordUtils;Kekule.RotationDir={CLOCKWISE:1,ANTICLOCKWISE:-1,UNKNOWN:0};var r=Kekule.RotationDir;Kekule.globalOptions.add("algorithm.stereoPerception",{useFlattenedShadow:!0,perceiveStereoConnectors:!0,perceiveChiralNodes:!0,calcParity:!0,strictStereoBondGeometry:!1,strictStereoAtomGeometry:!1,wedgeBondPrior:!0}),Kekule.MolStereoUtils={FISCHER_PROJECTION_BOND_ALLOWED_ERROR:.08,getDihedralAngleOfNodes:function(e,t,r,n,o,i){Kekule.ObjUtils.isUnset(i)&&(i=!0),Kekule.ObjUtils.isUnset(o)&&(o=t.hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D);var a=Kekule.MolStereoUtils._getNodeCoordForBondParity,s=t.getConnectorTo(r),l=s&&s.isDoubleBond&&s.isDoubleBond(),u=a(t,null,null,o,i),c=a(r,null,null,o,i),d=a(e,t,u,o,i,l),h=a(n,r,c,o,i,l);return d&&u&&c&&h?Kekule.GeometryUtils.getDihedralAngleOfPoints(d,u,c,h):-1},getParityOfNodeSeq:function(e,t,r,n,o,i){var a=Kekule.StereoParity,s=Kekule.MolStereoUtils.getDihedralAngleOfNodes(e,t,r,n,o,i);return s<0?a.UNKNOWN:s<2*Math.PI/5||s>8*Math.PI/5?a.ODD:s>3*Math.PI/5&&s<7*Math.PI/5?a.EVEN:a.UNKNOWN},_getNodeCoordForBondParity:function(e,r,n,o,i,a){if(o!==Kekule.CoordMode.COORD2D)return e.getAbsCoordOfMode(o,!0);var s=e.getAbsCoordOfMode(o,!0);if(r&&n){var l=e.getConnectorTo(r);if(l.getStereo){var u=l.getStereo(),c=Kekule.BondStereo,d=[c.UP,c.UP_INVERTED,c.DOWN,c.DOWN_INVERTED];if(d.indexOf(u)>=0){l.indexOfConnectedObj(e)-l.indexOfConnectedObj(r)<0&&(u=c.getInvertedDirection(u));var h=t.getDistance(s,n);s.z=h*[1,-1,-1,1][d.indexOf(u)]}else if([c.UP_OR_DOWN,c.UP_OR_DOWN_INVERTED].indexOf(u)>=0)return null}}return s.z=s.z||0,s},_calcParityOfCoordPairs:function(e,r,n,o,i,a,s){var l=Kekule.StereoParity,u=t.substract(r,e);if(!u.x&&!u.y)return l.UNKNOWN;for(var c=Math.atan2(u.y,u.x),d=t.calcTransform2DMatrix({rotateAngle:-c,center:e,translateX:-e.x,translateY:-e.y}),h=[e,r,n,o,i,a],f=[],m=0,g=h.length;m<g;++m){var p=h[m];f[m]=p?t.transform2DByMatrix(p,d):null}f[0];var C=f[1],O=f[2],k=f[3],S=t.substract(f[4],C),b=f[5]?t.substract(f[5],C):null,T=function(e,t,r,n){var o=0,i=Math.sqrt(Math.sqr(e.x)+Math.sqr(e.y));if(t){var a=Math.sqrt(Math.sqr(t.x)+Math.sqr(t.y));l=e.y/i-t.y/a;if(Math.abs(l)<r)o=0;else if(Math.sign(e.y)!==Math.sign(t.y))o=Math.sign(l)*n;else{if(s)return 0;l=-(e.x/e.y-t.x/t.y),o=Math.sign(l)}}else{var l=e.y/i;o=Math.abs(l)<r?0:Math.sign(e.y)*n}return o},E=T(O,k,.05,-1),I=T(S,b,.05,1);return E&&I?E!==I?l.ODD:l.EVEN:l.UNKNOWN},isStereoBond:function(t){var r=Kekule.ObjUtils.isUnset;if(t.getBelongedRingMinSize){var n=t.getBelongedRingMinSize()||0;if(n>0&&n<=10)return!1}var o=!1;if(t.isDoubleBond&&t.isDoubleBond()&&2===t.getConnectedObjCount()){var i=t.getConnectedChemNodes();if(2===i.length){o=!0;for(var a=0;a<2;++a){for(var s=i[a],l=s.getHydrogenCount(!0),u=[],c=s.getLinkedBonds(Kekule.BondType.COVALENT),d=0,h=c.length;d<h;++d){var f=c[d];if(f!==t){var m=f.getBondOrder();if(m&&m!==Kekule.BondOrder.SINGLE)return!1;var g=e.exclude(f.getConnectedChemNodes(),i);if(1!==g.length)return!1;u.push(g[0])}}if(l>=2||!u.length){o=!1;break}if(1===u.length);else if(2===u.length&&(r(u[0].getCanonicalizationIndex())&&r(u[1].getCanonicalizationIndex())||u[0].getCanonicalizationIndex()===u[1].getCanonicalizationIndex())){o=!1;break}for(d=0,h=u.length;d<h;++d){var p=s.getConnectorTo(u[d]);if(!p.isSingleBond||!p.isSingleBond()){o=!1;break}}if(!o)break}}}else o=!1;return o},doFindStereoBonds:function(e,t){var r=[];t||Kekule.canonicalizer.canonicalize(e,"morganEx");for(var n=0,o=e.getConnectorCount();n<o;++n){var i=e.getConnectorAt(n);Kekule.MolStereoUtils.isStereoBond(i)&&r.push(i)}return r},getStereoBondKeyNodes:function(t){var r=null;if(2===t.getConnectedObjCount()){var n=t.getConnectedChemNodes();if(2===n.length){for(var o=[],i=0;i<2;++i){var a=n[i],s=e.exclude(a.getLinkedChemNodes(),n);if(1===s.length)o.push(s[0]);else{if(2!==s.length)return null;var l=s[0].getCanonicalizationIndex()||-1,u=s[1].getCanonicalizationIndex()||-1;o.push(u>l?s[1]:s[0])}}r=[o[0],n[0],n[1],o[1]]}}return r},getStereoBondKeyNeighborConnectors:function(e){var t=Kekule.MolStereoUtils.getStereoBondKeyNodes(e);return[t[1].getConnectorTo(t[0]),t[2].getConnectorTo(t[3])]},getStereoBondRelNodes:function(t){var r=null;if(2===t.getConnectedObjCount()){var n=t.getConnectedChemNodes();if(2===n.length){for(var o=[],i=0;i<2;++i){var a=n[i],s=e.exclude(a.getLinkedChemNodes(),n);if(1===s.length)o.push(s[0]),o.push(null);else{if(2!==s.length)return null;var l=s[0].getCanonicalizationIndex()||-1,u=s[1].getCanonicalizationIndex()||-1;o.push(u>l?s[1]:s[0]),o.push(u>l?s[0]:s[1])}}r=[n[0],n[1],o[0],o[1],o[2],o[3]]}}return r},calcStereoBondParity:function(e,t,r,n){var o=Kekule.StereoParity;if(!r&&!Kekule.MolStereoUtils.isStereoBond(e))return o.NONE;if(e.getStereo&&[Kekule.BondStereo.E_OR_Z,Kekule.BondStereo.CIS_OR_TRANS].indexOf(e.getStereo())>=0)return o.NONE;var i,a,s=o.UNKNOWN,l=Kekule.MolStereoUtils.getStereoBondKeyNodes(e);if(l&&l.length){if(Kekule.ObjUtils.isUnset(t)&&(t=l[1].hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D),t===Kekule.CoordMode.COORD3D){var u=Kekule.MolStereoUtils.getDihedralAngleOfNodes(l[0],l[1],l[2],l[3],t);if(u<0||u>2*Math.PI/5&&u<3*Math.PI/5||u>7*Math.PI/5&&u<8*Math.PI/5)return o.UNKNOWN}var c=Kekule.MolStereoUtils._getNodeCoordForBondParity,d=Kekule.MolStereoUtils.getStereoBondRelNodes(e),h=[c(d[0],null,null,t,!0),c(d[1],null,null,t,!0)];h=h.concat([c(d[2],d[0],h[0],t,!0,!0),d[3]?c(d[3],d[0],h[0],t,!0,!0):null,c(d[4],d[1],h[1],t,!0,!0),d[5]?c(d[5],d[1],h[1],t,!0,!0):null]);for(var f=t===Kekule.CoordMode.COORD2D?[["x","y"]]:[["x","y"],["x","z"],["y","z"]],m=null,g=0,p=f.length;g<p;++g){for(var C=[],O=0,k=h.length;O<k;++O)h[O]?C.push((i=h[O],a=f[g],i?{x:i[a[0]],y:i[a[1]]}:null)):C.push(null);var S=Kekule.MolStereoUtils._calcParityOfCoordPairs(C[0],C[1],C[2],C[3],C[4],C[5],n);if(S!==o.UNKNOWN)if(null===m)m=S;else if(m!==S)return o.UNKNOWN}s=m}return s},doPerceiveStereoConnectors:function(e,t,r,n){var o=Kekule.MolStereoUtils.doFindStereoBonds(e,r);e.beginUpdate();try{if(o&&o.length)for(var i=0,a=o.length;i<a;++i){var s=o[i],l=Kekule.MolStereoUtils.calcStereoBondParity(s,t,!0,n);s.setParity&&s.setParity(l)}}finally{e.endUpdate()}return o},isChiralNode:function(e){var t=!1;if(e.mayContainElement){var r,n,o=null,i=!1;if(e.mayContainElement("C")||e.mayContainElement("Si")?(r=4,n=0,o=[0],i=!0):e.mayContainElement("N")?(r=4,n=0,i=!0):e.mayContainElement("S")||e.mayContainElement("P")?(r=3,n=0,i=!0):e.mayContainElement("B")&&(r=3,n=0,o=[-1],i=!0),i){if(e.getLinkedMultiCenterBonds().length)return!1;var a=e.getLinkedChemNodes(),s=e.getLinkedMultipleBonds(),l=e.getHydrogenCount?e.getHydrogenCount():0,u=e.getHydrogenCount?e.getHydrogenCount(!0):0,c=e.getCharge()||0;if(s.length>n||u>=2||a.length+l<r||o&&o.indexOf(c)<0)t=!1;else{t=!0;for(var d=[],h=0,f=a.length;h<f;++h){var m=a[h].getCanonicalizationIndex()||0;if(d[m]){t=!1;break}d[m]=1}}}}return t},doFindChiralNodes:function(e,t){var r=[];t||Kekule.canonicalizer.canonicalize(e,"morganEx");for(var n=0,o=e.getNodeCount();n<o;++n){var i=e.getNodeAt(n);Kekule.MolStereoUtils.isChiralNode(i)&&r.push(i)}return r},calcRotationDirection:function(e,n,o,i,a,s){var l,u=s?t.substract(e,n):t.substract(n,e),c=null;0!==u.x||0!==u.y?(l=Kekule.GeometryUtils.getVectorCrossProduct(u,{x:0,y:0,z:1}),m=Kekule.GeometryUtils.getVectorIncludedAngle(u,{x:0,y:0,z:1}),u.z<0&&(m=Math.PI-m)):u.z<0&&(l={x:1,y:0,z:0},m=Math.PI),l&&m&&(c=t.calcRotate3DMatrix({rotateAngle:m,rotateAxisVector:l,center:{x:0,y:0,z:0}}));var d=t.substract(o,e),h=t.substract(i,e),f=t.substract(a,e);c&&(d=t.transform3DByMatrix(d,c),h=t.transform3DByMatrix(h,c),f=t.transform3DByMatrix(f,c));var m=-Math.atan2(d.y,d.x),g=(c=t.calcTransform2DMatrix({rotateAngle:m,center:{x:0,y:0,z:0}}),t.transform2DByMatrix(h,c)),p=t.transform2DByMatrix(f,c);if(0===g.x||0===p.x)return r.UNKNOWN;var C=Math.atan2(g.y,g.x),O=Math.atan2(p.y,p.x);return O<0&&(O=2*Math.PI+O),C<0&&(C=2*Math.PI+C),C<O?r.ANTICLOCKWISE:C>O?r.CLOCKWISE:r.UNKNOWN},_extractFischerProjectionDetectOptions:function(e){var t=e||{};return{allowedError:t.fischerAllowedError,reversedDirection:t.reversedFischer,allowExplicitHydrogen:t.allowExplicitHydrogenInFischer,allowExplicitVerticalHydrogen:t.allowExplicitVerticalHydrogen}},_getFischerProjectionInfo:function(e,r,n){var o=Object.create(n||null);if(r.length<3||r.length>4)return null;if(3===r.length&&!o.allowExplicitHydrogen)return null;var i=Kekule.CoordMode.COORD2D,a=o.allowedError||Kekule.MolStereoUtils.FISCHER_PROJECTION_BOND_ALLOWED_ERROR;if(!o.ignoreStructure){var s=e instanceof Kekule.Atom&&6===e.getAtomicNumber();if(s&&e.getRenderOption&&(s=e.getRenderOption("nodeDisplayMode")!==Kekule.Render.NodeLabelDisplayMode.SHOWN),s)s=!e.getExplicitHydrogenCount();if(!s)return null}for(var l=e.getAbsCoordOfMode(i,!0),u=[],c=[],d=0,h=function(e,t,r){return!e[t]&&(e[t]=r,!0)},f=0,m=r.length;f<m;++f){var g=r[f],p=g.getConnectorTo(e);if(!o.ignoreStructure){var C=p.getStereo()||Kekule.BondStereo.NONE;if(!(p instanceof Kekule.Bond&&C===Kekule.BondStereo.NONE))return null}var O,k,S=g.getAbsCoordOfMode(i,!0),b=t.substract(S,l),T=Math.abs(b.x),E=Math.abs(b.y);if(Kekule.NumUtils.isFloatEqual(T,0)&&Kekule.NumUtils.isFloatEqual(E,0))return null;if(T>E?(k=E/T,O=b.x>0?1:3):(k=T/E,O=b.y>0?0:2,++d),k>a)return null;if(!h(u,O,g))return null;h(c,O,p)}if(2!==d&&!o.allowExplicitVerticalHydrogen)return null;var I={horizontalSiblings:[u[3],u[1]],verticalSiblings:[u[0],u[2]],horizontalBonds:[c[3],c[1]],verticalBonds:[c[0],c[2]]};return o.reversedDirection?(I.towardSiblings=I.verticalSiblings,I.awaySiblings=I.horizontalSiblings,I.towardBonds=I.verticalBonds,I.awayBonds=I.horizontalBonds,I.implicitTowardSibling=!u[0]||!u[2],I.implicitAwaySibling=!u[1]||!u[3]):(I.towardSiblings=I.horizontalSiblings,I.awaySiblings=I.verticalSiblings,I.towardBonds=I.horizontalBonds,I.awayBonds=I.verticalBonds,I.implicitTowardSibling=!u[1]||!u[3],I.implicitAwaySibling=!u[0]||!u[2]),I},calcTetrahedronChiralCenterRotationDirectionEx:function(n,o,i,a){var s=Object.extend({implicitFischerProjection:!0,allowExplicitHydrogenInFischer:!0},a),l=s.coordMode,u=!!s.withImplicitSibling,c=!!s.refSiblingBehind;s.implicitFischerProjection;if(!l){var d=n||o||i[0];if(!d)return{direction:r.UNKNOWN};l=d.hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D}var h=l===Kekule.CoordMode.COORD2D,f=i.length,m=f;if(o&&++m,u&&++m,m<4)return{direction:r.UNKNOWN};var g=Kekule.MolStereoUtils._extractFischerProjectionDetectOptions(s),p=[].concat(i);o&&Kekule.ArrayUtils.pushUnique(p,o);var C=n&&s.implicitFischerProjection?Kekule.MolStereoUtils._getFischerProjectionInfo(n,p,g):null,O=e.clone(i);o&&e.pushUnique(O,o);for(var k=function(e,r,n,o,i){var a=Kekule.ObjUtils.isUnset,l=n!==Kekule.CoordMode.COORD2D,u=e&&e.getAbsCoordOfMode(n,i);u&&a(u.z)&&(l?u.z=0:e.getZIndex2D?u.z=e.getZIndex2D()||0:u.z=0);for(var c=[],d={count:0,sum:0},h=0,f=r.length;h<f;++h){var m=r[h];if(l)E=m.getAbsCoordOfMode(n,i);else{if(a((E=m.getAbsCoordOfMode(n,i)).z)){var g=m.getConnectorTo(e);if(g.getStereo&&e&&u){var p=g.indexOfConnectedObj(m)-g.indexOfConnectedObj(e),C=Kekule.BondStereo,O=g.getStereo()||C.NONE;O===C.NONE&&o&&(o.towardSiblings.indexOf(m)>=0?O=p<0?C.UP_INVERTED:C.UP:o.awaySiblings.indexOf(m)>=0&&(O=p<0?C.DOWN_INVERTED:C.DOWN));var k=[C.UP,C.UP_INVERTED,C.DOWN,C.DOWN_INVERTED];if(k.indexOf(O)>=0){p<0&&(O=C.getInvertedDirection(O));var S=s.wedgeBondPrior?[2,-2,-1,1]:[1,-1,-1,1],b=t.getDistance(E,u);E.z=b*S[k.indexOf(O)]+u.z}else[C.UP_OR_DOWN,C.UP_OR_DOWN_INVERTED].indexOf(O)>=0&&(E=null)}}E&&a(E.z)&&m.getZIndex2D&&(E.z=m.getZIndex2D()),E&&!a(E.z)&&!1!==E.z&&(d.sum+=E.z-u.z,++d.count)}c.push(E)}if(!l&&u){var T=-d.sum/(r.length-d.count)+u.z;for(h=0,f=r.length;h<f;++h){var E;(E=c[h])&&a(E.z)&&(E.z=T)}}var I=new Kekule.MapEx;e&&I.set(e,u);for(h=0,f=r.length;h<f;++h)I.set(r[h],c[h]);return I}(n,O,l,C,!0),S=k.get(n),b=function(e,t,r,n,o){return k.get(e)},T=[],E=0;E<f;++E){var I=b(i[E]);T.push(I)}var A=e.clone(T),_=o?b(o):null;if(_&&A.push(_),A.indexOf(null)>=0)return{direction:r.UNKNOWN,fischerInfo:C};if(!S){for(var N={},y=(E=0,A.length);E<y;++E)N=t.add(A[E],N);S=t.divide(N,A.length)}var v=0;for(E=0,y=A.length;E<y;++E){var M=A[E],K=t.substract(M,S);M.x=K.x,M.y=K.y,M.z=K.z,h&&K.z&&++v}if(h&&v<=0)return{direction:r.UNKNOWN,fischerInfo:C};if(S={x:0,y:0,z:0},u){var D=0;for(N={},E=0,y=A.length;E<y;++E)N=t.add(A[E],N),D=Math.max(D,A[E].z||0);var R=t.substract({x:0,y:0,z:0},N);C&&(C.implicitTowardSibling||C.implicitTowardSibling)&&(R.z=C.implicitTowardSibling?D:-D),o?T.push(R):_=R}return 3===T.length&&T.indexOf(null)<0?{direction:Kekule.MolStereoUtils.calcRotationDirection(S,_,T[0],T[1],T[2],c),fischerInfo:C}:{direction:r.UNKNOWN,fischerInfo:C}},calcTetrahedronChiralCenterRotationDirection:function(e,t,r,n,o,i,a){var s=Object.create(a);return Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirectionEx(t,r,n,Object.extend(s,{coordMode:e,withImplicitSibling:o,refSiblingBehind:i})).direction},calcTetrahedronChiralNodeParity:function(e,t,n){var o=Object.create(n||null);t||(t=e.hasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D),o.coordMode=t,o.refSiblingBehind=!0;var i=Kekule.StereoParity;if(!o.ignoreChiralCheck&&!Kekule.MolStereoUtils.isChiralNode(e))return i.NONE;var a=e.getLinkedChemNodes();if(t===Kekule.CoordMode.COORD2D&&n.strictStereoAtomGeometry&&!Kekule.MolStereoUtils._isSiblingBond2DGeometryLegal(e,a))return i.UNKNOWN;var s=e.getHydrogenCount();o.withImplicitSibling=!!s||a.length<4,a.sort(function(e,t){return-((e.getCanonicalizationIndex()||0)-(t.getCanonicalizationIndex()||0))});var l=o.withImplicitSibling?null:a[3];a=a.slice(0,3);var u=Kekule.MolStereoUtils.calcTetrahedronChiralCenterRotationDirectionEx(e,l,a,o).direction;return u===r.CLOCKWISE?i.ODD:u===r.ANTICLOCKWISE?i.EVEN:i.UNKNOWN},_isSiblingBond2DGeometryLegal:function(e,t){for(var r=Kekule.BondStereo,n=[r.NONE,r.CLOSER],o=[2,2],i=[],a=0,s=t.length;a<s;++a){var l=t[a];if(!l.getZIndex2D()){var u=e.getConnectorTo(l);if(u.getStereo){var c=u.getStereo();if(n.indexOf(c)>=0)if(i[c]){if(++i[c],i[c]>o[c])return!1}else i[c]=1}}}return!0},doPerceiveChiralNodes:function(e,t,r,n){var o=Object.create(n||null),i=Object.create(o);i.ignoreChiralCheck=!0;var a=Kekule.MolStereoUtils.doFindChiralNodes(e,r);e.beginUpdate();try{if(a&&a.length)for(var s=0,l=a.length;s<l;++s){var u=a[s],c=Kekule.MolStereoUtils.calcTetrahedronChiralNodeParity(u,t,i);u.setParity&&u.setParity(c)}}finally{e.endUpdate()}return a},perceiveStereos:function(e,t,r,n){var o,i,a=Object.extend(Object.extend({},Kekule.globalOptions.algorithm.stereoPerception),n),s=e instanceof Kekule.StructureConnectionTable?e.getParent():e;i=a.useFlattenedShadow?s.getFlattenedShadowFragment(!0):s,r||Kekule.canonicalizer.canonicalize(i,"morganEx"),i.beginUpdate();try{var l,u;a.perceiveStereoConnectors&&(l=a.calcParity?Kekule.MolStereoUtils.doPerceiveStereoConnectors(i,t,!0,a.strictStereoBondGeometry):Kekule.MolStereoUtils.doFindStereoBonds(i,!0)),a.perceiveChiralNodes&&(u=a.calcParity?Kekule.MolStereoUtils.doPerceiveChiralNodes(i,t,!0,a):Kekule.MolStereoUtils.doFindChiralNodes(i,!0));var c=(u||[]).concat(l||[]);if(a.useFlattenedShadow&&!s.getFlattenedShadowOnSelf()){o=[],s.beginUpdate();try{for(var d=0,h=c.length;d<h;++d){var f=s.getFlatternedShadowSourceObj(c[d]);f&&(a.calcParity&&f.setParity(c[d].getParity()),o.push(f))}}finally{s.endUpdate()}}else o=c}finally{i.endUpdate()}return o},_setWedgeAroundFischerCenter:function(e,t,r,n){for(var o=Kekule.BondStereo,i=function(e,t,r){(e.setStereo(c),r)&&(e.getRenderOption("renderType")||e.setRenderOption("renderType",Kekule.Render.BondRenderType.SINGLE))},a=!(!n||!n.maintainRenderStyle),s=0,l=t.towardBonds.length;s<l;++s){var u=t.towardBonds[s];if(r.indexOf(u)>=0){var c=u.indexOfConnectedObj(e)>0?o.UP_INVERTED:o.UP;i(u,0,a)}}for(s=0,l=t.awayBonds.length;s<l;++s){u=t.awayBonds[s];if(r.indexOf(u)>=0){c=u.indexOfConnectedObj(e)>0?o.DOWN_INVERTED:o.DOWN;i(u,0,a)}}},convertFischerCenterBondsToWedge:function(e,t,r,n){r||(r=t.getLinkedBonds());var o=t.getLinkedChemNodes(),i=(Kekule.MolStereoUtils._extractFischerProjectionDetectOptions(n),Kekule.MolStereoUtils._getFischerProjectionInfo(t,o,fischerOptions));if(i){e.beginUpdate();try{Kekule.MolStereoUtils._setWedgeAroundFischerCenter(t,i,r,n)}finally{e.endUpdate()}}},convertFischerBondsToWedge:function(e,t){for(var r=Kekule.MolStereoUtils.perceiveStereos(e,null,null,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!1}),n=Kekule.MolStereoUtils._extractFischerProjectionDetectOptions(t),o=new Kekule.MapEx,i=[],a=0,s=r.length;a<s;++a){var l=r[a].getLinkedChemNodes();(d=Kekule.MolStereoUtils._getFischerProjectionInfo(r[a],l,n))&&(o.set(r[a],d),i.push(r[a]))}var u=function(e,t,r){for(var n=[],o=0,i=e.length;o<i;++o){var a=e[o],s=t.getLinkedObjsOnConnector(a);Kekule.ArrayUtils.intersect(s,r).length||n.push(a)}return n};e.beginUpdate();try{for(a=0,s=i.length;a<s;++a){var c=i[a],d=o.get(c),h=[].concat(d.towardBonds).concat(d.awayBonds);h=u(h,c,i),Kekule.MolStereoUtils._setWedgeAroundFischerCenter(c,d,h,t)}}finally{e.endUpdate()}},findStereoConnectors:function(e,t){return Kekule.MolStereoUtils.perceiveStereos(e,null,t,{perceiveStereoConnectors:!0,perceiveChiralNodes:!1,calcParity:!1})},perceiveStereoConnectors:function(e,t,r,n){return Kekule.MolStereoUtils.perceiveStereos(e,t,r,{perceiveStereoConnectors:!0,perceiveChiralNodes:!1,calcParity:!0,strictStereoBondGeometry:n})},findChiralNodes:function(e,t){return Kekule.MolStereoUtils.perceiveStereos(e,null,t,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!1})},perceiveChiralNodes:function(e,t,r,n){var o=Object.create(n||null);return o=Object.extend(o,{perceiveStereoConnectors:!1,perceiveChiralNodes:!0,calcParity:!0}),Kekule.MolStereoUtils.perceiveStereos(e,t,r,o)}},Kekule.CanonicalizationMorganExIndexer=Class.create(Kekule.CanonicalizationMorganIndexer,{CLASS_NAME:"Kekule.CanonicalizationMorganExIndexer",doExecute:function(e){var t=this.doCalcGraphAndEcResult(e);this.doExecuteOnGraphEcResult(t.graph,t.ecMapping,t.vertexGroup);var r=e.getNonHydrogenNodes(),n=this._groupNodesByCanoIndex(r),o=null,i=0;for(o=Kekule.MolStereoUtils.perceiveStereos(e,null,!0)||[];i<o.length;)n=this._regroupSortedNodes(n),this._setCanonicalizationIndexToNodeGroups(n),i=o.length,o=Kekule.MolStereoUtils.perceiveStereos(e,null,!0)||[];i>0&&this.doExecuteOnGraphEcResult(t.graph,t.ecMapping,t.vertexGroup)},_groupNodesByCanoIndex:function(t){return e.group(t,function(e,t){return(e.getCanonicalizationIndex()||-1)-(t.getCanonicalizationIndex()||-1)})},_regroupSortedNodes:function(e){var t,r,n=e;do{t=n.length,r=(n=this._doRegroupSortedNodes(n)).length}while(r>t);return n},_doRegroupSortedNodes:function(t){for(var r=[],n=0,o=t.length;n<o;++n){var i=t[n];if(e.isArray(i)){var a=e.group(i,function(e,t){var r=e.compareStructure(t);if(0===r){var n=e.getLinkedConnectors(),o=t.getLinkedConnectors();r=Kekule.ObjComparer.compareStructure(n,o)}return r});r=r.concat(a)}else r.push(i)}return r}}),Kekule.canonicalizer.registerExecutor("morganEx",[Kekule.CanonicalizationMorganExIndexer,Kekule.CanonicalizationMorganNodeSorter],!0),ClassEx.extend(Kekule.StructureFragment,{perceiveChiralNodes:function(e,t,r){return Kekule.MolStereoUtils.perceiveChiralNodes(this,e,t,r)},perceiveStereoConnectors:function(e,t){return Kekule.MolStereoUtils.perceiveStereoConnectors(this,e,t)},perceiveStereos:function(e,t,r){return Kekule.MolStereoUtils.perceiveStereos(this,e,t,r)}})}(),function(){"use strict";Kekule.Calculator={},Kekule.Calculator.Utils={_instanceMaxIndex:0,generateUid:function(){return++Kekule.Calculator.Utils._instanceMaxIndex,"Kekule.Calculator."+Kekule.Calculator.Utils._instanceMaxIndex}},Kekule.Calculator.getWorkerBasePath=function(){var e=Kekule.isUsingMinJs()?"workers/":"calculation/workers/";return e=Kekule.getScriptPath()+e},Kekule.Calculator.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Calculator.Base",WORKER_SHARED_COUNT_FIELD:"__$workerSharedCount$__",initialize:function(){this.setPropStoreFieldValue("uid",this._generateUid()),this.tryApplySuper("initialize")},initProperties:function(){this.defineProp("async",{dataType:DataType.BOOL}),this.defineProp("worker",{dataType:DataType.OBJECT,setter:null}),this.defineProp("uid",{dataType:DataType.STRING,setter:null})},initPropValues:function(){this.tryApplySuper("initPropValues"),this.setAsync(!0),this.reactWorkerMessageBind=this.reactWorkerMessage.bind(this),this.reactWorkerErrorBind=this.reactWorkerError.bind(this)},doFinalize:function(){this.finalizeWorker(),this.tryApplySuper("doFinalize")},_generateUid:function(){return Kekule.Calculator.Utils.generateUid()},isWorkerShared:function(){return!1},_incWorkerSharedCount:function(e){if(this.isWorkerShared()){var t=e[this.WORKER_SHARED_COUNT_FIELD]||0;++t,e[this.WORKER_SHARED_COUNT_FIELD]=t}},_decWorkerSharedCount:function(e){if(this.isWorkerShared()){var t=e[this.WORKER_SHARED_COUNT_FIELD]||0;t&&--t,e[this.WORKER_SHARED_COUNT_FIELD]=t}},_isWorkerInSharingState:function(e){return this.isWorkerShared()&&(e[this.WORKER_SHARED_COUNT_FIELD]||0)>0},getWorkerBasePath:function(){return Kekule.Calculator.getWorkerBasePath()},execute:function(e,t,r){if(this._doneCallback=e,this._errCallback=t,this._msgCallback=r,this.getAsync()&&this.isWorkerSupported()&&this.fetchWorker()){var n=this.getWorker();this._incWorkerSharedCount(n),this._installWorkerEventReceiver(n),this.workerStartCalc(n)}else{var o,i;try{i=this.executeSync(e)}catch(e){o=e}o?(Kekule.error(o),this.error(o)):i&&(o?this.error(o):this.done())}},executeSync:function(e){this._doneCallback=e;var t=this.doExecuteSync(e);return t&&this.done(),t},doExecuteSync:function(e){},error:function(e){if(!this._errCallback)throw e;this._errCallback(e)},done:function(){this._doneCallback&&this._doneCallback.apply(this,arguments),this.getWorker()&&this.workerJobDone()},halt:function(){var e=this.getWorker();e&&(e.terminate(),this.error(Kekule.$L("ErrorMsg.CALC_TERMINATED_BY_USER")))},isWorkerSupported:function(){return Kekule.BrowserFeature.workers},fetchWorker:function(){var e=this.getWorker();return e||(e=this.createWorker()),e},createWorker:function(){if(this.isWorkerSupported()){var e=this.getWorkerScriptFile();if(e){var t=new Worker(e);return this.setPropStoreFieldValue("worker",t),t}}},_installWorkerEventReceiver:function(e){e.addEventListener("message",this.reactWorkerMessageBind),e.addEventListener("error",this.reactWorkerErrorBind)},_uninstallWorkerEventReceiver:function(e){e.removeEventListener("message",this.reactWorkerMessageBind),e.removeEventListener("error",this.reactWorkerErrorBind)},getWorkerScriptFile:function(){return null},importWorkerScriptFile:function(e){this.postWorkerMessage({type:"importScript",url:e})},postWorkerMessage:function(e){var t=Object.extend({uid:this.getUid()},e),r=this.getWorker();r&&r.postMessage(t)},reactWorkerMessage:function(e){return e.data.uid===this.getUid()?(this._msgCallback&&this._msgCallback(e.data),this.doReactWorkerMessage(e.data,e)):null},doReactWorkerMessage:function(e,t){},reactWorkerError:function(e){this.error(e.message)},workerStartCalc:function(e){},workerJobDone:function(){var e=this.getWorker();e&&(this._uninstallWorkerEventReceiver(e),this._decWorkerSharedCount(e))},finalizeWorker:function(){var e=this.getWorker();e&&(this._isWorkerInSharingState(e)||e.terminate(),this.setPropStoreFieldValue("worker",null))}}),Kekule.Calculator.AbstractStructureGenerator=Class.create(Kekule.Calculator.Base,{CLASS_NAME:"Kekule.Calculator.AbstractStructureGenerator",initProperties:function(){this.defineProp("sourceMol",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("generatedMol",{dataType:"Kekule.StructureFragment",serializable:!1}),this.defineProp("childObjMap",{dataType:"Kekule.MapEx",serializable:!1}),this.defineProp("options",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("options");return e||(e={},this.setPropStoreFieldValue("options",e)),e}})},getGeneratorCoordMode:function(){return Kekule.CoordMode.COORD3D},done:function(){this._modifySourceAccordingToGeneratedMol(this.getSourceMol(),this.getGeneratedMol(),this.getChildObjMap()),this.tryApplySuper("done")},_modifySourceAccordingToGeneratedMol:function(e,t,r){var n=r;if(n){var o=this.getGeneratorCoordMode(),i=n.getKeys();e.beginUpdate();try{for(var a=0,s=i.length;a<s;++a)if(i[a]instanceof Kekule.ChemStructureNode){var l=i[a],u=n.get(l).getCoordOfMode(o);l.setCoordOfMode(u,o)}}finally{e.endUpdate()}}}}),Kekule.Calculator.ServiceManager={_serviceInfos:{},_getServiceClassInfos:function(t,r){var n=e._serviceInfos[t];return!n&&r&&(n=[],e._serviceInfos[t]=n),n},_findServiceClassInfoItemIndex:function(t,r,n){var o=e._getServiceClassInfos(t,!1);if(o)for(var i=o.length-1;i>=0;--i){var a=o[i];if(a&&!(r&&a.serviceClass!==r||n&&a.id!==n))return i}return-1},register:function(t,r,n,o){var i=e._getServiceClassInfos(t,!0),a=e._findServiceClassInfoItemIndex(t,r);a>=0&&i.splice(a,1),i.push({serviceClass:r,id:n,priorityLevel:o||0})},unregister:function(t,r){var n=e._findServiceClassInfoItemIndex(t,r);n>=0&&e._getServiceClassInfos(t,!1).splice(n,1)},_getRegisteredServiceInfo:function(t,r){var n=-1,o=null,i=e._getServiceClassInfos(t);if(i)for(var a=0,s=i.length;a<s;++a){var l=i[a];if(l){if(r&&l.id===r){o=l;break}(!o||l.priorityLevel>=n)&&(o=l,n=l.priorityLevel)}}return o},getServiceClass:function(t,r){var n=e._getRegisteredServiceInfo(t,r);return n&&n.serviceClass}};var e=Kekule.Calculator.ServiceManager;Kekule.Calculator.Services={GEN2D:"2D structure generator",GEN3D:"3D structure generator"},Kekule.Calculator.hasService=function(t){return!!e.getServiceClass(t)},Kekule.Calculator.generateStructure=function(t,r,n,o,i,a){var s=r||Kekule.Calculator.Services.GEN3D,l=e.getServiceClass(s);if(l){var u,c=new l;c.setChildObjMap&&(u=new Kekule.MapEx(!0),c.setChildObjMap(u));var d=function(e){i&&i(e)};try{c.setSourceMol(t),c.setOptions(n),n&&n.sync&&c.setAsync(!1),c.execute(function(){o&&o(c.getGeneratedMol(),u)},d,function(e){a&&a(e)})}catch(e){d(e)}return c}var h=Kekule.$L("ErrorMsg.CALC_SERVICE_UNAVAILABLE").format(s);return i&&i(h),null},Kekule.Calculator.generate3D=function(e,t,r,n,o){return Kekule.Calculator.generateStructure(e,Kekule.Calculator.Services.GEN3D,t,r,n,o)},Kekule.Calculator.generate2D=function(e,t,r,n,o){return Kekule.Calculator.generateStructure(e,Kekule.Calculator.Services.GEN2D,t,r,n,o)}}(),Kekule.chemicalElementsData=[{symbol:"H",casId:"1333-74-0",group:1,period:1,name:"Hydrogen",atomicNumber:1,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.37,radiiVdw:1.2,paulingE:2.2,naturalMass:1.00794075382579},{symbol:"He",casId:"7440-59-7",group:18,period:1,name:"Helium",atomicNumber:2,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.32,radiiVdw:1.4,naturalMass:4.002601902393709},{symbol:"Li",casId:"7439-93-2",group:1,period:2,name:"Lithium",atomicNumber:3,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:.32,radiiVdw:2.2,paulingE:.98,naturalMass:6.9400376247955},{symbol:"Be",casId:"7440-41-7",group:2,period:2,name:"Beryllium",atomicNumber:4,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:.9,radiiVdw:1.9,paulingE:1.57,naturalMass:9.0121822},{symbol:"B",casId:"7440-42-8",group:13,period:2,name:"Boron",atomicNumber:5,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:.82,radiiVdw:1.8,paulingE:2.04,naturalMass:10.811028088400002},{symbol:"C",casId:"7440-44-0",group:14,period:2,name:"Carbon",atomicNumber:6,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:.77,radiiVdw:1.7,paulingE:2.55,naturalMass:12.010735896788},{symbol:"N",casId:"7727-37-9",group:15,period:2,name:"Nitrogen",atomicNumber:7,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.77,radiiVdw:1.6,paulingE:3.04,naturalMass:14.006743088432001},{symbol:"O",casId:"7782-44-7",group:16,period:2,name:"Oxygen",atomicNumber:8,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:.73,radiiVdw:1.55,paulingE:3.44,naturalMass:15.999404927569397},{symbol:"F",casId:"7782-41-4",group:17,period:2,name:"Fluorine",atomicNumber:9,chemicalSerie:"Halogens",phase:"Gas",radiiCova:.73,radiiVdw:1.5,paulingE:3.98,naturalMass:18.99840322},{symbol:"Ne",casId:"7440-01-9",group:18,period:2,name:"Neon",atomicNumber:10,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.69,radiiVdw:1.54,naturalMass:20.180046383574997},{symbol:"Na",casId:"7440-23-5",group:1,period:3,name:"Sodium",atomicNumber:11,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.54,radiiVdw:2.4,paulingE:.93,naturalMass:22.98976928},{symbol:"Mg",casId:"7439-95-4",group:2,period:3,name:"Magnesium",atomicNumber:12,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.3,radiiVdw:2.2,paulingE:1.31,naturalMass:24.305051612423004},{symbol:"Al",casId:"7429-90-5",group:13,period:3,name:"Aluminum",atomicNumber:13,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.18,radiiVdw:2.1,paulingE:1.61,naturalMass:26.98153863},{symbol:"Si",casId:"7440-21-3",group:14,period:3,name:"Silicon",atomicNumber:14,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.11,radiiVdw:2.1,paulingE:1.9,naturalMass:28.085384754933294},{symbol:"P",casId:"7723-14-0",group:15,period:3,name:"Phosphorus",atomicNumber:15,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.06,radiiVdw:1.95,paulingE:2.19,naturalMass:30.97376163},{symbol:"S",casId:"7704-34-9",group:16,period:3,name:"Sulfur",atomicNumber:16,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.02,radiiVdw:1.8,paulingE:2.58,naturalMass:32.066084993038},{symbol:"Cl",casId:"7782-50-5",group:17,period:3,name:"Chlorine",atomicNumber:17,chemicalSerie:"Halogens",phase:"Gas",radiiCova:.99,radiiVdw:1.8,paulingE:3.16,naturalMass:35.452538168202},{symbol:"Ar",casId:"7440-37-1",group:18,period:3,name:"Argon",atomicNumber:18,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:.97,radiiVdw:1.8,naturalMass:39.947676710841314},{symbol:"K",casId:"7440-09-7",group:1,period:4,name:"Potassium",atomicNumber:19,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.96,radiiVdw:2.8,paulingE:.82,naturalMass:39.09830112446276},{symbol:"Ca",casId:"7440-70-2",group:2,period:4,name:"Calcium",atomicNumber:20,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.74,radiiVdw:2.4,paulingE:1,naturalMass:40.078022651988505},{symbol:"Sc",casId:"7440-20-2",group:3,period:4,name:"Scandium",atomicNumber:21,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.3,paulingE:1.36,naturalMass:44.9559119},{symbol:"Ti",casId:"7440-32-6",group:4,period:4,name:"Titanium",atomicNumber:22,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.15,paulingE:1.54,naturalMass:47.866749245159994},{symbol:"V",casId:"7440-62-2",group:5,period:4,name:"Vanadium",atomicNumber:23,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.63,naturalMass:50.94146749750001},{symbol:"Cr",casId:"7440-47-3",group:6,period:4,name:"Chromium",atomicNumber:24,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.27,radiiVdw:2.05,paulingE:1.66,naturalMass:51.996133070619},{symbol:"Mn",casId:"7439-96-5",group:7,period:4,name:"Manganese",atomicNumber:25,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.39,radiiVdw:2.05,paulingE:1.55,naturalMass:54.9380451},{symbol:"Fe",casId:"7439-89-6",group:8,period:4,name:"Iron",atomicNumber:26,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.83,naturalMass:55.845145623527},{symbol:"Co",casId:"7440-48-4",group:9,period:4,name:"Cobalt",atomicNumber:27,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2,paulingE:1.88,naturalMass:58.933195},{symbol:"Ni",casId:"7440-02-0",group:10,period:4,name:"Nickel",atomicNumber:28,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.21,radiiVdw:2,paulingE:1.91,naturalMass:58.693351562447994},{symbol:"Cu",casId:"7440-50-8",group:11,period:4,name:"Copper",atomicNumber:29,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2,paulingE:1.9,naturalMass:63.5456400936},{symbol:"Zn",casId:"7440-66-6",group:12,period:4,name:"Zinc",atomicNumber:30,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.1,paulingE:1.65,naturalMass:65.39556265691999},{symbol:"Ga",casId:"7440-55-3",group:13,period:4,name:"Gallium",atomicNumber:31,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.1,paulingE:1.81,naturalMass:69.723065622084},{symbol:"Ge",casId:"7440-56-4",group:14,period:4,name:"Germanium",atomicNumber:32,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.22,radiiVdw:2.1,paulingE:2.01,naturalMass:72.61275825015},{symbol:"As",casId:"7440-38-2",group:15,period:4,name:"Arsenic",atomicNumber:33,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.19,radiiVdw:2.05,paulingE:2.18,naturalMass:74.9215965},{symbol:"Se",casId:"7782-49-2",group:16,period:4,name:"Selenium",atomicNumber:34,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.16,radiiVdw:1.9,paulingE:2.55,naturalMass:78.9593882401},{symbol:"Br",casId:"7726-95-6",group:17,period:4,name:"Bromine",atomicNumber:35,chemicalSerie:"Halogens",phase:"Liquid",radiiCova:1.14,radiiVdw:1.9,paulingE:2.96,naturalMass:79.90352797085},{symbol:"Kr",casId:"7439-90-9",group:18,period:4,name:"Krypton",atomicNumber:36,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.1,radiiVdw:2.02,paulingE:3,naturalMass:83.79932499157},{symbol:"Rb",casId:"7440-17-7",group:1,period:5,name:"Rubidium",atomicNumber:37,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.11,radiiVdw:2.9,paulingE:.82,naturalMass:85.46766359685701},{symbol:"Sr",casId:"7440-24-6",group:2,period:5,name:"Strontium",atomicNumber:38,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.92,radiiVdw:2.55,paulingE:.95,naturalMass:87.61664410489999},{symbol:"Y",casId:"7440-65-5",group:3,period:5,name:"Yttrium",atomicNumber:39,chemicalSerie:"Transition metals",phase:"Solid",naturalMass:88.9058483},{symbol:"Zr",casId:"7440-67-7",group:4,period:5,name:"Zirconium",atomicNumber:40,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:91.22364760672002},{symbol:"Nb",casId:"7440-03-1",group:5,period:5,name:"Niobium",atomicNumber:41,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2.15,naturalMass:92.9063781},{symbol:"Mo",casId:"7439-98-7",group:6,period:5,name:"Molybdenum",atomicNumber:42,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.45,radiiVdw:2.1,naturalMass:95.93129211008},{symbol:"Tc",casId:"7440-26-8",group:7,period:5,name:"Technetium",atomicNumber:43,chemicalSerie:"Transition metals",phase:"Synthetic",radiiCova:1.56,radiiVdw:2.05},{symbol:"Ru",casId:"7440-18-8",group:8,period:5,name:"Ruthenium",atomicNumber:44,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2.05,naturalMass:101.06494544279},{symbol:"Rh",casId:"7440-16-6",group:9,period:5,name:"Rhodium",atomicNumber:45,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.35,radiiVdw:2,naturalMass:102.905504},{symbol:"Pd",casId:"7440-05-3",group:10,period:5,name:"Palladium",atomicNumber:46,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.05,naturalMass:106.41532878129999},{symbol:"Ag",casId:"7440-22-4",group:11,period:5,name:"Silver",atomicNumber:47,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.53,radiiVdw:2.1,naturalMass:107.86815084455},{symbol:"Cd",casId:"7440-43-9",group:12,period:5,name:"Cadmium",atomicNumber:48,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.2,naturalMass:112.41155220052002},{symbol:"In",casId:"7440-74-6",group:13,period:5,name:"Indium",atomicNumber:49,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.25,naturalMass:114.818085722},{symbol:"Sn",casId:"7440-31-5",group:14,period:5,name:"Tin",atomicNumber:50,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.41,radiiVdw:2.25,naturalMass:118.71010831537001},{symbol:"Sb",casId:"7440-36-0",group:15,period:5,name:"Antimony",atomicNumber:51,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:121.75978613257},{symbol:"Te",casId:"13494-80-9",group:16,period:5,name:"Tellurium",atomicNumber:52,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.35,radiiVdw:2.1,naturalMass:127.60312784714},{symbol:"I",casId:"7553-56-2",group:17,period:5,name:"Iodine",atomicNumber:53,chemicalSerie:"Halogens",phase:"Solid",radiiCova:1.33,radiiVdw:2.1,naturalMass:126.904473},{symbol:"Xe",casId:"7440-63-3",group:18,period:5,name:"Xenon",atomicNumber:54,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.3,radiiVdw:2.16,naturalMass:131.29248059059},{symbol:"Cs",casId:"7440-46-2",group:1,period:6,name:"Cesium",atomicNumber:55,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.25,radiiVdw:3,naturalMass:132.9054519},{symbol:"Ba",casId:"7440-39-3",group:2,period:6,name:"Barium",atomicNumber:56,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.98,radiiVdw:2.7,naturalMass:137.32689183471098},{symbol:"La",casId:"7439-91-0",group:3,period:6,name:"Lanthanum",atomicNumber:57,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.69,radiiVdw:2.5,naturalMass:138.90545398283},{symbol:"Ce",casId:"7440-45-1",period:6,name:"Cerium",atomicNumber:58,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.48,naturalMass:140.11572621392},{symbol:"Pr",casId:"7440-10-0",period:6,name:"Praseodymium",atomicNumber:59,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:140.9076528},{symbol:"Nd",casId:"7440-00-8",period:6,name:"Neodymium",atomicNumber:60,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:144.23613137220002},{symbol:"Pm",casId:"7440-12-2",period:6,name:"Promethium",atomicNumber:61,chemicalSerie:"Lanthanides",phase:"Synthetic",radiiVdw:2.43},{symbol:"Sm",casId:"7440-19-9",period:6,name:"Samarium",atomicNumber:62,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.43,naturalMass:150.36634852618},{symbol:"Eu",casId:"7440-53-1",period:6,name:"Europium",atomicNumber:63,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:2.4,naturalMass:151.96437047419},{symbol:"Gd",casId:"7440-54-2",period:6,name:"Gadolinium",atomicNumber:64,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.38,naturalMass:157.25212221544},{symbol:"Tb",casId:"7440-27-9",period:6,name:"Terbium",atomicNumber:65,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.37,naturalMass:158.9253468},{symbol:"Dy",casId:"7429-91-6",period:6,name:"Dysprosium",atomicNumber:66,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.35,naturalMass:162.49703350552},{symbol:"Ho",casId:"7440-60-0",period:6,name:"Holmium",atomicNumber:67,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.33,naturalMass:164.9303221},{symbol:"Er",casId:"7440-52-0",period:6,name:"Erbium",atomicNumber:68,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.32,naturalMass:167.25630413192},{symbol:"Tm",casId:"7440-30-4",period:6,name:"Thulium",atomicNumber:69,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.3,naturalMass:168.9342133},{symbol:"Yb",casId:"7440-64-4",period:6,name:"Ytterbium",atomicNumber:70,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.28,naturalMass:173.03769558789998},{symbol:"Lu",casId:"7439-94-3",period:6,name:"Lutetium",atomicNumber:71,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.6,radiiVdw:2.27,naturalMass:174.96672138555},{symbol:"Hf",casId:"7440-58-6",group:4,period:6,name:"Hafnium",atomicNumber:72,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.5,radiiVdw:2.25,naturalMass:178.48497214162},{symbol:"Ta",casId:"7440-25-7",group:5,period:6,name:"Tantalum",atomicNumber:73,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:180.94787573628},{symbol:"W",casId:"7440-33-7",group:6,period:6,name:"Tungsten",atomicNumber:74,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.46,radiiVdw:2.1,naturalMass:183.84177810241},{symbol:"Re",casId:"7440-15-5",group:7,period:6,name:"Rhenium",atomicNumber:75,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.59,radiiVdw:2.05,naturalMass:186.2067066106},{symbol:"Os",casId:"7440-04-2",group:8,period:6,name:"Osmium",atomicNumber:76,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2,naturalMass:190.22486304558998},{symbol:"Ir",casId:"7439-88-5",group:9,period:6,name:"Iridium",atomicNumber:77,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2,naturalMass:192.2160564148},{symbol:"Pt",casId:"7440-06-4",group:10,period:6,name:"Platinum",atomicNumber:78,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2.05,naturalMass:195.07780788031297},{symbol:"Au",casId:"7440-57-5",group:11,period:6,name:"Gold",atomicNumber:79,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.1,naturalMass:196.9665687},{symbol:"Hg",casId:"7439-97-6",group:12,period:6,name:"Mercury",atomicNumber:80,chemicalSerie:"Transition metals",phase:"Liquid",radiiCova:1.49,radiiVdw:2.05,naturalMass:200.59916661780002},{symbol:"Tl",casId:"7440-28-0",group:13,period:6,name:"Thallium",atomicNumber:81,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.49,radiiVdw:2.2,naturalMass:204.38333242650796},{symbol:"Pb",casId:"7439-92-1",group:14,period:6,name:"Lead",atomicNumber:82,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:207.21690766300003},{symbol:"Bi",casId:"7440-69-9",group:15,period:6,name:"Bismuth",atomicNumber:83,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.47,radiiVdw:2.3,naturalMass:208.9803987},{symbol:"Po",casId:"7440-08-6",group:16,period:6,name:"Polonium",atomicNumber:84,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.46,radiiVdw:2},{symbol:"At",casId:"7440-08-6",group:17,period:6,name:"Astatine",atomicNumber:85,chemicalSerie:"Halogens",phase:"Solid",radiiVdw:2},{symbol:"Rn",casId:"10043-92-2",group:18,period:6,name:"Radon",atomicNumber:86,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.45,radiiVdw:2},{symbol:"Fr",casId:"7440-73-5",group:1,period:7,name:"Francium",atomicNumber:87,chemicalSerie:"Alkali Metals",phase:"Solid",radiiVdw:2},{symbol:"Ra",casId:"7440-14-4",group:2,period:7,name:"Radium",atomicNumber:88,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiVdw:2},{symbol:"Ac",casId:"7440-34-8",group:3,period:7,name:"Actinium",atomicNumber:89,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Th",casId:"7440-29-1",period:7,name:"Thorium",atomicNumber:90,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:232.0380553},{symbol:"Pa",casId:"7440-13-3",period:7,name:"Protactinium",atomicNumber:91,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2,naturalMass:231.035884},{symbol:"U",casId:"7440-61-1",period:7,name:"Uranium",atomicNumber:92,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:238.0289182792545},{symbol:"Np",casId:"7439-99-8",period:7,name:"Neptunium",atomicNumber:93,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Pu",casId:"7440-07-5",period:7,name:"Plutonium",atomicNumber:94,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Am",casId:"7440-35-9",period:7,name:"Americium",atomicNumber:95,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cm",casId:"7440-51-9",period:7,name:"Curium",atomicNumber:96,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Bk",casId:"7440-40-6",period:7,name:"Berkelium",atomicNumber:97,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cf",casId:"7440-71-3",period:7,name:"Californium",atomicNumber:98,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Es",casId:"7429-92-7",period:7,name:"Einsteinium",atomicNumber:99,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Fm",casId:"7440-72-4",period:7,name:"Fermium",atomicNumber:100,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Md",casId:"7440-11-1",period:7,name:"Mendelevium",atomicNumber:101,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"No",casId:"10028-14-5",period:7,name:"Nobelium",atomicNumber:102,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Lr",casId:"22537-19-5",period:7,name:"Lawrencium",atomicNumber:103,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Rf",casId:"53850-36-5",group:4,period:7,name:"Rutherfordium",atomicNumber:104,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Db",casId:"53850-35-4",group:5,period:7,name:"Dubnium",atomicNumber:105,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Sg",casId:"54038-81-2",group:6,period:7,name:"Seaborgium",atomicNumber:106,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Bh",casId:"54037-14-8",group:7,period:7,name:"Bohrium",atomicNumber:107,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Hs",casId:"54037-57-9",group:8,period:7,name:"Hassium",atomicNumber:108,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Mt",casId:"54038-01-6",group:9,period:7,name:"Meitnerium",atomicNumber:109,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Ds",casId:"54083-77-1",group:10,period:7,name:"Darmstadtium",atomicNumber:110,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Rg",casId:"54386-24-2",group:11,period:7,name:"Roentgenium",atomicNumber:111,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Uub",group:12,period:7,name:"Ununbium",atomicNumber:112,chemicalSerie:"Transition metals",phase:"Synthetic"}],Kekule.isotopesData=[{elementSymbol:"H",atomicNumber:1,isotopes:[{id:"H1",massNumber:1,relativeAbundance:.999885,atomicNumber:1,exactMass:1.007825032,spin:"1/2+",magneticMoment:"+2.792846",halfLife:-1},{id:"H2",massNumber:2,relativeAbundance:115e-6,atomicNumber:1,exactMass:2.014101778,spin:"1+",magneticMoment:"+0.857438",halfLife:-1},{id:"H3",massNumber:3,exactMass:3.016049278,atomicNumber:1,spin:"1/2+",magneticMoment:"+2.978960",halfLife:388839e3,betaminusDecay:"0.01861",betaminusDecayLikeliness:"100.0"},{id:"H4",massNumber:4,exactMass:4.02781,atomicNumber:1},{id:"H5",massNumber:5,exactMass:5.03531,atomicNumber:1},{id:"H6",massNumber:6,exactMass:6.04494,atomicNumber:1},{id:"H7",massNumber:7,exactMass:7.05275,atomicNumber:1}]},{elementSymbol:"He",atomicNumber:2,isotopes:[{id:"He3",massNumber:3,relativeAbundance:137e-8,atomicNumber:2,exactMass:3.016029319,spin:"1/2+",magneticMoment:"-2.127624",halfLife:-1},{id:"He4",massNumber:4,relativeAbundance:.99999863,atomicNumber:2,exactMass:4.002603254,spin:"0+",halfLife:-1},{id:"He5",massNumber:5,exactMass:5.01222,atomicNumber:2},{id:"He6",massNumber:6,exactMass:6.0188891,atomicNumber:2,halfLife:.8067},{id:"He7",massNumber:7,exactMass:7.028021,atomicNumber:2},{id:"He8",massNumber:8,exactMass:8.033922,atomicNumber:2,halfLife:.119},{id:"He9",massNumber:9,exactMass:9.04395,atomicNumber:2},{id:"He10",massNumber:10,exactMass:10.0524,atomicNumber:2}]},null,null,{elementSymbol:"B",atomicNumber:5,isotopes:[{id:"B6",massNumber:6,exactMass:6.04681,atomicNumber:5},{id:"B7",massNumber:7,exactMass:7.02992,atomicNumber:5},{id:"B8",massNumber:8,exactMass:8.0246072,atomicNumber:5,halfLife:.77},{id:"B9",massNumber:9,exactMass:9.0133288,atomicNumber:5},{id:"B10",massNumber:10,relativeAbundance:.19899999999999998,atomicNumber:5,exactMass:10.012937,spin:"3+",magneticMoment:"+1.80065",halfLife:-1},{id:"B11",massNumber:11,relativeAbundance:.8009999999999999,atomicNumber:5,exactMass:11.0093054,spin:"3/2-",magneticMoment:"+2.688637",halfLife:-1},{id:"B12",massNumber:12,exactMass:12.0143521,atomicNumber:5,halfLife:.0202},{id:"B13",massNumber:13,exactMass:13.0177802,atomicNumber:5,halfLife:.01736},{id:"B14",massNumber:14,exactMass:14.025404,atomicNumber:5,halfLife:.0138},{id:"B15",massNumber:15,exactMass:15.031103,atomicNumber:5,halfLife:.0105},{id:"B16",massNumber:16,exactMass:16.03981,atomicNumber:5},{id:"B17",massNumber:17,exactMass:17.04699,atomicNumber:5,halfLife:.00508},{id:"B18",massNumber:18,exactMass:18.05617,atomicNumber:5},{id:"B19",massNumber:19,exactMass:19.06373,atomicNumber:5}]},{elementSymbol:"C",atomicNumber:6,isotopes:[{id:"C8",massNumber:8,exactMass:8.037675,atomicNumber:6},{id:"C9",massNumber:9,exactMass:9.0310367,atomicNumber:6,halfLife:.126},{id:"C10",massNumber:10,exactMass:10.0168532,atomicNumber:6,halfLife:19.255},{id:"C11",massNumber:11,exactMass:11.0114336,atomicNumber:6,spin:"3/2-",halfLife:1223.4,betaplusDecay:"0.96",betaplusDecayLikeliness:"100.0"},{id:"C12",massNumber:12,relativeAbundance:.9893000000000001,atomicNumber:6,exactMass:12,spin:"0+",halfLife:-1},{id:"C13",massNumber:13,relativeAbundance:.010700000000000001,atomicNumber:6,exactMass:13.00335484,spin:"1/2-",magneticMoment:"+0.702411",halfLife:-1},{id:"C14",massNumber:14,exactMass:14.00324199,atomicNumber:6,halfLife:180701e6,betaminusDecay:"0.15648",betaminusDecayLikeliness:"100.0"},{id:"C15",massNumber:15,exactMass:15.0105993,atomicNumber:6,halfLife:2.449},{id:"C16",massNumber:16,exactMass:16.014701,atomicNumber:6,halfLife:.747},{id:"C17",massNumber:17,exactMass:17.022586,atomicNumber:6,halfLife:.193},{id:"C18",massNumber:18,exactMass:18.02676,atomicNumber:6,halfLife:.095},{id:"C19",massNumber:19,exactMass:19.03481,atomicNumber:6,halfLife:.046},{id:"C20",massNumber:20,exactMass:20.04032,atomicNumber:6,halfLife:.014},{id:"C21",massNumber:21,exactMass:21.04934,atomicNumber:6},{id:"C22",massNumber:22,exactMass:22.0572,atomicNumber:6}]},{elementSymbol:"N",atomicNumber:7,isotopes:[{id:"N10",massNumber:10,exactMass:10.04165,atomicNumber:7},{id:"N11",massNumber:11,exactMass:11.02609,atomicNumber:7},{id:"N12",massNumber:12,exactMass:12.0186132,atomicNumber:7,halfLife:.011},{id:"N13",massNumber:13,exactMass:13.00573861,atomicNumber:7,halfLife:597.9},{id:"N14",massNumber:14,relativeAbundance:.9963200000000001,atomicNumber:7,exactMass:14.003074,spin:"1+",magneticMoment:"+0.403761",halfLife:-1},{id:"N15",massNumber:15,relativeAbundance:.00368,atomicNumber:7,exactMass:15.0001089,spin:"1/2-",magneticMoment:"-0.283189",halfLife:-1},{id:"N16",massNumber:16,exactMass:16.0061017,atomicNumber:7,halfLife:7.13},{id:"N17",massNumber:17,exactMass:17.00845,atomicNumber:7,halfLife:4.173},{id:"N18",massNumber:18,exactMass:18.014079,atomicNumber:7,halfLife:.624},{id:"N19",massNumber:19,exactMass:19.017029,atomicNumber:7,halfLife:.304},{id:"N20",massNumber:20,exactMass:20.02337,atomicNumber:7,halfLife:.1},{id:"N21",massNumber:21,exactMass:21.02711,atomicNumber:7,halfLife:.085},{id:"N22",massNumber:22,exactMass:22.03439,atomicNumber:7,halfLife:.024},{id:"N23",massNumber:23,exactMass:23.04122,atomicNumber:7},{id:"N24",massNumber:24,exactMass:24.05104,atomicNumber:7},{id:"N25",massNumber:25,exactMass:25.06066,atomicNumber:7}]},{elementSymbol:"O",atomicNumber:8,isotopes:[{id:"O12",massNumber:12,exactMass:12.034405,atomicNumber:8},{id:"O13",massNumber:13,exactMass:13.024812,atomicNumber:8,halfLife:.00858},{id:"O14",massNumber:14,exactMass:14.00859625,atomicNumber:8,halfLife:70.606},{id:"O15",massNumber:15,exactMass:15.0030656,atomicNumber:8,halfLife:122.24},{id:"O16",massNumber:16,relativeAbundance:.9975700000000001,atomicNumber:8,exactMass:15.99491462,spin:"0+",halfLife:-1},{id:"O17",massNumber:17,relativeAbundance:.00037999999999999997,atomicNumber:8,exactMass:16.9991317,spin:"5/2+",magneticMoment:"-1.89379",halfLife:-1},{id:"O18",massNumber:18,relativeAbundance:.0020499999999999997,atomicNumber:8,exactMass:17.999161,spin:"0+",halfLife:-1},{id:"O19",massNumber:19,exactMass:19.00358,atomicNumber:8,halfLife:26.91},{id:"O20",massNumber:20,exactMass:20.0040767,atomicNumber:8,halfLife:13.51},{id:"O21",massNumber:21,exactMass:21.008656,atomicNumber:8,halfLife:3.42},{id:"O22",massNumber:22,exactMass:22.00997,atomicNumber:8,halfLife:2.25},{id:"O23",massNumber:23,exactMass:23.01569,atomicNumber:8,halfLife:.082},{id:"O24",massNumber:24,exactMass:24.02047,atomicNumber:8,halfLife:.061},{id:"O25",massNumber:25,exactMass:25.02946,atomicNumber:8},{id:"O26",massNumber:26,exactMass:26.03834,atomicNumber:8},{id:"O27",massNumber:27,exactMass:27.04826,atomicNumber:8},{id:"O28",massNumber:28,exactMass:28.05781,atomicNumber:8}]},{elementSymbol:"F",atomicNumber:9,isotopes:[{id:"F14",massNumber:14,exactMass:14.03506,atomicNumber:9},{id:"F15",massNumber:15,exactMass:15.01801,atomicNumber:9,halfLife:-1},{id:"F16",massNumber:16,exactMass:16.011466,atomicNumber:9},{id:"F17",massNumber:17,exactMass:17.00209524,atomicNumber:9,halfLife:64.49},{id:"F18",massNumber:18,exactMass:18.000938,atomicNumber:9,spin:"1+",halfLife:6586.2,betaplusDecay:"0.64",betaplusDecayLikeliness:"97.0",ecDecay:"",ecDecayLikeliness:"3.0"},{id:"F19",massNumber:19,relativeAbundance:1,atomicNumber:9,exactMass:18.99840322,spin:"1/2+",magneticMoment:"+2.628866",halfLife:-1},{id:"F20",massNumber:20,exactMass:19.99998132,atomicNumber:9,halfLife:11},{id:"F21",massNumber:21,exactMass:20.999949,atomicNumber:9,halfLife:4.158},{id:"F22",massNumber:22,exactMass:22.002999,atomicNumber:9,halfLife:4.23},{id:"F23",massNumber:23,exactMass:23.00357,atomicNumber:9,halfLife:2.23},{id:"F24",massNumber:24,exactMass:24.00812,atomicNumber:9,halfLife:.34},{id:"F25",massNumber:25,exactMass:25.0121,atomicNumber:9,halfLife:.059},{id:"F26",massNumber:26,exactMass:26.01962,atomicNumber:9},{id:"F27",massNumber:27,exactMass:27.02676,atomicNumber:9},{id:"F28",massNumber:28,exactMass:28.03567,atomicNumber:9},{id:"F29",massNumber:29,exactMass:29.04326,atomicNumber:9},{id:"F30",massNumber:30,exactMass:30.0525,atomicNumber:9},{id:"F31",massNumber:31,exactMass:31.06043,atomicNumber:9}]},null,null,null,null,{elementSymbol:"Si",atomicNumber:14,isotopes:[{id:"Si22",massNumber:22,exactMass:22.03453,atomicNumber:14,halfLife:.006},{id:"Si23",massNumber:23,exactMass:23.02552,atomicNumber:14},{id:"Si24",massNumber:24,exactMass:24.011546,atomicNumber:14,halfLife:.102},{id:"Si25",massNumber:25,exactMass:25.004106,atomicNumber:14,halfLife:.22},{id:"Si26",massNumber:26,exactMass:25.99233,atomicNumber:14,halfLife:2.234},{id:"Si27",massNumber:27,exactMass:26.98670491,atomicNumber:14,halfLife:4.16},{id:"Si28",massNumber:28,relativeAbundance:.9222969999999999,atomicNumber:14,exactMass:27.97692653,spin:"0+",halfLife:-1},{id:"Si29",massNumber:29,relativeAbundance:.046832000000000006,atomicNumber:14,exactMass:28.9764947,spin:"1/2+",magneticMoment:"-0.55529",halfLife:-1},{id:"Si30",massNumber:30,relativeAbundance:.030872,atomicNumber:14,exactMass:29.97377017,spin:"0+",halfLife:-1},{id:"Si31",massNumber:31,exactMass:30.97536323,atomicNumber:14,halfLife:9438},{id:"Si32",massNumber:32,exactMass:31.97414808,atomicNumber:14,halfLife:47304e5},{id:"Si33",massNumber:33,exactMass:32.978,atomicNumber:14,halfLife:6.18},{id:"Si34",massNumber:34,exactMass:33.978576,atomicNumber:14,halfLife:2.77},{id:"Si35",massNumber:35,exactMass:34.98458,atomicNumber:14,halfLife:.78},{id:"Si36",massNumber:36,exactMass:35.9866,atomicNumber:14,halfLife:.45},{id:"Si37",massNumber:37,exactMass:36.99294,atomicNumber:14},{id:"Si38",massNumber:38,exactMass:37.99563,atomicNumber:14},{id:"Si39",massNumber:39,exactMass:39.00207,atomicNumber:14},{id:"Si40",massNumber:40,exactMass:40.00587,atomicNumber:14},{id:"Si41",massNumber:41,exactMass:41.01456,atomicNumber:14},{id:"Si42",massNumber:42,exactMass:42.01979,atomicNumber:14},{id:"Si43",massNumber:43,exactMass:43.02866,atomicNumber:14},{id:"Si44",massNumber:44,exactMass:44.03526,atomicNumber:14}]},{elementSymbol:"P",atomicNumber:15,isotopes:[{id:"P24",massNumber:24,exactMass:24.03435,atomicNumber:15},{id:"P25",massNumber:25,exactMass:25.02026,atomicNumber:15},{id:"P26",massNumber:26,exactMass:26.01178,atomicNumber:15,halfLife:.02},{id:"P27",massNumber:27,exactMass:26.99923,atomicNumber:15,halfLife:.26},{id:"P28",massNumber:28,exactMass:27.992315,atomicNumber:15,halfLife:.2703},{id:"P29",massNumber:29,exactMass:28.9818006,atomicNumber:15,halfLife:4.14},{id:"P30",massNumber:30,exactMass:29.9783138,atomicNumber:15,halfLife:149.88},{id:"P31",massNumber:31,relativeAbundance:1,atomicNumber:15,exactMass:30.97376163,spin:"1/2+",magneticMoment:"+1.13160",halfLife:-1},{id:"P32",massNumber:32,exactMass:31.97390727,atomicNumber:15,spin:"1+",magneticMoment:"-0.2524",halfLife:1232240,betaminusDecay:"1.710",betaminusDecayLikeliness:"100.0"},{id:"P33",massNumber:33,exactMass:32.9717255,atomicNumber:15,halfLife:2189380},{id:"P34",massNumber:34,exactMass:33.973636,atomicNumber:15,halfLife:12.43},{id:"P35",massNumber:35,exactMass:34.9733141,atomicNumber:15,halfLife:47.3},{id:"P36",massNumber:36,exactMass:35.97826,atomicNumber:15,halfLife:5.6},{id:"P37",massNumber:37,exactMass:36.97961,atomicNumber:15,halfLife:2.31},{id:"P38",massNumber:38,exactMass:37.98416,atomicNumber:15,halfLife:.64},{id:"P39",massNumber:39,exactMass:38.98618,atomicNumber:15,halfLife:.16},{id:"P40",massNumber:40,exactMass:39.9913,atomicNumber:15,halfLife:.26},{id:"P41",massNumber:41,exactMass:40.99434,atomicNumber:15,halfLife:.12},{id:"P42",massNumber:42,exactMass:42.00101,atomicNumber:15,halfLife:.11},{id:"P43",massNumber:43,exactMass:43.00619,atomicNumber:15,halfLife:.033},{id:"P44",massNumber:44,exactMass:44.01299,atomicNumber:15},{id:"P45",massNumber:45,exactMass:45.01922,atomicNumber:15},{id:"P46",massNumber:46,exactMass:46.02738,atomicNumber:15}]},{elementSymbol:"S",atomicNumber:16,isotopes:[{id:"S26",massNumber:26,exactMass:26.02788,atomicNumber:16},{id:"S27",massNumber:27,exactMass:27.01883,atomicNumber:16,halfLife:.021},{id:"S28",massNumber:28,exactMass:28.00437,atomicNumber:16,halfLife:.125},{id:"S29",massNumber:29,exactMass:28.99661,atomicNumber:16,halfLife:.187},{id:"S30",massNumber:30,exactMass:29.984903,atomicNumber:16,halfLife:1.178},{id:"S31",massNumber:31,exactMass:30.9795547,atomicNumber:16,halfLife:2.572},{id:"S32",massNumber:32,relativeAbundance:.9493,atomicNumber:16,exactMass:31.972071,spin:"0+",halfLife:-1},{id:"S33",massNumber:33,relativeAbundance:.0076,atomicNumber:16,exactMass:32.97145876,spin:"3/2+",magneticMoment:"+0.643821",halfLife:-1},{id:"S34",massNumber:34,relativeAbundance:.0429,atomicNumber:16,exactMass:33.9678669,spin:"0+",halfLife:-1},{id:"S35",massNumber:35,exactMass:34.96903216,atomicNumber:16,spin:"3/2+",magneticMoment:"+1",halfLife:7544450,betaminusDecay:"0.1674",betaminusDecayLikeliness:"100.0"},{id:"S36",massNumber:36,relativeAbundance:2e-4,atomicNumber:16,exactMass:35.96708076,spin:"0+",halfLife:-1},{id:"S37",massNumber:37,exactMass:36.97112557,atomicNumber:16,halfLife:303},{id:"S38",massNumber:38,exactMass:37.971163,atomicNumber:16,halfLife:10218},{id:"S39",massNumber:39,exactMass:38.97513,atomicNumber:16,halfLife:11.5},{id:"S40",massNumber:40,exactMass:39.97545,atomicNumber:16,halfLife:8.8},{id:"S41",massNumber:41,exactMass:40.97958,atomicNumber:16},{id:"S42",massNumber:42,exactMass:41.98102,atomicNumber:16,halfLife:.56},{id:"S43",massNumber:43,exactMass:42.98715,atomicNumber:16,halfLife:.22},{id:"S44",massNumber:44,exactMass:43.99021,atomicNumber:16,halfLife:.123},{id:"S45",massNumber:45,exactMass:44.99651,atomicNumber:16,halfLife:.082},{id:"S46",massNumber:46,exactMass:46.00075,atomicNumber:16},{id:"S47",massNumber:47,exactMass:47.00859,atomicNumber:16},{id:"S48",massNumber:48,exactMass:48.01417,atomicNumber:16},{id:"S49",massNumber:49,exactMass:49.02362,atomicNumber:16}]},{elementSymbol:"Cl",atomicNumber:17,isotopes:[{id:"Cl28",massNumber:28,exactMass:28.02851,atomicNumber:17},{id:"Cl29",massNumber:29,exactMass:29.01411,atomicNumber:17},{id:"Cl30",massNumber:30,exactMass:30.00477,atomicNumber:17},{id:"Cl31",massNumber:31,exactMass:30.99241,atomicNumber:17,halfLife:.15},{id:"Cl32",massNumber:32,exactMass:31.98569,atomicNumber:17,halfLife:.298},{id:"Cl33",massNumber:33,exactMass:32.9774519,atomicNumber:17,halfLife:2.511},{id:"Cl34",massNumber:34,exactMass:33.97376282,atomicNumber:17,halfLife:1.5264},{id:"Cl35",massNumber:35,relativeAbundance:.7578,atomicNumber:17,exactMass:34.96885268,spin:"3/2+",magneticMoment:"+0.82187",halfLife:-1},{id:"Cl36",massNumber:36,exactMass:35.96830698,atomicNumber:17},{id:"Cl37",massNumber:37,relativeAbundance:.2422,atomicNumber:17,exactMass:36.96590259,spin:"3/2+",magneticMoment:"+0.68412",halfLife:-1},{id:"Cl38",massNumber:38,exactMass:37.96801043,atomicNumber:17,halfLife:2234.4},{id:"Cl39",massNumber:39,exactMass:38.9680082,atomicNumber:17,halfLife:3336},{id:"Cl40",massNumber:40,exactMass:39.97042,atomicNumber:17,halfLife:81},{id:"Cl41",massNumber:41,exactMass:40.97068,atomicNumber:17,halfLife:38.4},{id:"Cl42",massNumber:42,exactMass:41.97325,atomicNumber:17,halfLife:6.8},{id:"Cl43",massNumber:43,exactMass:42.97405,atomicNumber:17,halfLife:3.3},{id:"Cl44",massNumber:44,exactMass:43.97828,atomicNumber:17,halfLife:.434},{id:"Cl45",massNumber:45,exactMass:44.98029,atomicNumber:17,halfLife:.4},{id:"Cl46",massNumber:46,exactMass:45.98421,atomicNumber:17,halfLife:.223},{id:"Cl47",massNumber:47,exactMass:46.98871,atomicNumber:17},{id:"Cl48",massNumber:48,exactMass:47.99495,atomicNumber:17},{id:"Cl49",massNumber:49,exactMass:49.00032,atomicNumber:17},{id:"Cl50",massNumber:50,exactMass:50.00784,atomicNumber:17},{id:"Cl51",massNumber:51,exactMass:51.01449,atomicNumber:17}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"Br",atomicNumber:35,isotopes:[{id:"Br67",massNumber:67,exactMass:66.96479,atomicNumber:35},{id:"Br68",massNumber:68,exactMass:67.95852,atomicNumber:35},{id:"Br69",massNumber:69,exactMass:68.95011,atomicNumber:35},{id:"Br70",massNumber:70,exactMass:69.94479,atomicNumber:35,halfLife:.0791},{id:"Br71",massNumber:71,exactMass:70.93874,atomicNumber:35,halfLife:21.4},{id:"Br72",massNumber:72,exactMass:71.93664,atomicNumber:35,halfLife:78.6},{id:"Br73",massNumber:73,exactMass:72.93169,atomicNumber:35,halfLife:204},{id:"Br74",massNumber:74,exactMass:73.929891,atomicNumber:35,halfLife:1524},{id:"Br75",massNumber:75,exactMass:74.925776,atomicNumber:35,halfLife:5802},{id:"Br76",massNumber:76,exactMass:75.924541,atomicNumber:35,halfLife:58320},{id:"Br77",massNumber:77,exactMass:76.921379,atomicNumber:35,halfLife:205330},{id:"Br78",massNumber:78,exactMass:77.921146,atomicNumber:35,halfLife:387.6},{id:"Br79",massNumber:79,relativeAbundance:.5069,atomicNumber:35,exactMass:78.9183371,spin:"3/2-",magneticMoment:"+2.1064",halfLife:-1},{id:"Br80",massNumber:80,exactMass:79.9185293,atomicNumber:35,halfLife:1060.8},{id:"Br81",massNumber:81,relativeAbundance:.49310000000000004,atomicNumber:35,exactMass:80.9162906,spin:"3/2-",magneticMoment:"+2.2706",halfLife:-1},{id:"Br82",massNumber:82,exactMass:81.9168041,atomicNumber:35,halfLife:127080},{id:"Br83",massNumber:83,exactMass:82.91518,atomicNumber:35,halfLife:8640},{id:"Br84",massNumber:84,exactMass:83.916479,atomicNumber:35,halfLife:1908},{id:"Br85",massNumber:85,exactMass:84.915608,atomicNumber:35,halfLife:174},{id:"Br86",massNumber:86,exactMass:85.918798,atomicNumber:35,halfLife:55.1},{id:"Br87",massNumber:87,exactMass:86.920711,atomicNumber:35,halfLife:55.6},{id:"Br88",massNumber:88,exactMass:87.92407,atomicNumber:35,halfLife:16.34},{id:"Br89",massNumber:89,exactMass:88.92639,atomicNumber:35,halfLife:4.348},{id:"Br90",massNumber:90,exactMass:89.93063,atomicNumber:35,halfLife:1.91},{id:"Br91",massNumber:91,exactMass:90.93397,atomicNumber:35,halfLife:.541},{id:"Br92",massNumber:92,exactMass:91.93926,atomicNumber:35,halfLife:.343},{id:"Br93",massNumber:93,exactMass:92.94305,atomicNumber:35,halfLife:.102},{id:"Br94",massNumber:94,exactMass:93.94868,atomicNumber:35,halfLife:.07},{id:"Br95",massNumber:95,exactMass:94.95287,atomicNumber:35},{id:"Br96",massNumber:96,exactMass:95.95853,atomicNumber:35},{id:"Br97",massNumber:97,exactMass:96.9628,atomicNumber:35}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,isotopes:[{id:"I108",massNumber:108,exactMass:107.94348,atomicNumber:53,halfLife:.036},{id:"I109",massNumber:109,exactMass:108.93815,atomicNumber:53,halfLife:1e-4},{id:"I110",massNumber:110,exactMass:109.93524,atomicNumber:53,halfLife:.65},{id:"I111",massNumber:111,exactMass:110.93028,atomicNumber:53,halfLife:2.5},{id:"I112",massNumber:112,exactMass:111.92797,atomicNumber:53,halfLife:3.42},{id:"I113",massNumber:113,exactMass:112.92364,atomicNumber:53,halfLife:6.6},{id:"I114",massNumber:114,exactMass:113.92185,atomicNumber:53,halfLife:2.1},{id:"I115",massNumber:115,exactMass:114.91805,atomicNumber:53,halfLife:78},{id:"I116",massNumber:116,exactMass:115.91681,atomicNumber:53,halfLife:2.91},{id:"I117",massNumber:117,exactMass:116.91365,atomicNumber:53,halfLife:133.2},{id:"I118",massNumber:118,exactMass:117.913074,atomicNumber:53,halfLife:822},{id:"I119",massNumber:119,exactMass:118.91007,atomicNumber:53,halfLife:1146},{id:"I120",massNumber:120,exactMass:119.910048,atomicNumber:53,halfLife:4860},{id:"I121",massNumber:121,exactMass:120.907367,atomicNumber:53,halfLife:7632},{id:"I122",massNumber:122,exactMass:121.907589,atomicNumber:53,halfLife:217.8},{id:"I123",massNumber:123,exactMass:122.905589,atomicNumber:53,halfLife:47772},{id:"I124",massNumber:124,exactMass:123.9062099,atomicNumber:53,halfLife:360806},{id:"I125",massNumber:125,exactMass:124.9046302,atomicNumber:53,spin:"5/2+",halfLife:5132850},{id:"I126",massNumber:126,exactMass:125.905624,atomicNumber:53,spin:"2-",halfLife:1132700},{id:"I127",massNumber:127,relativeAbundance:1,atomicNumber:53,exactMass:126.904473,spin:"5/2+",magneticMoment:"+2.808",halfLife:-1},{id:"I128",massNumber:128,exactMass:127.905809,atomicNumber:53,spin:"1+",halfLife:1499.4},{id:"I129",massNumber:129,exactMass:128.904988,atomicNumber:53,magneticMoment:"+2.617",halfLife:157e5,betaminusDecay:"0.193",betaminusDecayLikeliness:"100.0"},{id:"I130",massNumber:130,exactMass:129.906674,atomicNumber:53,halfLife:44496},{id:"I131",massNumber:131,exactMass:130.9061246,atomicNumber:53,halfLife:692988},{id:"I132",massNumber:132,exactMass:131.907997,atomicNumber:53,halfLife:8262},{id:"I133",massNumber:133,exactMass:132.907797,atomicNumber:53,halfLife:74880},{id:"I134",massNumber:134,exactMass:133.909744,atomicNumber:53,halfLife:3150},{id:"I135",massNumber:135,exactMass:134.910048,atomicNumber:53,halfLife:23652},{id:"I136",massNumber:136,exactMass:135.91465,atomicNumber:53,halfLife:83.4},{id:"I137",massNumber:137,exactMass:136.917871,atomicNumber:53,halfLife:24.5},{id:"I138",massNumber:138,exactMass:137.92235,atomicNumber:53,halfLife:6.49},{id:"I139",massNumber:139,exactMass:138.9261,atomicNumber:53,halfLife:2.29},{id:"I140",massNumber:140,exactMass:139.931,atomicNumber:53,halfLife:.86},{id:"I141",massNumber:141,exactMass:140.93503,atomicNumber:53,halfLife:.43},{id:"I142",massNumber:142,exactMass:141.94018,atomicNumber:53},{id:"I143",massNumber:143,exactMass:142.94456,atomicNumber:53},{id:"I144",massNumber:144,exactMass:143.94999,atomicNumber:53}]}],Kekule.structGenAtomTypesData=[{elementSymbol:"H",atomicNumber:1,atomTypes:[{id:"H1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Li",atomicNumber:3,atomTypes:[{id:"Li1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"B",atomicNumber:5,atomTypes:[{id:"B3",maxBondOrder:2,bondOrderSum:3}]},{elementSymbol:"C",atomicNumber:6,atomTypes:[{id:"C4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"N",atomicNumber:7,atomTypes:[{id:"N3",maxBondOrder:3,bondOrderSum:3},{id:"N5",maxBondOrder:2,bondOrderSum:5}]},{elementSymbol:"O",atomicNumber:8,atomTypes:[{id:"O2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"F",atomicNumber:9,atomTypes:[{id:"F1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Na",atomicNumber:11,atomTypes:[{id:"Na1",maxBondOrder:1,bondOrderSum:1}]},null,null,{elementSymbol:"Si",atomicNumber:14,atomTypes:[{id:"Si4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"P",atomicNumber:15,atomTypes:[{id:"P3",maxBondOrder:3,bondOrderSum:3},{id:"P4",maxBondOrder:3,bondOrderSum:5}]},{elementSymbol:"S",atomicNumber:16,atomTypes:[{id:"S2",maxBondOrder:2,bondOrderSum:2},{id:"S3",maxBondOrder:2,bondOrderSum:4},{id:"S4",maxBondOrder:2,bondOrderSum:6}]},{elementSymbol:"Cl",atomicNumber:17,atomTypes:[{id:"Cl1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"As",atomicNumber:33,atomTypes:[{id:"As3",maxBondOrder:1,bondOrderSum:3}]},{elementSymbol:"Se",atomicNumber:34,atomTypes:[{id:"Se2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"Br",atomicNumber:35,atomTypes:[{id:"Br1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,atomTypes:[{id:"I1",maxBondOrder:1,bondOrderSum:1}]}],Kekule.ChemicalElementsDataUtil={_getElementInfoBySymbol:function(e){for(var t,r=0,n=Kekule.chemicalElementsData.length;r<n;++r)if((t=Kekule.chemicalElementsData[r])&&t.symbol==e)return t;return null},_getElementInfoByAtomicNumber:function(e){var t=Kekule.chemicalElementsData[e-1];if(t&&t.atomicNumber==e)return t;if(!t||t.atomicNumber<e){for(var r=e,n=Kekule.chemicalElementsData.length;r<n;++r)if((t=Kekule.chemicalElementsData[r])&&t.atomicNumber==e)return t;for(r=e-2;r>=0;--r)if((t=Kekule.chemicalElementsData[r])&&t.atomicNumber==e)return t}else{for(r=e-2;r>=0;--r)if((t=Kekule.chemicalElementsData[r])&&t.atomicNumber==e)return t;for(r=e,n=Kekule.chemicalElementsData.length;r<n;++r)if((t=Kekule.chemicalElementsData[r])&&t.atomicNumber==e)return t}return null},getElementInfo:function(e){return"number"==typeof e?Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(e):Kekule.ChemicalElementsDataUtil._getElementInfoBySymbol(e)},getElementProp:function(e,t){var r=Kekule.ChemicalElementsDataUtil.getElementInfo(e);return r?r[t]:null},getAtomicNumber:function(e){var t=Kekule.ChemicalElementsDataUtil._getElementInfoBySymbol(e);return t?t.atomicNumber:0},getElementSymbol:function(e){var t=Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(e);return t?t.symbol:null},isAtomicNumberAvailable:function(e){return!!Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(e)},isElementSymbolAvailable:function(e){return Kekule.ChemicalElementsDataUtil.getAtomicNumber(e)>0},getAllElementSymbols:function(){for(var e=[],t=Kekule.chemicalElementsData,r=0,n=t.length;r<n;++r)e.push(t[r].symbol);return e}},Kekule.IsotopeAliasUtil={enableAlias:!0,ALIAS:[{alias:"D",atomicNumber:1,massNumber:2}],getAllAlias:function(){return Kekule.IsotopeAliasUtil.enableAlias?Kekule.IsotopeAliasUtil.ALIAS:[]},getAliasInfo:function(e){for(var t=Kekule.IsotopeAliasUtil.getAllAlias(),r=0,n=t.length;r<n;++r){var o=t[r];if(o.alias===e)return Object.extend(Kekule.IsotopesDataUtil.getIsotopeInfo(o.atomicNumber,o.massNumber),{isotopeAlias:e})}return null},getAlias:function(e,t){for(var r=Kekule.IsotopeAliasUtil.getAllAlias(),n=0,o=r.length;n<o;++n){var i=r[n];if(i.atomicNumber===e&&i.massNumber===t)return i.alias}return null}},Kekule.IsotopesDataUtil={_getElementItem:function(e){var t;if(t="number"==typeof e?e:Kekule.ChemicalElementsDataUtil.getAtomicNumber(e),!(o=Kekule.isotopesData[t-1])||o.atomicNumber!=t)for(var r=0,n=Kekule.isotopesData.length;r<n;++r){var o;if((o=Kekule.isotopesData[r])&&o.atomicNumber==t)break}return o},getAllIsotopeInfos:function(e){var t=Kekule.IsotopesDataUtil._getElementItem(e);return t?t.isotopes:null},getIsotopeInfo:function(e,t){var r=null;if(!t&&"string"==typeof e&&(r=Kekule.IsotopeAliasUtil.getAliasInfo(e)))return r;var n=Kekule.IsotopesDataUtil._getElementItem(e),o=n.isotopes;if(o){if(t)for(var i=0,a=o.length;i<a&&(!(r=o[i])||r.massNumber!=t);++i);else 1===o.length&&(r=o[0]);if(r)return r.elementSymbol=n.elementSymbol,r}return null},getIsotopeInfoById:function(e){var t=Kekule.IsotopesDataUtil.getIsotopeIdDetail(e);return Kekule.IsotopesDataUtil.getIsotopeInfo(t.symbol,t.massNumber)},isMassNumberAvailable:function(e,t){return!!Kekule.IsotopesDataUtil.getIsotopeInfo(e,t)},getIsotopeId:function(e,t){if("string"!=typeof e||t){var r=Kekule.IsotopeAliasUtil.getAlias(e,t);if(r)return r}else{if(Kekule.IsotopeAliasUtil.getAliasInfo(e))return e}var n=Kekule.ChemicalElementsDataUtil.getElementInfo(e);if(!n)return null;var o=n.symbol;return t?o+t.toString():o},getIsotopeIdDetail:function(e){if(!e)return null;for(var t="",r="",n=0,o=e.length;n<o;++n){var i=e.charAt(n);i>="0"&&i<="9"?r+=i:t+=i}var a=r?parseInt(r,10):null,s={symbol:t};return a&&(s.massNumber=a),s},isIsotopeIdAvailable:function(e){var t=Kekule.IsotopesDataUtil.getIsotopeIdDetail(e);if(Kekule.IsotopeAliasUtil.getAliasInfo(e))return!0;var r=Kekule.ChemicalElementsDataUtil.isElementSymbolAvailable(t.symbol);r&&t.massNum&&(r=!!Kekule.IsotopesDataUtil.getIsotopeInfo(t.symbol,t.massNum));return r}},Kekule.AtomTypeDataUtil={getAtomTypeInfoObj:function(e){var t;t="number"==typeof e?e:Kekule.ChemicalElementsDataUtil.getAtomicNumber(e);var r=Kekule.structGenAtomTypesData[t-1];if(r&&r.atomicNumber==t)return r;for(var n=0,o=Kekule.structGenAtomTypesData.length;n<o;++n)if((r=Kekule.structGenAtomTypesData[n])&&r.atomicNumber==t)return r;return null},getAllAtomTypes:function(e){var t=Kekule.AtomTypeDataUtil.getAtomTypeInfoObj(e);return t?t.atomTypes:null},getAtomTypeFromId:function(e,t){if(!e){for(var r="",n=0,o=t.length;n<o;++n){var i=t.chatAt(n);(i<"0"||i>"9")&&(r+=i)}e=r}if(e){var a=Kekule.AtomTypeDataUtil.getAllAtomTypes(e);for(n=0,o=a.length;n<o;++n)if(a[n].id==t)return a[n]}return null}},function(e){e||(e=Kekule.$jsRoot),Kekule.EmscriptenUtils={DEF_MODULE_NAME:"Module",_createdModules:{},_getActualModule:function(r){return e[r||t.DEF_MODULE_NAME]},isSupported:function(e){return void 0!==t._getActualModule(e)},getRootModule:function(e,r){var n=t._createdModules[e];if(n)return n;var o=t._getActualModule(e);return n=o,"function"==typeof o&&(n=o(r)),n&&(t._createdModules[e]=n),n},setRootModule:function(e,r){t._createdModules[e]=r},getModuleObj:function(e){return"object"==typeof e?e:t.getRootModule(e)},getMember:function(e,r){return(t.getModuleObj(r)||{})[e]},getClassCtor:function(e,r){return(t.getModuleObj(r)||{})[e]},cwrap:function(e,r,n,o){var i=t.getModuleObj(o);return i&&i.cwrap&&i.cwrap(e,r,n)},initModule:function(e,r,n){e||(e=Kekule.$jsRoot.document);var o=r.moduleName,i=r.moduleInitEventName,a=r.moduleInitCallbackName,s=r.creationOptions,l=function(e){n&&n(e)};if(t.isModuleReady(o))l();else try{if(i&&e&&Kekule.X){var u=function(){l(),Kekule.X.Event.removeListener(e,i,u)};Kekule.X.Event.addListener(e,i,u)}else a&&(Kekule.$jsRoot[a]=function(){l()});o&&t.getRootModule(o,s)}catch(e){throw l(e),e}},isModuleReady:function(e){return!!t._createdModules[e]},ensureModuleReady:function(e,r,n){return t.initModule(e,r,n)},loadScript:function(e,r,n,o){n||(n=Kekule.$jsRoot.document);var i=function(e){e?r(e):t.initModule(n,o,r)};if(Kekule.environment.isNode)try{var a=Kekule.environment.nodeRequire(e);o.moduleName&&(Kekule.$jsRoot[o.moduleName]=a),i()}catch(e){throw i(e),e}else Kekule.ScriptFileUtils.appendScriptFile(n,e,i)}};var t=Kekule.EmscriptenUtils}(this),Kekule.LOCAL_RES=!0,Kekule.Localization.setCurrModule("extra.openbabel"),Kekule.Localization.addResource("en","ErrorMsg",{OpenBabel:{CHEM_NODE_TYPE_NOT_SUITABLE:"Unsuitable node type",CHEM_CONNECTOR_TYPE_NOT_SUITABLE:"Unsuitable connector type",ONLY_STR_INPUT_DATA_ALLOWED:"Input data must be text",ONLY_STR_OUTPUT_DATA_ALLOWED:"Output data must be text",FAIL_TO_GENERATE_3D_STRUCTURE:"Fail to generate 3D structure coordinates"}}),function(){var e=Kekule.EmscriptenUtils,t={usingModulaize:!0,moduleName:"OpenBabelModule",moduleInitEventName:"OpenBabel.Initialized",moduleInitCallbackName:"__$openBabelInitialized$__"};Kekule.OpenBabel={_autoEnabled:!0,_module:null,SCRIPT_FILE:"openbabel.js",_enableFuncs:[],BondOrder:{SINGLE:1,DOUBLE:2,TRIPLE:3,EXPLICIT_AROMATIC:5},getObInitOptions:function(){return t},getModule:function(){return r._module||(r._module=e.getRootModule(t.moduleName,t)),r._module},setModule:function(n){r._module=n,e.setRootModule(t.moduleName,n)},getMember:function(t){return e.getMember(t,r.getModule())},getClassCtor:function(t){return e.getClassCtor(t,r.getModule())},isScriptLoaded:function(){return e.isSupported(t.moduleName)},isModuleReady:function(){return e.isModuleReady(t.moduleName)},enable:function(e){r.isScriptLoaded()?(r._enableAllFunctions(),e&&e()):r.loadObScript(Kekule.$jsRoot.document,function(t){t||r._enableAllFunctions(),e&&e(t)})},_enableAllFunctions:function(){if(r.isModuleReady())for(var e=r._enableFuncs,t=0,n=e.length;t<n;++t){var o=e[t];o&&o()}}};var r=Kekule.OpenBabel;Kekule._registerAfterLoadSysProc(function(){r._autoEnabled&&r.isScriptLoaded()&&e.ensureModuleReady(Kekule.$jsRoot.document,t,r._enableAllFunctions)}),Kekule.OpenBabel.getObPath=function(){var e=Kekule.environment.getEnvVar("openbabel.path");e||(e=Kekule.isUsingMinJs()?"extra/":"_extras/OpenBabel/",e=Kekule.getScriptPath()+e);return e},Kekule.OpenBabel.getObScriptUrl=function(){var e=Kekule.environment.getEnvVar("openbabel.scriptSrc");e||(e=Kekule.OpenBabel.getObPath()+Kekule.OpenBabel.SCRIPT_FILE,Kekule.isUsingMinJs()||(e+=".dev"));return e},Kekule.OpenBabel.loadObScript=function(n,o){n||(n=Kekule.$jsRoot.document);var i=function(e){r._obScriptLoadedBySelf=!e,o&&o(e)};if(r._obScriptLoadedBySelf||r.isScriptLoaded())i();else{var a=Kekule.OpenBabel.getObScriptUrl();e.loadScript(a,i,n,t)}},Kekule.OpenBabel.AdaptUtils={DEF_ATOM_ID_PREFIX:"A",DEF_BOND_ID_PREFIX:"B",DEF_MOL_ID_PREFIX:"M",wrapCFuncs:function(){if(!Kekule.OpenBabel._funcInited){Object.extend(Kekule.OpenBabel,{}),Kekule.OpenBabel._funcInited=!0}},isAvailable:function(){return void 0!==r.getClassCtor("ObBaseHelper")},obObjToKekule:function(e,t,r){var n=Kekule.OpenBabel.AdaptUtils,o=Kekule.ObjUtils.getPrototypeOf(e).constructor.name;return("OBReaction"===o?n.obReactionToKekule:"OBMol"===o?n.obMolToKekule:n.obBaseToKekule)(e,t,r)},kObjToOB:function(e,t,r){var n=Kekule.OpenBabel.AdaptUtils,o=e instanceof Kekule.Reaction?n.kReactionToOB:e instanceof Kekule.StructureFragment?n.kMolToOB:null;return o?o(e,t,r):null},kIdToOB:function(e){var t=parseInt(e,10);return t||null},obBondOrderToKekule:function(e){return e<=3?e:e===Kekule.OpenBabel.BondOrder.EXPLICIT_AROMATIC?Kekule.BondOrder.EXPLICIT_AROMATIC:Kekule.BondOrder.OTHER},kBondOrderToOB:function(e){return e<=3?e:e===Kekule.BondOrder.EXPLICIT_AROMATIC?Kekule.OpenBabel.BondOrder.EXPLICIT_AROMATIC:0},obBaseToKekule:function(e,t){var n=t||new Kekule.ChemObject,o=new(r.getClassCtor("ObBaseHelper"))(e),i=o.getTitle();i&&n.setName&&n.setName(i);var a=o.getDataSize();if(a)for(var s=n.getInfo(!0),l=0;l<a;++l){var u=o.getDataAt(l);if(u){var c=u.GetAttribute(),d=u.GetValue();c&&d&&(s[c]=d)}}return n},kChemObjToOB:function(e,t){var n=t||new(r.getClassCtor("OBBase"));e.getName&&n.SetTitle&&n.SetTitle(e.getName());var o=e.getInfo();if(o)for(var i=Kekule.ObjUtils.getOwnedFieldNames(o),a=0,s=i.length;a<s;++a){var l=i[a],u=o[l];if(l&&u){var c=new(r.getClassCtor("OBPairData"));c.SetAttribute(""+l),c.SetValue(""+u),n.SetData(c)}}},obAtomToKekule:function(e,t,r){var n=e.GetAtomicNum(),o=n?Kekule.Atom:Kekule.SubGroup;!t||t instanceof o||Kekule.Error(Kekule.$L("ErrorMsg.OpenBabel.CHEM_NODE_TYPE_NOT_SUITABLE"));var i,a=t||new o;return Kekule.OpenBabel.AdaptUtils.obBaseToKekule(e,a),i=e.GetId(),Kekule.ObjUtils.notUnset(i)&&a.setId(Kekule.OpenBabel.AdaptUtils.DEF_ATOM_ID_PREFIX+i),(i=e.GetFormalCharge())&&a.setCharge(i),(i=e.GetSpinMultiplicity())&&a.setRadical(i),i={x:e.GetX(),y:e.GetY()},r===Kekule.CoordMode.COORD3D&&(i.z=e.GetZ()),a.setAbsCoordOfMode?a.setAbsCoordOfMode(i,r):a.setCoordOfMode(i,r),a instanceof Kekule.Atom&&(n&&a.setAtomicNumber(n),(i=e.GetIsotope())&&a.setMassNumber(i),(i=e.GetHyb())&&a.setHybridizationType(i)),a},kChemNodeToOB:function(e,t,n){var o,i=t||new(r.getClassCtor("OBAtom"));if(o=e.getId(),o=Kekule.OpenBabel.AdaptUtils.kIdToOB(o),Kekule.ObjUtils.notUnset(o)&&i.SetId(o),o=e.getCharge())if(parseInt(o,10)===parseFloat(o))i.SetFormalCharge(o);else{var a=parseInt(o,10),s=o-a;i.SetFormalCharge(a),i.SetPartialCharge(s)}if((o=e.getRadical())&&i.SetSpinMultiplicity(o),o=e.getAbsCoordOfMode?e.getAbsCoordOfMode(n):e.getCoordOfMode(n),i.SetVector(o.x||0,o.y||0,o.z||0),e instanceof Kekule.Atom){i.SetAtomicNum(e.getAtomicNumber()),(o=e.getMassNumber())&&i.SetIsotope(o),(o=e.getHybridizationType())&&i.SetHyb(o);var l=e.getImplicitHydrogenCount();l&&i.SetImplicitHCount(l)}else i.SetAtomicNum(0);return i},obBondToKekule:function(e,t,r){var n,o=t||new Kekule.Bond;Kekule.OpenBabel.AdaptUtils.obBaseToKekule(e,o),n=e.GetId(),Kekule.ObjUtils.notUnset(n)&&o.setId(Kekule.OpenBabel.AdaptUtils.DEF_BOND_ID_PREFIX+n),n=e.GetBondOrder(),o.setBondOrder(Kekule.OpenBabel.AdaptUtils.obBondOrderToKekule(n));var i=Kekule.BondStereo;if(n=e.IsWedge()?i.UP:e.IsHash()?i.DOWN:e.IsWedgeOrHash()?i.UP_OR_DOWN:e.IsCisOrTrans()?i.CIS_OR_TRANS:e.IsDoubleBondGeometry()?i.E_Z_BY_COORDINATES:i.NONE,o.setStereo(n),console.log(e.GetFlags().toString(2)),r){n=null;for(var a=[e.GetBeginAtom(),e.GetEndAtom()],s=0,l=a.length;s<l;++s){var u=a[s];u&&(n=r.get(u.GetIdx()))&&o.appendConnectedObj(n)}}return o},kBondToOB:function(e,t,n,o){var i=t||new(r.getClassCtor("OBBond"));Kekule.OpenBabel.AdaptUtils.kChemObjToOB(e,i),c=Kekule.OpenBabel.AdaptUtils.kIdToOB(e.getId()),Kekule.ObjUtils.notUnset(c)&&i.SetId(c),(c=e.getBondOrder())&&(i.SetBondOrder(Kekule.OpenBabel.AdaptUtils.kBondOrderToOB(c)),c===Kekule.BondOrder.EXPLICIT_AROMATIC&&i.SetAromatic()),i.UnsetHash(),i.UnsetWedge(),i.UnsetUp(),i.UnsetDown(),i.UnsetAromatic();var a=Kekule.BondStereo;if((c=e.getStereo())===a.UP?i.SetWedge(!0):c===a.DOWN?i.SetHash(!0):c===a.UP_OR_DOWN&&i.SetWedgeOrHash(!0),n)for(var s=0,l=0,u=e.getConnectedObjCount();l<u;++l){var c,d=e.getConnectedObjAt(l);if(d&&d instanceof Kekule.ChemStructureNode)if((c=n.get(d))&&(0===s?i.SetBegin(c):1===s&&i.SetEnd(c),++s),c.AddBond&&c.AddBond(i),s>1)break}return i},obMolToKekule:function(e,t,n){var o=t,i=new(r.getClassCtor("ObConversionWrapper"));try{i.setOutFormat("","mol");var a=i.writeString(e,!1),s=Kekule.IO.loadFormatData(a,Kekule.IO.DataFormat.MOL);o?o.assign(s):o=s,s.finalize()}finally{i.delete()}if(Kekule.OpenBabel.AdaptUtils.obBaseToKekule(e,o),n){var l;if((l=e.NumAtoms())===o.getNodeCount())for(var u=0;u<l;++u){var c=e.GetAtom(u+1);if(c){var d=o.getNodeAt(u);d&&n.set(c,d)}}if((l=e.NumBonds())===o.getConnectorCount())for(u=0;u<l;++u){var h=e.GetBond(u);if(h){var f=o.getConnectorAt(u);f&&n.set(h,f)}}}return o},kMolToOB:function(e,t,n){var o=e.nodesHasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D,i=t||new(r.getClassCtor("OBMol"));t&&i.Clear();for(var a=new Kekule.MapEx(!1),s=e.getFlattenedShadowFragment(!0),l=0,u=s.getNodeCount();l<u;++l){var c=s.getNodeAt(l);if(c){var d=Kekule.OpenBabel.AdaptUtils.kChemNodeToOB(c,i.NewAtom(),o);if(d&&(a.set(c,d),n)){var h=e.getFlatternedShadowSourceObj(c);n.set(h,d)}}}for(l=0,u=s.getConnectorCount();l<u;++l){var f=s.getConnectorAt(l);if(f&&f instanceof Kekule.Bond){var m=Kekule.OpenBabel.AdaptUtils.kBondToOB(f,i.NewBond(),a,i);if(n&&m){var g=e.getFlatternedShadowSourceObj(f);n.set(g,m)}}}return a.finalize(),a=null,i},obReactionToKekule:function(e,t,r){var n=t||new Kekule.Reaction;n.clearAll(),Kekule.OpenBabel.AdaptUtils.obBaseToKekule(e,n),n.setDirection(e.IsReversible()?Kekule.ReactionDirection.BIDIRECTION:Kekule.ReactionDirection.FORWARD);for(var o=0,i=e.NumReactants();o<i;++o){var a=e.GetReactant(o),s=Kekule.OpenBabel.AdaptUtils.obMolToKekule(a,null,r);n.appendReactant(s),r&&r.set(a,s)}for(o=0,i=e.NumProducts();o<i;++o){a=e.GetProduct(o),s=Kekule.OpenBabel.AdaptUtils.obMolToKekule(a,null,r);n.appendProduct(s),r&&r.set(a,s)}return n},kReactionToOB:function(e,t,n){var o=t||new(r.getClassCtor("OBReaction"));o.Clear(),Kekule.OpenBabel.AdaptUtils.kChemObjToOB(e,o);var i=!1,a=e.getDirection();a===Kekule.ReactionDirection.BIDIRECTION?o.SetReversible(!0):a===Kekule.ReactionDirection.BACKWARD&&(i=!0);for(var s=0,l=e.getReactantCount();s<l;++s){if(c=e.getReactantAt(s)){var u=Kekule.OpenBabel.AdaptUtils.kMolToOB(c,null,n);i?o.AddProduct(u):o.AddReactant(u),n&&n.set(c,u)}}for(s=0,l=e.getProductCount();s<l;++s){var c;if(c=e.getProductAt(s)){u=Kekule.OpenBabel.AdaptUtils.kMolToOB(c,null,n);i?o.AddReactant(u):o.AddProduct(u),n&&n.set(c,u)}}}}}(),function(){Kekule.EmscriptenUtils;var e=Kekule.OpenBabel,t=Kekule.OpenBabel.AdaptUtils;Kekule.IO.OpenBabelReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.OpenBabelReader",initialize:function(e){this.tryApplySuper("initialize")},finalize:function(){this.tryApplySuper("finalize")},getFormatTargetObClassName:function(e){return e.getTypeName().toLowerCase().indexOf("reaction")>=0?"OBReaction":"OBMol"},doReadData:function(r,n,o){this._obConv=new(e.getClassCtor("ObConversionWrapper"));try{var i=Kekule.IO.DataFormatsManager.getFormatInfo(o),a=(i.mimeType,i.fileExts[0],this._obConv.setInFormatId(i.id)),s=this.getFormatTargetObClassName(a);try{var l=[];this._obConv.setInStr(r);for(var u=new(e.getClassCtor(s)),c=this._obConv.readFromInput(u);c;){if(u.NumAtoms&&u.NumAtoms()>0){var d=t.obObjToKekule(u);l.push(d)}c=this._obConv.readFromInput(u)}var h=l.length;if(h<=0)return null;if(1===h)return l[0];for(var f=new Kekule.ChemObjList,m=0;m<h;++m)f.append(l[m]);return f}finally{u&&(u.delete(),u=null)}}finally{this._obConv&&(this._obConv.delete(),this._obConv=null)}}}),Kekule.IO.OpenBabelWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.OpenBabelWriter",initialize:function(e){this.tryApplySuper("initialize",[e])},finalize:function(){this.tryApplySuper("finalize")},doWriteData:function(r,n,o){this._obConv=new(e.getClassCtor("ObConversionWrapper"));try{var i=Kekule.IO.DataFormatsManager.getFormatInfo(o);i.mimeType,i.fileExts[0];this._obConv.setOutFormatId(i.id);for(var a=Kekule.ChemStructureUtils.getChildStructureObjs(r,!0),s=0,l=a.length;s<l;++s){var u=a[s];if(u){var c=t.kObjToOB(u);if(c)try{if(!this._obConv.writeToOutput(c))break}finally{c.delete(),c=null}}}return this._obConv.getOutStr()}finally{this._obConv&&this._obConv.delete()}},isAllowedObj:function(e){var t=Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES;return Kekule.ObjUtils.isInstanceOf(e,t)}}),Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES=[Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace],Kekule.OpenBabel.IORegHelper=Class.create({listFormatInfo:function(e,t){for(var r=[],n=("in"===e?t.getSupportedInputFormatsStr("\n"):t.getSupportedOutputFormatsStr("\n")).split("\n"),o=0,i=n.length;o<i;++o){var a=n[o],s=a.indexOf("--");if(s>0){var l=a.substring(0,s).trim(),u=t.getFormatInfoById(l);r.push(u)}}return r},registerByInfos:function(e,t){for(var r=Kekule.IO.DataFormatsManager,n=[],o=0,i=e.length;o<i;++o){var a=e[o],s=a.id,l=a.mimeType;if((u=r.findFormatId(l))&&(u=r.findFormatId(null,s)),!u)var u=r.register(s,l,s,Kekule.IO.ChemDataType.UNKNOWN,a.description,a.description,{specificationUrl:a.specificationURL}).id;("in"===t?Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(u):Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(u))||Kekule.ArrayUtils.pushUnique(n,u)}n.length&&("in"===t?Kekule.IO.ChemDataReaderManager.register("openbabel",Kekule.IO.OpenBabelReader,n):Kekule.IO.ChemDataWriterManager.register("openbabel",Kekule.IO.OpenBabelWriter,Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES,n))},registerAll:function(){var t=new(e.getClassCtor("ObConversionWrapper"));try{var r=this.listFormatInfo("in",t);this.registerByInfos(r,"in");r=this.listFormatInfo("out",t);this.registerByInfos(r,"out")}finally{t.delete()}}}),Kekule.IO.registerAllOpenBabelFormats=function(){if(Kekule.OpenBabel.AdaptUtils.isAvailable())try{var e=new Kekule.OpenBabel.IORegHelper;e.registerAll()}finally{e=null}},Kekule.OpenBabel._enableFuncs.push(Kekule.IO.registerAllOpenBabelFormats),Kekule.IO.enableOpenBabelFormats=function(){Kekule.OpenBabel.AdaptUtils.isAvailable()?Kekule.IO.registerAllOpenBabelFormats():Kekule.OpenBabel.loadObScript(document,function(){Kekule.IO.registerAllOpenBabelFormats()})}}(),function(){"use strict";Kekule.EmscriptenUtils;var e=Kekule.OpenBabel,t=Kekule.OpenBabel.AdaptUtils;Kekule.OpenBabel.StructUtils={generate2DStructure:function(e,r,n){var o=r||{};try{var i=new Kekule.MapEx,a=new Kekule.MapEx,s=t.kObjToOB(e,null,i);if(Kekule.OpenBabel.StructUtils._gen2DByObOperation(s,o)||(s.delete(),s=null),s){if(e=t.obObjToKekule(s,null,a),n)for(var l=i.getKeys(),u=0,c=l.length;u<c;++u){var d=l[u],h=i.get(d);if(h){var f=a.get(h);f&&n.set(d,f)}}}else Kekule.raise(Kekule.$L("ErrorMsg.OpenBabel.FAIL_TO_GENERATE_3D_STRUCTURE"))}finally{s&&s.delete()}return e},generate3DStructure:function(r,n,o){var i,a=n||{},s=a.forceField;try{var l=new Kekule.MapEx,u=new Kekule.MapEx,c=t.kObjToOB(r,null,l);if(a.applyFFCalc){var d=new(e.getClassCtor("OB3DGenWrapper"));try{d.generate3DStructure(c,s||"")}finally{d.delete()}}else Kekule.OpenBabel.StructUtils._gen3DByObOperation(c,a)||(c.delete(),c=null);if(c){if(i=t.obObjToKekule(c,null,u),o)for(var h=l.getKeys(),f=0,m=h.length;f<m;++f){var g=h[f],p=l.get(g);if(p){var C=u.get(p);C&&o.set(g,C)}}}else Kekule.raise(Kekule.$L("ErrorMsg.OpenBabel.FAIL_TO_GENERATE_3D_STRUCTURE"))}finally{c&&c.delete()}return i},_gen2DByObOperation:function(t,r){var n=!1,o=e.getModule().OBOp.FindType("Gen2D");if(o){var i=""+r.speed||"";o.Do(t,i),n=!0}return n},_gen3DByObOperation:function(t,r){var n=""+r.speed||"",o=!1,i=e.getModule().OBOp.FindType("Gen3D");return i&&(i.Do(t,n),o=!0),o}},Kekule.Calculator&&(Kekule.Calculator.ObStructureBaseGenerator=Class.create(Kekule.Calculator.AbstractStructureGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructureBaseGenerator",isWorkerShared:function(){return!0},getGeneratorCoordMode:function(){return 2===this.getOutputDimension()?Kekule.CoordMode.COORD2D:Kekule.CoordMode.COORD3D},getOutputDimension:function(){return 3},_getInputMsgName:function(){return"gen"+this.getOutputDimension()+"D"},_getOutputMsgName:function(){return"output"+this.getOutputDimension()+"D"},getObInitOptions:function(){return Kekule.OpenBabel.getObInitOptions()},getForceField:function(){return this.getOptions().forceField},doGetWorker:function(){var e=this.tryApplySuper("doGetWorker");return e||(e=Kekule.Calculator.ObStructureBaseGenerator._worker),e},_requestImportingObScriptInWorker:function(){var e=Kekule.OpenBabel.getObScriptUrl();this.importWorkerScriptFile(e)},createWorker:function(){var e=this.tryApplySuper("createWorker");if(e){this._requestImportingObScriptInWorker();var t=this.getObInitOptions();this.postWorkerMessage({type:"obInit",usingModulaize:t.usingModulaize,moduleName:t.moduleName,initCallbackName:t.moduleInitCallbackName}),Kekule.Calculator.ObStructureBaseGenerator._worker=e}return e},getWorkerScriptFile:function(){return Kekule.OpenBabel.getObPath()+"kekule.worker.obStructureGenerator.js"},doReactWorkerMessage:function(e,t){if(this.tryApplySuper("doReactWorkerMessage",[e,t]),e.type===this._getOutputMsgName()){var r=e.molData;if(r){var n=Kekule.IO.loadMimeData(r,"chemical/x-mdl-molfile"),o=this.getChildObjMap();if(o){for(var i=this.getSourceMol().getFlattenedShadowFragment(!0),a=0,s=i.getNodeCount();a<s;++a)o.set(i.getNodeAt(a),n.getNodeAt(a));for(a=0,s=i.getConnectorCount();a<s;++a)o.set(i.getConnectorAt(a),n.getConnectorAt(a))}this.setGeneratedMol(n),this.done()}}},workerStartCalc:function(e){this._requestImportingObScriptInWorker();var t=this.getSourceMol().getFlattenedShadowFragment(!0),r=Kekule.IO.saveMimeData(t,"chemical/x-mdl-molfile"),n=Object.extend(this.getOptions(),{type:this._getInputMsgName(),molData:r});this.postWorkerMessage(n)},doExecuteSync:function(e){if(Kekule.OpenBabel){var t=this;Kekule.OpenBabel.loadObScript(null,function(){var r;try{var n=(2===t.getOutputDimension()?Kekule.OpenBabel.StructUtils.generate2DStructure:Kekule.OpenBabel.StructUtils.generate3DStructure)(t.getSourceMol(),t.getOptions());t.setGeneratedMol(n)}catch(e){throw r=e,e}return r||t.done(),e&&e(r),!0})}else Kekule.error(Kekule.$L("ErrorMsg.MODULE_NOT_LOADED").format("OpenBabel"));return!1}}),Kekule.Calculator.ObStructure3DGenerator=Class.create(Kekule.Calculator.ObStructureBaseGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructure3DGenerator",getOutputDimension:function(){return 3}}),Kekule.Calculator.ObStructure2DGenerator=Class.create(Kekule.Calculator.ObStructureBaseGenerator,{CLASS_NAME:"Kekule.Calculator.ObStructure2DGenerator",getOutputDimension:function(){return 2}}),Kekule.Calculator.ServiceManager.register(Kekule.Calculator.Services.GEN3D,Kekule.Calculator.ObStructure3DGenerator,"openbabel",10),Kekule.Calculator.ServiceManager.register(Kekule.Calculator.Services.GEN2D,Kekule.Calculator.ObStructure2DGenerator,"openbabel",10))}(),function(e){"use strict";var t=Kekule.EmscriptenUtils,r={usingModulaize:!0,moduleName:"IndigoModule",moduleInitEventName:"Indigo.Initialized",moduleInitCallbackName:"__$indigoInitialized$__",indigoAdaptFuncName:"CreateIndigo"};Kekule.Indigo={_autoEnabled:!0,_module:null,_indigo:null,SCRIPT_FILE:"indigo.js",HELPER_SCRIPT_FILE:"indigoAdapter.js",_enableFuncs:[],isScriptLoaded:function(){return t.isSupported(r.moduleName)&&void 0!==e[r.indigoAdaptFuncName]},getIndigoInitOptions:function(){return r},getModule:function(){return n._module||(n._module=t.getRootModule(r.moduleName,r)),n._module},setModule:function(e){n._module=e,t.setRootModule(r.moduleName,e)},getIndigo:function(){if(!n._indigo){var t=n.getModule();t&&(n._indigo=e[r.indigoAdaptFuncName](t))}return n._indigo},getClassCtor:function(e){return t.getClassCtor(e,n.getModule())},isAvailable:function(){return n.getModule()&&n.getIndigo()},enable:function(e){n.isScriptLoaded()?(n._enableAllFunctions(),e&&e()):n.loadIndigoScript(Kekule.$jsRoot.document,function(t){t||n._enableAllFunctions(),e&&e(t)})},_enableAllFunctions:function(){if(t.isModuleReady(r.moduleName))for(var e=n._enableFuncs,o=0,i=e.length;o<i;++o){var a=e[o];a&&a()}}},Kekule.Indigo.getIndigoPath=function(){var e=Kekule.environment.getEnvVar("indigo.path");e||(e=Kekule.isUsingMinJs()?"extra/":"_extras/Indigo/",e=Kekule.getScriptPath()+e);return e},Kekule.Indigo.getIndigoScriptUrl=function(){var e=Kekule.environment.getEnvVar("indigo.scriptSrc");e||(e=n.getIndigoPath()+n.SCRIPT_FILE,Kekule.isUsingMinJs()||(e+=".dev"));return e},Kekule.Indigo.getIndigoHelperScriptUrl=function(){return n.getIndigoPath()+n.HELPER_SCRIPT_FILE},Kekule.Indigo.loadIndigoScript=function(e,o){e||(e=Kekule.$jsRoot.document);var i=function(e){n._scriptLoadedBySelf=!e,e||Kekule.Indigo.getIndigo(),o&&o(e)};if(n._scriptLoadedBySelf||n.isScriptLoaded())i();else{var a=n.getIndigoScriptUrl();t.loadScript(a,function(t){t?i(t):Kekule.ScriptFileUtils.appendScriptFiles(e,[n.getIndigoHelperScriptUrl()],i)},e,r)}};var n=Kekule.Indigo;Kekule.Indigo.AdaptUtils={iMolToKekule:function(e){var t=n.getIndigo(),r=t.molfile(e);return t.free(e),Kekule.IO.loadFormatData(r,Kekule.IO.DataFormat.MOL)},kMolToIndigo:function(e){var t=n.getIndigo(),r=Kekule.IO.saveFormatData(e,Kekule.IO.DataFormat.MOL);return t.loadMoleculeFromString(r)}},Kekule._registerAfterLoadSysProc(function(){n._autoEnabled&&n.isScriptLoaded()&&t.ensureModuleReady(Kekule.$jsRoot.document,r,n._enableAllFunctions)})}(this),function(){"use strict";Kekule.EmscriptenUtils;var e=Kekule.Indigo;Kekule.IO.IndigoReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.IndigoReader",doReadData:function(t,r,n,o){var i=e.getIndigo(),a=i.loadMoleculeFromString(t);if(a>=0){if(n===Kekule.IO.DataFormat.SMILES){!o||o.autoLayout||Kekule.ObjUtils.isUnset(o.autoLayout);0}var s=i.molfile(a);return i.free(a),Kekule.IO.loadFormatData(s,Kekule.IO.DataFormat.MOL)}return null}}),Kekule.IO.registerAllIndigoFormats=function(){e.isAvailable()&&Kekule.IO.ChemDataReaderManager.register("Indigo-smiles",Kekule.IO.IndigoReader,Kekule.IO.DataFormat.SMILES)},Kekule.IO.enableIndigoFormats=function(){e.isAvailable()?Kekule.IO.registerAllIndigoFormats():e.loadIndigoScript(document,function(){Kekule.IO.registerAllIndigoFormats()})},e._enableFuncs.push(Kekule.IO.registerAllIndigoFormats)}(),function(){"use strict";var e=Kekule.Indigo;Kekule.Indigo.StructUtils={generate2DStructure:function(t,r,n){var o=e.getIndigo(),i=e.AdaptUtils.kMolToIndigo(t);return o.setOption("smart-layout","true"),o.layout(i),e.AdaptUtils.iMolToKekule(i)}},Kekule.Calculator&&(Kekule.Calculator.IndigoStructure2DGenerator=Class.create(Kekule.Calculator.AbstractStructureGenerator,{CLASS_NAME:"Kekule.Calculator.IndigoStructure2DGenerator",execute:function(e){var t,r;try{r=this.executeSync(e)}catch(e){t=e}t?(Kekule.error(t),this.error(t)):r&&(t?this.error(t):this.done())},doExecuteSync:function(e){if(Kekule.Indigo){var t=this;Kekule.Indigo.loadIndigoScript(null,function(){var r;try{var n=Kekule.Indigo.StructUtils.generate2DStructure(t.getSourceMol(),t.getOptions());t.setGeneratedMol(n)}catch(e){r=e}r||t.done(),e&&e(r)})}else Kekule.error(Kekule.$L("ErrorMsg.MODULE_NOT_LOADED").format("Indigo"));return!1}}),Kekule.Calculator.ServiceManager.register(Kekule.Calculator.Services.GEN2D,Kekule.Calculator.IndigoStructure2DGenerator,"indigo",0))}(),void 0!==Kekule&&Kekule._loaded(),"undefined"!=typeof module)try{module.exports={Class:Class,ClassEx:ClassEx,ObjectEx:ObjectEx,DataType:DataType,Kekule:Kekule}}catch(e){}